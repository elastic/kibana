{"attributes":{"name":"Installation of Custom Shim Databases v101.0.0","rule_id":"c5ce48a6-7f57-4ee8-9313-3d0024caee10:101.0.0","rule_version":"101.0.0","stack_version_min":"8.5.0","stack_version_max":"8.7.0","description":"Identifies the installation of custom Application Compatibility Shim databases. This Windows functionality has been abused by attackers to stealthily gain persistence and arbitrary code execution in legitimate Windows processes.","risk_score":47,"severity":"medium","license":"Elastic License v2","author":["Elastic"],"from":"now-9m","tags":["Elastic","Host","Windows","Threat Detection","Persistence"],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1546","name":"Event Triggered Execution","reference":"https://attack.mitre.org/techniques/T1546/","subtechnique":[{"id":"T1546.011","name":"Application Shimming","reference":"https://attack.mitre.org/techniques/T1546/011/"}]}]}],"language":"eql","query":"sequence by process.entity_id with maxspan = 5m\n  [process where event.type == \"start\" and\n    not (process.name : \"sdbinst.exe\" and process.parent.name : \"msiexec.exe\")]\n  [registry where event.type in (\"creation\", \"change\") and\n    registry.path : \"HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\AppCompatFlags\\\\Custom\\\\*.sdb\"]\n","type":"eql","index":["logs-endpoint.events.*","winlogbeat-*","logs-windows.*"],"required_fields":[{"ecs":true,"name":"event.type","type":"keyword"},{"ecs":true,"name":"process.entity_id","type":"keyword"},{"ecs":true,"name":"process.name","type":"keyword"},{"ecs":true,"name":"process.parent.name","type":"keyword"},{"ecs":true,"name":"registry.path","type":"keyword"}]},"id":"c5ce48a6-7f57-4ee8-9313-3d0024caee10:101.0.0","type":"security-rule"}