{"attributes":{"rule_id":"0f93cb9a-1931-48c2-8cd0-f173fd3e5283","versions":[{"name":"Potential LSASS Memory Dump via PssCaptureSnapShot v101.0.0","rule_version":"101.0.0","stack_version_min":"8.5.0","stack_version_max":"8.7.0","description":"Identifies suspicious access to an LSASS handle via PssCaptureSnapShot where two successive process accesses are performed by the same process and target two different instances of LSASS. This may indicate an attempt to evade detection and dump LSASS memory for credential access.","risk_score":73,"severity":"high","license":"Elastic License v2","note":"","timestamp_override":"event.ingested","author":["Elastic"],"from":"now-9m","references":["https://www.matteomalvica.com/blog/2019/12/02/win-defender-atp-cred-bypass/","https://twitter.com/sbousseaden/status/1280619931516747777?lang=en"],"tags":["Elastic","Host","Windows","Threat Detection","Credential Access","Sysmon Only"],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1003","name":"OS Credential Dumping","reference":"https://attack.mitre.org/techniques/T1003/","subtechnique":[{"id":"T1003.001","name":"LSASS Memory","reference":"https://attack.mitre.org/techniques/T1003/001/"}]}]}],"query":"event.category:process and event.code:10 and\n winlog.event_data.TargetImage:(\"C:\\\\Windows\\\\system32\\\\lsass.exe\" or\n                                 \"c:\\\\Windows\\\\system32\\\\lsass.exe\" or\n                                 \"c:\\\\Windows\\\\System32\\\\lsass.exe\")\n","threshold":{"field":["process.entity_id"],"value":2,"cardinality":[{"field":"winlog.event_data.TargetProcessId","value":2}]},"type":"threshold","index":["winlogbeat-*","logs-windows.*"],"language":"kuery","required_fields":[{"ecs":true,"name":"event.category","type":"keyword"},{"ecs":true,"name":"event.code","type":"keyword"},{"ecs":false,"name":"winlog.event_data.TargetImage","type":"unknown"}],"setup":"This is meant to run only on datasources using Elastic Agent 7.14+ since versions prior to that will be missing the threshold\nrule cardinality feature."},{"name":"Potential LSASS Memory Dump via PssCaptureSnapShot v101.0.1","rule_version":"101.0.1","stack_version_min":"8.5.0","stack_version_max":"8.7.0","description":"Identifies suspicious access to an LSASS handle via PssCaptureSnapShot where two successive process accesses are performed by the same process and target two different instances of LSASS. This may indicate an attempt to evade detection and dump LSASS memory for credential access.","risk_score":73,"severity":"high","license":"Elastic License v2","note":"","timestamp_override":"event.ingested","author":["Elastic"],"from":"now-9m","references":["https://www.matteomalvica.com/blog/2019/12/02/win-defender-atp-cred-bypass/","https://twitter.com/sbousseaden/status/1280619931516747777?lang=en"],"tags":["Elastic","Host","Windows","Threat Detection","Credential Access","Sysmon Only"],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1003","name":"OS Credential Dumping","reference":"https://attack.mitre.org/techniques/T1003/","subtechnique":[{"id":"T1003.001","name":"LSASS Memory","reference":"https://attack.mitre.org/techniques/T1003/001/"}]}]}],"query":"event.category:process and event.code:10 and\n winlog.event_data.TargetImage:(\"C:\\\\Windows\\\\system32\\\\lsass.exe\" or\n                                 \"c:\\\\Windows\\\\system32\\\\lsass.exe\" or\n                                 \"c:\\\\Windows\\\\System32\\\\lsass.exe\")\n","threshold":{"field":["process.entity_id"],"value":2,"cardinality":[{"field":"winlog.event_data.TargetProcessId","value":2}]},"type":"threshold","index":["winlogbeat-*","logs-windows.*"],"language":"kuery","required_fields":[{"ecs":true,"name":"event.category","type":"keyword"},{"ecs":true,"name":"event.code","type":"keyword"},{"ecs":false,"name":"winlog.event_data.TargetImage","type":"unknown"}],"setup":"This is meant to run only on datasources using Elastic Agent 7.14+ since versions prior to that will be missing the threshold\nrule cardinality feature."},{"name":"Potential LSASS Memory Dump via PssCaptureSnapShot v101.0.2","rule_version":"101.0.2","stack_version_min":"8.5.0","stack_version_max":"8.7.0","description":"Identifies suspicious access to an LSASS handle via PssCaptureSnapShot where two successive process accesses are performed by the same process and target two different instances of LSASS. This may indicate an attempt to evade detection and dump LSASS memory for credential access.","risk_score":73,"severity":"high","license":"Elastic License v2","note":"","timestamp_override":"event.ingested","author":["Elastic"],"from":"now-9m","references":["https://www.matteomalvica.com/blog/2019/12/02/win-defender-atp-cred-bypass/","https://twitter.com/sbousseaden/status/1280619931516747777?lang=en"],"tags":["Elastic","Host","Windows","Threat Detection","Credential Access","Sysmon Only"],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1003","name":"OS Credential Dumping","reference":"https://attack.mitre.org/techniques/T1003/","subtechnique":[{"id":"T1003.001","name":"LSASS Memory","reference":"https://attack.mitre.org/techniques/T1003/001/"}]}]}],"query":"event.category:process and event.code:10 and\n winlog.event_data.TargetImage:(\"C:\\\\Windows\\\\system32\\\\lsass.exe\" or\n                                 \"c:\\\\Windows\\\\system32\\\\lsass.exe\" or\n                                 \"c:\\\\Windows\\\\System32\\\\lsass.exe\")\n","threshold":{"field":["process.entity_id"],"value":2,"cardinality":[{"field":"winlog.event_data.TargetProcessId","value":2}]},"type":"threshold","index":["winlogbeat-*","logs-windows.*"],"language":"kuery","required_fields":[{"ecs":true,"name":"event.category","type":"keyword"},{"ecs":true,"name":"event.code","type":"keyword"},{"ecs":false,"name":"winlog.event_data.TargetImage","type":"unknown"}],"setup":"This is meant to run only on datasources using Elastic Agent 7.14+ since versions prior to that will be missing the threshold\nrule cardinality feature."}]},"id":"0f93cb9a-1931-48c2-8cd0-f173fd3e5283","type":"security-rule"}