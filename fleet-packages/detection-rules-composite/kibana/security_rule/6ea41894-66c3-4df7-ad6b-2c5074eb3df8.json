{"attributes":{"rule_id":"6ea41894-66c3-4df7-ad6b-2c5074eb3df8","versions":[{"name":"Potential Windows Error Manager Masquerading v100.0.0","rule_version":"100.0.0","stack_version_min":"8.5.0","stack_version_max":"8.7.0","description":"Identifies suspicious instances of the Windows Error Reporting process (WerFault.exe or Wermgr.exe) with matching command-line and process executable values performing outgoing network connections. This may be indicative of a masquerading attempt to evade suspicious child process behavior detections.","risk_score":47,"severity":"medium","license":"Elastic License v2","author":["Elastic"],"false_positives":["Legit Application Crash with rare Werfault commandline value"],"from":"now-9m","references":["https://twitter.com/SBousseaden/status/1235533224337641473","https://www.hexacorn.com/blog/2019/09/20/werfault-command-line-switches-v0-1/","https://app.any.run/tasks/26051d84-b68e-4afb-8a9a-76921a271b81/"],"tags":["Elastic","Host","Windows","Threat Detection","Defense Evasion"],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1036","name":"Masquerading","reference":"https://attack.mitre.org/techniques/T1036/"}]}],"language":"eql","query":"sequence by host.id, process.entity_id with maxspan = 5s\n  [process where event.type:\"start\" and process.name : (\"wermgr.exe\", \"WerFault.exe\") and process.args_count == 1]\n  [network where process.name : (\"wermgr.exe\", \"WerFault.exe\") and network.protocol != \"dns\" and\n    network.direction : (\"outgoing\", \"egress\") and destination.ip !=\"::1\" and destination.ip !=\"127.0.0.1\"\n  ]\n","type":"eql","index":["winlogbeat-*","logs-endpoint.events.*","logs-windows.*"],"required_fields":[{"ecs":true,"name":"destination.ip","type":"ip"},{"ecs":true,"name":"event.type","type":"keyword"},{"ecs":true,"name":"host.id","type":"keyword"},{"ecs":true,"name":"network.direction","type":"keyword"},{"ecs":true,"name":"network.protocol","type":"keyword"},{"ecs":true,"name":"process.args_count","type":"long"},{"ecs":true,"name":"process.entity_id","type":"keyword"},{"ecs":true,"name":"process.name","type":"keyword"}]},{"name":"Potential Windows Error Manager Masquerading v100.0.1","rule_version":"100.0.1","stack_version_min":"8.5.0","stack_version_max":"8.7.0","description":"Identifies suspicious instances of the Windows Error Reporting process (WerFault.exe or Wermgr.exe) with matching command-line and process executable values performing outgoing network connections. This may be indicative of a masquerading attempt to evade suspicious child process behavior detections.","risk_score":47,"severity":"medium","license":"Elastic License v2","author":["Elastic"],"false_positives":["Legit Application Crash with rare Werfault commandline value"],"from":"now-9m","references":["https://twitter.com/SBousseaden/status/1235533224337641473","https://www.hexacorn.com/blog/2019/09/20/werfault-command-line-switches-v0-1/","https://app.any.run/tasks/26051d84-b68e-4afb-8a9a-76921a271b81/"],"tags":["Elastic","Host","Windows","Threat Detection","Defense Evasion"],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1036","name":"Masquerading","reference":"https://attack.mitre.org/techniques/T1036/"}]}],"language":"eql","query":"sequence by host.id, process.entity_id with maxspan = 5s\n  [process where event.type:\"start\" and process.name : (\"wermgr.exe\", \"WerFault.exe\") and process.args_count == 1]\n  [network where process.name : (\"wermgr.exe\", \"WerFault.exe\") and network.protocol != \"dns\" and\n    network.direction : (\"outgoing\", \"egress\") and destination.ip !=\"::1\" and destination.ip !=\"127.0.0.1\"\n  ]\n","type":"eql","index":["winlogbeat-*","logs-endpoint.events.*","logs-windows.*"],"required_fields":[{"ecs":true,"name":"destination.ip","type":"ip"},{"ecs":true,"name":"event.type","type":"keyword"},{"ecs":true,"name":"host.id","type":"keyword"},{"ecs":true,"name":"network.direction","type":"keyword"},{"ecs":true,"name":"network.protocol","type":"keyword"},{"ecs":true,"name":"process.args_count","type":"long"},{"ecs":true,"name":"process.entity_id","type":"keyword"},{"ecs":true,"name":"process.name","type":"keyword"}]},{"name":"Potential Windows Error Manager Masquerading v100.0.2","rule_version":"100.0.2","stack_version_min":"8.5.0","stack_version_max":"8.7.0","description":"Identifies suspicious instances of the Windows Error Reporting process (WerFault.exe or Wermgr.exe) with matching command-line and process executable values performing outgoing network connections. This may be indicative of a masquerading attempt to evade suspicious child process behavior detections.","risk_score":47,"severity":"medium","license":"Elastic License v2","author":["Elastic"],"false_positives":["Legit Application Crash with rare Werfault commandline value"],"from":"now-9m","references":["https://twitter.com/SBousseaden/status/1235533224337641473","https://www.hexacorn.com/blog/2019/09/20/werfault-command-line-switches-v0-1/","https://app.any.run/tasks/26051d84-b68e-4afb-8a9a-76921a271b81/"],"tags":["Elastic","Host","Windows","Threat Detection","Defense Evasion"],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1036","name":"Masquerading","reference":"https://attack.mitre.org/techniques/T1036/"}]}],"language":"eql","query":"sequence by host.id, process.entity_id with maxspan = 5s\n  [process where event.type:\"start\" and process.name : (\"wermgr.exe\", \"WerFault.exe\") and process.args_count == 1]\n  [network where process.name : (\"wermgr.exe\", \"WerFault.exe\") and network.protocol != \"dns\" and\n    network.direction : (\"outgoing\", \"egress\") and destination.ip !=\"::1\" and destination.ip !=\"127.0.0.1\"\n  ]\n","type":"eql","index":["winlogbeat-*","logs-endpoint.events.*","logs-windows.*"],"required_fields":[{"ecs":true,"name":"destination.ip","type":"ip"},{"ecs":true,"name":"event.type","type":"keyword"},{"ecs":true,"name":"host.id","type":"keyword"},{"ecs":true,"name":"network.direction","type":"keyword"},{"ecs":true,"name":"network.protocol","type":"keyword"},{"ecs":true,"name":"process.args_count","type":"long"},{"ecs":true,"name":"process.entity_id","type":"keyword"},{"ecs":true,"name":"process.name","type":"keyword"}]}]},"id":"6ea41894-66c3-4df7-ad6b-2c5074eb3df8","type":"security-rule"}