[[timelion-math]]
=== Use mathematical functions

Create a Timelion visualization for inbound and outbound network traffic.

[[timelion-math-before-you-begin]]
==== Before you begin

In this tutorial, you'll continue to use the time series data from https://www.elastic.co/guide/en/beats/metricbeat/current/index.html[Metricbeat].

[[math-add-timelion-visualization]]
==== Add a Timelion visualization to the sheet

. Click *Visualize*.

. On the *Visualizations* page, click *Create new visualization*.

. On the *New Visualization* window, click *Timelion*.
+
Youâ€™ll notice that the query bar has been replaced with the default `.es(*)` expression. 

image::images/timelion-math01.png[]
{nbsp}

. To start tracking the inbound and outbound network traffic, enter the following in the *Timelion Expression* field:

[source,text]
----------------------------------
.es(index=metricbeat*, timefield=@timestamp, metric=max:system.network.in.bytes)
----------------------------------

image::images/timelion-math02.png[]
{nbsp}

. Plot the change in values over time:

[source,text]
----------------------------------
.es(index=metricbeat*, timefield=@timestamp, metric=max:system.network.in.bytes).derivative()
----------------------------------

image::images/timelion-math03.png[]
{nbsp}

. Add a similar calculation for `system.network.out.bytes`:

[source,text]
----------------------------------
.es(index=metricbeat*, timefield=@timestamp, metric=max:system.network.in.bytes).derivative(), .es(index=metricbeat*, timefield=@timestamp, metric=max:system.network.out.bytes).derivative().multiply(-1)
----------------------------------

image::images/timelion-math04.png[]
{nbsp}

. To make this visualization a bit easier to consume, convert the series from bytes to megabytes:

[source,text]
----------------------------------
.es(index=metricbeat*, timefield=@timestamp, metric=max:system.network.in.bytes).derivative().divide(1048576), .es(index=metricbeat*, timefield=@timestamp, metric=max:system.network.out.bytes).derivative().multiply(-1).divide(1048576)
----------------------------------

image::images/timelion-math05.png[]
{nbsp}

. Update your visualization:

[source,text]
----------------------------------
.es(index=metricbeat*, timefield=@timestamp, metric=max:system.network.in.bytes).derivative().divide(1048576).lines(fill=2, width=1).color(green).label("Inbound traffic").title("Network traffic (MB/s)"), .es(index=metricbeat*, timefield=@timestamp, metric=max:system.network.out.bytes).derivative().multiply(-1).divide(1048576).lines(fill=2, width=1).color(blue).label("Outbound traffic").legend(columns=2, position=nw)
----------------------------------

image::images/timelion-math06.png[]
{nbsp}
