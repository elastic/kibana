[[timelion-create]]
== Creating time series visualizations

We will be using time series data from https://www.elastic.co/guide/en/beats/metricbeat/current/index.html[Metricbeat] to walk you through a number of functions that Timelion offers. To get started, download Metricbeat and follow the https://www.elastic.co/downloads/beats/metricbeat[instructions here] to start ingesting the data locally.

To get started, we will create a visualization that compares the average percentage of CPU time spent in user space to the previous hour. In order to do so, we’ll need to create two expressions. One with the current average of `system.cpu.user.pct` and another with the average from the previous hour.

First we'll need to define an `index`, `timefield` and `metric` in our first expression. Go ahead and enter the below expression into the Timelion query bar.

[source,text]
----------------------------------
.es(index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct')
----------------------------------

image::images/timelion-create01.png[]


Now we want to add a another series with data from the previous hour for comparison. To do so, we'll have to add an `offset` arguement to our `.es()` function. `offset` will offset the series retrieval by a date expression. For our case, we want to look at the previous hour and will be using the date expression `-1h`. Using a comma to separate our two series, enter the following expression into the Timelion query bar:

[source,text]
----------------------------------
.es(index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct'), .es(offset=-1h,index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct')
----------------------------------

image::images/timelion-create02.png[]


It’s a bit hard to differentiate the two series. Let's customize the labels in order to easily distinguish which series is which. You  can always append the `.label()` function to any expression to add a custom label. Enter the below expression into the Timelion query bar to customize your labels:
[source,text]
----------------------------------
.es(offset=-1h,index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct').label('last hour'), .es(index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct').label('current hour')
----------------------------------

image::images/timelion-create03.png[]

Save the entire Timelion sheet as _Metricbeat Example_. As a best practice, you should be saving any significant changes made to this sheet as you progress through the tutorial.