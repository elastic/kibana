[[timelion-create]]
== Creating time series visualizations

We will use https://www.elastic.co/downloads/beats/metricbeat[Metricbeat] to walk you through a number of functions timelion offers. If you do not want to index this data locally, feel free to test out these same queries in our *[demo environment]*.

Let’s compare the average percentage of CPU time spent in user space to the previous hour. In order to do so, we’ll need to create two expressions. One with the current average of *system.cpu.user.pct* and another with the average from the previous hour.

To start - define a index, timefield and metric in the Timelion querybar

[source,text]
----------------------------------
.es(index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct')
----------------------------------

image::images/timelion-create01.png[]

Now we want to add a another series with an offset of the previous hour. To do so, add the below expression to the Timelion querybar

[source,text]
----------------------------------
.es(offset=-1h,index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct')
----------------------------------

The final expression should look like the following:

[source,text]
----------------------------------
.es(index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct'), .es(offset=-1h,index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct')
----------------------------------

image::images/timelion-create02.png[]

It’s hard to differentiate the two, add the following option to label each series accordingly.

[source,text]
----------------------------------
.es(offset=-1h,index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct').label('last hour'), .es(index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct').label('current hour')
----------------------------------

image::images/timelion-create03.png[]