<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Optimize model context | Kibana Guide | Elastic</title>
<meta class="elastic" name="content" content="Optimize model context | Kibana Guide">

<link rel="home" href="index.html" title="Kibana Guide"/>
<link rel="up" href="playground.html" title="Playground"/>
<link rel="prev" href="playground.html" title="Playground"/>
<link rel="next" href="playground-query.html" title="View and modify queries"/>
<meta class="elastic" name="product_version" content=""/>
<meta class="elastic" name="product_name" content=""/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="playground.html">« Playground</a>
</span>
<span class="next">
<a href="playground-query.html">View and modify queries »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Kibana Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="playground.html">Playground</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Optimize model context</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/master/docs/playground/playground-context.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="chapter xpack">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="playground-context"></a>Optimize model context</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/master/docs/playground/playground-context.asciidoc">edit</a></div>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in technical preview and may be changed or removed in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>Context is the information you provide to the LLM, to optimize the relevance of your query results.
Without additional context, an LLM will generate results solely based on its training data.
In Playground, this additional context is the information contained in your Elasticsearch indices.</p>
<p>There are a few ways to optimize this context for better results.
Some adjustments can be made directly in the Playground UI.
Others require refining your indexing strategy, and potentially reindexing your data.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Currently you can only select <span class="strong strong"><strong>one field</strong></span> to be provided as context to the LLM.</p>
</div>
</div>
<div class="position-relative"><h2><a id="playground-context-ui"></a>Edit context in UI</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/master/docs/playground/playground-context.asciidoc">edit</a></div>
<p>Use the <span class="strong strong"><strong>Edit context</strong></span> button in the Playground UI to adjust the number of documents and fields sent to the LLM.</p>
<p>If you&#8217;re hitting context length limits, try the following:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Limit the number of documents retrieved
</li>
<li class="listitem">
Pick a field with less tokens, reducing the context length
</li>
</ul>
</div>
<div class="position-relative"><h2><a id="playground-context-index"></a>Other context optimizations</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/master/docs/playground/playground-context.asciidoc">edit</a></div>
<p>This section covers additional context optimizations that you won&#8217;t be able to make directly in the UI.</p>
<div class="position-relative"><h3><a id="playground-context-index-chunking"></a>Chunking large documents</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/master/docs/playground/playground-context.asciidoc">edit</a></div>
<p>If you&#8217;re working with large fields, you may need to adjust your indexing strategy.
Consider breaking your documents into smaller chunks, such as sentences or paragraphs.</p>
<p>If you don&#8217;t yet have a chunking strategy, start by chunking your documents into passages.</p>
<p>Otherwise, consider updating your chunking strategy, for example, from sentence based to paragraph based chunking.</p>
<p>Refer to the following Python notebooks for examples of how to chunk your documents:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/elastic/elasticsearch-labs/tree/main/notebooks/ingestion-and-chunking/json-chunking-ingest.ipynb" class="ulink" target="_top">JSON documents</a>
</li>
<li class="listitem">
<a href="https://github.com/elastic/elasticsearch-labs/tree/main/notebooks/ingestion-and-chunking/pdf-chunking-ingest.ipynb" class="ulink" target="_top">PDF document</a>
</li>
<li class="listitem">
<a href="https://github.com/elastic/elasticsearch-labs/tree/main/notebooks/ingestion-and-chunking/website-chunking-ingest.ipynb" class="ulink" target="_top">Website content</a>
</li>
</ul>
</div>
<div class="position-relative"><h3><a id="playground-context-balance"></a>Balancing cost/latency and result quality</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/master/docs/playground/playground-context.asciidoc">edit</a></div>
<p>Here are some general recommendations for balancing cost/latency and result quality with different context sizes:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Optimize context length
</span>
</dt>
<dd>
Determine the optimal context length through empirical testing.
Start with a baseline and adjust incrementally to find a balance that optimizes both response quality and system performance.
</dd>
<dt>
<span class="term">
Implement token pruning for ELSER model
</span>
</dt>
<dd>
<p>
If you&#8217;re using our ELSER model, consider implementing token pruning to reduce the number of tokens sent to the model.
Refer to these relevant blog posts:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://www.elastic.co/search-labs/blog/introducing-elser-v2-part-2" class="ulink" target="_top">Optimizing retrieval with ELSER v2</a>
</li>
<li class="listitem">
<a href="https://www.elastic.co/search-labs/blog/text-expansion-pruning" class="ulink" target="_top">Improving text expansion performance using token pruning</a>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Monitor and adjust
</span>
</dt>
<dd>
Continuously monitor the effects of context size changes on performance and adjust as necessary.
</dd>
</dl>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="playground.html">« Playground</a>
</span>
<span class="next">
<a href="playground-query.html">View and modify queries »</a>
</span>
</div>
</body>
</html>
