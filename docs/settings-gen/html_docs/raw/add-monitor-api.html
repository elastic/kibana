<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Add Monitor API | Kibana Guide | Elastic</title>
<meta class="elastic" name="content" content="Add Monitor API | Kibana Guide">

<link rel="home" href="index.html" title="Kibana Guide"/>
<link rel="up" href="synthetics-apis.html" title="Synthetics APIs"/>
<link rel="prev" href="synthetics-apis.html" title="Synthetics APIs"/>
<link rel="next" href="update-monitor-api.html" title="Update Monitor API"/>
<meta class="elastic" name="product_version" content=""/>
<meta class="elastic" name="product_name" content=""/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>
</head>
<body>
<div class="navheader">
<span class="prev">
<a href="synthetics-apis.html">« Synthetics APIs</a>
</span>
<span class="next">
<a href="update-monitor-api.html">Update Monitor API »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Kibana Guide</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="api.html">REST API</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="synthetics-apis.html">Synthetics APIs</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Add Monitor API</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/master/docs/api/synthetics/monitors/add-monitor-api.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h2 class="title"><a id="add-monitor-api"></a>Add Monitor API</h2><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/master/docs/api/synthetics/monitors/add-monitor-api.asciidoc">edit</a></div>
</div></div></div>

<p>Creates a new monitor with the specified attributes. A monitor can be one of the following types: HTTP, TCP, ICMP, or Browser. The required and default fields may vary based on the monitor type.</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_request"></a>Request</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/master/docs/api/synthetics/monitors/add-monitor-api.asciidoc">edit</a></div>
</div></div></div>
<p><code class="literal">POST &lt;kibana host&gt;:&lt;port&gt;/api/synthetics/monitors</code></p>
<p><code class="literal">POST &lt;kibana host&gt;:&lt;port&gt;/s/&lt;space_id&gt;/api/synthetics/monitors</code></p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h3 class="title"><a id="_prerequisites_4"></a>Prerequisites</h3><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/master/docs/api/synthetics/monitors/add-monitor-api.asciidoc">edit</a></div>
</div></div></div>
<p>You must have <code class="literal">all</code> privileges for the <span class="strong strong"><strong>Synthetics</strong></span> feature in the <span class="strong strong"><strong>Observability</strong></span> section of the
<a class="xref" href="kibana-privileges.html#kibana-feature-privileges" title="Feature privileges">Kibana feature privileges</a>.</p>
<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="monitor-request-body"></a>Request Body</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/master/docs/api/synthetics/monitors/add-monitor-api.asciidoc">edit</a></div>
</div></div></div>
<p>The request body should contain the attributes of the monitor you want to create. The required and default fields differ depending on the monitor type:</p>
<p><span class="strong strong"><strong>Common Fields</strong></span>:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">name</code>
</span>
</dt>
<dd>
(Required, string): The monitor&#8217;s name.
</dd>
<dt>
<span class="term">
<code class="literal">type</code>
</span>
</dt>
<dd>
(Required, string): The monitor type (e.g., <code class="literal">http</code> , <code class="literal">tcp</code> , <code class="literal">icmp</code> or <code class="literal">browser</code>).
</dd>
<dt>
<span class="term">
<code class="literal">schedule</code>
</span>
</dt>
<dd>
<p>
(Optional, number): The monitor&#8217;s schedule in minutes. Supported values are <code class="literal">1</code>, <code class="literal">3</code>, <code class="literal">5</code>, <code class="literal">10</code>, <code class="literal">15</code>, <code class="literal">30</code>, <code class="literal">60</code>, <code class="literal">120</code> and <code class="literal">240</code>.
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The default value is <code class="literal">3</code> minutes for HTTP, TCP, and ICMP monitors.
</li>
<li class="listitem">
The default value is <code class="literal">10</code> minutes for Browser monitors.
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">locations</code>
</span>
</dt>
<dd>
<p>
(<a href="https://github.com/elastic/synthetics/blob/main/src/locations/public-locations.ts#L28-L37" class="ulink" target="_top"><code class="literal">Array&lt;SyntheticsLocationsType&gt;</code></a>)
Where to deploy the monitor. Monitors can be deployed in multiple locations so that you can detect differences in availability and response times across those locations.
</p>
<p>To list available locations you can:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Run the {locations-command}[<code class="literal">elastic-synthetics locations</code>] command
with the deployment&#8217;s Kibana URL.
</li>
<li class="listitem">
Go to <span class="strong strong"><strong>Synthetics</strong></span> &#8594; <span class="strong strong"><strong>Management</strong></span> and click <span class="strong strong"><strong>Create monitor</strong></span>.
Locations will be listed in <em>Locations</em>.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">private_locations</code> (<code class="literal">Array&lt;string&gt;</code>)
</span>
</dt>
<dd>
<p>
The <a href="https://www.elastic.co/guide/en/observability/current/synthetics-private-location.html" class="ulink" target="_top">Private Locations</a> to which the monitors will be deployed. These Private Locations refer to locations hosted and managed by you, whereas
<code class="literal">locations</code> are hosted by Elastic. You can specify a Private Location using the location&#8217;s name.
</p>
<p>To list available Private Locations you can:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Run the {locations-command}[<code class="literal">elastic-synthetics locations</code>] command
with the deployment&#8217;s Kibana URL.
</li>
<li class="listitem">
Go to <span class="strong strong"><strong>Synthetics</strong></span> &#8594; <span class="strong strong"><strong>Settings</strong></span> and click <span class="strong strong"><strong>Private locations</strong></span>.
Private Locations will be listed in the table.
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You may provide <code class="literal">locations</code> or <code class="literal">private_locations</code>, or both. At least one is required.</p>
</div>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">enabled</code>
</span>
</dt>
<dd>
(Optional, boolean, default: true): Whether the monitor is enabled.
</dd>
<dt>
<span class="term">
<code class="literal">tags</code>
</span>
</dt>
<dd>
(Optional, array of strings): An array of tags.
</dd>
<dt>
<span class="term">
<code class="literal">alert</code>
</span>
</dt>
<dd>
(Optional, object, default: <code class="literal">{ status: { enabled: true }, tls: { enabled: true } }</code>): Alert configuration.
</dd>
<dt>
<span class="term">
<code class="literal">service.name</code>
</span>
</dt>
<dd>
(Optional, string): The APM service name.
</dd>
<dt>
<span class="term">
<code class="literal">timeout</code>
</span>
</dt>
<dd>
(Optional, number, default: 16): The monitor timeout in seconds, monitor will fail if it doesn&#8217;t complete within this time.
</dd>
<dt>
<span class="term">
<code class="literal">namespace</code>
</span>
</dt>
<dd>
(Optional, string, default: "default"): The namespace field should be lowercase and not contain spaces. The namespace must not include any of the following characters: <code class="literal">*</code>, <code class="literal">\</code>, <code class="literal">/</code>, <code class="literal">?</code>, <code class="literal">"</code>, <code class="literal">&lt;</code>, <code class="literal">&gt;</code>, <code class="literal">|</code>, whitespace, <code class="literal">,</code>, <code class="literal">#</code>, <code class="literal">:</code>, or <code class="literal">-</code>
</dd>
<dt>
<span class="term">
<code class="literal">params</code>
</span>
</dt>
<dd>
(Optional, string): Monitor parameters.
</dd>
<dt>
<span class="term">
<code class="literal">retest_on_failure</code>
</span>
</dt>
<dd>
(Optional, boolean, default: true): Enable or disable retesting when a monitor fails. By default, monitors are automatically retested if the monitor goes from "up" to "down". If the result of the retest is also "down", an error will be created, and if configured, an alert sent. Then the monitor will resume running according to the defined schedule. Using <code class="literal">retest_on_failure</code> can reduce noise related to transient problems.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>HTTP Monitor Fields</strong></span>:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">url</code>
</span>
</dt>
<dd>
(Required, string): URL to monitor.
</dd>
<dt>
<span class="term">
<code class="literal">ssl</code>
</span>
</dt>
<dd>
(Optional, object): The TLS/SSL connection settings for use with the HTTPS endpoint. If you don&#8217;t specify settings, the system defaults are used. See <a href="https://www.elastic.co/guide/en/beats/heartbeat/current/configuration-ssl.html" class="ulink" target="_top">https://www.elastic.co/guide/en/beats/heartbeat/current/configuration-ssl.html</a> for full SSL Options.
</dd>
<dt>
<span class="term">
<code class="literal">max_redirects</code>
</span>
</dt>
<dd>
(Optional, number, default: 0): The maximum number of redirects to follow.
</dd>
<dt>
<span class="term">
<code class="literal">mode</code>
</span>
</dt>
<dd>
<p>
(Optional, string, default: "any"): The mode of the monitor. Can be "all" or "any". If you’re using a DNS-load balancer and want to ping every IP address for the specified hostname, you should use all.
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">any</code>: The monitor pings only one IP address for a hostname.
</li>
<li class="listitem">
<code class="literal">all</code>: The monitor pings all resolvable IPs for a hostname.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">ipv4</code>
</span>
</dt>
<dd>
(Optional, boolean, default: true): Whether to ping using the ipv4 protocol.
</dd>
<dt>
<span class="term">
<code class="literal">ipv6</code>
</span>
</dt>
<dd>
(Optional, boolean, default: true): Whether to ping using the ipv6 protocol.
</dd>
<dt>
<span class="term">
<code class="literal">username</code>
</span>
</dt>
<dd>
(Optional, string): The username for authenticating with the server. The credentials are passed with the request.
</dd>
<dt>
<span class="term">
<code class="literal">password</code>
</span>
</dt>
<dd>
(Optional, string): The password for authenticating with the server. The credentials are passed with the request.
</dd>
<dt>
<span class="term">
<code class="literal">proxy_headers</code>
</span>
</dt>
<dd>
(Optional, object): Additional headers to send to proxies during CONNECT requests.
</dd>
<dt>
<span class="term">
<code class="literal">proxy_url</code>
</span>
</dt>
<dd>
(Optional, string): The URL of the proxy to use for this monitor.
</dd>
<dt>
<span class="term">
<code class="literal">response</code>
</span>
</dt>
<dd>
(Optional, object): Controls the indexing of the HTTP response body contents to the <code class="literal">http.response.body.contents</code> field.
</dd>
<dt>
<span class="term">
<code class="literal">response.include_body</code>
</span>
</dt>
<dd>
<p>
(Optional, boolean, default: true): Controls the indexing of the HTTP response body contents to the <code class="literal">http.response.body.contents</code> field.
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><code class="literal">include_body</code> ("on_error" | "never" | "always", default: on_error) Set response.include_body to one of the options listed below.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">on_error</code>: Include the body if an error is encountered during the check. This is the default.
</li>
<li class="listitem">
<code class="literal">never</code>: Never include the body.
</li>
<li class="listitem">
<code class="literal">always</code>: Always include the body.
</li>
</ul>
</div>
</li>
<li class="listitem">
<code class="literal">include_body_max_bytes</code> (Optional, number, default: 1024) Set <code class="literal">response.include_body_max_bytes</code> to control the maximum size of the stored body contents.
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">check</code>
</span>
</dt>
<dd>
<p>
(Optional, object): The check request settings.
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p><code class="literal">request</code> An optional request to send to the remote host. Under check.request, specify these options:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">method</code> ("HEAD" | "GET" | "POST" | "OPTIONS"): The HTTP method to use.
</li>
<li class="listitem">
<code class="literal">headers</code> (Optional, object): A dictionary of additional HTTP headers to send. By default Synthetics will set the User-Agent header to identify itself.
</li>
<li class="listitem">
<p><code class="literal">body</code> (Optional, string): Optional request body content.</p>
<pre class="literallayout">Example: This POSTs an x-www-form-urlencoded string to the endpoint</pre>

<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">{
  "check": {
    "request": {
      "method": "POST",
      "headers": {
        "Content-Type": "application/x-www-form-urlencoded"
      },
      "body": "name=first&amp;email=someemail%40someemailprovider.com"
    }
  }
}</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p><code class="literal">response</code> The expected response. Under <code class="literal">check.response</code>, specify these options:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">status</code>  A list of expected status codes. 4xx and 5xx codes are considered down by default. Other codes are considered up.
</li>
<li class="listitem">
<code class="literal">headers</code> (Optional, object): A dictionary of expected HTTP headers. If the header is not found, the check fails.
</li>
<li class="listitem">
<code class="literal">body.positive</code>: A list of regular expressions to match the body output. Only a single expression needs to match.
Example:
This monitor examines the response body for the strings foo or Foo:
</li>
<li class="listitem">
<code class="literal">body.negative</code>: A list of regular expressions to match the body output negatively. Return match failed if single expression matches. HTTP response bodies of up to 100MiB are supported.
This monitor examines match successfully if there is no bar or Bar at all, examines match failed if there is bar or Bar in the response body:
</li>
<li class="listitem">
<p><code class="literal">json</code>: A list of expressions executed against the body when parsed as JSON. Body sizes must be less than or equal to 100 MiB.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">description</code> (string): A description of the check.
</li>
<li class="listitem">
<code class="literal">expression</code> (string): The following configuration shows how to check the response using <a href="https://github.com/PaesslerAG/gval" class="ulink" target="_top">gval</a> expressions when the body contains JSON:
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>TCP Monitor Fields</strong></span>:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">host</code>
</span>
</dt>
<dd>
(Required, string): The host to monitor; it can be an IP address or a hostname. The host can include the port using a colon (e.g., "example.com:9200").
</dd>
<dt>
<span class="term">
<code class="literal">ssl</code>
</span>
</dt>
<dd>
(Optional, object): The TLS/SSL connection settings for use with the HTTPS endpoint. If you don&#8217;t specify settings, the system defaults are used. See <a href="https://www.elastic.co/guide/en/beats/heartbeat/current/configuration-ssl.html" class="ulink" target="_top">https://www.elastic.co/guide/en/beats/heartbeat/current/configuration-ssl.html</a> for full SSL Options.
</dd>
<dt>
<span class="term">
<code class="literal">check</code>
</span>
</dt>
<dd>
<p>
An optional payload string to send to the remote host and the expected answer. If no payload is specified, the endpoint is assumed to be available if the connection attempt was successful. If send is specified without receive, any response is accepted as OK. If receive is specified without send, no payload is sent, but the client expects to receive a payload in the form of a "hello message" or "banner" on connect.
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">send</code> (Optional, string): check.send: <em>Hello World</em>
</li>
<li class="listitem">
<code class="literal">receive</code> (Optional, string): check.receive: <em>Hello World</em>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">proxy_url</code>
</span>
</dt>
<dd>
(Optional, string): The URL of the SOCKS5 proxy to use when connecting to the server. The value must be a URL with a scheme of <code class="literal">socks5://</code>. If the SOCKS5 proxy server requires client authentication, then a username and password can be embedded in the URL. When using a proxy, hostnames are resolved on the proxy server instead of on the client. You can change this behavior by setting the <code class="literal">proxy_use_local_resolver</code> option.
</dd>
<dt>
<span class="term">
<code class="literal">proxy_use_local_resolver</code>
</span>
</dt>
<dd>
(Optional, boolean, default: false): A Boolean value that determines whether hostnames are resolved locally instead of being resolved on the proxy server. The default value is false, which means that name resolution occurs on the proxy server.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>ICMP Monitor Fields</strong></span>:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">host</code>
</span>
</dt>
<dd>
(Required, string): Host to ping.
</dd>
<dt>
<span class="term">
<code class="literal">wait</code>
</span>
</dt>
<dd>
(Optional, number, default: 1): Wait time in seconds.
</dd>
</dl>
</div>
<p><span class="strong strong"><strong>Browser Monitor Fields</strong></span>:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">inline_script</code>
</span>
</dt>
<dd>
(Required, string): The inline script.
</dd>
<dt>
<span class="term">
<code class="literal">screenshots</code>
</span>
</dt>
<dd>
(Optional, string, default: "on"): Screenshot option, either "on",  "off" or "only-on-failure".
</dd>
<dt>
<span class="term">
<code class="literal">synthetics_args</code>
</span>
</dt>
<dd>
(Optional, array): Synthetics agent CLI arguments.
</dd>
<dt>
<span class="term">
<code class="literal">ignore_https_errors</code>
</span>
</dt>
<dd>
(Optional, boolean, default: false): Whether to ignore HTTPS errors.
</dd>
<dt>
<span class="term">
<code class="literal">playwright_options</code>
</span>
</dt>
<dd>
(Optional, object): Playwright options.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<div class="position-relative"><h4 class="title"><a id="_examples_6"></a>Examples</h4><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/master/docs/api/synthetics/monitors/add-monitor-api.asciidoc">edit</a></div>
</div></div></div>
<p>Here are some examples of creating monitors of different types:</p>
<p><span class="strong strong"><strong>HTTP Monitor</strong></span>:
Create an HTTP monitor to check a website&#8217;s availability.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">POST /api/synthetics/monitors
{
  "type": "http",
  "name": "Website Availability",
  "url": "https://example.com",
  "tags": ["website", "availability"],
  "locations": ["united_kingdom"]
}</pre>
</div>
<p><span class="strong strong"><strong>TCP Monitor</strong></span>:
Create a TCP monitor to monitor a server&#8217;s availability.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">POST /api/synthetics/monitors
{
  "type": "tcp",
  "name": "Server Availability",
  "host": "example.com",
  "private_locations": ["my_private_location"]
}</pre>
</div>
<p><span class="strong strong"><strong>ICMP Monitor</strong></span>:
Create an ICMP monitor to perform ping checks.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">POST /api/synthetics/monitors
{
  "type": "icmp",
  "name": "Ping Test",
  "host": "example.com",
  "locations": ["united_kingdom"]
}</pre>
</div>
<p><span class="strong strong"><strong>Browser Monitor</strong></span>:
Create a Browser monitor to check a website.</p>
<div class="pre_wrapper lang-sh">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-sh">POST /api/synthetics/monitors
{
  "type": "browser",
  "name": "Example journey",
  "inline_script": "step('Go to https://google.com.co', () =&gt; page.goto('https://www.google.com'))",
  "locations": ["united_kingdom"]
}</pre>
</div>
</div>

</div>

</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="synthetics-apis.html">« Synthetics APIs</a>
</span>
<span class="next">
<a href="update-monitor-api.html">Update Monitor API »</a>
</span>
</div>
</body>
</html>
