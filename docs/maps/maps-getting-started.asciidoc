[role="xpack"]
[[maps-getting-started]]
== Create a map with multiple layers and data sources

++++
<titleabbrev>Create a multilayer map</titleabbrev>
++++

If you are new to creating maps in {kib}, this tutorial is a good place to start.
It guides you through the most common steps for plotting location data.

You'll learn to:

- Create a map with multiple layers and data sources
- Use symbols, colors, and labels to style data values
- Embed a map in a dashboard
- Search across panels in your dashboard

When you complete this tutorial, you’ll have a map that looks like this:

[role="screenshot"]
image::maps/images/sample_data_web_logs.png[]

[float]
=== Prerequisites

- If you don’t already have {kib}, set it up with https://www.elastic.co/cloud/elasticsearch-service/signup?baymax=docs-body&elektra=docs[our free trial].
- This tutorial uses the <<get-started, web logs sample data set>>. The sample data includes a [Logs] Total Requests and Bytes map, which you’ll create in this tutorial.
- You must have the correct privileges for creating a map. If you have insufficient privileges to create or save maps,
a read-only icon appears in the application header. For more information on granting access to {kib},
 see <<xpack-security-authorization,Granting access to {kib}>>.

[float]
[[maps-create]]
=== Step 1. Create a map

. Open the main menu, then click *Dashboard*.
. Click **Create dashboards**.
. Set the time range to *Last 7 days*.
. Click **Create new**
. Click **Maps**.

[float]
[[maps-add-choropleth-layer]]
=== Step 2. Add a choropleth layer

The first layer you'll add is a choropleth layer to shade world countries
by web log traffic. Darker will shades symbolize countries with more web log traffic,
and lighter shades will symbolize countries with less traffic.

. Click **Add layer**, and then click **Choropleth**.

. From the **Layer** dropdown menu, select **World Countries**.

. In **Statistics source**, set:
** **Index pattern** to **kibana_sample_data_logs**
** **Join field** to **geo.src**

. Click **Add layer**.

. In **Layer settings**, set:

** **Name** to `Total Requests by Country`
** **Opacity** to 50%

. Add a Tooltip field:

** Select **ISO 3166-1 alpha-2 code** and **name**
** Click **Add**

. In **Layer style**, set:

** **Fill color** to the grey color ramp
** **Border color** to white

. Click **Save & close**.
+
Your map now looks like this:
+
[role="screenshot"]
image::maps/images/gs_add_cloropeth_layer.png[]

[float]
[[maps-add-elasticsearch-layer]]
=== Step 3. Add layers for the Elasticsearch data

To avoid overwhelming the user with too much data at once, you'll add two layers
for the Elasticsearch data. The first layer will display individual documents
when the user zooms in the maps. The second layer will
display aggregated data when the user zooms out the map.

[float]
==== Add a layer for indiviual documents

This layer displays web log documents as points.
The layer is only visible when users zoom in past level 9.

. Click **Add layer**, and then click **Documents**.

. Set **Index pattern** to **kibana_sample_data_logs**.

. Click **Add layer**.

. Set **Scaling* to *Limits reulsts to 10000.*

. In **Layer settings**, set:
** **Name** to `Actual Requests`
** **Visibilty** to the range [9, 24]
** **Opacity** to 100%

. Add a tooltip field and select **timestamp**, **agent**, **bytes**, **clientip**, **host**, **machine.os**, **request**, and **response**.

. Set **Fill color** to **#2200ff**.

. Click **Save & close**.
+
Your map will look like this between zoom levels 9 and 24:
+
[role="screenshot"]
image::maps/images/gs_add_es_document_layer.png[]

[float]
==== Add a layer for aggregated data

You'll create a layer for aggregated data and make it visible only when the map
is zoomed out past zoom level 9. Darker colors will symbolize grids
with more web log traffic, and lighter colors will symbolize grids with less
traffic. Larger circles will symbolize grids with
more total bytes transferred, and smaller circles will symbolize
grids with less bytes transferred.

. Click **Add layer**, and select **Clusters and grids**.
. Set **Index pattern** to **kibana_sample_data_logs**.
. Click **Add layer**.
. In **Layer settings**, set:
** **Name** to `Total Requests and Bytes`
** **Visibility** to the range [0, 9]
** **Opacity** to 100%
. Add a metric with:
** **Aggregation** set to **Sum**
** **Field** set to **bytes**
. In **Layer style**, change **Symbol size**:
** Min size to 7
** Max size to 25
** Change the field select from *count* to *sum of bytes*.
. Click **Save & close** button.
+
Your map will look like this between zoom levels 0 and 9:
+
[role="screenshot"]
image::maps/images/sample_data_web_logs.png[]

[float]
[[maps-save]]
=== Step 4. Save the map
Now that your map is complete, you'll want to save it and return to the dashboard.

. In the application toolbar, click *Save*.
. Enter `Tutorial web logs map` for the title.
. Ensure *Add to Dashboard after saving* is enabled.
. Click *Save and return*.

[float]
[[maps-embedding]]
=== Step 5. Explore your data from the dashboard

View your geospatial data alongside a heat map and pie charts, and then fitler the data.

. Click **Add** to open a panel with a list of objects that you can add to the dashboard.
. Set the **Types** select to **Visualization** and add **[Logs] Heatmap** and **[Logs] Visitors by OS** to the dashboard.
+
[role="screenshot"]
image::maps/images/gs_dashboard_with_map.png[]

. Apply filters to your dashboard to hone in on the data that you are most interested in.
The panels are linked, so watch as you apply a filter in one panel, it is applied to all panels on the dashboard.

.. To filter filter for documents where **machine.os.keyword** is **osx**, click **osx** in the pie chart.

.. In the filter bar, click the **x** to remove the **machine.os.keyword: osx** filter.

.. In the map, click anywhere in the United States vector.

.. To show documents where **geo.src** is **US**, click the plus (+) icon next to the iso2 row in the tooltip.
+
[role="screenshot"]
image::maps/images/gs_dashboard_with_terms_filter.png[]

[float]
=== What's next?

* Check out <<vector-layer, additional layers>> that you can build.
* Learn more about <<maps-vector-style-properties, customizing your map>>.
