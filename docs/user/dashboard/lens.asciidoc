[[lens]]
=== Lens

*Lens* let's you drag and drop the data fields you want to visualize, then uses heuristics to apply each field and create a visualization for you. If you already know how you want to display the fields in the visualization, you can drag and drop the fields directly onto the *Vertical axis*, *Hortizontal axis*, or other visualization-specific field grouping.

Area, bar, and line charts allow you to visualize the data using multiple layers. Each layer can display a different index pattern and visualization type, which allows you to display multiple index patterns and visualization types in a single visualization. For each layer, you can choose the fields, bucket and metrics aggregation functions, and display options. The fields are grouped by *Vertical axis*, *Hortizontal axis*, and *Break down by*, and the *Vertical axis* and *Hortizontal axis* groups support multiple fields.

All other visualization types support a single layer. The field groups are different for each visualization type, but also include the aggregation functions and display options.

++++
<script type="text/javascript" async 
src="https://play.vidyard.com/embed/v4.js"></script>
<img
style="width: 100%; margin: auto; display: block;"
class="vidyard-player-embed"
src="https://play.vidyard.com/vVJ69WCgUwGNJSDqjPZbaV.jpg"
data-uuid="vVJ69WCgUwGNJSDqjPZbaV"
data-v="4"
data-type="inline"
/>
</br>
++++

[float]
[[create-the-visualization-panel]]
==== Create visualizations

Each time you create a visualization, you click *Create visualization* on the dashboard, then use the following process:

* *Choose the visualization type.* If you know the type of visualization you'd like to use, open the *Visualization type* menu, then select the visualization type before you drag and drop any fields. If you're unsure, drag and drop the fields you want to visualize onto the workspace, then let *Lens* choose the visualization type for you. 
+
To view the visualizations that *Lens* automatically created for the data, click the *Suggestions*. If one of the *Suggestions* meets your visualization needs, click *Save and return* to add it to the dashboard.

* *Choose the data you want to visualize.* If you know how you want to display each field, drag and drop the fields directly onto the *Vertical axis*, *Hortizontal axis*, or other visualization-specific field grouping, then use the automatically selected aggregation function. If you're unsure, drag and drop the fields onto the workspace. When you use the *Filters* function, you can skip this step.
+
If you want to learn more about the data a field contains, click *i* next to the field.

* *Edit and delete.* To change the function and display options, click the field name in the layer or visualization pane. To delete a field, close the configuration options, then click
*Delete*. To reset the layer or visualization options, click *Reset*.

[float]
[[lens-required-choices]]
==== Change the fields

Change the list of fields you can use to drag and drop onto the workspace.

* If you want to visualize the fields in a different index pattern, open the *Index pattern* menu, then select a new one. 

* If the list of fields is empty, change the <<set-time-filter,time filter>>.

* To add fields, click *...*, then select *Add field to index pattern*.
+
[role="screenshot"]
image:images/runtime-field-menu.png[Dropdown menu located next to index pattern field with items for adding and managing fields, width=50%]
+
For more information about adding fields to index patterns and Painless scripting language examples, refer to <<runtime-fields,Runtime fields>>.

[float]
[[drag-and-drop-keyboard-navigation]]
==== Create visualizations with keyboard navigation

*Lens* has a fully accessible, continuously improved drag and drop system, which allows you to use a keyboard instead of a mouse.

[role="screenshot"]
image::images/lens_drag_drop_1.gif[Presented Lens drag and drop]

. Set a focus on the chosen item. Most of the draggable elements have two focus states. The inner focus state opens a panel with detailed information or options. 
The outer focus state allows you to drag an item. Tab through the page until you get the outer focus state on the chosen item:
+
[role="screenshot"]
image::images/lens_drag_drop_2.png[Lens drag and drop focus state]

. Complete the following actions:

* To start dragging an item, press Space bar.

* To select where you want to drop the item, use the Left and Right arrows.

* To reorder the fields in the group, use Up and Down arrows.

* To duplicate an operation, use the Left and Right arrows to select the `Drop a field or click to add` in the same group.
+
[role="screenshot"]
image::images/lens_drag_drop_3.gif[Using drag and drop to reorder]

. Press Space bar to confirm, or to cancel, press Esc.

[float]
[[lens-formulas]]
==== Use formulas to perform math

Formulas let you perform math on aggregated data. The most common formulas are dividing two values to produce a percent.

. In the editor, click a dimension.

. Click *Formula*, then enter the formula. 
+
Filter ratio example:: Use `kql=''` to filter one set of documents, then compare the document set to other documents within the same grouping:
+
See how the error rate changes over time:
+
```
count(kql='response.status_code > 400') / count()
```
+
Week over week example:: Use `shift='1w'` to get the value of each grouping from the previous week. Time shift should not be used with the *Top values* function.
+
```
percentile(system.network.in.bytes, percentile=99) /
percentile(system.network.in.bytes, percentile=99, shift='1w')
```
+
Percent of total example:: Formulas can calculate `overall_sum` for all the groupings,
which lets you convert each grouping into a percent of total:
+
```
sum(products.base_price) / overall_sum(sum(products.base_price))
```
+
TIP: For detailed information on formulas, click image:dashboard/images/formula_reference.png[Formula reference icon].

. To accurately display formulas in your visualization, select *Percent* from the *Value format* dropdown.

[float]
[[compare-data-with-time-offsets]]
==== Compare differences over time

Compare your real-time data set to the results offset by a time increment. For example, you can compare the real-time percentage of a user CPU time spent to the results offset by one hour. 

. In the editor, click the dimension you want to offset.

. From the *Add advanced options* dropdown, select *Time shift*.

. Select the time offset increment. 

[float]
[[create-custom-tables]]
==== Create custom tables

*Lens* tables are highly customizable, and provide you with text alignment, value formatting, coloring options, and more.

. From the *Chart type* dropdown, select *Table*. 

. Drag and drop the fields you want to visualize onto the workspace. 

. To sort or hide the columns, click the arrow next to the column heading, then select an option.

. To change the display options, click a *Metrics* dimension, then configure the following options:

* *Display name* &mdash; Specifies the dimension name. 

* *Value format* &mdash; Specifies how the dimension value displays in the table. 

* *Text alignment* &mdash; Aligns the values in the cell to the *Left*, *Center*, or *Right*.

* *Hide column* &mdash; Hides the dimension column.

* *Summary row* &mdash; Adds a row that displays the specified summary value. When specified, allows you to enter a *Summary label*.

* *Color by value* &mdash; Applies color to the cell or text values. To change the color, click *Edit*. 

[float]
[[configure-the-visualization-components]]
==== Configure the visualization components

The components you can configure include the data labels, legend, axes, and other visual options. The options differ depending on the visualization type.

[role="screenshot"]
image:images/lens_dropdown_menus.gif[Dropdown menus in Lens for configuring the visualization components, width=50%]

For example, to add data labels to bar and horizontal bar charts, use the *Values* dropdown.

[role="screenshot"]
image::images/lens_value_labels_xychart_toggle.png[Lens Bar chart value labels menu]

NOTE: In bar charts, you are unable to move the label positions.

To add data labels to pie charts, donut charts, or treemaps, use the *Labels* dropdown.

[role="screenshot"]
image::images/lens_value_labels_partition_toggle.png[Lens Pie chart value labels menu]

[float]
[[filter-the-data]]
==== Filter the data

Apply filters to visualizations based on the dimensions in the legend. Only *Bar*, *Line and area*, and *Proportion* visualizations support legend filters.

. In the legend, open the filter menu for the dimension.

. Choose one of the following options:

* *Filter for value* &mdash; Applies a filter for the dimension value to the visualization.

* *Filter out value* &mdash; Applies a filter that removes the dimension value from the visualization.

[float]
[[lens-faq]]
==== Frequently asked questions

For the answers to common *Lens* questions, review the following. 

[discrete]
[[kql-]]
.When should I use the top filter bar, filters function, or "Filter by"?
[%collapsible]
====
Using the top <<semi-structured-search>> bar is best when you want to focus on a known set of
data for all the visualization results. These top level filters are combined with other filters
using AND logic.

Use the *Filters* function in the following scenarios:

* When you want to apply more than one KQL filter to the visualization.

* When you want to apply the KQL filter to a single layer, which allows you to visualize filtered and unfiltered data.

Use the *Filter by* advanced option in the following scenarios:

* When you want to assign a custom color to each filter in a bar, line, or area chart.

* When you want to build a complex table, such as showing both failure rate and overall.
====

[discrete]
[[when-should-i-normalize-the-data-by-unit-or-use-a-custom-interval]]
.When should I normalize the data by unit or use a custom interval?
[%collapsible]
====
* *Normalize by unit* &mdash; Calculates the average for the specified interval. When you normalize the data by unit, the data appears less granular, but *Lens* is able to calculate the data faster. 

* *Customize time interval* &mdash; Creates a bucket for each specified interval. When you customize the time interval, you can use a large time range, but *Lens* calculates the data slower.

To normalize the interval: 

. In the layer, click a field.

. Click *Add advanced options > Normalize by unit*. 

. From the *Normalize by unit* dropdown, select an option, then click *Close*.

To create a custom interval:

. In the layer, click a field.

. Select *Customize time interval*.

. Change the *Minimum interval*, then click *Close*.
====

[discrete]
[[what-is-the-other-category]]
.What data is categorized as Other?
[%collapsible]
====
The *Other* category contains all of the documents that do not match the specified criteria or filters. 
Use *Other* when you want to compare a value, or multiple values, to a whole.
By default, *Group other values as "Other"* is enabled when you select the *Top values* function. 

To disable *Group other values as "Other"*:

. In the layer, click a field. 

. Click *Advanced*, then deselect *Group other values as "Other"*.
====

[discrete]
[[how-can-i-include-documents-without-the-field-in-the-operation]]
.How can I include documents without the field?
[%collapsible]
====
By default, *Lens* retrieves only the documents from the specified field. 
For bucket aggregations, such as *Top values*, you can choose to include documents that do not contain the specified field, 
which is helpful when you want to compare to the whole documentation set.

. In the layer, click a field. 

. Click *Advanced*, then select *Include documents without this field*.
+
[role="screenshot"]
image::images/lens_bucketed_aggregation_advanced_dropdown.png[Lens Advanced options for bucketed aggregations]
====

[discrete]
[[is-it-possible-to-select-color-for-specific-bar-or-point]]
.How do I change the color for a single data point?
[%collapsible]
====
*Lens* provides you with color pallettes that you can apply to the entire visualization, but you are unable to change the color for a single data point, such as a bar or line.
====

[discrete]
[[is-it-possible-to-have-more-than-one-Y-axis-scale]]
.Is it possible to have more than one y-axis scale in visualizations?
[%collapsible]
====
*Lens* lets you pick, for each y-axis, up to two distinct axess: *left* and *right*. Each axis can have a different scale.
====

[discrete]
[[why-is-my-value-with-the-right-color-using-value-based-coloring]]
.Why is my value with the incorrect color when using value-based coloring?
[%collapsible]
====
There could be various reasons for a specific value in the table to have a different color than expected.

Here's a short list of few different aspects to check:
* Make sure the value falls within the desired color stop value defined in the panel. Color stop values are "inclusive".

* Make sure you have the correct value precision setup. Value formatters could round the numeric values up or down.

* Make sure the correct color continuity option is selected. If the number is below the first color stop value, a continuity of type `Below` or `Above and below range` is required.

* The default values set by the Value type are based on the current data range displayed in the data table.

** If a custom `Number` configuration is used, check that the color stop values are covering the current data range.

** If a `Percent` configuration is used, and the data range changes, the colors displayed are affected.
====

When do I use runtime fields vs. formula?

[discrete]
[[can-i-sort-by-multiple-columns]]
.How do I sort by multiple columns?
[%collapsible]
====
Multiple column sorting is unsupported, but is supported in *Discover*. For information on how to sort multiple columns in *Discover*, 
refer to <<explore-fields-in-your-data,Explore the fields in your data>>.
====

[discrete]
[[is-it-possible-to-sort-dimensions-in-a-chart]]
.How do I sort the fields in layers?
[%collapsible]
====
Sorting the fields in charts, treemap, and heatmap is unsupported, but you can sort the fields for a single data table column.

. Click the column header.

. Select the sorting criteria you want to use.
+
If you use the group as `Columns`, then all the columns that belong to the same group are sorted in the table.
====

[discrete]
[[is-it-possible-to-use-saved-serches-in-lens]]
.How do I visualize saved searches?
[%collapsible]
====
Visualizing saved searches in unsupported.
====

[discrete]
[[is-it-possible-to-decrease-or-increase-the-number-of-suggestions]]
.How do I change the number of suggestions?
[%collapsible]
====
Configuring the *Suggestions* is unsupported.
====

[discrete]
[[why-my-field-x-is-missing-from-the-fields-list]]
.Why is my field missing from the list?
[%collapsible]
====
Full-text fields are unsupported and do not appear in data summaries.
====

[discrete]
[[how-to-handle-gaps-in-time-series-visualizations]]
.How do I handle gaps in time series visualizations?
[%collapsible]
====
When you create *Area* and *Line* charts, and the time series data is sparse, open the *Visual options* menu, then select how to handle missing values. The default is to hide the missing values.

[role="screenshot"]
image::images/lens_missing_values_strategy.png[Lens Missing values strategies menu]
====

[discrete]
[[is-it-possible-to-change-the-scale-of-Y-axis]]
.Is it possible to statically define the scale of the y-axis in a visualization?
[%collapsible]
====
You can set the bounds on area, bar, and line charts, unless you are using percentage mode. Bar
and area charts must have 0 in the bounds. Logarithmic scales are unsupported.
To set the y-axis bounds, click the icon representing the axis you want to customize.
====

[discrete]
[[is-it-possible-to-have-pagination-for-datatable]]
.Is it possible to have pagination in a data table?
[%collapsible]
====
Pagination in a data table is unsupported. To use pagination in data tables, refer to <<types-of-visualizations,aggregation-based data table>>.
====




