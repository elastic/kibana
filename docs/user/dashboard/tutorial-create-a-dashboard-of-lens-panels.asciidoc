[[create-a-dashboard-of-panels-with-web-server-data]]
== Tutorial: Build your first dashboard

Learn the most common ways to build a dashboard from your own data.
The tutorial will use sample data from the perspective of an analyst looking
at website logs, but this type of dashboard works on any type of data.
Before using this tutorial, you should be familiar with the <<kibana-concepts-analysts>>.

[role="screenshot"]
image::images/lens_end_to_end_dashboard.png[Final dashboard vis]

[discrete]
[[add-the-data-and-create-the-dashboard]]
=== Add the data and create the dashboard

If you are working with your own data, you should already have an <<index-patterns, index pattern>>.
To install the sample logs that contain fake website traffic:

. From the {kib} *Home* page, click *Try our sample data*.

. From *Sample web logs*, click *Add data*.

Then create a new dashboard:

. Open the main menu, click *Dashboard*.

. Click *Create dashboard*.

. Set the <<set-time-filter,time filter>> to *Last 90 days*.

You don't need to save the dashboard while it's in draft mode.

[float]
[[open-and-set-up-lens]]
=== Open and set up Lens

*Lens* is the visualization builder recommended for most users.
With *Lens*, you identify the data fields you want to visualize, drag and drop the fields, then watch as
*Lens* uses heuristics to apply the fields and create a visualization for you.

. From the dashboard, click *Create visualization*.
+
[role="screenshot"]
image::images/lens_end_to_end_1_1.png[Dashboard create visualization button]

. Make sure the *kibana_sample_data_logs* index appears. You may need to select
a different index pattern from the menu:
+
[role="screenshot"]
image::images/lens_end_to_end_1_2.png[Lens index pattern selector]

[discrete]
[[view-the-number-of-website-visitors]]
=== Build your first visualization

Every time you build a visualization in *Lens*, you will follow these steps:

. Do you know which chart type you'd like to use? If you do, select the type before
dragging any fields. If you don't, you can change the chart types after configuring your functions.

. Do you know exactly which functions you want? If so, click the dimension and
configure it manually.

. Do you want to use a specific field in a chart, but aren't sure which function? Drag the field
to a specific dimension and Lens will pick a function for you.

. Do you want to use a specific field, but want Lens to assign it automatically? Drag the field
onto the main Lens workspace and it will get added to your chart.

. Don't like your chart? Delete a specific dimension or reset the entire chart.

To put this into practice, pick a field like `clientip` which you want to analyze. If you want
to analyze only this field, you can use the *metric* chart type to show a big number.
The only number function that you can use with `clientip` is the *unique count* function
You know that the *unique count* function, also known as cardinality, will get an approximate count
of the unique IP addresses in the data. Putting this together, build a metric chart:

. Click *Bar vertical stacked* to open the chart type dropdown, then select *Metric*.
+
[role="screenshot"]
image::images/lens_end_to_end_1_2_1.png[Chart Type dropdown with Metric selected]

. From the *Available fields* list, drag and drop *clientip* to the main workspace.
Lens will select the unique count function because it is the only numeric function
that works for IP addresses. You could also drag *clientip* onto
the empty dimension for the same result.
+
[role="screenshot"]
image::images/lens_end_to_end_1_3.png[Changed type and dropped clientip field]

. In the editor, click *Unique count of clientip*.

.. In the *Display name* field, enter `Unique visitors`.

.. Click *Close*.
+
[role="screenshot"]
image::images/lens_end_to_end_1_4.png[Flyout config open]

. Click *Save and return*. You will return to the dashboard, where you can customize
the newly added panel:

.. Drag the bottom corner of the panel until the metric takes up one quarter of the screen
width. The row for the metric will have 4 items on it later.

.. The metric visualization has its own label, so you do not need to add a panel title.

. Click *Save* on the dashboard menu

. Enter the title "Logs dashboard"

. Check the *Store time with dashboard* box, then click *Save*

. After the dashboard refreshes, click *Edit* again.

[discrete]
[[mixed-multiaxis]]
=== View a metric over time

If your index pattern has a default time field, *Lens* will add that field automatically
when you drag a numeric field onto the workspace panel. This is a helpful shortcut.
If your data has multiple time fields you can drag to replace the previous time field.

For this example, you want to visualize the `bytes` field over time, but you may not have
chosen a specific function yet:

. Drag `bytes` from the field list to the workspace panel to have *Lens* automatically
create a chart. It will create a bar chart using the *median of bytes* as the metric.

. *Lens* chooses a date interval automatically. To zoom in on the data you want to view,
click and drag your cursor across the bars. 

[role="screenshot"]
image::images/lens_end_to_end_3_1_1.gif[Zoom in on the data]

Bar charts are a good default chart, but for this metric a line chart is more appropriate.
Switch to a line chart one of three ways:

* Click the line chart that appears under *Suggestions*
* Click *Bar vertical stacked* and choose the *Line* chart type
* Click the chart type icon above *Horizontal axis*

The default interval that *Lens* has chosen is 3 hours. To customize the time interval:

. In the editor, click *timestamp*.

. Select *Customize time interval*.

. Change the *Minimum interval* to `1 days`, then click *Close*.
+
[role="screenshot"]
image::images/lens_end_to_end_3_1.png[Customize time interval]

You can also decrease the time interval with a more advanced guide on <<small-time-interval, small time intervals in Lens>>.

This chart will be displayed in a small space in the dashboard, so to save space, hide the vertical and horizontal
axis labels:

. In the toolbar next to *Line* click the *Left axis* icon, then deselect *Show*.
+
[role="screenshot"]
image::images/lens_end_to_end_4_3.png[Turn off axis name]

. Click the *Bottom axis* icon, then deselect *Show*.

. Click *Save and return*

. Arrange the panel so that it is in the same row as the *Metric* visualization. The two should
take up half the screen width.

. Add a panel title to explain the visualization, which is necessary because you removed the axis labels.

.. Click the gear icon and choose *Edit panel title*.

.. Enter "Median of bytes" as the panel title, then click *Save*.

. Click *Save* on the entire dashboard.

[discrete]
[[view-the-distribution-of-visitors-by-operating-system]]
=== View the most frequent values

When you drag a text or IP address field into the *Lens* workspace you will see
the most frequent values of that field using the *top values* function. The values
are ranked based on another metric like *Count of records*. Only exact matches count:
`win 10` and `win xp` are distinct.

For this tutorial, you have decided to see the most frequently viewed URLs on your website
ranked by the `Unique count of clientip` metric, but you have not yet determined which chart type to use.

. Starting with the default bar chart, drag the `clientip` field onto the *Vertical axis*.
This will produce the `Unique count of clientip` metric. Do not drop the field into the main workspace,
because the *top values* function will be used instead.

. Drag and drop `request.keyword` to the main workspace, and *Lens* will add `Top value of request.keyword`
to the *Horizontal axis*.
+
[role="screenshot"]
image::images/lens_end_to_end_2_1_1.png[Vertical bar chart with top values of request.keyword by most unique visitors]

This chart is hard to read because the `request.keyword` field contains long text. You could try
using one of the *Suggestions*, but the suggestions also have issues with long text. Instead, switch
to a *Table* visualization:

. Click *Bar vertical stacked* to open the chart switcher

. Click *Table*
+
[role="screenshot"]
image::images/lens_end_to_end_2_1_2.png[Table with top values of request.keyword by most unique visitors]

Customize the table even more:

. Click *Top values of request.keyword*

.. Increase the *Number of values*. The maximum allowed value is 1000.

.. In the *Display name* field, enter `Page URL`.

. Click *Close*.

. Click *Save and return*.

. Arrange the table panel so that it has its own row, but keep the default width of half the screen.

. You do not need a panel title because the table columns are clearly labeled.

[discrete]
[[custom-ranges]]
=== Compare the percentage of a subset to the whole

To compare a subset to the whole you need to create non-overlapping sets of documents that add up to 100%.
For numeric data the *intervals* function is the best option, while for all other data types *filters* is
recommended. Use a proportion chart to display the values as a percentage of the sum. Lens has 5 types of proportion charts:
pie, donut, treemap, percentage bar and percentage area.

To determine if your users transfer more small files versus large files, create two non-overlapping intervals. Start
with a bar chart and then switch to a pie chart to display as percentage:

. From the *Available fields* list, drag and drop `bytes` to *Vertical axis* in the editor.

. Click *Median of bytes* and then select *Sum* instead. Then *Close*.

. From the *Available fields* list, drag and drop `bytes` to *Break down by* in the editor, then specify the file size ranges.

.. Click `bytes`.

.. Click *Create custom ranges*, enter the following, then press Return:

* *Ranges* &mdash; `0` -> `10240`

* *Label* &mdash; `Below 10KB`

.. Click *Add range*, enter the following, then press Return:

* *Ranges* &mdash; `10240` -> `+âˆž`

* *Label* &mdash; `Above 10KB`
+
[role="screenshot"]
image::images/lens_end_to_end_6_1.png[Custom ranges configuration]

.. From the *Value format* dropdown, select *Bytes (1024)*, then click *Close*.

. Click *Bar vertical stacked*, then select *Pie*. Notice how the *Suggestions* update with 

. Click *Save and return*.

. Arrange the panel into a small square on the first row of the dashboard, less than one quarter of the screen width.

.. Click the gear icon and choose *Edit panel title*.

.. Enter "Sum of bytes from large requests" as the panel title, then click *Save*.

[discrete]
[[histogram]]
=== View the numeric distribution in a histogram

Use the *intervals* function in *Lens* to see an evenly spaced numeric distribution.
For logs data, this might be used to find the best time to shut down your website for maintenance.
To create a numeric histogram showing total traffic per hour:

. From the *Available fields* list, drag and drop `bytes` to *Vertical axis* in the editor.

. Click *Median of bytes* and choose the *Sum* function instead.

. In the *Display name* field, enter `Transferred bytes`.

. From the *Value format* dropdown, select `Bytes (1024)`, then click *Close*.

. From the *Available fields* list, drag and drop *hour_of_day* to *Horizontal axis* in the editor.

. Click *hour_of_day*, and then slide the *Intervals granularity* slider until the horizontal axis displays hourly intervals.
+
[role="screenshot"]
image::images/lens_end_to_end_5_2.png[Create custom ranges]

. Click *Save and return*.

. Shrink the panel size, then drag it to the first row next to the *Median of bytes* panel. There
should be four panels in a row.

. You do not need a panel title because the axis labels are self-explanatory.

[discrete]
[[treemap]]
=== Create a multi-level chart

*Lens* lets you use multiple functions in the data table and proportion charts. For example,
to create a chart which breaks down the traffic sources and user geography, use the *filters*
function and *top values* function:

. Click *Bar vertical stacked*, then select *Treemap*.

. From the *Available fields* list, drag and drop *Records* to the *Size by* field in the editor. 

. In the editor, click the *Drop a field or click to add* field for *Group by*, then create a filter for each website traffic source.

.. From *Select a function*, click *Filters*.

.. Click *All records*, enter the following, then press Return:

* *KQL* &mdash; `referer : *facebook.com*`

* *Label* &mdash; `Facebook`

.. Click *Add a filter*, enter the following, then press Return:

* *KQL* &mdash; `referer : *twitter.com*`

* *Label* &mdash; `Twitter`

.. Click *Add a filter*, enter the following, then press Return:

* *KQL* &mdash; `NOT referer : *twitter.com* OR NOT referer: *facebook.com*`

* *Label* &mdash; `Other`

.. Click *Close*.

Then add the next break down by geography:

. From the *Available fields* list, drag and drop *geo.src* to the main workspace.

. To change the *Group by* order, click and drag *Top values of geo.src* so that it appears first in the editor.
+
[role="screenshot"]
image::images/lens_end_to_end_7_2.png[Treemap vis]

. To view only the Facebook and Twitter data, remove the *Other* category. 

.. In the editor, click *Top values of geo.src*.

.. From the *Advanced* dropdown, deselect *Group other values as "Other"*, then click *Close*.
+
[role="screenshot"]
image::images/lens_end_to_end_7_3.png[Group other values as Other]

. Click *Save and return*.

. Arrange the panel so that it is in the same row as the table.

.. Click the gear icon and choose *Edit panel title*.

.. Enter "Page views by location and referer" as the panel title, then click *Save*.

[discrete]
=== Save the dashboard

Now that you have a complete overview of your web server data, save the dashboard.

. In the toolbar, click *Save*.

. On the *Save dashboard* window, enter `Web server data`, then click *Save*.

. If this was not the first time you saved the dashboard, click *Switch to view mode*
