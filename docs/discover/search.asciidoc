[[search]]
== Searching Your Data
You can search the indices that match the current index pattern by entering
your search criteria in the Query bar. By default you can use Kibana's standard query language
which features autocomplete and a simple, easy to use syntax. Kibana's legacy query
language (based on Lucene https://lucene.apache.org/core/2_9_4/queryparsersyntax.html[query syntax])
is still available for the time being under the options menu in the Query Bar. When this
legacy query language is selected, the full JSON-based {ref}/query-dsl.html[Elasticsearch Query DSL]
can also be used.

When you submit a search request, the histogram, Documents table, and Fields
list are updated to reflect the search results. The total number of hits
(matching documents) is shown in the toolbar. The Documents table shows the
first five hundred hits. By default, the hits are listed in reverse
chronological order, with the newest documents shown first. You can reverse
the sort order by clicking the Time column header. You can also sort the table
by the values in any indexed field. For more information, see <<sorting,
Sorting the Documents Table>>.

To search your data, enter your search criteria in the Query bar and
press *Enter* or click *Search* image:images/search-button.jpg[] to submit
the request to Elasticsearch.

include::kuery.asciidoc[]

[[lucene-query]]
=== Lucene Query Syntax
Kibana's legacy query language was based on the Lucene query syntax. For the time being this syntax
is still available under the options menu in the Query Bar and in Advanced Settings. The following
are some tips that can help get you started.

* To perform a free text search, simply enter a text string. For example, if
you're searching web server logs, you could enter `safari` to search all
fields for the term `safari`.

* To search for a value in a specific field, prefix the value with the name
of the field. For example, you could enter `status:200` to find all of
the entries that contain the value `200` in the `status` field.

* To search for a range of values, you can use the bracketed range syntax,
`[START_VALUE TO END_VALUE]`. For example, to find entries that have 4xx
status codes, you could enter `status:[400 TO 499]`.

* To specify more complex search criteria, you can use the Boolean operators
`AND`, `OR`, and `NOT`. For example, to find entries that have 4xx status
codes and have an extension of `php` or `html`, you could enter `status:[400 TO
499] AND (extension:php OR extension:html)`.

For more detailed information about the Lucene query syntax, see the
{ref}/query-dsl-query-string-query.html#query-string-syntax[Query String Query]
docs.

NOTE: These examples use the Lucene query syntax. When lucene is selected as your
query language you can also submit queries using the {ref}/query-dsl.html[Elasticsearch Query DSL].


[[save-open-search]]
=== Saving and Opening Searches
Saved searches persist your current Discover view for later retrieval and reuse. They can be reloaded into Discover, added to dashboards as panels, or used as the basis for <<visualize, visualizations>>. A saved search includes the query text, filters, and (optionally) the time filter. It also includes the selected columns in the document table, the sort order, and the current index pattern.

[role="xpack"]
[[discover-read-only-access]]
==== Read only access
When you have insufficient privileges to save searches, the following indicator in Kibana will be
displayed and the *Save* button won't be visible. For more information on granting access to
Kibana see <<xpack-security-authorization>>.

[role="screenshot"]
image::discover/images/read-only-badge.png[Example of Discover's read only access indicator in Kibana's header]

==== Saving a Search
To save the current search:

. Click *Save* in the Kibana toolbar.
. Enter a name for the search and click *Save*.

You can import, export and delete saved searches from *Management/Kibana/Saved Objects*.

==== Opening a Saved Search
To load a saved search into Discover:

. Click *Open* in the Kibana toolbar.
. Select the search you want to open.

If the saved search is associated with a different index pattern than is currently
selected, opening the saved search changes the selected index pattern. The query language
used for the saved search will also be automatically selected.

[[save-load-delete-query]]
=== Saving and Loading Queries
Saving queries allows you to reuse them in <<discover, Discover>>, <<visualize, Visualize>> and <<dashboard, Dashboard>>.
Saved queries always include the KQL or Lucene query text, but the filter bar and time picker can optionally be included as well. Unlike saved searches, queries do not include Discover specific information like the columns selected in the document table, the sort order, or the index pattern. Saved searches can be thought of as a way to persist a particular Discover view. Saved queries on the other hand are a portable set of filters that can be reused in other applications.

[role="xpack"]
==== Read only access
When you have insufficient privileges to save queries the *Save* button won't be visible in the saved query management popover.

[role="screenshot"]
image::discover/images/saved-query-management-component-readonly.png["Example of the saved query management popover with read only access to Discover",width="80%"]

==== Saving a Query
To save the current query text, filters, and time filter:

. Click *#* in the search bar, next to the query text input.
. Click *Save* in the popover.
. Enter a name, a description, and then select the filter options that you want to include. Filters are automatically included but the time filter is not.
+
[role="screenshot"]
image::discover/images/saved-query-save-form.png["Example of the saved query management save form with the filters option included and the time filter option excluded",width="80%"]
. Click *Save*.
+
[role="screenshot"]
image::discover/images/saved-query-management-component.png["Example of the saved query management popover with a list of saved queries with write access",width="80%"]

==== Loading a Query
To load a saved query into Discover:

. Click *#* in the search bar, next to the query text input.
. Select the query you want to load. You might need to scroll down to find the query you are looking for.

==== Saving Changes Made to a Query
When you have loaded a query and made changes to the query text, the filters, or the time filter, you can save the changes as a new saved query or save the changes to the existing saved query.

To save the changes as a new saved query:

. Click *#* in the search bar, next to the query text input.
. Click *Save as new* in the popover.
. Enter a name and a description, and then select the filter options that you want to include. Filters are automatically included but the time filter is not.

Click *Save*.

To save the changes to the current query:

. Click *#* in the search bar, next to the query text input.
. Click *Save changes* in the popover.
. Enter a description, and then select the filter options that you want to include. Filters are automatically included but the time filter is not.

Click *Save*.

==== Clearing a Query
To clear a query that is currently loaded:

. Click *#* in the search bar, next to the query text input.
. Click *Clear* in the popover.

This will unload the query but will not delete it.

==== Deleting a Query
To delete a query from the saved query management popover:

. Click *#* in the search bar, next to the query text input.
. Click the trash can icon to delete the query.
+
[role="screenshot"]
image::discover/images/saved-query-management-component-save-as-new.png["Example of the saved query management popover when a query is loaded and we are about to delete a query",width="80%"]

You can import, export, and delete saved queries from *Management > Kibana > Saved Objects*.

[[select-pattern]]
=== Changing Which Indices You're Searching
When you submit a search request, the indices that match the currently-selected
index pattern are searched. The current index pattern is shown below the toolbar.
To change which indices you are searching, click the index pattern and select a
different index pattern.

For more information about index patterns, see <<settings-create-pattern,
Creating an Index Pattern>>.

[[autorefresh]]
=== Refreshing the Search Results
As more documents are added to the indices you're searching, the search results
shown in Discover and used to display visualizations get stale. You can
configure a refresh interval to periodically resubmit your searches to
retrieve the latest results.

To enable auto refresh:

. Click the *Time Picker* image:images/time-picker.jpg[Time Picker] in the
Kibana toolbar.
. Click *Auto refresh*.
. Choose a refresh interval from the list.
+
image::images/autorefresh-intervals.png[]

When auto refresh is enabled, the refresh interval is displayed next to the
Time Picker, along with a Pause button. To temporarily disable auto refresh,
click *Pause*.

NOTE: If auto refresh is not enabled, you can manually refresh visualizations
by clicking *Refresh*.
