[[snapshot-repositories-example]]

[role="xpack"]
[[snapshot-restore-tutorial]]
=== Tutorial:  Snapshot and Restore


Ready to try *Snapshot and Restore*? In this tutorial, you'll learn to:

* Register a repository
* Add snapshots to the repository
* Create a snapshot lifecycle policy
* Restore a snapshot

==== Before you begin

This example shows you how to register a shared file system repository 
and store snapshots.
Before you begin, you must register the location of the repository in the 
{ref}/modules-snapshots.html#_shared_file_system_repository[path.repo] setting on 
your master and data nodes.  You can do this in one of two ways:

* Edit  your `elasticsearch.yml` to include the `path.repo` setting.

* Pass the `path.repo` setting when you start Elasticsearch.
+
`bin/elasticsearch -E path.repo=/tmp/es-backups`

[float]
[[register-repo-example]]
==== Register a repository

Use *Snapshot and Restore* to register the repository where your snapshots 
will live. 

. Go to *Management > Elasticsearch > Snapshot and Restore*.
. Click *Register a repository* in either the introductory message or *Repository view*.
. Enter a name for your repository, for example, `my_backup`.
. Select *Shared file system*.
+ 
[role="screenshot"]
image:management/snapshot-restore/images/register_repo.png["Register repository"]

. Click *Next*.
. In *File system location*, enter the path to the snapshot repository, `/tmp/es-backups`.
. In *Chunk size*, enter `100mb` so that snapshot files are not bigger than that size.
. Use the defaults for all other fields, and then click *Register*.
+
Your new repository is listed on the *Repositories* view.
The repository currently doesn’t have any snapshots.


[float]
==== Add a snapshot to the repository
Use the {ref}//modules-snapshots.html#snapshots-take-snapshot[snapshot API] to create a snapshot.

. Go to *Dev Tools > Console*.
. Create the snapshot:
+
[source,js]
PUT /_snapshot/my_backup/2019-04-25_snapshot?wait_for_completion=true
+
In this example, the snapshot name is `2019-04-25_snapshot`. You can also 
use {ref}//date-math-index-names.html[date math expression] for the snapshot name.
+
[role="screenshot"]
image:management/snapshot-restore/images/create_snapshot.png["Create snapshot"]

. Return to *Snapshot and Restore*. 
+
Your new snapshot is available in the *Snapshots* view.

[[create-policy-example]]
==== Create a snapshot lifecycle policy

Now you'll automate the creation and deletion of snapshots
using the repository created in the previous example.

. Open the *Policies* view.
. Click *Create a policy*.
+ 
[role="screenshot"]
image:management/snapshot-restore/images/create-policy-example.png["Create policy wizard"]

. As you walk through the wizard, enter the following values:
+
|===
|*Logistics* |

|Policy name
|`daily-snapshots`

|Snapshot name
|`<daily-snap-{now/d}>`

|Schedule
|Every day at 1:30 a.m.

|Repository
|`my_backup`

|*Snapshot&nbsp;settings* |

|Indices
|Select the indices to back up. By default, all indices, including system indices, are backed up.

|All&nbsp;other&nbsp;settings
|Use the defaults.

|*Snapshot&nbsp;retention* |

|Expiration
|`30 days`

|Snapshots&nbsp;to&nbsp;retain
|Minimum count: `5`, Maximum count: `50`
|===

. Review your input, and then click *Create policy*.
+
Your new policy is listed in the *Policies* view, and you see a summary of its details.

[[restore-snapshot-example]]
==== Restore a snapshot
Finally, you'll restore indices from an existing snapshot.

. In the *Snapshots* view, find the snapshot you want to restore, for example `2019-04-25_snapshot`.
. Click the restore icon in the *Actions* column.
. As you walk through the wizard, enter the following values:
+
|===
|*Logistics* |

|Indices
|Toggle to choose specific indices to restore, or leave in place to restore all indices.

|Rename indices
|Toggle to give your restored indices new names, or leave in place to restore under original index names.

|All other fields
|Use the defaults.

|*Index&nbsp;settings* |

|Modify&nbsp;index&nbsp;settings
|Toggle to overwrite index settings when they are restored, 
or leave in place to keep existing settings.

|Reset&nbsp;index&nbsp;settings
|Toggle to reset index settings back to the default when they are restored, 
or leave in place to keep existing settings.
|===

. Review your restore settings, and then click *Restore snapshot*.
+
The operation loads for a few seconds, 
and then you’re navigated to *Restore Status*, 
where you can monitor the status of your restored indices.

