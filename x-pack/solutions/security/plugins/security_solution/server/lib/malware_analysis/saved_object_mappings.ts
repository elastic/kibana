/*
 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
 * or more contributor license agreements. Licensed under the Elastic License
 * 2.0; you may not use this file except in compliance with the Elastic License
 * 2.0.
 */

import type { SavedObjectsType } from '@kbn/core-saved-objects-server';
import { SECURITY_SOLUTION_SAVED_OBJECT_INDEX } from '@kbn/core-saved-objects-server';

/**
 * Saved object type name for cached malware analysis results
 */
export const malwareAnalysisResultSavedObjectType = 'malware-analysis-result';

/**
 * Mappings for the malware analysis result saved object
 */
export const malwareAnalysisResultSavedObjectMappings: SavedObjectsType['mappings'] = {
  properties: {
    alert_id: {
      type: 'keyword',
    },
    sha256: {
      type: 'keyword',
    },
    task_id: {
      type: 'keyword',
    },
    status: {
      type: 'keyword',
    },
    analysis: {
      type: 'text',
      index: false,
    },
    error: {
      type: 'text',
      index: false,
    },
    cost_usd: {
      type: 'float',
    },
    input_tokens: {
      type: 'long',
    },
    output_tokens: {
      type: 'long',
    },
    created_at: {
      type: 'date',
    },
    updated_at: {
      type: 'date',
    },
  },
};

/**
 * Saved object type definition for malware analysis results.
 * Stores cached AI-generated malware reverse engineering analysis results
 * keyed by alert ID, so they persist across sessions and don't need to be regenerated.
 */
export const malwareAnalysisResultType: SavedObjectsType = {
  name: malwareAnalysisResultSavedObjectType,
  indexPattern: SECURITY_SOLUTION_SAVED_OBJECT_INDEX,
  hidden: false,
  namespaceType: 'single',
  mappings: malwareAnalysisResultSavedObjectMappings,
};
