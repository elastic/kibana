openapi: 3.0.3
info:
  title: 'Security Detections API (Elastic Cloud Serverless)'
  description: 'Use the detections APIs to create and manage detection rules. Detection rules search events and external alerts sent to Elastic Security and generate detection alerts from any hits. Alerts are displayed on the **Alerts** page and can be assigned and triaged, using the alert status to mark them as open, closed, or acknowledged.'

tags:
  - name: 'Security Detections API'
    x-displayName: 'Security detections'
    description: |
      Use the detections APIs to create and manage detection rules. Detection rules search events and external alerts sent to Elastic Security and generate detection alerts from any hits. Alerts are displayed on the **Alerts** page and can be assigned and triaged, using the alert status to mark them as open, closed, or acknowledged.

      This API supports both key-based authentication and basic authentication.

      To use key-based authentication, create an API key, then specify the key in the header of your API calls.

      To use basic authentication, provide a username and password; this automatically creates an API key that matches the current user's privileges.

      In both cases, the API key is subsequently used for authorization when the rule runs.
      > warn
      > If the API key used for authorization has different privileges than the key that created or most recently updated a rule, the rule behavior might change.

      > If the API key that created a rule is deleted, or the user that created the rule becomes inactive, the rule will stop running.

      To create and run rules, the user must meet specific requirements for the Kibana space. Refer to the [Detections requirements](https://www.elastic.co/guide/en/security/current/detections-permissions-section.html) for a complete list of requirements.


      ## Security Detections API Alerting API Key Behavior

      The following table shows how Security Solution Detections APIs map to the underlying API key regeneration behavior:

      | Security Solution API | Creates New API Key |
      |----------------------|---------------------|
      | Create Rule (enabled) (`POST /api/detection_engine/rules`) | Yes |
      | Create Rule (disabled) (`POST /api/detection_engine/rules`) | No |
      | Update Rule (`PUT /api/detection_engine/rules`) | Yes (+ See notes for Rule Enable) |
      | Patch Rule (`PATCH /api/detection_engine/rules`) | Yes (+ See notes for Rule Enable) |
      | Delete Rule (`DELETE /api/detection_engine/rules`) | N/A (rule deleted) |
      | Bulk Enable (`POST /api/detection_engine/rules/_bulk_action`, action: enable) | Yes if null (+ See notes for Rule Enable |
      | Bulk Disable (`POST /api/detection_engine/rules/_bulk_action`, action: disable) | No |
      | Bulk Delete (`POST /api/detection_engine/rules/_bulk_action`, action: delete) | N/A (rule deleted) |
      | Bulk Duplicate (`POST /api/detection_engine/rules/_bulk_action`, action: duplicate) | Yes (on create and update) |
      | Bulk Edit (`POST /api/detection_engine/rules/_bulk_action`, action: edit) | Conditional (See notes for Bulk Edit) |
      | Bulk Export (`POST /api/detection_engine/rules/_bulk_action`, action: export) | No |
      | Bulk Run (`POST /api/detection_engine/rules/_bulk_action`, action: run) | No |
      | Import Rules - new (`POST /api/detection_engine/rules/_import`) | Yes |
      | Import Rules - overwrite (`POST /api/detection_engine/rules/_import`) | Yes (+ Conditional for enable) |
      | Install Prebuilt Rules (`POST /api/detection_engine/rules/prepackaged/_perform`) | Yes |
      | Upgrade Prebuilt Rules - same type (`POST /api/detection_engine/prebuilt_rules/upgrade/_perform`) | Yes |
      | Upgrade Prebuilt Rules - type change (`POST /api/detection_engine/prebuilt_rules/upgrade/_perform`) | Yes (for a new rule) |

      ### Notes on "Conditional" API Key Behavior
      - **Rule Enable**: Creates an API key only if the rule doesn't already have one. This commonly happens for rules that are exported and re-imported, as rules are exported with `enabled: false` and API key values are stripped.
      - **Bulk Edit**: Only regenerates the API key for certain edit operations. After version 9.2, editing exception list parameters will not invalidate the existing API key.
      - **Update/Patch**: After version 9.2, editing exception list parameters will not invalidate the existing API key.
