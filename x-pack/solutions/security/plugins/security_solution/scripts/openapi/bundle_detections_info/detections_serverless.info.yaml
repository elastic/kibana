openapi: 3.0.3
info:
  title: 'Security Detections API (Elastic Cloud Serverless)'
  description: 'Use the detections APIs to create and manage detection rules. Detection rules search events and external alerts sent to Elastic Security and generate detection alerts from any hits. Alerts are displayed on the **Alerts** page and can be assigned and triaged, using the alert status to mark them as open, closed, or acknowledged.'

tags:
  - name: 'Security Detections API'
    x-displayName: 'Security detections'
    description: |
      Use the detections APIs to create and manage detection rules. Detection rules search events and external alerts sent to Elastic Security and generate detection alerts from any hits. Alerts are displayed on the **Alerts** page and can be assigned and triaged, using the alert status to mark them as open, closed, or acknowledged.

      This API supports both key-based authentication and basic authentication.

      To use key-based authentication, create an API key, then specify the key in the header of your API calls.

      To use basic authentication, provide a username and password; this automatically creates an API key that matches the current user's privileges.

      In both cases, the API key is subsequently used for authorization when the rule runs.
      > warn
      > If the API key used for authorization has different privileges than the key that created or most recently updated a rule, the rule behavior might change.

      > If the API key that created a rule is deleted, or the user that created the rule becomes inactive, the rule will stop running.

      To create and run rules, the user must meet specific requirements for the Kibana space. Refer to the [Detections requirements](https://www.elastic.co/guide/en/security/current/detections-permissions-section.html) for a complete list of requirements.


      ## Security Detections API Alerting API Key Behavior

      The following table shows how Security Solution Detections APIs affect the rule's API key:

      | Security Solution API | API key behavior |
      |----------------------|------------------|
      | Create Rule (enabled) (`POST /api/detection_engine/rules`) | Creates new key |
      | Create Rule (disabled) (`POST /api/detection_engine/rules`) | No effect |
      | Update Rule (`PUT /api/detection_engine/rules`) | Regenerates if exists* |
      | Patch Rule (`PATCH /api/detection_engine/rules`) | Regenerates if exists* |
      | Delete Rule (`DELETE /api/detection_engine/rules`) | Deletes with rule |
      | Bulk Enable (`POST /api/detection_engine/rules/_bulk_action`, action: enable) | Creates if missing |
      | Bulk Disable (`POST /api/detection_engine/rules/_bulk_action`, action: disable) | No effect |
      | Bulk Delete (`POST /api/detection_engine/rules/_bulk_action`, action: delete) | Deletes with rule |
      | Bulk Duplicate (`POST /api/detection_engine/rules/_bulk_action`, action: duplicate) | Creates new key |
      | Bulk Edit (`POST /api/detection_engine/rules/_bulk_action`, action: edit) | Regenerates if exists* |
      | Bulk Export (`POST /api/detection_engine/rules/_bulk_action`, action: export) | No effect |
      | Bulk Run (`POST /api/detection_engine/rules/_bulk_action`, action: run) | No effect |
      | Import Rules - new (`POST /api/detection_engine/rules/_import`) | Creates new key |
      | Import Rules - overwrite (`POST /api/detection_engine/rules/_import`) | Regenerates if exists* |
      | Install Prebuilt Rules (`POST /api/detection_engine/rules/prepackaged/_perform`) | No effect |
      | Upgrade Prebuilt Rules - same type (`POST /api/detection_engine/prebuilt_rules/upgrade/_perform`) | Regenerates if exists* |
      | Upgrade Prebuilt Rules - type change (`POST /api/detection_engine/prebuilt_rules/upgrade/_perform`) | Creates new key |

      ### Notes
      - **Exception list changes (9.2+)**: After version 9.2, editing only exception list parameters will not regenerate the API key.
      - **Enabling during update**: If an update, patch, or import operation also enables the rule (changes `enabled` from `false` to `true`), and no API key exists, a new key will be created.
      - **Exported rules**: Rules are exported with `enabled: false` and API key values are stripped. When re-imported, the enable behavior applies.
