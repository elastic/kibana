openapi: 3.0.0
info:
  title: Details Schema
  version: '2023-10-31'
paths:
  /api/endpoint/action/{action_id}:
    get:
      summary: Get action details
      operationId: EndpointGetActionsDetails
      description: Get the details of a response action using the action ID.
      x-codegen-enabled: false
      x-labels: [ ess, serverless ]
      parameters:
        - name: action_id
          in: path
          required: true
          schema:
            type: string
            description: The ID of the action to retrieve.
            example: 'fr518850-681a-4y60-aa98-e22640cae2b8'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActionDetailsResponse'


components:
  x-codegen-enabled: false
  schemas:
    ActionDetailsResponse:
      oneOf:
        - $ref: '#/components/schemas/KillProcess'
        - $ref: '#/components/schemas/GetFile'
        - $ref: '#/components/schemas/Execute'
        - $ref: '#/components/schemas/Runscript'
        - $ref: '#/components/schemas/Upload'
        - $ref: '#/components/schemas/Scan'
        - $ref: '#/components/schemas/Cancel'
        - $ref: '#/components/schemas/Isolate'
        - $ref: '#/components/schemas/Unisolate'
        - $ref: '#/components/schemas/SuspendProcess'
        - $ref: '#/components/schemas/RunningProcesses'
        - $ref: '#/components/schemas/MemoryDump'
      discriminator:
        propertyName: command
        mapping:
          kill-process: '#/components/schemas/KillProcess'
          get-file: '#/components/schemas/GetFile'
          execute: '#/components/schemas/Execute'
          runscript: '#/components/schemas/Runscript'
          upload: '#/components/schemas/Upload'
          scan: '#/components/schemas/Scan'
          cancel: '#/components/schemas/Cancel'
          isolate: '#/components/schemas/Isolate'
          unisolate: '#/components/schemas/Unisolate'
          suspend-process: '#/components/schemas/SuspendProcess'
          running-processes: '#/components/schemas/RunningProcesses'
          memory-dump: '#/components/schemas/MemoryDump'

    DownloadUri:
      type: object
      properties:
        downloadUri:
          type: string
          format: uri-reference
          description: |
            The server relative URI to download the file associated with the output of the response action.
            URI does **not** include the space prefix
          example: '/api/endpoint/action/497f6eca-6276/file/35645-6276-4993/download'

    KillProcess:
      allOf:
        - $ref: '../../model/schema/common.schema.yaml#/components/schemas/ResponseActionDetails'
        - type: object
          properties:
            parameters:
              oneOf:
                - type: object
                  properties:
                    pid:
                      type: number
                      description: The process ID (PID) of the process to terminate.
                      minimum: 1
                - type: object
                  properties:
                    entity_id:
                      type: string
                      description: The entity ID of the process to terminate.
                      minLength: 1
                - type: object
                  properties:
                    process_name:
                      type: string
                      description: The name of the process to terminate. Valid for SentinelOne agent type only.

            outputs:
              type: object
              additionalProperties:
                type: object
                properties:
                  content:
                    oneOf:
                      - type: object
                        properties:
                          code:
                            type: string
                          command:
                            type: string
                          pid:
                            type: number
                      - type: object
                        properties:
                          code:
                            type: string
                          command:
                            type: string
                          entity_id:
                            type: string
                      - type: object
                        properties:
                          code:
                            type: string
                          command:
                            type: string
                          process_name:
                            type: string

    GetFile:
      allOf:
        - $ref: '../../model/schema/common.schema.yaml#/components/schemas/ResponseActionDetails'
        - type: object
          properties:
            parameters:
              type: object
              properties:
                path:
                  type: string
            outputs:
              type: object
              additionalProperties:
                type: object
                properties:
                  content:
                    allOf:
                      - $ref: '#/components/schemas/DownloadUri'
                      - type: object
                        properties:
                          code:
                            type: string
                          zip_size:
                            type: number
                          contents:
                            type: array
                            items:
                              type: object
                              properties:
                                path:
                                  type: string
                                sha256:
                                  type: string
                                size:
                                  type: number
                                file_name:
                                  type: string
                                type:
                                  type: string

    Execute:
      allOf:
        - $ref: '../../model/schema/common.schema.yaml#/components/schemas/ResponseActionDetails'
        - type: object
          properties:
            parameters:
              type: object
              properties:
                command:
                  type: string
                timeout:
                  type: number

            outputs:
              type: object
              additionalProperties:
                type: object
                properties:
                  content:
                    allOf:
                      - $ref: '#/components/schemas/DownloadUri'
                      - type: object
                        properties:
                          code:
                            type: string
                          stdout:
                            type: string
                          stderr:
                            type: string
                          stdout_truncated:
                            type: boolean
                          stderr_truncated:
                            type: boolean
                          shell_code:
                            type: number
                          cwd:
                            type: string
                          output_file_id:
                            type: string
                          output_file_stdout_truncated:
                            type: boolean
                          output_file_stderr_truncated:
                            type: boolean

    RunscriptParamsCrowdStrike:
      type: object
      properties:
        raw:
          type: string
        hostPath:
          type: string
        cloudFile:
          type: string
        commandLine:
          type: string
        timeout:
          type: number

    RunscriptParamsMicrosoft:
      type: object
      properties:
        scriptName:
          type: string
        args:
          type: string

    RunscriptParamsSentinelOne:
      type: object
      properties:
        scriptId:
          type: string
        scriptInput:
          type: string

    Runscript:
      allOf:
        - $ref: '../../model/schema/common.schema.yaml#/components/schemas/ResponseActionDetails'
        - type: object
          properties:
            parameters:
              oneOf:
                - $ref: '#/components/schemas/RunscriptParamsCrowdStrike'
                - $ref: '#/components/schemas/RunscriptParamsMicrosoft'
                - $ref: '#/components/schemas/RunscriptParamsSentinelOne'
            outputs:
              type: object
              additionalProperties:
                type: object
                properties:
                  content:
                    allOf:
                      - $ref: '#/components/schemas/DownloadUri'
                      - type: object
                        properties:
                          code:
                            type: string
                          stdout:
                            type: string
                          stderr:
                            type: string

    Upload:
      allOf:
        - $ref: '../../model/schema/common.schema.yaml#/components/schemas/ResponseActionDetails'
        - type: object
          properties:
            parameters:
              type: object
              description: |
                The parameters for upload returned on the details are derived via the API from the file that
                was uploaded at the time that the response action was submitted
              properties:
                file_sha256:
                  type: string
                file_size:
                  type: number
                file_name:
                  type: string
                file_id:
                  type: string
            outputs:
              type: object
              additionalProperties:
                type: object
                properties:
                  content:
                    type: object
                    properties:
                      code:
                        type: string
                      path:
                        type: string
                      disk_free_space:
                        type: number

    Scan:
      allOf:
        - $ref: '../../model/schema/common.schema.yaml#/components/schemas/ResponseActionDetails'
        - type: object
          properties:
            parameters:
              type: object
              properties:
                path:
                  type: string
            outputs:
              type: object
              additionalProperties:
                type: object
                properties:
                  content:
                    type: object
                    properties:
                      code:
                        type: string

    Cancel:
      allOf:
        - $ref: '../../model/schema/common.schema.yaml#/components/schemas/ResponseActionDetails'
        - type: object
          properties:
            parameters:
              type: object
              properties:
                id:
                  type: string
                  format: uuid
            outputs:
              type: object
              additionalProperties:
                type: object
                properties:
                  content:
                    type: object
                    properties:
                      code:
                        type: string

    Isolate:
      $ref: '../../model/schema/common.schema.yaml#/components/schemas/ResponseActionDetails'

    Unisolate:
      $ref: '../../model/schema/common.schema.yaml#/components/schemas/ResponseActionDetails'

    SuspendProcess:
      allOf:
        - $ref: '../../model/schema/common.schema.yaml#/components/schemas/ResponseActionDetails'
        - type: object
          properties:
            parameters:
              oneOf:
                - type: object
                  properties:
                    pid:
                      type: number
                      description: The process ID (PID) of the process to terminate.
                      minimum: 1
                - type: object
                  properties:
                    entity_id:
                      type: string
                      description: The entity ID of the process to terminate.
                      minLength: 1
            outputs:
              type: object
              additionalProperties:
                type: object
                properties:
                  content:
                    oneOf:
                      - type: object
                        properties:
                          code:
                            type: string
                          command:
                            type: string
                          pid:
                            type: number
                      - type: object
                        properties:
                          code:
                            type: string
                          command:
                            type: string
                          entity_id:
                            type: string

    RunningProcessesOutputEndpoint:
      type: object
      description: Processes output for `agentType` of `endpoint`
      properties:
        code:
          type: string
        entries:
          type: array
          items:
            type: object
            properties:
              command:
                type: string
              pid:
                type: number
              entity_id:
                type: string
              user:
                type: string

    RunningProcessesOutputSentinelOne:
      allOf:
        - $ref: '#/components/schemas/DownloadUri'
        - type: object
          description: Processes output for `agentType` of `sentinel_one`
          properties:
            code:
              type: string

    RunningProcesses:
      allOf:
        - $ref: '../../model/schema/common.schema.yaml#/components/schemas/ResponseActionDetails'
        - type: object
          properties:
            outputs:
              type: object
              additionalProperties:
                type: object
                properties:
                  content:
                    oneOf:
                      - $ref: '#/components/schemas/RunningProcessesOutputEndpoint'
                      - $ref: '#/components/schemas/RunningProcessesOutputSentinelOne'

    MemoryDump:
      allOf:
        - $ref: '../../model/schema/common.schema.yaml#/components/schemas/ResponseActionDetails'
        - type: object
          required:
            - parameters
          properties:
            parameters:
              oneOf:
                - type: object
                  title: Kernel memory dump
                  required:
                    - type
                  properties:
                    type:
                      description: Kernel-level memory dump
                      type: string
                      enum:
                        - kernel
                - type: object
                  title: Process memory dump with PID
                  required:
                    - type
                    - pid
                  properties:
                    type:
                      description: Process-level memory dump using a process ID
                      type: string
                      enum:
                        - process
                    pid:
                      type: number
                      description: The process ID (PID)
                - type: object
                  title: Process memory dump with entity ID
                  required:
                    - type
                    - entity_id
                  properties:
                    type:
                      description: Process-level memory dump using an entity ID
                      type: string
                      enum:
                        - process
                    entity_id:
                      type: string
                      description: The process entity ID

            outputs:
              type: object
              additionalProperties:
                type: object
                properties:
                  content:
                    type: object
                    title: Memory dump output
                    properties:
                      code:
                        type: string
                      file_size:
                        type: string
                        description: The size of the memory dump compressed file in bytes
                      path:
                        type: string
                        description: The path to the memory dump compressed file on the host machine
                      disk_free_space:
                        type: number
                        description: The free space on the host machine in bytes after the memory dump is written to disk
