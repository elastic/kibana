openapi: 3.0.0
info:
  version: '2023-10-31'
  title: Entity Store - Update or Create Entity
paths:
  /api/entity_store/entities/{entityType}:
    put:
      x-labels: [ess, serverless]
      x-codegen-enabled: true
      operationId: UpsertEntity
      summary: Upsert an entity in Entity Store
      description: >
        Update or create an entity in Entity Store.
        
        If the specified entity already exists, it is updated with the provided values. 
        If the entity does not exist, a new one is created.
        By default, only the following fields can be updated:
        * `entity.attributes.*`
        * `entity.lifecycle.*`
        * `entity.behavior.*`
        To update other fields, set the `force` query parameter to `true`.
        > info
        > Some fields always retain the first observed value. Updates to these fields will not appear in the final index.
        
        > Due to technical limitations, not all updates are guaranteed to appear in the final list of observed values.

        > Due to technical limitations, create is an async operation. The time for a document to be present in the 
        > final index depends on the entity store transform and usually takes more than 1 minute.
      parameters:
        - name: entityType
          in: path
          required: true
          schema:
            $ref: '../common.schema.yaml#/components/schemas/EntityType'
        - name: force
          in: query
          required: false
          schema:
            type: boolean
            default: false
      requestBody:
        description: Schema for the updating a single entity
        required: true
        content:
          application/json:
            schema:
              $ref: './common.schema.yaml#/components/schemas/Entity'
      responses:
        '409':
          description: Conflict. The entity was updated while another update was happening in ElasticSearch
        '403':
          description: Operation on a restricted field
        '503':
          description: Operation on an uninitialized Engine or in a cluster without CRUD API Enabled
        '200':
          description: Entity updated or created
          content:
            application/json:
              schema:
                $ref: './common.schema.yaml#/components/schemas/Entity'