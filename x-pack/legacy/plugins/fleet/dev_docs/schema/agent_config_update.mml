sequenceDiagram
  participant User
  participant Ingest API
  participant SavedObjects

  User->>Ingest API: updateConfig|addDatasource|...
  rect rgba(191, 223, 255, .2)
  Note over Ingest API,SavedObjects: Update saved objects
  Ingest API->>SavedObjects: updateAgentConfig()
  Ingest API->>SavedObjects: updateDatasources()
  end

  rect rgba(191, 223, 255, .2)
    loop For every enrolled agent using this config
      Ingest API->>Ingest API: getConfigForAgent(agentId)
      Ingest API->>SavedObjects: getAgent(agentId)
      Ingest API->>SavedObjects: updateAgent(newConfig)
      Note right of SavedObjects: config need to be <br/>encrypted
    end
  end

  Ingest API->>User: sucess
