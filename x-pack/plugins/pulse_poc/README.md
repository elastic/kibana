# Pulse Service POC

This is the POC service code. This wouldn't actually be in the Kibana project, but it is for the POC.

## How it works

The Pulse **client** in Kibana would send telemetry organized by *channel* periodically to the Pulse service's intake API. Independently, the Pulse client polls the instructions API on the Pulse service to receive any instructions that it should act on.

The Pulse **service** performs *checks* across all of its channels when the client requests it, and it returns any *instructions* that are generated by those checks. Kibana would be orchestrated to react to those instructions.

## Set up

You must run Elasticsearch with security disabled, for example:

```sh
yarn es snapshot -E xpack.security.enabled=false
```

Only after Elasticsearch has finished starting up, you must start Kibana on
localhost and port 5601 (the defaults) and not be using the basepath proxy:

```sh
yarn start --no-base-path
```

## Rest API

These APIs are accessible through Kibana for this POC. The actual service would
live at a dedicated elastic.co URL.

### `POST /api/pulse_poc/intake/{deploymentId}`

Used to send channel-based telemetry into the pulse service.

### `GET /api/pulse_poc/instructions/{deploymentId}`

Used to retrieve the current set of instructions for the current deployment. The response will include any instructions for the given deployment, organized by the channel they are associated with.

## Channels

Any directory inside `pulse_poc/server/channels` will become an available
channel.

## Checks

Any TypeScript file beginning with `check_` inside of a channel directory will
be imported as a "check" module. These modules should export `async check()`
which returns `undefined` if the check should not generate any instructions
for this deployment. If the conditions of the check do warrant sending
instructions to this deployment, then `check` should return those instructions
in the form of a plain JS object.
