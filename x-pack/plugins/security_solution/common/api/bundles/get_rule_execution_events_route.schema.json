{
  "openapi": "3.0.0",
  "info": {
    "title": "Get Rule Execution Events API endpoint",
    "version": "1"
  },
  "paths": {
    "/internal/detection_engine/rules/{ruleId}/execution/events": {
      "put": {
        "operationId": "GetRuleExecutionEvents",
        "x-codegen-enabled": true,
        "summary": "Returns execution events of a given rule (aggregated by execution UUID) from Event Log.",
        "tags": [
          "Rule Execution Log API"
        ],
        "parameters": [
          {
            "name": "ruleId",
            "in": "path",
            "required": true,
            "description": "Saved object ID of the rule to get execution results for",
            "schema": {
              "type": "string",
              "minLength": 1
            }
          },
          {
            "name": "start",
            "in": "query",
            "required": true,
            "description": "Start date of the time range to query",
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          },
          {
            "name": "end",
            "in": "query",
            "required": true,
            "description": "End date of the time range to query",
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          },
          {
            "name": "query_text",
            "in": "query",
            "required": false,
            "description": "Query text to filter results by",
            "schema": {
              "type": "string",
              "default": ""
            }
          },
          {
            "name": "status_filters",
            "in": "query",
            "required": false,
            "description": "Comma-separated list of rule execution statuses to filter results by",
            "schema": {
              "type": "array",
              "items": {
                "$ref": "#/components/schemas/RuleExecutionStatus"
              },
              "default": []
            }
          },
          {
            "name": "sort_field",
            "in": "query",
            "required": false,
            "description": "Field to sort results by",
            "schema": {
              "$ref": "#/components/schemas/SortFieldOfRuleExecutionResult",
              "default": "timestamp"
            }
          },
          {
            "name": "sort_order",
            "in": "query",
            "required": false,
            "description": "Sort order to sort results by",
            "schema": {
              "$ref": "#/components/schemas/SortOrder",
              "default": "desc"
            }
          },
          {
            "name": "page",
            "in": "query",
            "required": false,
            "description": "Page number to return",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "required": false,
            "description": "Number of results per page",
            "schema": {
              "type": "integer",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Indicates a successful call",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "events": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/RuleExecutionResult"
                      }
                    },
                    "total": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "RuleExecutionStatus": {
        "type": "string",
        "description": "Custom execution status of Security rules that is different from the status used in the Alerting Framework. We merge our custom status with the Framework's status to determine the resulting status of a rule.\n- going to run - @deprecated Replaced by the 'running' status but left for backwards compatibility with rule execution events already written to Event Log in the prior versions of Kibana. Don't use when writing rule status changes.\n- running - Rule execution started but not reached any intermediate or final status.\n- partial failure - Rule can partially fail for various reasons either in the middle of an execution (in this case we update its status right away) or in the end of it. So currently this status can be both intermediate and final at the same time. A typical reason for a partial failure: not all the indices that the rule searches over actually exist.\n- failed - Rule failed to execute due to unhandled exception or a reason defined in the business logic of its executor function.\n- succeeded - Rule executed successfully without any issues. Note: this status is just an indication of a rule's \"health\". The rule might or might not generate any alerts despite of it.",
        "enum": [
          "going to run",
          "running",
          "partial failure",
          "failed",
          "succeeded"
        ]
      },
      "SortFieldOfRuleExecutionResult": {
        "type": "string",
        "description": "We support sorting rule execution results by these fields.",
        "enum": [
          "timestamp",
          "duration_ms",
          "gap_duration_s",
          "indexing_duration_ms",
          "search_duration_ms",
          "schedule_delay_ms"
        ]
      },
      "SortOrder": {
        "type": "string",
        "enum": [
          "asc",
          "desc"
        ]
      },
      "RuleExecutionResult": {
        "type": "object",
        "description": "Rule execution result is an aggregate that groups plain rule execution events by execution UUID. It contains such information as execution UUID, date, status and metrics.",
        "properties": {
          "execution_uuid": {
            "type": "string"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "duration_ms": {
            "type": "integer"
          },
          "status": {
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "num_active_alerts": {
            "type": "integer"
          },
          "num_new_alerts": {
            "type": "integer"
          },
          "num_recovered_alerts": {
            "type": "integer"
          },
          "num_triggered_actions": {
            "type": "integer"
          },
          "num_succeeded_actions": {
            "type": "integer"
          },
          "num_errored_actions": {
            "type": "integer"
          },
          "total_search_duration_ms": {
            "type": "integer"
          },
          "es_search_duration_ms": {
            "type": "integer"
          },
          "schedule_delay_ms": {
            "type": "integer"
          },
          "timed_out": {
            "type": "boolean"
          },
          "indexing_duration_ms": {
            "type": "integer"
          },
          "search_duration_ms": {
            "type": "integer"
          },
          "gap_duration_s": {
            "type": "integer"
          },
          "security_status": {
            "type": "string"
          },
          "security_message": {
            "type": "string"
          }
        },
        "required": [
          "execution_uuid",
          "timestamp",
          "duration_ms",
          "status",
          "message",
          "num_active_alerts",
          "num_new_alerts",
          "num_recovered_alerts",
          "num_triggered_actions",
          "num_succeeded_actions",
          "num_errored_actions",
          "total_search_duration_ms",
          "es_search_duration_ms",
          "schedule_delay_ms",
          "timed_out",
          "indexing_duration_ms",
          "search_duration_ms",
          "gap_duration_s",
          "security_status",
          "security_message"
        ]
      }
    }
  }
}