openapi: 3.0.0
info:
  title: Get alerts migration status API endpoint
  version: '2023-10-31'
paths:
  /api/detection_engine/signals/migration_status:
    post:
      x-labels: [ess]
      operationId: GetAlertsMigrationStatus
      summary: Returns an alerts migration status
      tags:
        - Alerts migration API
      parameters:
        - name: from
          in: query
          description: Maximum age of qualifying detection alerts
          required: true
          schema:
            type: string
            description: |
              Time from which data is analyzed. For example, now-4200s means the rule analyzes data from 70 minutes
              before its start time. Defaults to now-6m (analyzes data from 6 minutes before the start time).
            format: date-math
      responses:
        200:
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetAlertsMigrationStatusResponse'
        400:
          description: Invalid input data response
          content:
            application/json:
              schema:
                $ref: '../../model/error_response.schema.yaml#/components/schemas/GenericErrorResponse'
        401:
          description: Unsuccessful authentication response
          content:
            application/json:
              schema:
                $ref: '../../model/error_response.schema.yaml#/components/schemas/GenericErrorResponse'

components:
  schemas:
    GetAlertsMigrationStatusResponse:
      type: object
      properties:
        indices:
          type: array
          items:
            $ref: '#/components/schemas/IndexMigrationStatus'

    IndexMigrationStatus:
      type: object
      properties:
        index:
          $ref: '../../../model/primitives.schema.yaml#/components/schemas/NonEmptyString'
        version:
          type: integer
        signal_versions:
          type: array
          items:
            $ref: '#/components/schemas/AlertVersion'
        migrations:
          type: array
          items:
            $ref: '#/components/schemas/MigrationStatus'
        is_outdated:
          type: boolean

    AlertVersion:
      type: object
      properties:
        version:
          type: integer
        count:
          type: integer

    MigrationStatus:
      type: object
      properties:
        id:
          $ref: '../../../model/primitives.schema.yaml#/components/schemas/NonEmptyString'
        status:
          type: string
          enum:
            - success
            - failure
            - pending
        version:
          type: integer
        updated:
          type: string
          format: date-time
