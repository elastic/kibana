{{~#if type~}}
  {{~> (concat "type_" type)~}}
  {{~#if nullable}}.nullable(){{/if~}}
  {{~#if (eq required false)}}.optional(){{/if~}}
  {{~#if (defined default)}}.default({{{toJSON default}}}){{/if~}}
{{~/if~}}

{{~#if $ref~}}
  {{prefix}}{{parseRef $ref}}
  {{~#if nullable}}.nullable(){{/if~}}
  {{~#if (eq required false)}}.optional(){{/if~}}
  {{~#if (defined default)}}.default({{{toJSON default}}}){{/if~}}
{{~/if~}}

{{~#if allOf~}}
  {{~#each allOf~}}
    {{~#if @first~}}
      {{> schema_item prefix=prefix}}
    {{~else~}}
      .and({{> schema_item prefix=prefix}})
    {{~/if~}}
  {{~/each~}}
{{~/if~}}

{{~#if anyOf~}}
  z.union([
    {{~#each anyOf~}}
    {{~> schema_item prefix=prefix~}},
    {{~/each~}}
  ])
{{~/if~}}
{{~#if oneOf~}}
  z.union([
    {{~#each oneOf~}}
    {{~> schema_item prefix=prefix~}},
    {{~/each~}}
  ])
{{~/if~}}

{{~#*inline "type_array"~}}
  {{~#if x-preprocess}}
  z.preprocess({{prefix}}{{x-preprocess}}, z.array({{~> schema_item items prefix=prefix~}}))
  {{else}}
  z.array({{~> schema_item items prefix=prefix~}})
  {{~/if~}}
  {{~#if minItems}}.min({{minItems}}){{/if~}}
  {{~#if maxItems}}.max({{maxItems}}){{/if~}}
{{~/inline~}}

{{~#*inline "type_boolean"~}}
  z.boolean()
  {{~#if nullable}}.nullable(){{/if~}}
{{~/inline~}}

{{~#*inline "type_integer"~}}
  z.number()
  {{~#if minimum includeZero=true}}.min({{minimum}}){{/if~}}
  {{~#if maximum includeZero=true}}.max({{maximum}}){{/if~}}
{{~/inline~}}

{{~#*inline "type_object"~}}
  z.object({
    {{#each properties}}
      {{#if description}}
      /** 
      * {{{description}}} 
      */
      {{/if}}
      {{@key}}: {{> schema_item prefix=../prefix required=(includes ../required @key)}},
    {{/each}}
  })
{{~/inline~}}

{{~#*inline "type_string"~}}
  {{~#if enum~}}
  z.enum([
    {{~#each enum~}}
      "{{.}}",
    {{~/each~}}
  ])
  {{~else~}}
  z.string()
  {{~#if minLength}}.min({{minLength}}){{/if~}}
  {{~#if maxLength}}.max({{maxLength}}){{/if~}}
  {{~#if (eq format 'date-time')}}.datetime(){{/if~}}
  {{~/if~}}
{{~/inline~}}
