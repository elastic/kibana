/*
 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
 * or more contributor license agreements. Licensed under the Elastic License
 * 2.0; you may not use this file except in compliance with the Elastic License
 * 2.0.
 */

import type { RootSchema } from '@kbn/analytics-client';
import type { Message } from '../../common';
import type { Feedback } from '../components/feedback_buttons';

export const MESSAGE_FEEDBACK =
  'observability_ai_assistant_chat_assistant_message_feedback_from_user' as const;
export const INSIGHT_FEEDBACK = 'observability_ai_assistant_insight_feedback_from_user' as const;

export interface MessageFeedback extends Message {
  feedback: Feedback;
}

export interface FeedbackFromUserOnAssistantTelemetryEvent {
  eventType: typeof MESSAGE_FEEDBACK | typeof INSIGHT_FEEDBACK;
  schema: RootSchema<MessageFeedback>;
}

export const MESSAGE_FEEDBACK_SCHEMA: FeedbackFromUserOnAssistantTelemetryEvent = {
  eventType: MESSAGE_FEEDBACK,
  schema: {
    '@timestamp': {
      type: 'text',
      _meta: {
        description: 'The timestamp of the message.',
      },
    },
    feedback: {
      type: 'text',
      _meta: {
        description: 'Whether the user has deemed this response useful or not',
      },
    },
    message: {
      properties: {
        content: {
          type: 'text',
          _meta: {
            description: 'The response generated by the LLM.',
            optional: true,
          },
        },
        name: {
          type: 'text',
          _meta: {
            description: 'The name of the function that was executed.',
            optional: true,
          },
        },
        role: {
          type: 'text',
          _meta: {
            description: 'The actor that generated the response.',
          },
        },
        data: {
          type: 'text',
          _meta: {
            description: '',
            optional: true,
          },
        },
        function_call: {
          _meta: {
            description: 'The function call that was executed.',
            optional: true,
          },
          properties: {
            name: {
              type: 'text',
              _meta: {
                description: 'The name of the function that was executed.',
                optional: false,
              },
            },
            arguments: {
              type: 'text',
              _meta: {
                description: 'The arguments that were used when executing the function.',
                optional: true,
              },
            },
            trigger: {
              type: 'text',
              _meta: {
                description: 'The actor which triggered the execution of this function.',
              },
            },
          },
        },
      },
    },
  },
};
