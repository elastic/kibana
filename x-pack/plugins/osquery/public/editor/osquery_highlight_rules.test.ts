/*
 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
 * or more contributor license agreements. Licensed under the Elastic License
 * 2.0; you may not use this file except in compliance with the Elastic License
 * 2.0.
 */

import { getEditorAutoCompleteSuggestion } from './osquery_highlight_rules';
import { flatMap } from 'lodash';

describe('Osquery Editor', () => {
  const regex = /\s*[\s,]\s*/;

  test('should split properly by regex', () => {
    const value = 'Select description, user_account from services; /n Where des';
    const split = value.split(regex);
    const result = [
      'Select',
      'description',
      'user_account',
      'from',
      'services;',
      '/n',
      'Where',
      'des',
    ];

    // const suggestions = getEditorAutoCompleteSuggestion(defaultRange, value, false);

    expect(split).toEqual(result);
    // expect(suggestions).toEqual([]);
  });
  test('should provide proper suggestions', () => {
    const value = 'Select description, user_account from services; /n Where des';

    const range = { startLineNumber: 2, endLineNumber: 2, startColumn: 2, endColumn: 2 };

    // @ts-expect-error TS2339: Property 'suggestions' does not exist on type 'ProviderResult '.
    const { suggestions } = getEditorAutoCompleteSuggestion(range, value, false);

    const flatSuggestionLabels = flatMap(suggestions, (obj) => obj.label);
    expect(flatSuggestionLabels).toEqual(suggestionLabels);
  });
  test('should provide just keywords if column is 1', () => {
    const value = 'Select description, user_account from services; /n Where des';

    const range = { startLineNumber: 1, endLineNumber: 1, startColumn: 1, endColumn: 1 };

    // @ts-expect-error TS2339: Property 'suggestions' does not exist on type 'ProviderResult '.
    const { suggestions } = getEditorAutoCompleteSuggestion(range, value, false);

    const flatSuggestionLabels = flatMap(suggestions, (obj) => obj.label);
    expect(flatSuggestionLabels).toEqual(keywordsSuggestionLabels);
  });
});

const keywordsSuggestionLabels = [
  'SELECT',
  'INSERT',
  'UPDATE',
  'DELETE',
  'FROM',
  'WHERE',
  'AND',
  'OR',
  'GROUP',
  'BY',
  'ORDER',
  'LIMIT',
  'OFFSET',
  'HAVING',
  'AS',
  'CASE',
  'WHEN',
  'ELSE',
  'END',
  'TYPE',
  'LEFT',
  'RIGHT',
  'JOIN',
  'ON',
  'OUTER',
  'DESC',
  'ASC',
  'UNION',
  'CREATE',
  'TABLE',
  'PRIMARY',
  'KEY',
  'IF',
  'FOREIGN',
  'NOT',
  'REFERENCES',
  'DEFAULT',
  'NULL',
  'INNER',
  'CROSS',
  'NATURAL',
  'DATABASE',
  'DROP',
  'GRANT',
];
const suggestionLabels = [
  ...keywordsSuggestionLabels,
  'account_policy_data',
  'acpi_tables',
  'ad_config',
  'alf',
  'alf_exceptions',
  'alf_explicit_auths',
  'app_schemes',
  'apparmor_events',
  'apparmor_profiles',
  'appcompat_shims',
  'apps',
  'apt_sources',
  'arp_cache',
  'asl',
  'atom_packages',
  'augeas',
  'authenticode',
  'authorization_mechanisms',
  'authorizations',
  'authorized_keys',
  'autoexec',
  'azure_instance_metadata',
  'azure_instance_tags',
  'background_activities_moderator',
  'battery',
  'bitlocker_info',
  'block_devices',
  'bpf_process_events',
  'bpf_socket_events',
  'browser_plugins',
  'carbon_black_info',
  'carves',
  'certificates',
  'chassis_info',
  'chocolatey_packages',
  'chrome_extension_content_scripts',
  'chrome_extensions',
  'connectivity',
  'cpu_info',
  'cpu_time',
  'cpuid',
  'crashes',
  'crontab',
  'cups_destinations',
  'cups_jobs',
  'curl',
  'curl_certificate',
  'deb_packages',
  'default_environment',
  'device_file',
  'device_firmware',
  'device_hash',
  'device_partitions',
  'disk_encryption',
  'disk_events',
  'disk_info',
  'dns_cache',
  'dns_resolvers',
  'docker_container_envs',
  'docker_container_fs_changes',
  'docker_container_labels',
  'docker_container_mounts',
  'docker_container_networks',
  'docker_container_ports',
  'docker_container_processes',
  'docker_container_stats',
  'docker_containers',
  'docker_image_history',
  'docker_image_labels',
  'docker_image_layers',
  'docker_images',
  'docker_info',
  'docker_network_labels',
  'docker_networks',
  'docker_version',
  'docker_volume_labels',
  'docker_volumes',
  'drivers',
  'ec2_instance_metadata',
  'ec2_instance_tags',
  'es_process_events',
  'es_process_file_events',
  'etc_hosts',
  'etc_protocols',
  'etc_services',
  'event_taps',
  'extended_attributes',
  'fan_speed_sensors',
  'file',
  'file_events',
  'firefox_addons',
  'gatekeeper',
  'gatekeeper_approved_apps',
  'groups',
  'hardware_events',
  'hash',
  'homebrew_packages',
  'host_groups',
  'host_processes',
  'host_users',
  'hvci_status',
  'ibridge_info',
  'ie_extensions',
  'intel_me_info',
  'interface_addresses',
  'interface_details',
  'interface_ipv6',
  'iokit_devicetree',
  'iokit_registry',
  'iptables',
  'kernel_extensions',
  'kernel_info',
  'kernel_modules',
  'kernel_panics',
  'keychain_acls',
  'keychain_items',
  'known_hosts',
  'kva_speculative_info',
  'last',
  'launchd',
  'launchd_overrides',
  'listening_ports',
  'load_average',
  'location_services',
  'logged_in_users',
  'logical_drives',
  'logon_sessions',
  'lxd_certificates',
  'lxd_cluster',
  'lxd_cluster_members',
  'lxd_images',
  'lxd_instance_config',
  'lxd_instance_devices',
  'lxd_instances',
  'lxd_networks',
  'lxd_storage_pools',
  'magic',
  'managed_policies',
  'md_devices',
  'md_drives',
  'md_personalities',
  'mdfind',
  'mdls',
  'memory_array_mapped_addresses',
  'memory_arrays',
  'memory_device_mapped_addresses',
  'memory_devices',
  'memory_error_info',
  'memory_info',
  'memory_map',
  'mounts',
  'msr',
  'nfs_shares',
  'npm_packages',
  'ntdomains',
  'ntfs_acl_permissions',
  'ntfs_journal_events',
  'nvram',
  'oem_strings',
  'office_mru',
  'os_version',
  'osquery_events',
  'osquery_extensions',
  'osquery_flags',
  'osquery_info',
  'osquery_packs',
  'osquery_registry',
  'osquery_schedule',
  'package_bom',
  'package_install_history',
  'package_receipts',
  'password_policy',
  'patches',
  'pci_devices',
  'physical_disk_performance',
  'pipes',
  'platform_info',
  'plist',
  'portage_keywords',
  'portage_packages',
  'portage_use',
  'power_sensors',
  'powershell_events',
  'preferences',
  'prefetch',
  'process_envs',
  'process_events',
  'process_file_events',
  'process_memory_map',
  'process_namespaces',
  'process_open_files',
  'process_open_pipes',
  'process_open_sockets',
  'processes',
  'programs',
  'prometheus_metrics',
  'python_packages',
  'quicklook_cache',
  'registry',
  'routes',
  'rpm_package_files',
  'rpm_packages',
  'running_apps',
  'safari_extensions',
  'sandboxes',
  'scheduled_tasks',
  'screenlock',
  'seccomp_events',
  'secureboot',
  'security_profile_info',
  'selinux_events',
  'selinux_settings',
  'services',
  'shadow',
  'shared_folders',
  'shared_memory',
  'shared_resources',
  'sharing_preferences',
  'shell_history',
  'shellbags',
  'shimcache',
  'signature',
  'sip_config',
  'smbios_tables',
  'smc_keys',
  'socket_events',
  'ssh_configs',
  'startup_items',
  'sudoers',
  'suid_bin',
  'syslog_events',
  'system_controls',
  'system_extensions',
  'system_info',
  'systemd_units',
  'temperature_sensors',
  'time',
  'time_machine_backups',
  'time_machine_destinations',
  'tpm_info',
  'ulimit_info',
  'unified_log',
  'uptime',
  'usb_devices',
  'user_events',
  'user_groups',
  'user_interaction_events',
  'user_ssh_keys',
  'userassist',
  'users',
  'video_info',
  'virtual_memory_info',
  'wifi_networks',
  'wifi_status',
  'wifi_survey',
  'winbaseobj',
  'windows_crashes',
  'windows_eventlog',
  'windows_events',
  'windows_firewall_rules',
  'windows_optional_features',
  'windows_security_center',
  'windows_security_products',
  'windows_update_history',
  'wmi_bios_info',
  'wmi_cli_event_consumers',
  'wmi_event_filters',
  'wmi_filter_consumer_binding',
  'wmi_script_event_consumers',
  'xprotect_entries',
  'xprotect_meta',
  'xprotect_reports',
  'yara',
  'yara_events',
  'ycloud_instance_metadata',
  'yum_sources',
  'true',
  'false',
  'avg',
  'count',
  'first',
  'max',
  'min',
  'sum',
  'ucase',
  'lcase',
  'mid',
  'len',
  'round',
  'rank',
  'now',
  'format',
  'coalesce',
  'ifnull',
  'isnull',
  'nvl',
  'int',
  'numeric',
  'decimal',
  'date',
  'varchar',
  'char',
  'bigint',
  'float',
  'double',
  'bit',
  'binary',
  'text',
  'set',
  'timestamp',
  'money',
  'real',
  'number',
  'integer',
  'description',
  'user_account',
  'services;',
  '/n',
];
