input {
    stdin {}
}

filter {
    csv {
        columns => ["avlAddress","avlAirTemp","avlBlast","avlDirection","avlDryRate","avlLatitudeDD","avlLiquidRate","avlLongitudeDD","avlPlowStatus","avlSecond","avlVehName","avlVehType","avlVelocity","kytcADTLastCnt","kytcADTLastCntYr","kytcCityTxt","kytcCountyName","kytcCountyNmbr","kytcDataCaptureTimeUTC","kytcDateExistsET","kytcDateExistsUTC","kytcDistrict","kytcFunctionalClass","kytcGovLevelTxt","kytcHourET","kytcLatDDRdSnap","kytcLongDDRdSnap","kytcMinuteET","kytcMPInitial","kytcRdName","kytcRoute","kytcRouteLbl","kytcRouteType","kytcRtNumber","kytcRtPrefix","kytcRtSection","kytcRtSuffix","kytcRtUniqueInitial","kytcSnapDistanceOnLine","kytcSnapDistanceToLine","kytcSnapHeadingRadians","kytcSnapPercentAlong","kytcSnapPercentAlong","kytcSnapStatus","kytcSnwIcePriority","kytcTypeOp","kytcWeekDayTxtET","kytcYearDayET","kytcDryRateCalc","kytcLiquidRateCalc","kytcDryRateCalcCost","kytcLiquidRateCalcCost","kytcYearET","kytcMonthET","kytcdayet"]
    }
    # Ignore first row
    if [avlAddress] == "avladdress" {
      drop {}
    }

    if [avlLongitudeDD] and [avlLatitudeDD] {
        mutate {
            add_field => { 
                "[avlPoint][lon]" => "%{avlLongitudeDD}"
                "[avlPoint][lat]" => "%{avlLatitudeDD}"
            }
        }
    }
    if [kytcLongDDRdSnap] and [kytcLatDDRdSnap] {
        mutate {
            add_field => {
            "[kytcSnapPoint][lon]" => "%{kytcLongDDRdSnap}"
            "[kytcSnapPoint][lat]" => "%{kytcLatDDRdSnap}"
            }
        }
    }
    mutate {
        remove_field => ["message"]
    }
}

output {
    # stdout {}
    elasticsearch {
        template => "./avl_webtech_es_idx_template.json"
        template_overwrite => "true"
        template_name => "avl_webtech"
        document_type => "_doc"
        index => "avl_webtech-archive"
    }  
}