openapi: 3.0.0
info:
  title: Common Attack Discovery Schedule Types (API)
  version: 'not applicable'
paths: {}
components:
  x-codegen-enabled: true
  schemas:
    AttackDiscoveryApiSchedule:
      type: object
      description: An attack discovery schedule
      required:
        - id
        - name
        - created_by
        - updated_by
        - created_at
        - updated_at
        - enabled
        - params
        - schedule
        - actions
      properties:
        id:
          description: UUID of attack discovery schedule
          type: string
        name:
          description: The name of the schedule
          type: string
        created_by:
          description: The name of the user that created the schedule
          type: string
        updated_by:
          description: The name of the user that updated the schedule
          type: string
        created_at:
          description: The date the schedule was created
          type: string
          format: date-time
        updated_at:
          description: The date the schedule was updated
          type: string
          format: date-time
        enabled:
          description: Indicates whether the schedule is enabled
          type: boolean
        params:
          description: The attack discovery schedule configuration parameters
          $ref: '#/components/schemas/AttackDiscoveryApiScheduleParams'
        schedule:
          description: The attack discovery schedule interval
          $ref: '#/components/schemas/IntervalApiSchedule'
        actions:
          description: The attack discovery schedule actions
          type: array
          items:
            $ref: '#/components/schemas/AttackDiscoveryApiScheduleAction'
        last_execution:
          description: The attack discovery schedule last execution summary
          $ref: '#/components/schemas/AttackDiscoveryApiScheduleExecution'

    AttackDiscoveryApiScheduleParams:
      type: object
      description: An attack discovery schedule params
      required:
        - alerts_index_pattern
        - api_config
        - size
      properties:
        alerts_index_pattern:
          description: The index pattern to get alerts from
          type: string
        api_config:
          description: LLM API configuration.
          allOf:
            - $ref: '../../../../conversations/common_attributes.schema.yaml#/components/schemas/ApiConfig'
            - type: object
              required:
                - name
              properties:
                name:
                  description: The name of the connector
                  type: string
        end:
          type: string
        query:
          $ref: '#/components/schemas/Query'
        filters:
          $ref: '#/components/schemas/Filters'
        combined_filter:
          type: object
          additionalProperties: true
        size:
          type: number
        start:
          type: string

    Query:
      type: object
      description: An query condition to filter alerts
      required:
        - query
        - language
      properties:
        query:
          oneOf:
            - type: string
            - type: object
              additionalProperties: true # { [key: string]: any }
        language:
          type: string

    Filters:
      description: The filter array used to define the conditions for when alerts are selected as an attack discovery context. Defaults to an empty array.
      type: array
      items: {} # unknown

    IntervalApiSchedule:
      type: object
      required:
        - interval
      properties:
        interval:
          description: The schedule interval
          type: string

    AttackDiscoveryApiScheduleActionThrottle:
      description: Defines how often schedule actions are taken. Time interval in seconds, minutes, hours, or days.
      type: string
      pattern: '^[1-9]\d*[smhd]$' # any number except zero followed by one of the suffixes 's', 'm', 'h', 'd'
      example: '1h'

    AttackDiscoveryApiScheduleActionNotifyWhen:
      type: string
      enum:
        - 'onActiveAlert'
        - 'onThrottleInterval'
        - 'onActionGroupChange'
      description: 'The condition for throttling the notification: `onActionGroupChange`, `onActiveAlert`,  or `onThrottleInterval`'

    AttackDiscoveryApiScheduleActionFrequency:
      type: object
      description: The action frequency defines when the action runs (for example, only on schedule execution or at specific time intervals).
      properties:
        summary:
          type: boolean
          description: Action summary indicates whether we will send a summary notification about all the generate alerts or notification per individual alert
        notify_when:
          $ref: '#/components/schemas/AttackDiscoveryApiScheduleActionNotifyWhen'
        throttle:
          $ref: '#/components/schemas/AttackDiscoveryApiScheduleActionThrottle'
          nullable: true
      required:
        - summary
        - notify_when
        - throttle

    AttackDiscoveryApiScheduleActionAlertsFilter:
      type: object
      additionalProperties: true

    AttackDiscoveryApiScheduleActionParams:
      type: object
      description: Object containing the allowed connector fields, which varies according to the connector type.
      additionalProperties: true

    AttackDiscoveryApiScheduleActionGroup:
      type: string
      description: Groups actions by use cases. Use `default` for alert notifications.

    AttackDiscoveryApiScheduleActionId:
      type: string
      description: The connector ID.

    AttackDiscoveryApiScheduleGeneralAction:
      type: object
      properties:
        action_type_id:
          type: string
          description: The action type used for sending notifications.
        group:
          $ref: '#/components/schemas/AttackDiscoveryApiScheduleActionGroup'
        id:
          $ref: '#/components/schemas/AttackDiscoveryApiScheduleActionId'
        params:
          $ref: '#/components/schemas/AttackDiscoveryApiScheduleActionParams'
        uuid:
          $ref: '../../../../common_attributes.schema.yaml#/components/schemas/NonEmptyString'
        alerts_filter:
          $ref: '#/components/schemas/AttackDiscoveryApiScheduleActionAlertsFilter'
        frequency:
          $ref: '#/components/schemas/AttackDiscoveryApiScheduleActionFrequency'
      required:
        - action_type_id
        - group
        - id
        - params

    AttackDiscoveryApiScheduleSystemAction:
      type: object
      properties:
        action_type_id:
          type: string
          description: The action type used for sending notifications.
        id:
          $ref: '#/components/schemas/AttackDiscoveryApiScheduleActionId'
        params:
          $ref: '#/components/schemas/AttackDiscoveryApiScheduleActionParams'
        uuid:
          $ref: '../../../../common_attributes.schema.yaml#/components/schemas/NonEmptyString'
      required:
        - action_type_id
        - id
        - params

    AttackDiscoveryApiScheduleAction:
      oneOf:
        - $ref: '#/components/schemas/AttackDiscoveryApiScheduleGeneralAction'
        - $ref: '#/components/schemas/AttackDiscoveryApiScheduleSystemAction'

    AttackDiscoveryApiScheduleExecutionStatus:
      type: string
      description: An attack discovery schedule execution status
      enum:
        - ok
        - active
        - error
        - unknown
        - warning

    AttackDiscoveryApiScheduleExecution:
      type: object
      description: An attack discovery schedule execution information
      required:
        - date
        - status
        - last_duration
      properties:
        date:
          description: Date of the execution
          type: string
          format: date-time
        duration:
          description: Duration of the execution
          type: number
        status:
          description: Status of the execution
          $ref: '#/components/schemas/AttackDiscoveryApiScheduleExecutionStatus'
        message:
          type: string

    AttackDiscoveryApiScheduleCreateProps:
      type: object
      description: An attack discovery schedule create properties
      required:
        - name
        - params
        - schedule
      properties:
        name:
          description: The name of the schedule
          type: string
        enabled:
          description: Indicates whether the schedule is enabled
          type: boolean
        params:
          description: The attack discovery schedule configuration parameters
          $ref: '#/components/schemas/AttackDiscoveryApiScheduleParams'
        schedule:
          description: The attack discovery schedule interval
          $ref: '#/components/schemas/IntervalApiSchedule'
        actions:
          description: The attack discovery schedule actions
          type: array
          items:
            $ref: '#/components/schemas/AttackDiscoveryApiScheduleAction'

    AttackDiscoveryApiScheduleUpdateProps:
      type: object
      description: An attack discovery schedule update properties
      required:
        - name
        - params
        - schedule
        - actions
      properties:
        name:
          description: The name of the schedule
          type: string
        params:
          description: The attack discovery schedule configuration parameters
          $ref: '#/components/schemas/AttackDiscoveryApiScheduleParams'
        schedule:
          description: The attack discovery schedule interval
          $ref: '#/components/schemas/IntervalApiSchedule'
        actions:
          description: The attack discovery schedule actions
          type: array
          items:
            $ref: '#/components/schemas/AttackDiscoveryApiScheduleAction'
