# INLINESTATS-BY

The INLINE STATS command groups rows based on a common value specified after BY and calculates one or more aggregated values over the grouped rows. The output table retains all columns from the input table, with new columns added or existing columns overridden if their names overlap. Aggregated values can be filtered using WHERE clauses, and if BY is omitted, aggregations are applied over the entire dataset. Supported aggregation functions include AVG, COUNT, MAX, MIN, SUM, and more. Supported grouping functions include BUCKET and TBUCKET. This command is similar to STATS, but preserves all columns from the input table.

## Syntax

`INLINE STATS [column1 =] expression1 [WHERE boolean_expression1][,
      ...,
      [columnN =] expressionN [WHERE boolean_expressionN]]
      [BY [grouping_name1 =] grouping_expression1[,
          ...,
          [grouping_nameN = ] grouping_expressionN]]`

### Parameters

#### columnX

The name by which the aggregated value is returned. If omitted, the name is equal to the corresponding expression. If multiple columns have the same name, all but the rightmost column with this name will be ignored.

#### expressionX

An expression that computes an aggregated value.

#### grouping_expressionX

An expression that outputs the values to group by. If its name coincides with one of the existing or computed columns, that column will be overridden by this one.

#### boolean_expressionX

The condition that determines which rows are included when evaluating expressionX.

## Examples

Calculate the maximum salary for each language group:

This query retrieves the employee number, languages, and salary columns from the employees dataset, then calculates the maximum salary for each language group and adds it as a new column called `max_salary` to each row within the group.

```esql
FROM employees
| KEEP emp_no, languages, salary
| INLINE STATS max_salary = MAX(salary) BY languages
```

Calculate the maximum salary over the entire dataset, adding the result as a new column:

This query selects the employee number, languages, and salary columns from the employees dataset, then calculates the maximum salary across all employees and adds it as a new column called `max_salary` to every row.

```esql
FROM employees
| KEEP emp_no, languages, salary
| INLINE STATS max_salary = MAX(salary)
```

Calculate average salary and count, grouped by languages and tenure:

This query filters for employees who are still hired, keeps relevant columns, calculates each employee's tenure in years, removes the hire date column, and then computes the average salary and the count of employees for each combination of language and tenure. The results are added as new columns to each row in their respective groups.

```esql
FROM employees
| WHERE still_hired
| KEEP emp_no, languages, salary, hire_date
| EVAL tenure = DATE_DIFF("year", hire_date, "2025-09-18T00:00:00")
| DROP hire_date
| INLINE STATS avg_salary = AVG(salary), count = count(*) BY languages, tenure
```

Calculate rounded average salaries for different salary ranges using WHERE clauses:

This query keeps the employee number and salary columns, then calculates the rounded average salary for three different salary ranges: less than $50,000, between $50,000 and $60,000, and $60,000 or more. Each result is added as a new column to every row, depending on which salary range the row falls into.

```esql
FROM employees
| KEEP emp_no, salary
| INLINE STATS avg_lt_50 = ROUND(AVG(salary)) WHERE salary < 50000,
               avg_lt_60 = ROUND(AVG(salary)) WHERE salary >=50000 AND salary < 60000,
               avg_gt_60 = ROUND(AVG(salary)) WHERE salary >= 60000
```

## Limitations

- The CATEGORIZE grouping function is not currently supported.
- You cannot use LIMIT (explicit or implicit) before INLINE STATS, as this can lead to unexpected results.
- You cannot use FORK before INLINE STATS, because FORK adds an implicit LIMIT to each branch, which can lead to unexpected results.