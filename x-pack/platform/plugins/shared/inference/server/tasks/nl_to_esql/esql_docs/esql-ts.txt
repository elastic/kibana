# TS

The TS source command enables time series semantics and allows the use of time series aggregation functions within the STATS command, such as AVG_OVER_TIME() or RATE. These functions are evaluated per time series and then aggregated by group using a secondary aggregation function. The TS command is similar to the FROM source command, but it specifically targets time series indices and enables time series aggregation functions inside STATS.

## Syntax

`TS index_pattern [METADATA fields]`

### Parameters

#### index_pattern

A list of indices, data streams, or aliases. Supports wildcards and date math.

#### fields

A comma-separated list of metadata fields to retrieve. This parameter is optional.

## Examples

Calculate the total rate of search requests per host and hour, using the RATE function per time series in hourly buckets and summing the rates for each host and hourly bucket.
```esql
TS metrics
| WHERE @timestamp >= now() - 1 hour
| STATS SUM(RATE(search_requests)) BY TBUCKET(1 hour), host
```

Calculate the sum of average memory usage per host and hourly bucket over the last day.
```esql
TS metrics
| WHERE @timestamp >= now() - 1 day
| STATS SUM(AVG_OVER_TIME(memory_usage)) BY host, TBUCKET(1 hour)
```

Return the average of the last memory usage values per time series, implicitly using LAST_OVER_TIME.
```esql
TS metrics | STATS AVG(memory_usage)
```

Explicitly return the average of the last memory usage values per time series.
```esql
TS metrics | STATS AVG(LAST_OVER_TIME(memory_usage))
```

Calculate the average memory usage across per-time-series averages.
```esql
TS metrics | STATS AVG(AVG_OVER_TIME(memory_usage))
```

## Limitations

- The TS command can only be used with time series indices.
- A time series aggregation function must be wrapped inside a regular aggregation function. For example, `TS metrics | STATS RATE(search_requests)` is invalid.
- Using a time series aggregation in combination with an inner function causes an error. For example, `TS metrics | STATS AVG_OVER_TIME(RATE(memory_usage))` is invalid.
- The TS command cannot be combined with certain operations (such as FORK) before the STATS command is applied. Once STATS is applied, you can process the output with other operations.
- Avoid aggregating multiple metrics with different dimensional cardinalities in the same query, as this can result in null values for some dimension combinations.