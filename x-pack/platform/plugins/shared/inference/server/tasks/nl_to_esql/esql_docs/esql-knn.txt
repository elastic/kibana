# KNN

The KNN function finds the k nearest vectors to a query vector using a similarity metric. It performs approximate search on indexed dense_vector or semantic_text fields to identify the closest matches.

## Syntax

`KNN(field, query, options, boost, k, visit_percentage, min_candidates, rescore_oversample, similarity)`

### Parameters

#### field

The field to target for the query. Only dense_vector or semantic_text fields are supported; other text fields are not allowed.

#### query

The vector value for which to find the top nearest neighbors.

#### options

(Optional) Additional kNN options as function named parameters. Refer to the knn query documentation for more details.

#### boost

(Optional) A floating point number to adjust the relevance scores of the query. Defaults to 1.0.

#### k

(Optional) The number of nearest neighbors to return from each shard. This value must be less than or equal to num_candidates and is automatically set when a LIMIT is applied.

#### visit_percentage

(Optional) The percentage of vectors to explore per shard during knn search with bbq_disk. Must be between 0 and 100. Defaults to approximately 1% per shard for every 1 million vectors. Increasing this value can improve accuracy.

#### min_candidates

(Optional) The minimum number of nearest neighbor candidates to consider per shard. Cannot exceed 10,000. Defaults to 1.5 times k (or LIMIT) used for the query. Increasing this value can improve accuracy.

#### rescore_oversample

(Optional) Specifies the oversampling factor for rescoring quantized vectors.

#### similarity

(Optional) The minimum similarity required for a document to be considered a match. This value relates to the raw similarity, not the document score.

## Examples

The following query finds the color vectors in the `colors` index that are closest to the RGB value `[0, 120, 0]` (a shade of green). It uses the KNN function to identify the nearest neighbors based on the `rgb_vector` field, includes the relevance score (`_score`) in the results, and sorts the output by descending score and ascending color name.

```esql
from colors metadata _score
| where knn(rgb_vector, [0, 120, 0])
| sort _score desc, color asc
```

## Limitations

- The KNN function can only be used with dense_vector or semantic_text fields. Other text fields are not supported.
- The min_candidates parameter cannot exceed 10,000.
- The k parameter must be less than or equal to num_candidates and is automatically set when a LIMIT is applied.