# KNN

The KNN function finds the k nearest vectors to a query vector using a similarity metric. It performs approximate search on indexed `dense_vector` or `semantic_text` fields to identify the closest matches.

## Syntax

`KNN(field, query, options, boost, k, visit_percentage, min_candidates, rescore_oversample, similarity)`

### Parameters

#### field

The field to target for the query. This must be a `dense_vector` or `semantic_text` field. Other text fields are not supported.

#### query

The vector value for which to find the top nearest neighbors.

#### options

(Optional) Additional kNN options as function named parameters. See the knn query documentation for more details.

#### boost

A floating point number used to decrease or increase the relevance scores of the query. Defaults to 1.0.

#### k

The number of nearest neighbors to return from each shard. Elasticsearch collects k results from each shard and merges them to find the global top results. This value must be less than or equal to `num_candidates` and is automatically set when a LIMIT is applied.

#### visit_percentage

The percentage of vectors to explore per shard during knn search with `bbq_disk`. Must be between 0 and 100. A value of 0 defaults to using `num_candidates` for calculating the percent visited. Increasing this value can improve accuracy. If set for `bbq_disk`, `num_candidates` is ignored. Defaults to approximately 1% per shard for every 1 million vectors.

#### min_candidates

The minimum number of nearest neighbor candidates to consider per shard during knn search. Cannot exceed 10,000. Increasing this value can improve accuracy. Defaults to 1.5 times the value of `k` (or LIMIT) used for the query.

#### rescore_oversample

A double value specifying the oversampling factor for rescoring quantized vectors.

#### similarity

The minimum similarity required for a document to be considered a match. This value relates to the raw similarity used, not the document score.

## Examples

The following query finds the nearest color vectors to a given RGB vector and sorts the results by score and color:

```esql
from colors metadata _score
| where knn(rgb_vector, [0, 120, 0])
| sort _score desc, color asc
```
This query searches the `colors` index for vectors in the `rgb_vector` field that are closest to the `[0, 120, 0]` RGB value. It uses k-nearest neighbor (KNN) search to find the most similar color vectors, includes the relevance score (`_score`) in the results, and sorts the output first by descending score (most relevant matches first) and then alphabetically by color name.