# KNN

The KNN function finds the k nearest vectors to a query vector using a similarity metric. It performs approximate search on indexed dense_vector or semantic_text fields to identify the closest matches.

## Syntax

`KNN(field, query, options, boost, k, visit_percentage, min_candidates, rescore_oversample, similarity)`

### Parameters

#### field

The field to target for the query. The function works with dense_vector or semantic_text fields. Other text fields are not allowed.

#### query

The vector value for which to find the top nearest neighbors.

#### options

(Optional) Additional kNN options as function named parameters. Refer to the knn query documentation for more details.

#### boost

(Optional) A floating point number used to decrease or increase the relevance scores of the query. Defaults to 1.0.

#### k

The number of nearest neighbors to return from each shard. The system collects k results from each shard and merges them to find the global top results. This value must be less than or equal to num_candidates and is automatically set when a LIMIT is applied.

#### visit_percentage

(Optional) The percentage of vectors to explore per shard during knn search with bbq_disk. Must be between 0 and 100. A value of 0 defaults to using num_candidates for the percent visited. Increasing visit_percentage can improve accuracy. If set for bbq_disk, num_candidates is ignored. Defaults to approximately 1% per shard for every 1 million vectors.

#### min_candidates

(Optional) The minimum number of nearest neighbor candidates to consider per shard during knn search. Cannot exceed 10,000. Increasing min_candidates can improve accuracy. Defaults to 1.5 * k (or LIMIT) used for the query.

#### rescore_oversample

(Optional) Applies the specified oversampling for rescoring quantized vectors.

#### similarity

(Optional) The minimum similarity required for a document to be considered a match. The similarity value relates to the raw similarity used, not the document score.

## Examples

Finds the color vectors in the `colors` index that are closest to the RGB value `[0, 120, 0]`, then sorts the results by relevance score (descending) and color name (ascending):

```esql
from colors metadata _score
| where knn(rgb_vector, [0, 120, 0])
| sort _score desc, color asc
```
