# GRID ENCODING FUNCTIONS

The GRID ENCODING FUNCTIONS calculate spatial grid encodings for a given geo_point at a specified precision. These include geotile, geohex (H3 cell-id), and geohash encodings. The result is long encoded and can be converted to a string, long, or geo_shape bounding geometry using TO_STRING, TO_LONG, or TO_GEOSHAPE. These functions are related to spatial grid queries and aggregations.

## Syntax

`GRID ENCODING FUNCTIONS(geometry, precision, bounds)`

### Parameters

#### geometry

Expression of type `geo_point`. If `null`, the function returns `null`.

#### precision

Expression of type `integer`. If `null`, the function returns `null`. Valid values depend on the function:
- ST_GEOTILE: 0 to 29
- ST_GEOHEX: 0 to 15
- ST_GEOHASH: 1 to 12

#### bounds

Optional. Bounds to filter the grid tiles, specified as a `geo_shape` of type `BBOX`. Use `ST_ENVELOPE` if the `geo_shape` is of any other type.

## Examples

The following query calculates the geotile grid encoding for each airport location at precision 2. It then aggregates the data by geotile, computing the count of airports and the centroid of their locations within each tile. The results are converted to string format, sorted by count (descending) and geotile string (ascending), and only the count, centroid, and geotile string are kept in the output.

```esql
FROM airports
| EVAL geotile = ST_GEOTILE(location, 2)
| STATS
    count = COUNT(geotile),
    centroid = ST_CENTROID_AGG(location)
      BY geotile
| EVAL geotileString = TO_STRING(geotile)
| SORT count DESC, geotileString ASC
| KEEP count, centroid, geotileString
```

This query calculates the geohex (H3 cell-id) grid encoding for each airport location at precision 1. It aggregates the data by geohex, computing the count and centroid for each cell. Only cells with a count of 10 or more are included. The geohex values are converted to strings, and the results are sorted by count (descending) and geohex string (ascending), keeping only the count, centroid, and geohex string.

```esql
FROM airports
| EVAL geohex = ST_GEOHEX(location, 1)
| STATS
    count = COUNT(geohex),
    centroid = ST_CENTROID_AGG(location)
      BY geohex
| WHERE count >= 10
| EVAL geohexString = TO_STRING(geohex)
| KEEP count, centroid, geohexString
| SORT count DESC, geohexString ASC
```

This query calculates the geohash grid encoding for each airport location at precision 1. It aggregates the data by geohash, computing the count and centroid for each geohash cell. Only cells with a count of 10 or more are included. The geohash values are converted to strings, and the results are sorted by count (descending) and geohash string (ascending), keeping only the count, centroid, and geohash string.

```esql
FROM airports
| EVAL geohash = ST_GEOHASH(location, 1)
| STATS
    count = COUNT(geohash),
    centroid = ST_CENTROID_AGG(location)
      BY geohash
| WHERE count >= 10
| EVAL geohashString = TO_STRING(geohash)
| KEEP count, centroid, geohashString
| SORT count DESC, geohashString ASC
```