# GRID ENCODING FUNCTIONS

The GRID ENCODING FUNCTIONS calculate the geotile, geohex (H3 cell-id), or geohash of a given geo_point at a specified precision. The result is long encoded. You can use TO_STRING to convert the result to a string, TO_LONG to convert it to a long, or TO_GEOSHAPE to calculate the geo_shape bounding geometry. These functions are related to the geo_grid query and the corresponding grid aggregations.

## Syntax

`GRID ENCODING FUNCTIONS(geometry, precision, bounds)`

### Parameters

#### geometry

Expression of type geo_point. If null, the function returns null.

#### precision

Expression of type integer. If null, the function returns null. Valid values depend on the function:
- ST_GEOTILE: 0 to 29
- ST_GEOHEX: 0 to 15
- ST_GEOHASH: 1 to 12

#### bounds

Optional. Bounds to filter the grid tiles, specified as a geo_shape of type BBOX. Use ST_ENVELOPE if the geo_shape is of any other type.

## Examples

Aggregates airport locations into geotile grid cells at precision 2, calculates the count and centroid for each cell, converts the geotile to a string, sorts by count and geotile, and keeps relevant fields.

```esql
FROM airports
| EVAL geotile = ST_GEOTILE(location, 2)
| STATS
    count = COUNT(geotile),
    centroid = ST_CENTROID_AGG(location)
      BY geotile
| EVAL geotileString = TO_STRING(geotile)
| SORT count DESC, geotileString ASC
| KEEP count, centroid, geotileString
```

Aggregates airport locations into geohex (H3) grid cells at precision 1, calculates the count and centroid for each cell, filters cells with at least 10 airports, converts the geohex to a string, sorts, and keeps relevant fields.

```esql
FROM airports
| EVAL geohex = ST_GEOHEX(location, 1)
| STATS
    count = COUNT(geohex),
    centroid = ST_CENTROID_AGG(location)
      BY geohex
| WHERE count >= 10
| EVAL geohexString = TO_STRING(geohex)
| KEEP count, centroid, geohexString
| SORT count DESC, geohexString ASC
```

Aggregates airport locations into geohash grid cells at precision 1, calculates the count and centroid for each cell, filters cells with at least 10 airports, converts the geohash to a string, sorts, and keeps relevant fields.

```esql
FROM airports
| EVAL geohash = ST_GEOHASH(location, 1)
| STATS
    count = COUNT(geohash),
    centroid = ST_CENTROID_AGG(location)
      BY geohash
| WHERE count >= 10
| EVAL geohashString = TO_STRING(geohash)
| KEEP count, centroid, geohashString
| SORT count DESC, geohashString ASC
```