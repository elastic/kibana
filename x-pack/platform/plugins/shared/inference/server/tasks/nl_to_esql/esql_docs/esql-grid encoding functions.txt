# GRID ENCODING FUNCTIONS

These functions calculate the grid encoding of a given geo_point at a specified precision. The result is long encoded. You can use TO_STRING to convert the result to a string, TO_LONG to convert it to a long, or TO_GEOSHAPE to calculate the geo_shape bounding geometry. These functions are related to the geo_grid query and the corresponding grid aggregations.

## Syntax

`ST_GEOTILE(geometry, precision [, bounds])`

`ST_GEOHEX(geometry, precision [, bounds])`

`ST_GEOHASH(geometry, precision [, bounds])`

### Parameters

#### geometry

An expression of type geo_point. If null, the function returns null.

#### precision

An expression of type integer. If null, the function returns null. The valid range depends on the function:
- ST_GEOTILE: 0 to 29
- ST_GEOHEX: 0 to 15
- ST_GEOHASH: 1 to 12

#### bounds

Optional. Bounds to filter the grid tiles, specified as a geo_shape of type BBOX. Use ST_ENVELOPE if the geo_shape is of any other type.

## Examples

The following query calculates the geotile grid cell for each airport's location at precision 2, then aggregates the results by geotile, computing the count and centroid for each tile. The results are then converted to string format, sorted by count (descending) and geotile string (ascending), and only the relevant columns are kept.

```esql
FROM airports
| EVAL geotile = ST_GEOTILE(location, 2)
| STATS
    count = COUNT(geotile),
    centroid = ST_CENTROID_AGG(location)
      BY geotile
| EVAL geotileString = TO_STRING(geotile)
| SORT count DESC, geotileString ASC
| KEEP count, centroid, geotileString
```

This query calculates the H3 geohex cell ID for each airport's location at precision 1, aggregates the results by geohex, and computes the count and centroid for each cell. It then filters to include only cells with at least 10 airports, converts the geohex to a string, keeps the relevant columns, and sorts the results by count (descending) and geohex string (ascending).

```esql
FROM airports
| EVAL geohex = ST_GEOHEX(location, 1)
| STATS
    count = COUNT(geohex),
    centroid = ST_CENTROID_AGG(location)
      BY geohex
| WHERE count >= 10
| EVAL geohexString = TO_STRING(geohex)
| KEEP count, centroid, geohexString
| SORT count DESC, geohexString ASC
```

This query calculates the geohash for each airport's location at precision 1, aggregates the results by geohash, and computes the count and centroid for each geohash. It filters to include only geohashes with at least 10 airports, converts the geohash to a string, keeps the relevant columns, and sorts the results by count (descending) and geohash string (ascending).

```esql
FROM airports
| EVAL geohash = ST_GEOHASH(location, 1)
| STATS
    count = COUNT(geohash),
    centroid = ST_CENTROID_AGG(location)
      BY geohash
| WHERE count >= 10
| EVAL geohashString = TO_STRING(geohash)
| KEEP count, centroid, geohashString
| SORT count DESC, geohashString ASC
```