"Simple wrapper over @babel/cli so we can quickly re-use the same configurations over packages"

load("@npm//@babel/cli:index.bzl", _babel = "babel")

def jsts_transpiler(name, srcs, build_pkg_name, root_input_dir = "src", config_file = ".babelrc", additional_args = ["--quiet"], **kwargs):
  """A macro around the autogenerated babel rule.

  Args:
    name: target name
    srcs: list of sources
    root_input_dir: defines the root input dir to transpile files from, defaults to "src"
    config_file: transpiler config file, it defaults to a package local .babelrc
    additional_args: Any additional extra arguments, defaults to --quiet
    **kwargs: the rest
  """
  args = [
    "./%s/%s" % (build_pkg_name, root_input_dir),
    "--config-file",
    "./%s/%s" % (build_pkg_name, config_file),
    "--out-dir",
    "$(@D)",
    "--extensions",
    ".ts,.tsx,.js",
  ] + additional_args

  data = [config_file] + srcs + [
    "//packages/kbn-babel-preset",
  ]

  _babel(
    name = name,
    data = data,
    output_dir = True,
    args = args,
    **kwargs
  )
