<kbn-management-app section="kibana">
  <kbn-management-indices>
    <div
      ng-controller="managementIndicesCreate as controller"
      data-test-subj="createIndexPatternContainer"
      class="kuiViewContent"
    >
      <h1
        class="kuiTitle kuiVerticalRhythm"
        translate="KIBANA-CONFIGURE_INDEX_PATTERN"
      ></h1>

      <p
        class="kuiText kuiVerticalRhythm"
        translate="KIBANA-INDEX_PATTERN_EXPLANATION_1"
      ></p>

      <!-- User has no data -->
      <div
        ng-if="!controller.hasIndices()"
        class="kuiPanel kuiPanel--prompt kuiVerticalRhythm"
      >
        <div class="kuiPanelBody">
          <h2 class="kuiSubTitle kuiSubduedText kuiVerticalRhythm">
            Missing Elasticsearch data
          </h2>

          <div class="kuiVerticalRhythm">
            <p class="kuiText kuiSubduedText kuiVerticalRhythmSmall">
              You'll need to index some data into Elasticsearch before you can create an index pattern.
              <a
                href="#"
                class="kuiLink"
                aria-label="Learn how to index data into Elasticsearch"
              >
                Learn how.
              </a>
            </p>
          </div>

          <button class="kuiButton kuiButton--secondary kuiButton--iconText kuiVerticalRhythm">
            <span class="kuiButton__inner">
              <span aria-hidden="true" class="kuiButton__icon kuiIcon fa-refresh"></span>
              <span>Check for new data</span>
            </span>
          </button>
        </div>
      </div>

      <!-- User has data -->
      <div
        ng-if="controller.hasIndices()"
        ng-switch="controller.wizardStep"
        class="kuiVerticalRhythm"
      >
        <!-- Specify index pattern -->
        <div
          ng-switch-when="indexPattern"
          class="kuiPanel"
        >
          <div class="kuiPanelHeader">
            <div class="kuiPanelHeaderSection">
              <h2
                class="kuiPanelHeader__title"
                translate="KIBANA-SPECIFY_INDEX_PATTERN"
              ></h2>
            </div>
          </div>

          <div class="kuiPanelBody">
            <p class="kuiText kuiVerticalRhythm">
              <span translate="KIBANA-INDEX_PATTERN_EXPLANATION_2"></span>
              <a
                class="kuiLink"
                ng-href="{{ controller.documentationLinks.indexPatterns.introduction }}"
                translate="KIBANA-INDEX_PATTERN_EXPLANATION_3"
              ></a>
            </p>

            <!-- Index pattern input -->
            <div class="kuiVerticalRhythm">
              <label
                class="kuiLabel kuiVerticalRhythmSmall"
                translate="KIBANA-INDEX_NAME_OR_PATTERN"
              ></label>

              <div class="kuiVerticalRhythm kuiVerticalRhythmSmall">
                <input
                  class="kuiTextInput kuiTextInput--large"
                  data-test-subj="createIndexPatternNameInput"
                  ng-model="controller.formValues.name"
                  ng-model-options="{ updateOn: 'default blur', debounce: {'default': 500, 'blur': 0} }"
                  validate-index-name
                  allow-wildcard
                  name="name"
                  required
                  type="text"
                >
              </div>

              <!-- Input error text -->
              <div
                class="kuiVerticalRhythm"
                ng-if="controller.timeFieldOptionsError"
              >
                <p class="kuiText">
                  <span class="kuiStatusText kuiStatusText--error">
                    <span class="kuiStatusText__icon kuiIcon fa-warning"></span>
                    {{controller.timeFieldOptionsError}}
                  </span>
                </p>
              </div>
            </div>

            <!-- List of matching indices -->
            <div
              class="kuiVerticalRhythm"
              ng-switch="controller.matchingIndicesListType"
            >
              <matching-indices-list
                ng-switch-when="noMatches"
                indices="controller.allIndices"
                template-index-patterns="controller.allTemplateIndexPatterns"
              ></matching-indices-list>

              <matching-indices-list
                ng-switch-when="partialMatches"
                indices="controller.partialMatchingIndices"
                template-index-patterns="controller.partialMatchingTemplateIndexPatterns"
              ></matching-indices-list>

              <matching-indices-list
                ng-switch-when="exactMatches"
                indices="controller.matchingIndices"
                template-index-patterns="controller.matchingTemplateIndexPatterns"
              ></matching-indices-list>
            </div>

            <!-- Actions -->
            <div class="kuiBar">
              <div class="kuiBarSection">
                <div class="kuiButtonGroup">
                  <button
                    class="kuiButton kuiButton--primary kuiButton--iconText"
                    ng-click="controller.goToTimeFieldStep()"
                  >
                    <span class="kuiButton__inner">
                      <span>Next: Specify an optional time field</span>
                      <span aria-hidden="true" class="kuiButton__icon kuiIcon fa-chevron-right"></span>
                    </span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Specify optional time field -->
        <div
          ng-switch-when="timeField"
          class="kuiPanel"
        >
          <div class="kuiPanelHeader">
            <div class="kuiPanelHeaderSection">
              <h2
                class="kuiPanelHeader__title"
                translate="KIBANA-SPECIFY_TIME_FIELD"
                translate-values="{ indexPatternName: controller.formValues.name }"
              ></h2>
            </div>
          </div>

          <div class="kuiPanelBody">
            <p
              class="kuiText kuiVerticalRhythm"
              translate="KIBANA-TIME_FIELD_EXPLANATION"
            ></p>

            <!-- Time field select -->
            <div class="kuiVerticalRhythm">
              <label class="kuiLabel kuiVerticalRhythmSmall">
                <span translate="KIBANA-TIME_FILTER_FIELD_NAME"></span>
                &nbsp;
                <kbn-info info="{{ 'KIBANA-FIELD_FILTER_EVENTS_GLOBAL_TIME' | translate }}"></kbn-info>
                &nbsp;
                <small>
                  <a
                    class="kuiLink"
                    ng-click="controller.refreshTimeFieldOptions();"
                    translate="KIBANA-REFRESH_FIELDS"
                  ></a>
                </small>
              </label>

              <div class="kuiVerticalRhythmSmall">
                <select
                  class="kuiSelect kuiSelect--large kuiVerticalRhythmSmall"
                  data-test-subj="createIndexPatternTimeFieldSelect"
                  ng-disabled="controller.isLoading() || controller.timeFieldOptionsError || controller.timeFieldOptions.length === 1"
                  ng-required="controller.timeFieldOptions.length"
                  ng-options="option.display for option in controller.timeFieldOptions"
                  ng-model="controller.formValues.timeFieldOption"
                ></select>
              </div>
            </div>

            <!-- Expand index pattern checkbox -->
            <div class="kuiVerticalRhythm" ng-if="controller.canEnableExpandWildcard()">
              <label class="kuiCheckBoxLabel kuiVerticalRhythm">
                <input
                  class="kuiCheckBox"
                  type="checkbox"
                  data-test-subj="createIndexPatternEnableExpand"
                  ng-model="controller.formValues.expandWildcard"
                >
                <span class="kuiCheckBoxLabel__text">
                  <span translate="KIBANA-EXPAND_INDEX_PATTERN"></span>
                  <span translate="KIBANA-DEPRECATED"></span>
                </span>
              </label>

              <!-- Checkbox help text -->
              <div class="kuiVerticalRhythm">
                <p
                  class="kuiSubText kuiVerticalRhythmSmall"
                  translate="KIBANA-WILDCARD_DEFAULT_EXPANDED_TO_CURRENT_TIME_RANGE"
                ></p>

                <p class="kuiSubText kuiVerticalRhythmSmall">
                  <span translate="KIBANA-SEARCH_AGAINST_INDEX_PATTERN"></span>
                  <em translate="KIBANA-LOGSTASH_WILDCARD"></em>
                  <span translate="KIBANA-ACTUALLY_QUERY"></span>
                  <em translate="KIBANA-EXAMPLE_TIME_RANGE"></em>
                  <span translate="KIBANA-FALL_WITHIN_CURRENT_TIME_RANGE"></span>
                </p>

                <p
                  class="kuiSubText kuiVerticalRhythmSmall"
                  translate="KIBANA-EXPAND_INDEX_PATTERN_DEPRECATION"
                ></p>
              </div>
            </div>

            <!-- Actions -->
            <div class="kuiBar kuiVerticalRhythm">
              <div class="kuiBarSection">
                <div class="kuiButtonGroup">
                  <button
                    class="kuiButton kuiButton--secondary kuiButton--iconText"
                    ng-click="controller.goToIndexPatternStep()"
                  >
                    <span class="kuiButton__inner">
                      <span aria-hidden="true" class="kuiButton__icon kuiIcon fa-chevron-left"></span>
                      <span>Back</span>
                    </span>
                  </button>

                  <button
                    data-test-subj="createIndexPatternCreateButton"
                    ng-disabled="form.$invalid || controller.timeFieldOptionsError || controller.isLoading()"
                    class="kuiButton kuiButton--primary"
                    type="submit"
                    translate="KIBANA-CREATE"
                  ></button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Form -->
      <form
        name="form"
        role="form"
        class="kuiVerticalRhythm"
        ng-submit="controller.createIndexPattern()"
      ></form>

    </div>
  </kbn-management-indices>
</kbn-management-app>
