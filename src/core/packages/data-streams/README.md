# Data Streams Core Packages

## Description
The Data Streams core packages provide a comprehensive framework for managing Elasticsearch data streams within Kibana's server environment. This collection consists of three interconnected packages that handle data stream registration, client management, and testing utilities for the Kibana core system.

## Package Overview

### @kbn/core-data-streams-server
**Location**: `src/core/packages/data-streams/server`

The main public API package that provides the setup and start contracts for data stream management. It exports type definitions and interfaces for registering data streams during setup phase and obtaining data stream clients during start phase. This package serves as the primary entry point for plugins that need to work with data streams.

**Key Features**:
- `DataStreamsSetup` interface for registering data stream definitions
- `DataStreamsStart` interface for obtaining data stream clients
- Type exports from the core `@kbn/data-streams` package
- Public API contracts for plugin integration

### @kbn/core-data-streams-server-internal
**Location**: `src/core/packages/data-streams/server-internal`

The internal implementation package that contains the core `DataStreamsService` class. This service manages the lifecycle of data streams, handles registration during setup, and provides initialized clients during the start phase. It implements concurrent initialization with rate limiting to efficiently set up multiple data streams.

**Key Features**:
- `DataStreamsService` core implementation
- Concurrent data stream initialization with p-limit
- Integration with Elasticsearch service
- Client lifecycle management
- Error handling for unregistered or uninitialized streams

### @kbn/core-data-streams-server-mocks
**Location**: `src/core/packages/data-streams/server-mocks`

Testing utilities package that provides Jest mock implementations for the data streams service contracts. This package enables unit testing of plugins and services that depend on data streams functionality without requiring actual Elasticsearch connections.

**Key Features**:
- Mock implementations of `DataStreamsSetup` and `DataStreamsStart`
- Jest-compatible mock functions
- Testing utilities for plugin development
- Isolated testing environment support

## Architecture
The packages follow a layered architecture pattern:

1. **Public API Layer** (`server`): Exposes contracts and types for external consumption
2. **Implementation Layer** (`server-internal`): Contains the actual service implementation with business logic
3. **Testing Layer** (`server-mocks`): Provides test doubles for isolated testing

The architecture ensures separation of concerns with clear boundaries between public APIs and internal implementations, while providing comprehensive testing support.

## Dependencies
- `@kbn/data-streams`: Core data stream functionality and type definitions
- `@kbn/core-elasticsearch-server-internal`: Elasticsearch client integration
- `@kbn/logging`: Logging infrastructure
- `@kbn/core-base-server-internal`: Core server utilities
- `p-limit`: Concurrent execution control

## Usage
The data streams packages are typically used by Kibana plugins during their setup and start phases:

```typescript
// In plugin setup
setup(core) {
  core.dataStreams.registerDataStream(myDataStreamDefinition);
}

// In plugin start
start(core) {
  const client = core.dataStreams.getClient(myDataStreamDefinition);
  // Use client for data stream operations
}
```

## Testing
Use the mock package for unit testing:

```typescript
import { dataStreamServiceMock } from '@kbn/core-data-streams-server-mocks';

const mockSetup = dataStreamServiceMock.createSetupContract();
const mockStart = dataStreamServiceMock.createStartContract();
```

## Tutorials
- pending

## Attribution
This README was generated by an AI assistant based on the code and JSDocs of the packages
