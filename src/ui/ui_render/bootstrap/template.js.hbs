window.onload = function () {
  var files = [
    '{{bundlePath}}/vendors.style.css',
    '{{bundlePath}}/commons.style.css',
    '{{bundlePath}}/{{appId}}.style.css',

    '{{bundlePath}}/vendors.bundle.js',
    '{{bundlePath}}/commons.bundle.js',
    '{{bundlePath}}/{{appId}}.bundle.js'
  ];

  {{#each styleSheetPaths}}
    files.unshift('{{this}}');
  {{/each}}

  (function next() {
    var file = files.shift();
    if (!file) return;

    var failure = function () {
      // make subsequent calls to failure() noop
      failure = function () {};

      var err = document.createElement('h1');
      err.style['color'] = 'white';
      err.style['font-family'] = 'monospace';
      err.style['text-align'] = 'center';
      err.style['background'] = '#F44336';
      err.style['padding'] = '25px';
      err.innerText = '{{i18n 'common.ui.welcomeError' '{"defaultMessage": "Kibana did not load properly. Check the server output for more information."}'}}';

      document.body.innerHTML = err.outerHTML;
    }

    var type = /\.js(\?.+)?$/.test(file) ? 'script' : 'link';
    var dom = document.createElement(type);
    dom.setAttribute('async', '');
    dom.addEventListener('error', failure);

    if (type === 'script') {
      dom.setAttribute('src', file);
      dom.addEventListener('load', next);
      document.head.appendChild(dom);
    } else {
      dom.setAttribute('rel', 'stylesheet');
      dom.setAttribute('href', file);
      document.head.appendChild(dom);
      next();
    }
  }());
};
