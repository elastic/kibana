<div class="filterEditor kuiModal">
  <div class="kuiModalHeader">
    <div class="kuiModalHeader__title">
      <span ng-show="filterEditor.filter.meta.isNew">Add</span>
      <span ng-hide="filterEditor.filter.meta.isNew">Edit</span>
      filter
    </div>

    <div
      class="kuiModalHeaderCloseButton kuiIcon fa-times"
      ng-click="filterEditor.onCancel()"
    ></div>
  </div>

  <div class="kuiModalBody">
    <div ng-show="filterEditor.showQueryDslEditor()">
      <filter-query-dsl-editor
        filter="filterEditor.filter"
        on-change="filterEditor.setQueryDsl(queryDsl)"
      ></filter-query-dsl-editor>
      <div
        ng-show="filterEditor.isEditingQueryDsl"
        ng-click="filterEditor.isEditingQueryDsl = false"
      >
        <button class="kuiMenuButton kuiMenuButton--basic">
          <span class="kuiMenuButton__icon kuiIcon fa-chevron-left"></span>
          <span>Back</span>
        </button>
      </div>
    </div>

    <div
      class="kuiFieldGroup kuiVerticalRhythm"
      ng-hide="filterEditor.showQueryDslEditor()"
    >
      <div class="kuiFieldGroupSection kuiColumn kuiColumn--4">
        <filter-field-select
          field="filterEditor.field"
          index-patterns="filterEditor.indexPatterns"
          on-select="filterEditor.onFieldSelect(field)"
        ></filter-field-select>
      </div>

      <div class="kuiFieldGroupSection kuiColumn kuiColumn--4">
        <filter-operator-select
          ng-show="filterEditor.field"
          operator="filterEditor.operator"
          field="filterEditor.field"
          on-select="filterEditor.onOperatorSelect(operator)"
        ></filter-operator-select>
      </div>

      <div class="kuiFieldGroupSection kuiFieldGroupSection--wide kuiColumn kuiColumn--4">
        <ui-select
          ng-if="filterEditor.operator.type === 'phrase'"
          ng-model="filterEditor.params.value"
          ui-select-focus-on="focus-params"
        >
          <ui-select-match placeholder="Values...">
            <span tooltip="{{$select.selected}}">{{$select.selected}}</span>
          </ui-select-match>
          <ui-select-choices
            repeat="value in compactUnion([$select.search, $select.selected], filterEditor.valueSuggestions) | filter:$select.search | sortPrefixFirst:$select.search"
            refresh="filterEditor.refreshValueSuggestions($select.search)"
            refresh-delay="100"
          >
            <div ng-bind-html="value | highlight: $select.search"></div>
          </ui-select-choices>
        </ui-select>

        <ui-select
          ng-if="filterEditor.operator.type === 'phrases'"
          ng-model="filterEditor.params.values"
          multiple
          ui-select-focus-on="focus-params"
        >
          <ui-select-match placeholder="Values...">
            <span class="pillWithTooltip" tooltip="{{$item}}">
              {{$item}}
            </span>
          </ui-select-match>
          <ui-select-choices
            repeat="value in compactUnion([$select.search], filterEditor.valueSuggestions) | filter:$select.search | sortPrefixFirst:$select.search"
            refresh="filterEditor.refreshValueSuggestions($select.search)"
            refresh-delay="100"
          >
            <div ng-bind-html="value | highlight: $select.search"></div>
          </ui-select-choices>
        </ui-select>

        <div
          class="kuiFieldGroup"
          ng-if="filterEditor.operator.type === 'range'"
        >
          <div class="kuiFieldGroupSection">
            <input
              type="text"
              class="kuiTextInput kuiTextInput--small"
              ng-model="filterEditor.params.from"
              placeholder="From..."
            />
          </div>
          <div class="kuiFieldGroupSection">
            <input
              type="text"
              class="kuiTextInput kuiTextInput--small"
              ng-model="filterEditor.params.to"
              placeholder="To..."
            />
          </div>
        </div>
      </div>
    </div>

    <div class="kuiHeaderBar kuiVerticalRhythm">
      <div class="kuiHeaderBarSection">
        <h2 class="kuiSubTitle">
          Label
        </h2>
      </div>
    </div>

    <div class="kuiFieldGroup kuiVerticalRhythm">
      <div class="kuiFieldGroupSection">
        <input
          class="kuiTextInput"
          placeholder="Optional"
          type="text"
          ng-model="filterEditor.alias"
        />
      </div>
    </div>

    <div class="kuiHeaderBar kuiVerticalRhythm">
      <div class="kuiHeaderBarSection">
        <h2 class="kuiSubTitle">
          More actions
        </h2>
      </div>
    </div>

    <div class="kuiMenuButtonGroup kuiVerticalRhythm">
      <button
        class="kuiMenuButton kuiMenuButton--basic"
        ng-hide="filterEditor.filter.meta.isNew || filterEditor.showQueryDslEditor()"
        ng-click="filterEditor.isEditingQueryDsl = true"
      >
        <span>Edit the query DSL</span>
      </button>

      <button
        class="kuiMenuButton kuiMenuButton--basic"
        ng-hide="filterEditor.isPinned"
        ng-click="filterEditor.isPinned = true"
      >
        <span>Pin</span>
      </button>

      <button
        class="kuiMenuButton kuiMenuButton--basic"
        ng-show="filterEditor.isPinned"
        ng-click="filterEditor.isPinned = false"
      >
        <span>Unpin</span>
      </button>

      <button
        class="kuiMenuButton kuiMenuButton--basic"
        ng-hide="filterEditor.isDisabled"
        ng-click="filterEditor.isDisabled = true"
      >
        <span>Disable</span>
      </button>

      <button
        class="kuiMenuButton kuiMenuButton--basic"
        ng-show="filterEditor.isDisabled"
        ng-click="filterEditor.isDisabled = false"
      >
        <span>Enable</span>
      </button>
    </div>
  </div>

  <div class="kuiModalFooter kuiBar">
    <div class="kuiBarSection" ng-hide="filterEditor.filter.meta.isNew">
      <button
        class="kuiButton kuiButton--danger"
        ng-click="filterEditor.onDelete()"
      >
        <span class="fa fa-trash"></span>
      </button>
    </div>

    <div class="kuiBarSection">
      <button
        class="kuiButton kuiButton--basic"
        ng-click="filterEditor.onCancel()"
      >
        Cancel
      </button>
      <button
        class="kuiButton kuiButton--primary"
        ng-disabled="!filterEditor.isValid()"
        ng-click="filterEditor.save()"
      >
        Save
      </button>
    </div>
  </div>
</div>
