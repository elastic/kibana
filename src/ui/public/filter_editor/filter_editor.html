<div class="filterEditor kuiModal">
  <div class="kuiModalHeader">
    <div class="kuiModalHeader__title">
      <span ng-show="filterEditor.filter.meta.isNew">Add</span>
      <span ng-hide="filterEditor.filter.meta.isNew">Edit</span>
      filter
    </div>

    <div
      class="kuiModalHeaderCloseButton kuiIcon fa-times"
      ng-click="filterEditor.onCancel()"
    ></div>
  </div>

  <div class="kuiModalBody">
    <div ng-show="filterEditor.showQueryDslEditor()">
      <div
        json-input
        require-keys="true"
        ui-ace="{
          mode: 'json',
          onLoad: aceLoaded
        }"
        ng-model="filterEditor.queryDsl"
      ></div>
      <div
        ng-show="filterEditor.isEditingQueryDsl"
        ng-click="filterEditor.isEditingQueryDsl = false"
      >
        <button class="kuiMenuButton kuiMenuButton--basic">
          <span class="kuiMenuButton__icon kuiIcon fa-chevron-left"></span>
          <span>Back</span>
        </button>
      </div>
    </div>

    <div
      class="kuiFieldGroup kuiVerticalRhythm"
      ng-hide="filterEditor.showQueryDslEditor()"
    >
      <div class="kuiFieldGroupSection kuiColumn kuiColumn--4">
        <ui-select
          ng-model="filterEditor.getSetField"
          ng-model-options="{ getterSetter: true }"
          ui-select-focus-on="focus-field"
          on-select="filterEditor.setFocus('operator')"
        >
          <ui-select-match placeholder="Fields...">
            {{$select.selected.name}}
          </ui-select-match>
          <ui-select-choices
            repeat="field in filterEditor.fieldSuggestions | filter:{ name: $select.search } | orderBy:'name' | sortPrefixFirst:$select.search:'name'"
            group-by="'indexPattern'"
          >
            <div ng-bind-html="field.name | highlight: $select.search"></div>
          </ui-select-choices>
        </ui-select>
      </div>

      <div class="kuiFieldGroupSection kuiColumn kuiColumn--4">
        <ui-select
          ng-model="filterEditor.getSetOperator"
          ng-model-options="{ getterSetter: true }"
          ng-show="filterEditor.field"
          ui-select-focus-on="focus-operator"
          on-select="filterEditor.setFocus('params')"
        >
          <ui-select-match placeholder="Operators...">
            {{$select.selected.name}}
          </ui-select-match>
          <ui-select-choices repeat="operator in filterEditor.operatorSuggestions | filter:{ name: $select.search } | sortPrefixFirst:$select.search:'name'">
            <div ng-bind-html="operator.name | highlight: $select.search"></div>
          </ui-select-choices>
        </ui-select>
      </div>

      <div class="kuiFieldGroupSection kuiFieldGroupSection--wide kuiColumn kuiColumn--4">
        <ui-select
          ng-if="filterEditor.operator.type === 'phrase' && filterEditor.field.type === 'string'"
          ng-model="filterEditor.params.value"
          ui-select-focus-on="focus-params"
        >
          <ui-select-match placeholder="Values...">
            <span tooltip="{{$select.selected}}">{{$select.selected}}</span>
          </ui-select-match>
          <ui-select-choices
            repeat="value in compactUnion([$select.search, $select.selected], filterEditor.valueSuggestions) | filter:$select.search | sortPrefixFirst:$select.search"
            refresh="filterEditor.refreshValueSuggestions($select.search)"
            refresh-delay="100"
          >
            <div ng-bind-html="value | highlight: $select.search"></div>
          </ui-select-choices>
        </ui-select>

        <input
          type="number"
          step="any"
          class="kuiTextInput"
          ng-if="filterEditor.operator.type === 'phrase' && filterEditor.field.type === 'number'"
          ng-model="filterEditor.params.value"
          placeholder="Value..."
        />

        <input
          type="text"
          class="kuiTextInput"
          ng-if="filterEditor.operator.type === 'phrase' && filterEditor.field.type === 'date'"
          ng-model="filterEditor.params.value"
          placeholder="Value..."
        />

        <ui-select
          ng-if="filterEditor.operator.type === 'phrases'"
          ng-model="filterEditor.params.values"
          multiple
          ui-select-focus-on="focus-params"
        >
          <ui-select-match placeholder="Values...">
            <span class="pillWithTooltip" tooltip="{{$item}}">
              {{$item}}
            </span>
          </ui-select-match>
          <ui-select-choices
            repeat="value in compactUnion([$select.search], filterEditor.valueSuggestions) | filter:$select.search | sortPrefixFirst:$select.search"
            refresh="filterEditor.refreshValueSuggestions($select.search)"
            refresh-delay="100"
          >
            <div ng-bind-html="value | highlight: $select.search"></div>
          </ui-select-choices>
        </ui-select>

        <div
          class="kuiFieldGroup"
          ng-if="filterEditor.operator.type === 'range'"
        >
          <div class="kuiFieldGroupSection">
            <input
              type="text"
              class="kuiTextInput kuiTextInput--small"
              ng-model="filterEditor.params.from"
              placeholder="From..."
            />
          </div>
          <div class="kuiFieldGroupSection">
            <input
              type="text"
              class="kuiTextInput kuiTextInput--small"
              ng-model="filterEditor.params.to"
              placeholder="To..."
            />
          </div>
        </div>
      </div>
    </div>

    <div class="kuiHeaderBar kuiVerticalRhythm">
      <div class="kuiHeaderBarSection">
        <h2 class="kuiSubTitle">
          Label
        </h2>
      </div>
    </div>

    <div class="kuiFieldGroup kuiVerticalRhythm">
      <div class="kuiFieldGroupSection">
        <input
          class="kuiTextInput"
          placeholder="Optional"
          type="text"
          ng-model="filterEditor.alias"
        />
      </div>
    </div>

    <div class="kuiHeaderBar kuiVerticalRhythm">
      <div class="kuiHeaderBarSection">
        <h2 class="kuiSubTitle">
          More actions
        </h2>
      </div>
    </div>

    <div class="kuiMenuButtonGroup kuiVerticalRhythm">
      <button
        class="kuiMenuButton kuiMenuButton--basic"
        ng-hide="filterEditor.filter.meta.isNew || filterEditor.showQueryDslEditor()"
        ng-click="filterEditor.isEditingQueryDsl = true"
      >
        <span>Edit the query DSL</span>
      </button>

      <button
        class="kuiMenuButton kuiMenuButton--basic"
        ng-hide="filterEditor.isPinned"
        ng-click="filterEditor.isPinned = true"
      >
        <span>Pin</span>
      </button>

      <button
        class="kuiMenuButton kuiMenuButton--basic"
        ng-show="filterEditor.isPinned"
        ng-click="filterEditor.isPinned = false"
      >
        <span>Unpin</span>
      </button>

      <button
        class="kuiMenuButton kuiMenuButton--basic"
        ng-hide="filterEditor.isDisabled"
        ng-click="filterEditor.isDisabled = true"
      >
        <span>Disable</span>
      </button>

      <button
        class="kuiMenuButton kuiMenuButton--basic"
        ng-show="filterEditor.isDisabled"
        ng-click="filterEditor.isDisabled = false"
      >
        <span>Enable</span>
      </button>
    </div>
  </div>

  <div class="kuiModalFooter kuiBar">
    <div class="kuiBarSection" ng-hide="filterEditor.filter.meta.isNew">
      <button
        class="kuiButton kuiButton--danger"
        ng-click="filterEditor.onDelete()"
      >
        <span class="fa fa-trash"></span>
      </button>
    </div>

    <div class="kuiBarSection">
      <button
        class="kuiButton kuiButton--basic"
        ng-click="filterEditor.onCancel()"
      >
        Cancel
      </button>
      <button
        class="kuiButton kuiButton--primary"
        ng-disabled="!filterEditor.isValid()"
        ng-click="filterEditor.save()"
      >
        Save
      </button>
    </div>
  </div>
</div>
