<div class="filterEditor kuiModal" style="width: 500px; position: absolute; z-index: 20;">
  <div class="kuiModalHeader">
    <div class="kuiModalHeader__title">
      <span ng-show="filterEditor.filter.meta.isNew">Add</span>
      <span ng-hide="filterEditor.filter.meta.isNew">Edit</span>
      filter
    </div>

    <div
      class="kuiModalHeaderCloseButton kuiIcon fa-times"
      ng-click="filterEditor.onCancel()"
    ></div>
  </div>

  <div class="kuiModalBody">
    <div
      ng-show="filterEditor.showAdvancedEditor()"
      json-input
      require-keys="true"
      ui-ace="{
        mode: 'json',
        onLoad: aceLoaded
      }"
      ng-model="filterEditor.customJson"
    ></div>

    <div
      class="kuiFieldGroup kuiVerticalRhythm"
      ng-hide="filterEditor.showAdvancedEditor()"
    >
      <div class="kuiFieldGroupSection kuiColumn kuiColumn--4">
        <ui-select
          ng-model="filterEditor.getSetField"
          ng-model-options="{ getterSetter: true }"
          ui-select-focus-on="focus-field"
          on-select="filterEditor.setFocus('operator')"
        >
          <ui-select-match placeholder="Fields...">
            {{$select.selected.name}}
          </ui-select-match>
          <ui-select-choices repeat="field in filterEditor.fieldSuggestions | filter:{ name: $select.search } | orderBy:'name' | sortPrefixFirst:$select.search:'name'">
            <div ng-bind-html="field.name | highlight: $select.search"></div>
          </ui-select-choices>
        </ui-select>
      </div>

      <div class="kuiFieldGroupSection kuiColumn kuiColumn--4">
        <ui-select
          ng-model="filterEditor.getSetOperator"
          ng-model-options="{ getterSetter: true }"
          ng-show="filterEditor.field"
          ui-select-focus-on="focus-operator"
          on-select="filterEditor.setFocus('params')"
        >
          <ui-select-match placeholder="Operators...">
            {{$select.selected.name}}
          </ui-select-match>
          <ui-select-choices repeat="operator in filterEditor.operatorSuggestions | filter:{ name: $select.search } | sortPrefixFirst:$select.search:'name'">
            <div ng-bind-html="operator.name | highlight: $select.search"></div>
          </ui-select-choices>
        </ui-select>
      </div>

      <div class="kuiFieldGroupSection kuiColumn kuiColumn--4">
        <ui-select
          ng-show="filterEditor.operator.type === 'match'"
          ng-model="filterEditor.params.value"
          ui-select-focus-on="focus-params"
        >
          <ui-select-match placeholder="Values...">
            {{$select.selected}}
          </ui-select-match>
          <ui-select-choices
            repeat="value in filterEditor.valueSuggestions | filter:$select.search | sortPrefixFirst:$select.search"
            refresh="filterEditor.refreshValueSuggestions($select.search)"
            refresh-delay="100"
          >
            <div ng-bind-html="value | highlight: $select.search"></div>
          </ui-select-choices>
        </ui-select>

        <ui-select
          ng-show="filterEditor.operator.type === 'terms'"
          ng-model="filterEditor.params.values"
          multiple
          ui-select-focus-on="focus-params"
        >
          <ui-select-match placeholder="Values...">
            {{$item}}
          </ui-select-match>
          <ui-select-choices
            repeat="value in filterEditor.valueSuggestions | filter:$select.search | sortPrefixFirst:$select.search"
            refresh="filterEditor.refreshValueSuggestions($select.search)"
            refresh-delay="100"
          >
            <div ng-bind-html="value | highlight: $select.search"></div>
          </ui-select-choices>
        </ui-select>

        <div
          class="kuiFieldGroup"
          ng-show="filterEditor.operator.type === 'range'"
        >
          <div class="kuiFieldGroupSection">
            <input
              type="text"
              class="kuiTextInput kuiTextInput--small"
              ng-model="filterEditor.params.from"
              placeholder="From..."
            />
          </div>
          <div class="kuiFieldGroupSection">
            <input
              type="text"
              class="kuiTextInput kuiTextInput--small"
              ng-model="filterEditor.params.to"
              placeholder="To..."
            />
          </div>
        </div>
      </div>
    </div>

    <div class="kuiMenuButtonGroup kuiVerticalRhythm">
      <button
        class="kuiMenuButton kuiMenuButton--basic"
        ng-hide="filterEditor.showAdvancedEditor()"
        ng-click="filterEditor.manualAdvancedMode = true"
      >
        <span>Edit the actual DSL</span>
      </button>

      <button
        class="kuiMenuButton kuiMenuButton--basic"
        ng-show="filterEditor.manualAdvancedMode"
        ng-click="filterEditor.manualAdvancedMode = false"
      >
        <span class="kuiMenuButton__icon kuiIcon fa-chevron-left"></span>
        <span>Back</span>
      </button>
    </div>
  </div>

  <div class="kuiModalFooter kuiBar">
    <div class="kuiBarSection" ng-hide="filterEditor.filter.meta.isNew">
      <button
        class="kuiButton kuiButton--danger"
        ng-click="filterEditor.onDelete()"
      >
        <span class="fa fa-trash"></span>
      </button>
    </div>

    <div class="kuiBarSection">
      <button
        class="kuiButton kuiButton--basic"
        ng-click="filterEditor.onCancel()"
      >
        Cancel
      </button>
      <button
        class="kuiButton kuiButton--primary"
        ng-click="filterEditor.save()"
      >
        Save
      </button>
    </div>
  </div>
</div>
