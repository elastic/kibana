- name: install dependencies
  become: yes
  yum:
    name:
      - nss
      - fontconfig
      - freetype
    state: latest

- name: install kibana from local file
  become: yes
  yum:
    name: /packages/kibana-{{ kibana_version }}-x86_64.rpm
    state: present
    disable_gpg_check: yes

- name: copy kibana configuration
  become: yes
  copy:
    src: files/kibana.yml
    dest: /etc/kibana/kibana.yml
  register: config

- name: open port 5601/tcp
  become: yes
  command:
    cmd: firewall-cmd --zone=public --permanent --add-port=5601/tcp

- name: reload firewall
  become: yes
  command:
    cmd: firewall-cmd --reload

- name: start kibana
  become: yes
  systemd:
    state: started
    name: kibana
    daemon_reload: yes
