{
  "summary": {
    "total": 397,
    "succeeded": 397,
    "skipped": 0,
    "failed": 0
  },
  "results": {
    "created": [
      {
        "name": "PowerShell Script with Remote Execution Capabilities via WinRM",
        "description": "Identifies the use of Cmdlets and methods related to remote execution activities using WinRM. Attackers can abuse WinRM to perform lateral movement using built-in tools.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 208,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Lateral Movement",
          "Tactic: Execution",
          "Data Source: PowerShell Logs",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://attack.mitre.org/techniques/T1021/006/",
          "https://github.com/cobbr/SharpSploit/blob/master/SharpSploit/LateralMovement/PowerShellRemoting.cs",
          "https://github.com/BC-SECURITY/Empire/blob/main/empire/server/modules/powershell/lateral_movement/invoke_psremoting.py"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1021",
                "name": "Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1021/",
                "subtechnique": [
                  {
                    "id": "T1021.006",
                    "name": "Windows Remote Management",
                    "reference": "https://attack.mitre.org/techniques/T1021/006/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.001",
                    "name": "PowerShell",
                    "reference": "https://attack.mitre.org/techniques/T1059/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe 'PowerShell Script Block Logging' logging policy must be enabled.\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nAdministrative Templates >\nWindows PowerShell >\nTurn on PowerShell Script Block Logging (Enable)\n```\n\nSteps to implement the logging policy via registry:\n\n```\nreg add \"hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\" /v EnableScriptBlockLogging /t REG_DWORD /d 1\n```\n",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.directory",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "powershell.file.script_block_text",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "6cff6325-d7e5-4971-bfef-129c3dc16636",
        "rule_id": "0abf0c5b-62dd-48d2-ac4e-6b43fe3a6e83",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.246Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.246Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "winlogbeat-*",
          "logs-windows.powershell*"
        ],
        "filters": [
          {
            "meta": {
              "negate": true
            },
            "query": {
              "wildcard": {
                "file.path": {
                  "case_insensitive": true,
                  "value": "?:\\\\Program Files\\\\WindowsPowerShell\\\\Modules\\\\dbatools\\\\*\\\\allcommands.ps1"
                }
              }
            }
          },
          {
            "meta": {
              "negate": true
            },
            "query": {
              "wildcard": {
                "file.directory": {
                  "case_insensitive": true,
                  "value": "?:\\\\Program Files\\\\Microsoft\\\\Exchange Server\\\\*\\\\bin"
                }
              }
            }
          },
          {
            "meta": {
              "negate": true
            },
            "query": {
              "wildcard": {
                "file.directory": {
                  "case_insensitive": true,
                  "value": "?:\\\\ExchangeServer\\\\bin*"
                }
              }
            }
          }
        ],
        "query": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    (\"Invoke-WmiMethod\" or \"Invoke-Command\" or \"Enter-PSSession\") and \"ComputerName\"\n  ) and\n  not user.id : \"S-1-5-18\" and\n  not file.directory : (\n    \"C:\\\\Program Files\\\\LogicMonitor\\\\Agent\\\\tmp\"\n  ) and not\n  powershell.file.script_block_text : (\n    \"Export-ModuleMember -Function @('Invoke-Expression''Invoke-Command')\" and\n    \"function Invoke-Command {\"\n  )\n",
        "language": "kuery"
      },
      {
        "name": "System Binary Moved or Copied",
        "description": "This rule monitors for the copying or moving of a system binary. Adversaries may copy/move and rename system binaries to evade detection. Copying a system binary to a different location should not occur often, so if it does, the activity should be investigated.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 13,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://intezer.com/blog/research/kaiji-new-chinese-linux-malware-turning-to-golang/",
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.003",
                    "name": "Rename System Utilities",
                    "reference": "https://attack.mitre.org/techniques/T1036/003/"
                  }
                ]
              },
              {
                "id": "T1564",
                "name": "Hide Artifacts",
                "reference": "https://attack.mitre.org/techniques/T1564/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.original.extension",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.Ext.original.path",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "505dcd28-d434-42cb-8c10-5204423a524a",
        "rule_id": "fda1d332-5e08-4f27-8a9b-8c802e3292a6",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.251Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.251Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.type == \"change\" and event.action == \"rename\" and process.name != null and\nfile.Ext.original.path : (\n  \"/bin/*\", \"/usr/bin/*\", \"/usr/local/bin/*\", \"/sbin/*\", \"/usr/sbin/*\", \"/usr/local/sbin/*\"\n) and not (\n  process.executable in (\n    \"/bin/dpkg\", \"/usr/bin/dpkg\", \"/bin/dockerd\", \"/usr/bin/dockerd\", \"/usr/sbin/dockerd\", \"/bin/microdnf\",\n    \"/usr/bin/microdnf\", \"/bin/rpm\", \"/usr/bin/rpm\", \"/bin/snapd\", \"/usr/bin/snapd\", \"/bin/yum\", \"/usr/bin/yum\",\n    \"/bin/dnf\", \"/usr/bin/dnf\", \"/bin/podman\", \"/usr/bin/podman\", \"/bin/dnf-automatic\", \"/usr/bin/dnf-automatic\",\n    \"/bin/pacman\", \"/usr/bin/pacman\", \"/usr/bin/dpkg-divert\", \"/bin/dpkg-divert\", \"/sbin/apk\", \"/usr/sbin/apk\",\n    \"/usr/local/sbin/apk\", \"/usr/bin/apt\", \"/usr/sbin/pacman\", \"/bin/podman\", \"/usr/bin/podman\", \"/usr/bin/puppet\",\n    \"/bin/puppet\", \"/opt/puppetlabs/puppet/bin/puppet\", \"/usr/bin/chef-client\", \"/bin/chef-client\",\n    \"/bin/autossl_check\", \"/usr/bin/autossl_check\", \"/proc/self/exe\", \"/dev/fd/*\",  \"/usr/bin/pamac-daemon\",\n    \"/bin/pamac-daemon\", \"/usr/lib/snapd/snapd\", \"/usr/local/bin/dockerd\", \"/usr/libexec/netplan/generate\",\n    \"/usr/bin/update-alternatives\", \"/bin/update-alternatives\", \"/usr/sbin/update-alternatives\",\n    \"/sbin/update-alternatives\", \"/usr/bin/pip3\", \"/bin/pip3\", \"/usr/local/bin/pip3\", \"/usr/local/bin/node\",\n    \"/bin/node\", \"/usr/bin/node\", \"/sbin/apk\", \"/usr/sbin/apk\", \"/usr/local/sbin/apk\", \"/usr/bin/pip\", \"/bin/pip\",\n    \"/usr/local/bin/pip\", \"/usr/libexec/platform-python\", \"/usr/bin/platform-python\", \"/bin/platform-python\",\n    \"/usr/lib/systemd/systemd\", \"/usr/sbin/sshd\", \"/sbin/sshd\", \"/usr/local/sbin/sshd\", \"/usr/sbin/crond\", \"/sbin/crond\",\n    \"/usr/local/sbin/crond\", \"/usr/sbin/gdm\"\n  ) or\n  process.name like (\n    \"python*\", \"packagekitd\", \"systemd\", \"ln\", \"platform-python\", \"dnf_install\", \"runc\", \"apt-get\", \"ssm-agent-worker\",\n    \"convert-usrmerge\", \"updatenow.static-cpanelsync\", \"apk\", \"exe\", \"php\", \"containerd-shim-runc-v2\", \"dpkg\", \"sed\",\n    \"platform-python*\", \"gedit\", \"crond\", \"sshd\", \"ruby\", \"sudo\", \"chainctl\", \"update-alternatives\", \"pip*\"\n  ) or\n  file.Ext.original.path : (\n    \"/bin/*.tmp\", \"/usr/bin/*.tmp\", \"/usr/local/bin/*.tmp\", \"/sbin/*.tmp\", \"/usr/sbin/*.tmp\", \"/usr/local/sbin/*.tmp\"\n  ) or\n  file.extension in (\"swp\", \"swpx\", \"swx\", \"dpkg-remove\") or\n  file.Ext.original.extension == \"dpkg-new\" or\n  process.executable : (\"/nix/store/*\", \"/var/lib/dpkg/*\", \"/tmp/vmis.*\", \"/snap/*\", \"/dev/fd/*\") or\n  process.executable == null or\n  (process.name == \"sed\" and file.name : \"sed*\") or\n  (process.name == \"perl\" and file.name : \"e2scrub_all.tmp*\") \n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*"
        ]
      },
      {
        "name": "Potential Okta MFA Bombing via Push Notifications",
        "description": "Detects when an attacker abuses the Multi-Factor authentication mechanism by repeatedly issuing login requests until the user eventually accepts the Okta push notification. An adversary may attempt to bypass the Okta MFA policies configured for an organization to obtain unauthorized access.",
        "risk_score": 73,
        "severity": "high",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Potential Okta MFA Bombing via Push Notifications\n\nMulti-Factor Authentication (MFA) is an effective method to prevent unauthorized access. However, some adversaries may abuse the system by repeatedly sending MFA push notifications until the user unwittingly approves the access.\n\nThis rule detects when a user denies MFA Okta Verify push notifications twice, followed by a successful authentication event within a 10-minute window. This sequence could indicate an adversary's attempt to bypass the Okta MFA policy.\n\n#### Possible investigation steps:\n\n- Identify the user who received the MFA notifications by reviewing the `user.email` field.\n- Identify the time, source IP, and geographical location of the MFA requests and the subsequent successful login.\n- Review the `event.action` field to understand the nature of the events. It should include two `user.mfa.okta_verify.deny_push` actions and one `user.authentication.sso` action.\n- Ask the user if they remember receiving the MFA notifications and subsequently logging into their account.\n- Check if the MFA requests and the successful login occurred during the user's regular activity hours.\n- Look for any other suspicious activity on the account around the same time.\n- Identify whether the same pattern is repeated for other users in your organization. Multiple users receiving push notifications simultaneously might indicate a larger attack.\n\n### False positive analysis:\n\n- Determine if the MFA push notifications were legitimate. Sometimes, users accidentally trigger MFA requests or deny them unintentionally and later approve them.\n- Check if there are known issues with the MFA system causing false denials.\n\n### Response and remediation:\n\n- If unauthorized access is confirmed, initiate your incident response process.\n- Alert the user and your IT department immediately.\n- If possible, isolate the user's account until the issue is resolved.\n- Investigate the source of the unauthorized access.\n- If the account was accessed by an unauthorized party, determine the actions they took after logging in.\n- Consider enhancing your MFA policy to prevent such incidents in the future.\n- Encourage users to report any unexpected MFA notifications immediately.\n- Review and update your incident response plans and security policies based on the findings from the incident.\n",
        "output_index": "",
        "version": 207,
        "tags": [
          "Use Case: Identity and Access Audit",
          "Tactic: Credential Access",
          "Data Source: Okta"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.mandiant.com/resources/russian-targeting-gov-business",
          "https://www.elastic.co/security-labs/testing-okta-visibility-and-detection-dorothy",
          "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection",
          "https://www.rezonate.io/blog/okta-logs-decoded-unveiling-identity-threats-through-threat-hunting/",
          "https://www.elastic.co/security-labs/monitoring-okta-threats-with-elastic-security",
          "https://www.elastic.co/security-labs/starter-guide-to-understanding-okta"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1621",
                "name": "Multi-Factor Authentication Request Generation",
                "reference": "https://attack.mitre.org/techniques/T1621/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe Okta Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.\n",
        "related_integrations": [
          {
            "package": "okta",
            "version": "^3.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "okta.actor.id",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.event_type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.outcome.result",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "923ec01c-8de1-4052-b65f-6761ca7fda05",
        "rule_id": "8a0fbd26-867f-11ee-947c-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.256Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.256Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by okta.actor.id with maxspan=10m\n  [authentication where event.dataset == \"okta.system\"\n    and okta.event_type == \"user.mfa.okta_verify.deny_push\"] with runs=5\n  until [authentication where event.dataset == \"okta.system\"\n    and (okta.event_type: (\n      \"user.authentication.sso\",\n      \"user.authentication.auth_via_mfa\",\n      \"user.authentication.verify\",\n      \"user.session.start\") and okta.outcome.result == \"SUCCESS\")]\n",
        "language": "eql",
        "index": [
          "filebeat-*",
          "logs-okta*"
        ],
        "event_category_override": "event.category"
      },
      {
        "name": "Creation of SettingContent-ms Files",
        "description": "Identifies the suspicious creation of SettingContents-ms files, which have been used in attacks to achieve code execution while evading defenses.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 106,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend",
          "Rule Type: BBR",
          "Data Source: Sysmon",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://posts.specterops.io/the-tale-of-settingcontent-ms-files-f1ea253e4d39"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1204",
                "name": "User Execution",
                "reference": "https://attack.mitre.org/techniques/T1204/",
                "subtechnique": [
                  {
                    "id": "T1204.002",
                    "name": "Malicious File",
                    "reference": "https://attack.mitre.org/techniques/T1204/002/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1566",
                "name": "Phishing",
                "reference": "https://attack.mitre.org/techniques/T1566/",
                "subtechnique": [
                  {
                    "id": "T1566.001",
                    "name": "Spearphishing Attachment",
                    "reference": "https://attack.mitre.org/techniques/T1566/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "3988f7fb-271b-48c7-b26a-6ccb1ba4d671",
        "rule_id": "1e6363a6-3af5-41d4-b7ea-d475389c0ceb",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.398Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.398Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"windows\" and event.type == \"creation\" and\n  file.extension : \"settingcontent-ms\" and\n  not file.path : (\n    \"?:\\\\*\\\\AppData\\\\Local\\\\Packages\\\\windows.immersivecontrolpanel_*\\\\LocalState\\\\Indexed\\\\Settings\\\\*\",\n    \"\\\\Device\\\\HarddiskVolume*\\\\Windows\\\\WinSxS\\\\amd64_microsoft-windows-s..*\\\\*.settingcontent-ms\"\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "Suspicious Utility Launched via ProxyChains",
        "description": "This rule monitors for the execution of suspicious linux tools through ProxyChains. ProxyChains is a command-line tool that enables the routing of network connections through intermediary proxies, enhancing anonymity and enabling access to restricted resources. Attackers can exploit the ProxyChains utility to hide their true source IP address, evade detection, and perform malicious activities through a chain of proxy servers, potentially masking their identity and intentions.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Suspicious Utility Launched via ProxyChains\n\nAttackers can leverage `proxychains` to obfuscate their origin and bypass network defenses by routing their malicious traffic through multiple intermediary servers.\n\nThis rule looks for a list of suspicious processes spawned through `proxychains` by analyzing process command line arguments. \n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/master/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n> This investigation guide uses [placeholder fields](https://www.elastic.co/guide/en/security/current/osquery-placeholder-fields.html) to dynamically pass alert data into Osquery queries. Placeholder fields were introduced in Elastic Stack version 8.7.0. If you're using Elastic Stack version 8.6.0 or earlier, you'll need to manually adjust this investigation guide's queries to ensure they properly run.\n\n#### Possible investigation steps\n\n- Identify any signs of suspicious network activity or anomalies that may indicate network obfuscation. This could include unexpected traffic patterns or unusual network behavior.\n  - Investigate listening ports and open sockets to look for potential protocol tunneling, reverse shells, or data exfiltration.\n    - !{osquery{\"label\":\"Osquery - Retrieve Listening Ports\",\"query\":\"SELECT pid, address, port, socket, protocol, path FROM listening_ports\"}}\n    - !{osquery{\"label\":\"Osquery - Retrieve Open Sockets\",\"query\":\"SELECT pid, family, remote_address, remote_port, socket, state FROM process_open_sockets\"}}\n- Identify the user account that performed the action, analyze it, and check whether it should perform this kind of action.\n  - !{osquery{\"label\":\"Osquery - Retrieve Information for a Specific User\",\"query\":\"SELECT * FROM users WHERE username = {{user.name}}\"}}\n- Investigate whether the user is currently logged in and active.\n  - !{osquery{\"label\":\"Osquery - Investigate the Account Authentication Status\",\"query\":\"SELECT * FROM logged_in_users WHERE user = {{user.name}}\"}}\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence and whether they are located in expected locations.\n  - !{osquery{\"label\":\"Osquery - Retrieve Running Processes by User\",\"query\":\"SELECT pid, username, name FROM processes p JOIN users u ON u.uid = p.uid ORDER BY username\"}}\n  - !{osquery{\"label\":\"Osquery - Retrieve Process Info\",\"query\":\"SELECT name, cmdline, parent, path, uid FROM processes\"}}\n- Investigate other alerts associated with the user/host during the past 48 hours.\n  - If scripts or executables were dropped, retrieve the files and determine if they are malicious:\n    - Use a private sandboxed malware analysis system to perform analysis.\n      - Observe and collect information about the following activities:\n        - Attempts to contact external domains and addresses.\n          - Check if the domain is newly registered or unexpected.\n          - Check the reputation of the domain or IP address.\n        - File access, modification, and creation activities.\n\n### Related rules\n\n- ProxyChains Activity - 4b868f1f-15ff-4ba3-8c11-d5a7a6356d37\n- Potential Protocol Tunneling via Chisel Client - 3f12325a-4cc6-410b-8d4c-9fbbeb744cfd\n- Potential Protocol Tunneling via Chisel Server - ac8805f6-1e08-406c-962e-3937057fa86f\n- Potential Linux Tunneling and/or Port Forwarding - 6ee947e9-de7e-4281-a55d-09289bdf947e\n- Potential Protocol Tunneling via EarthWorm - 9f1c4ca3-44b5-481d-ba42-32dc215a2769\n\n### False positive analysis\n\n- If this activity is related to new benign software installation activity, consider adding exceptions — preferably with a combination of user and command line conditions.\n- If this activity is related to a system administrator or developer who uses this utility for benign purposes, consider adding exceptions for specific user accounts or hosts. \n- Try to understand the context of the execution by thinking about the user, machine, or business purpose. A small number of endpoints, such as servers with unique software, might appear unusual but satisfy a specific business need.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors, such as reverse shells, reverse proxies, or droppers, that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Leverage the incident response data and logging to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 7,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Command and Control",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://blog.bitsadmin.com/living-off-the-foreign-land-windows-as-offensive-platform"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1572",
                "name": "Protocol Tunneling",
                "reference": "https://attack.mitre.org/techniques/T1572/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "8fdf3b3b-db57-4751-a74d-71cffd66a388",
        "rule_id": "6ace94ba-f02c-4d55-9f53-87d99b6f9af4",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.394Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.394Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\", \"executed\", \"process_started\")\n and process.name == \"proxychains\" and process.args : (\n  \"ssh\", \"sshd\", \"sshuttle\", \"socat\", \"iodine\", \"iodined\", \"dnscat\", \"hans\", \"hans-ubuntu\", \"ptunnel-ng\",\n  \"ssf\", \"3proxy\", \"ngrok\", \"gost\", \"pivotnacci\", \"chisel*\", \"nmap\", \"ping\", \"python*\", \"php*\", \"perl\", \"ruby\",\n  \"lua*\", \"openssl\", \"nc\", \"netcat\", \"ncat\", \"telnet\", \"awk\", \"java\", \"telnet\", \"ftp\", \"curl\", \"wget\"\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "New Okta Identity Provider (IdP) Added by Admin",
        "description": "Detects the creation of a new Identity Provider (IdP) by a Super Administrator or Organization Administrator within Okta.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating New Okta Identity Provider (IdP) Added by Admin\n\nThis rule detects the creation of a new Identity Provider (IdP) by a Super Administrator or Organization Administrator within Okta.\n\n#### Possible investigation steps:\n- Identify the actor associated with the IdP creation by examining the `okta.actor.id`, `okta.actor.type`, `okta.actor.alternate_id`, and `okta.actor.display_name` fields.\n- Identify the IdP added by reviewing the `okta.target` field and determing if this IdP is authorized.\n- Determine the client used by the actor. Review the `okta.client.ip`, `okta.client.user_agent.raw_user_agent`, `okta.client.zone`, `okta.client.device`, and `okta.client.id` fields.\n- If the client is a device, check the `okta.device.id`, `okta.device.name`, `okta.device.os_platform`, `okta.device.os_version`, and `okta.device.managed` fields.\n- Review the past activities of the actor involved in this action by checking their previous actions logged in the `okta.target` field.\n- Examine the `okta.request.ip_chain` field to potentially determine if the actor used a proxy or VPN to perform this action.\n- Evaluate the actions that happened just before and after this event in the `okta.event_type` field to help understand the full context of the activity.\n\n### False positive analysis:\n- It might be a false positive if the action was part of a planned activity or performed by an authorized person.\n- Several unsuccessful attempts prior to this success, may indicate an adversary attempting to add an unauthorized IdP multiple times.\n\n### Response and remediation:\n- If the IdP is unauthorized, deactivate it immediately via the Okta console.\n- If the IdP is authorized, ensure that the actor who created it is authorized to do so.\n- If the actor is unauthorized, deactivate their account via the Okta console.\n- If the actor is authorized, ensure that the actor's account is not compromised.\n- Reset the user's password and enforce MFA re-enrollment, if applicable.\n- Block the IP address or device used in the attempts if they appear suspicious, using the data from the `okta.client.ip` and `okta.device.id` fields.\n- Conduct a review of Okta policies and ensure they are in accordance with security best practices.\n- If the deactivated IdP was crucial to the organization, consider adding a new IdP and removing the unauthorized IdP.",
        "output_index": "",
        "version": 205,
        "tags": [
          "Use Case: Identity and Access Audit",
          "Tactic: Persistence",
          "Data Source: Okta"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-30m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://blog.cloudflare.com/cloudflare-investigation-of-the-january-2022-okta-compromise/",
          "https://www.elastic.co/security-labs/testing-okta-visibility-and-detection-dorothy",
          "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection",
          "https://unit42.paloaltonetworks.com/muddled-libra/",
          "https://www.elastic.co/security-labs/monitoring-okta-threats-with-elastic-security",
          "https://www.elastic.co/security-labs/starter-guide-to-understanding-okta"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1556",
                "name": "Modify Authentication Process",
                "reference": "https://attack.mitre.org/techniques/T1556/",
                "subtechnique": [
                  {
                    "id": "T1556.007",
                    "name": "Hybrid Identity",
                    "reference": "https://attack.mitre.org/techniques/T1556/007/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "The Okta Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.",
        "related_integrations": [
          {
            "package": "okta",
            "version": "^3.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "okta.outcome.result",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "525cb158-9834-4e77-99b2-5e93f58eaa3e",
        "rule_id": "29b53942-7cd4-11ee-b70e-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.389Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.389Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-okta*"
        ],
        "query": "event.dataset: \"okta.system\" and event.action: \"system.idp.lifecycle.create\" and okta.outcome.result: \"SUCCESS\"\n",
        "language": "kuery"
      },
      {
        "name": "New Okta Authentication Behavior Detected",
        "description": "Detects events where Okta behavior detection has identified a new authentication behavior.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating New Okta Authentication Behavior Detected\n\nThis rule detects events where Okta behavior detection has identified a new authentication behavior such as a new device or location.\n\n#### Possible investigation steps:\n- Identify the user involved in this action by examining the `okta.actor.id`, `okta.actor.type`, `okta.actor.alternate_id`, and `okta.actor.display_name` fields.\n- Determine the authentication anomaly by examining the `okta.debug_context.debug_data.risk_behaviors` and `okta.debug_context.debug_data.flattened` fields.\n- Determine the client used by the actor. Review the `okta.client.ip`, `okta.client.user_agent.raw_user_agent`, `okta.client.zone`, `okta.client.device`, and `okta.client.id` fields.\n- If the client is a device, check the `okta.device.id`, `okta.device.name`, `okta.device.os_platform`, `okta.device.os_version`, and `okta.device.managed` fields.\n- Review the past activities of the actor involved in this action by checking their previous actions.\n- Examine the `okta.request.ip_chain` field to potentially determine if the actor used a proxy or VPN to perform this action.\n- Evaluate the actions that happened just before and after this event in the `okta.event_type` field to help understand the full context of the activity.\n\n### False positive analysis:\n- A user may be using a new device or location to sign in.\n- The Okta behavior detection may be incorrectly identifying a new authentication behavior and need adjusted.\n\n### Response and remediation:\n- If the user is legitimate and the authentication behavior is not suspicious, no action is required.\n- If the user is legitimate but the authentication behavior is suspicious, consider resetting the user's password and enabling multi-factor authentication (MFA).\n    - If MFA is already enabled, consider resetting MFA for the user.\n- If the user is not legitimate, consider deactivating the user's account.\n- If this is a false positive, consider adjusting the Okta behavior detection settings.\n- Block the IP address or device used in the attempts if they appear suspicious, using the data from the `okta.client.ip` and `okta.device.id` fields.\n- Conduct a review of Okta policies and ensure they are in accordance with security best practices.",
        "output_index": "",
        "version": 206,
        "tags": [
          "Use Case: Identity and Access Audit",
          "Tactic: Initial Access",
          "Data Source: Okta"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-30m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/testing-okta-visibility-and-detection-dorothy",
          "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection",
          "https://unit42.paloaltonetworks.com/muddled-libra/",
          "https://help.okta.com/oie/en-us/content/topics/security/behavior-detection/about-behavior-detection.htm",
          "https://www.elastic.co/security-labs/monitoring-okta-threats-with-elastic-security",
          "https://www.elastic.co/security-labs/starter-guide-to-understanding-okta"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": []
          }
        ],
        "setup": "The Okta Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.",
        "related_integrations": [
          {
            "package": "okta",
            "version": "^3.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "okta.debug_context.debug_data.risk_behaviors",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "b27fc9f9-2f8c-41a9-8c27-9e8ae839cc39",
        "rule_id": "260486ee-7d98-11ee-9599-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.385Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.385Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-okta*"
        ],
        "query": "event.dataset:okta.system and okta.debug_context.debug_data.risk_behaviors:*\n",
        "language": "kuery"
      },
      {
        "name": "Okta Sign-In Events via Third-Party IdP",
        "description": "Detects sign-in events where authentication is carried out via a third-party Identity Provider (IdP).",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Okta Sign-In Events via Third-Party IdP\n\nThis rule detects sign-in events where authentication is carried out via a third-party Identity Provider (IdP).\n\nAdversaries may attempt to add an unauthorized IdP to an Okta tenant to gain access to the tenant. Following this action, adversaries may attempt to sign in to the tenant using the unauthorized IdP. This rule detects both the addition of an unauthorized IdP and the subsequent sign-in attempt.\n\n#### Possible investigation steps:\n- Identify the third-party IdP by examining the `okta.authentication_context.issuer.id` field.\n- Once the third-party IdP is identified, determine if this IdP is authorized to be used by the tenant.\n- If the IdP is unauthorized, deactivate it immediately via the Okta console.\n- Identify the actor associated with the IdP creation by examining the `okta.actor.id`, `okta.actor.type`, `okta.actor.alternate_id`, and `okta.actor.display_name` fields in historical data.\n    - The `New Okta Identity Provider (IdP) Added by Admin` rule may be helpful in identifying the actor and the IdP creation event.\n- Determine the client used by the actor. Review the `okta.client.ip`, `okta.client.user_agent.raw_user_agent`, `okta.client.zone`, `okta.client.device`, and `okta.client.id` fields.\n- If the client is a device, check the `okta.device.id`, `okta.device.name`, `okta.device.os_platform`, `okta.device.os_version`, and `okta.device.managed` fields.\n- Review the past activities of the actor involved in this action by checking their previous actions logged in the `okta.target` field.\n- Examine the `okta.request.ip_chain` field to potentially determine if the actor used a proxy or VPN to perform this action.\n- Evaluate the actions that happened just before and after this event in the `okta.event_type` field to help understand the full context of the activity.\n\n### False positive analysis:\n- It might be a false positive if this IdP is authorized to be used by the tenant.\n- This may be a false positive if an authorized third-party IdP is used to sign in to the tenant but failures occurred due to an incorrect configuration.\n\n### Response and remediation:\n- If the IdP is unauthorized, deactivate it immediately via the Okta console.\n- Reset the effected user's password and enforce MFA re-enrollment, if applicable.\n- Mobile device forensics may be required to determine if the user's device is compromised.\n- If the IdP is authorized, ensure that the actor who created it is authorized to do so.\n- If the actor is unauthorized, deactivate their account via the Okta console.\n- If the actor is authorized, ensure that the actor's account is not compromised.\n\n- Block the IP address or device used in the attempts if they appear suspicious, using the data from the `okta.client.ip` and `okta.device.id` fields.\n- Conduct a review of Okta policies and ensure they are in accordance with security best practices.\n- If the deactivated IdP was crucial to the organization, consider adding a new IdP and removing the unauthorized IdP.",
        "output_index": "",
        "version": 206,
        "tags": [
          "Use Case: Identity and Access Audit",
          "Tactic: Initial Access",
          "Data Source: Okta"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-30m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://blog.cloudflare.com/cloudflare-investigation-of-the-january-2022-okta-compromise/",
          "https://www.elastic.co/security-labs/testing-okta-visibility-and-detection-dorothy",
          "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection",
          "https://unit42.paloaltonetworks.com/muddled-libra/",
          "https://www.elastic.co/security-labs/monitoring-okta-threats-with-elastic-security",
          "https://www.elastic.co/security-labs/starter-guide-to-understanding-okta"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1199",
                "name": "Trusted Relationship",
                "reference": "https://attack.mitre.org/techniques/T1199/"
              }
            ]
          }
        ],
        "setup": "The Okta Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.",
        "related_integrations": [
          {
            "package": "okta",
            "version": "^3.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "okta.authentication_context.issuer.id",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.debug_context.debug_data.request_uri",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.outcome.reason",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.outcome.result",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "11e42dbb-4ddf-4c91-86a0-4451015d4da5",
        "rule_id": "1ceb05c4-7d25-11ee-9562-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.381Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.381Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-okta*"
        ],
        "query": "event.dataset:okta.system and okta.debug_context.debug_data.request_uri:/oauth2/v1/authorize/callback and\n    (not okta.authentication_context.issuer.id:Okta and event.action:(user.authentication.auth_via_IDP\n        or user.authentication.auth_via_inbound_SAML\n        or user.authentication.auth_via_mfa\n        or user.authentication.auth_via_social)\n        or event.action:user.session.start) or\n    (event.action:user.authentication.auth_via_IDP and okta.outcome.result:FAILURE\n        and okta.outcome.reason:(\"A SAML assert with the same ID has already been processed by Okta for a previous request\"\n            or \"Unable to match transformed username\"\n            or \"Unable to resolve IdP endpoint\"\n            or \"Unable to validate SAML Response\"\n            or \"Unable to validate incoming SAML Assertion\"))\n",
        "language": "kuery"
      },
      {
        "name": "Machine Learning Detected a Suspicious Windows Event with a High Malicious Probability Score",
        "description": "A supervised machine learning model (ProblemChild) has identified a suspicious Windows process event with high probability of it being malicious activity. Alternatively, the model's blocklist identified the event as being malicious.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 110,
        "tags": [
          "OS: Windows",
          "Data Source: Elastic Endgame",
          "Use Case: Living off the Land Attack Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-10m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/problemchild",
          "https://www.elastic.co/security-labs/detecting-living-off-the-land-attacks-with-new-elastic-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.004",
                    "name": "Masquerade Task or Service",
                    "reference": "https://attack.mitre.org/techniques/T1036/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Living off the Land (LotL) Attack Detection integration assets to be installed, as well as Windows process events collected by integrations such as Elastic Defend or Winlogbeat.  \n\n### LotL Attack Detection Setup\nThe LotL Attack Detection integration detects living-off-the-land activity in Windows process events.\n\n#### Prerequisite Requirements:\n- Fleet is required for LotL Attack Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Windows process events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration or Winlogbeat(https://www.elastic.co/guide/en/beats/winlogbeat/current/_winlogbeat_overview.html).\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To set up and run Winlogbeat, follow [this](https://www.elastic.co/guide/en/beats/winlogbeat/current/winlogbeat-installation-configuration.html) guide.\n\n#### The following steps should be executed to install assets associated with the LotL Attack Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Living off the Land Attack Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Configure the ingest pipeline**.\n",
        "related_integrations": [
          {
            "package": "problemchild",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "blocklist_label",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "problemchild.prediction",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "problemchild.prediction_probability",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d4beeb87-d010-4493-ad57-d11f1c687c84",
        "rule_id": "994e40aa-8c85-43de-825e-15f665375ee8",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.376Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.376Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where ((problemchild.prediction == 1 and problemchild.prediction_probability > 0.98) or\nblocklist_label == 1) and not process.args : (\"*C:\\\\WINDOWS\\\\temp\\\\nessus_*.txt*\", \"*C:\\\\WINDOWS\\\\temp\\\\nessus_*.tmp*\")\n",
        "language": "eql",
        "index": [
          "endgame-*",
          "logs-endpoint.events.process-*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "Machine Learning Detected a Suspicious Windows Event with a Low Malicious Probability Score",
        "description": "A supervised machine learning model (ProblemChild) has identified a suspicious Windows process event with low probability of it being malicious activity. Alternatively, the model's blocklist identified the event as being malicious.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 8,
        "tags": [
          "OS: Windows",
          "Data Source: Elastic Endgame",
          "Use Case: Living off the Land Attack Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-10m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/problemchild",
          "https://www.elastic.co/security-labs/detecting-living-off-the-land-attacks-with-new-elastic-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.004",
                    "name": "Masquerade Task or Service",
                    "reference": "https://attack.mitre.org/techniques/T1036/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Living off the Land (LotL) Attack Detection integration assets to be installed, as well as Windows process events collected by integrations such as Elastic Defend or Winlogbeat.  \n\n### LotL Attack Detection Setup\nThe LotL Attack Detection integration detects living-off-the-land activity in Windows process events.\n\n#### Prerequisite Requirements:\n- Fleet is required for LotL Attack Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Windows process events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration or Winlogbeat(https://www.elastic.co/guide/en/beats/winlogbeat/current/_winlogbeat_overview.html).\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To set up and run Winlogbeat, follow [this](https://www.elastic.co/guide/en/beats/winlogbeat/current/winlogbeat-installation-configuration.html) guide.\n\n#### The following steps should be executed to install assets associated with the LotL Attack Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Living off the Land Attack Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Configure the ingest pipeline**.\n",
        "related_integrations": [
          {
            "package": "problemchild",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "blocklist_label",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "problemchild.prediction",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "problemchild.prediction_probability",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "e1211613-82ce-4cd0-b3df-64feed3768fb",
        "rule_id": "13e908b9-7bf0-4235-abc9-b5deb500d0ad",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.371Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.371Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where ((problemchild.prediction == 1 and problemchild.prediction_probability <= 0.98) or\nblocklist_label == 1) and not process.args : (\"*C:\\\\WINDOWS\\\\temp\\\\nessus_*.txt*\", \"*C:\\\\WINDOWS\\\\temp\\\\nessus_*.tmp*\")\n",
        "language": "eql",
        "index": [
          "endgame-*",
          "logs-endpoint.events.process-*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "Kirbi File Creation",
        "description": "Identifies the creation of .kirbi files. The creation of this kind of file is an indicator of an attacker running Kerberos ticket dump utilities, such as Mimikatz, and precedes attacks such as Pass-The-Ticket (PTT), which allows the attacker to impersonate users using Kerberos tickets.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 311,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon",
          "Data Source: SentinelOne",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: Elastic Endgame",
          "Data Source: Crowdstrike"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1003",
                "name": "OS Credential Dumping",
                "reference": "https://attack.mitre.org/techniques/T1003/"
              },
              {
                "id": "T1558",
                "name": "Steal or Forge Kerberos Tickets",
                "reference": "https://attack.mitre.org/techniques/T1558/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "crowdstrike",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "952de505-670c-490f-a56d-caf89e9a2b0d",
        "rule_id": "b8f8da2d-a9dc-48c0-90e4-955c0aa1259a",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.367Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.367Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"windows\" and event.type == \"creation\" and file.extension : \"kirbi\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file-*",
          "logs-windows.sysmon_operational-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-m365_defender.event-*",
          "winlogbeat-*",
          "endgame-*",
          "logs-crowdstrike.fdr*"
        ]
      },
      {
        "name": "PowerShell Kerberos Ticket Dump",
        "description": "Detects PowerShell scripts that have the capability of dumping Kerberos tickets from LSA, which potentially indicates an attacker's attempt to acquire credentials for lateral movement.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating PowerShell Kerberos Ticket Dump\n\nKerberos is an authentication protocol that relies on tickets to grant access to network resources. Adversaries may abuse this protocol to acquire credentials for lateral movement within a network.\n\nThis rule indicates the use of scripts that contain code capable of dumping Kerberos tickets, which can indicate potential PowerShell abuse for credential theft.\n\n### Possible investigation steps\n\n- Examine the script content that triggered the detection; look for suspicious DLL imports, collection or exfiltration capabilities, suspicious functions, encoded or compressed data, and other potentially malicious characteristics.\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Investigate if the script was executed, and if so, which account was targeted.\n- Identify the account involved and contact the owner to confirm whether they are aware of this activity.\n- Check if the script has any other functionality that can be potentially malicious.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Investigate other potentially compromised accounts and hosts. Review login events (like 4624) for suspicious events involving the subject and target accounts.\n\n### False positive analysis\n\n- If this activity is expected and noisy in your environment, consider adding exceptions — preferably with a combination of file path and user ID conditions.\n\n### Related Rules\n\n- PowerShell Kerberos Ticket Request - eb610e70-f9e6-4949-82b9-f1c5bcd37c39\n\n### Response and Remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n  - If malicious activity is confirmed, perform a broader investigation to identify the scope of the compromise and determine the appropriate remediation steps.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- Disable or limit involved accounts during the investigation and response.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Reimage the host operating system or restore the compromised files to clean versions.\n- Restrict PowerShell usage outside of IT and engineering business units using GPOs, AppLocker, Intune, or similar software.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 107,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: PowerShell Logs"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/MzHmO/PowershellKerberos/blob/main/dumper.ps1"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1003",
                "name": "OS Credential Dumping",
                "reference": "https://attack.mitre.org/techniques/T1003/"
              },
              {
                "id": "T1558",
                "name": "Steal or Forge Kerberos Tickets",
                "reference": "https://attack.mitre.org/techniques/T1558/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.001",
                    "name": "PowerShell",
                    "reference": "https://attack.mitre.org/techniques/T1059/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe 'PowerShell Script Block Logging' logging policy must be enabled.\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nAdministrative Templates >\nWindows PowerShell >\nTurn on PowerShell Script Block Logging (Enable)\n```\n\nSteps to implement the logging policy via registry:\n\n```\nreg add \"hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\" /v EnableScriptBlockLogging /t REG_DWORD /d 1\n```\n",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "powershell.file.script_block_text",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "5a280597-e712-43aa-ad21-91746f432537",
        "rule_id": "fddff193-48a3-484d-8d35-90bb3d323a56",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.443Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.443Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "winlogbeat-*",
          "logs-windows.powershell*"
        ],
        "query": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    \"LsaCallAuthenticationPackage\" and\n    (\n      \"KerbRetrieveEncodedTicketMessage\" or\n      \"KerbQueryTicketCacheMessage\" or\n      \"KerbQueryTicketCacheExMessage\" or\n      \"KerbQueryTicketCacheEx2Message\" or\n      \"KerbRetrieveTicketMessage\" or\n      \"KerbDecryptDataMessage\"\n    )\n  )\n",
        "language": "kuery"
      },
      {
        "name": "Potential Meterpreter Reverse Shell",
        "description": "This detection rule identifies a sample of suspicious Linux system file reads used for system fingerprinting, leveraged by the Metasploit Meterpreter shell to gather information about the target that it is executing its shell on. Detecting this pattern is indicative of a successful meterpreter shell connection.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 7,
        "tags": [
          "Data Source: Auditd Manager",
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/primer-on-persistence-mechanisms",
          "https://www.elastic.co/security-labs/linux-detection-engineering-with-auditd"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1071",
                "name": "Application Layer Protocol",
                "reference": "https://attack.mitre.org/techniques/T1071/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from one of the following integrations:\n- Auditbeat\n- Auditd Manager\n\n### Auditbeat Setup\nAuditbeat is a lightweight shipper that you can install on your servers to audit the activities of users and processes on your systems. For example, you can use Auditbeat to collect and centralize audit events from the Linux Audit Framework. You can also use Auditbeat to detect changes to critical files, like binaries and configuration files, and identify potential security policy violations.\n\n#### The following steps should be executed in order to add the Auditbeat on a Linux System:\n- Elastic provides repositories available for APT and YUM-based distributions. Note that we provide binary packages, but no source packages.\n- To install the APT and YUM repositories follow the setup instructions in this [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setup-repositories.html).\n- To run Auditbeat on Docker follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-docker.html).\n- To run Auditbeat on Kubernetes follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-kubernetes.html).\n- For complete “Setup and Run Auditbeat” information refer to the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setting-up-and-running.html).\n\n### Auditd Manager Integration Setup\nThe Auditd Manager Integration receives audit events from the Linux Audit Framework which is a part of the Linux kernel.\nAuditd Manager provides a user-friendly interface and automation capabilities for configuring and monitoring system auditing through the auditd daemon. With `auditd_manager`, administrators can easily define audit rules, track system events, and generate comprehensive audit reports, improving overall security and compliance in the system.\n\n#### The following steps should be executed in order to add the Elastic Agent System integration \"auditd_manager\" on a Linux System:\n- Go to the Kibana home page and click “Add integrations”.\n- In the query bar, search for “Auditd Manager” and select the integration to see more details about it.\n- Click “Add Auditd Manager”.\n- Configure the integration name and optionally add a description.\n- Review optional and advanced settings accordingly.\n- Add the newly installed “auditd manager” to an existing or a new agent policy, and deploy the agent on a Linux system from which auditd log files are desirable.\n- Click “Save and Continue”.\n- For more details on the integration refer to the [helper guide](https://docs.elastic.co/integrations/auditd_manager).\n\n#### Rule Specific Setup Note\nAuditd Manager subscribes to the kernel and receives events as they occur without any additional configuration.\nHowever, if more advanced configuration is required to detect specific behavior, audit rules can be added to the integration in either the \"audit rules\" configuration box or the \"auditd rule files\" box by specifying a file to read the audit rules from.\n- For this detection rule the following additional audit rules are required to be added to the integration:\n  -w /proc/net/ -p r -k audit_proc\n  -w /etc/machine-id -p wa -k machineid\n  -w /etc/passwd -p wa -k passwd\n",
        "related_integrations": [
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "auditd.data.a2",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "auditd.data.syscall",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pid",
            "type": "long",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a95ca0d9-8c3e-47b6-ba6d-dda495e174ee",
        "rule_id": "5c895b4f-9133-4e68-9e23-59902175355c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.448Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.448Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sample by host.id, process.pid, user.id\n  [file where host.os.type == \"linux\" and auditd.data.syscall == \"open\" and auditd.data.a2 == \"1b6\" and file.path == \"/etc/machine-id\"]\n  [file where host.os.type == \"linux\" and auditd.data.syscall == \"open\" and auditd.data.a2 == \"1b6\" and file.path == \"/etc/passwd\"]\n  [file where host.os.type == \"linux\" and auditd.data.syscall == \"open\" and auditd.data.a2 == \"1b6\" and file.path == \"/proc/net/route\"]\n  [file where host.os.type == \"linux\" and auditd.data.syscall == \"open\" and auditd.data.a2 == \"1b6\" and file.path == \"/proc/net/ipv6_route\"]\n  [file where host.os.type == \"linux\" and auditd.data.syscall == \"open\" and auditd.data.a2 == \"1b6\" and file.path == \"/proc/net/if_inet6\"]\n",
        "language": "eql",
        "index": [
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Okta FastPass Phishing Detection",
        "description": "Detects when Okta FastPass prevents a user from authenticating to a phishing website.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "",
        "output_index": "",
        "version": 307,
        "tags": [
          "Tactic: Initial Access",
          "Use Case: Identity and Access Audit",
          "Data Source: Okta"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Austin Songer"
        ],
        "false_positives": [],
        "references": [
          "https://developer.okta.com/docs/reference/api/system-log/",
          "https://developer.okta.com/docs/reference/api/event-types/",
          "https://sec.okta.com/fastpassphishingdetection",
          "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection",
          "https://www.elastic.co/security-labs/monitoring-okta-threats-with-elastic-security",
          "https://www.elastic.co/security-labs/starter-guide-to-understanding-okta"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1566",
                "name": "Phishing",
                "reference": "https://attack.mitre.org/techniques/T1566/"
              }
            ]
          }
        ],
        "setup": "The Okta Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.\n\nThis rule requires Okta to have the following turned on:\n\nOkta Identity Engine - select 'Phishing Resistance for FastPass' under Settings > Features in the Admin Console.",
        "related_integrations": [
          {
            "package": "okta",
            "version": "^3.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "okta.event_type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.outcome.reason",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "a69e9892-c083-44f0-b62f-09475c3c10fa",
        "rule_id": "ee39a9f7-5a79-4b0a-9815-d36b3cf28d3e",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.452Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.452Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-okta*"
        ],
        "query": "event.dataset:okta.system and event.category:authentication and\n  okta.event_type:user.authentication.auth_via_mfa and event.outcome:failure and okta.outcome.reason:\"FastPass declined phishing attempt\"\n",
        "language": "kuery"
      },
      {
        "name": "First Occurrence of Okta User Session Started via Proxy",
        "description": "Identifies the first occurrence of an Okta user session started via a proxy.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating First Occurrence of Okta User Session Started via Proxy\n\nThis rule detects the first occurrence of an Okta user session started via a proxy. This rule is designed to help identify suspicious authentication behavior that may be indicative of an attacker attempting to gain access to an Okta account while remaining anonymous. This rule leverages the New Terms rule type feature where the `okta.actor.id` value is checked against the previous 7 days of data to determine if the value has been seen before for this activity.\n\n#### Possible investigation steps:\n- Identify the user involved in this action by examining the `okta.actor.id`, `okta.actor.type`, `okta.actor.alternate_id`, and `okta.actor.display_name` fields.\n- Determine the client used by the actor. Review the `okta.client.ip`, `okta.client.user_agent.raw_user_agent`, `okta.client.zone`, `okta.client.device`, and `okta.client.id` fields.\n- Examine the `okta.debug_context.debug_data.flattened` field for more information about the proxy used.\n- Review the `okta.request.ip_chain` field for more information about the geographic location of the proxy.\n- Review the past activities of the actor involved in this action by checking their previous actions.\n- Evaluate the actions that happened just before and after this event in the `okta.event_type` field to help understand the full context of the activity.\n\n### False positive analysis:\n- A user may have legitimately started a session via a proxy for security or privacy reasons.\n\n### Response and remediation:\n- Review the profile of the user involved in this action to determine if proxy usage may be expected.\n- If the user is legitimate and the authentication behavior is not suspicious, no action is required.\n- If the user is legitimate but the authentication behavior is suspicious, consider resetting the user's password and enabling multi-factor authentication (MFA).\n    - If MFA is already enabled, consider resetting MFA for the user.\n- If the user is not legitimate, consider deactivating the user's account.\n- Conduct a review of Okta policies and ensure they are in accordance with security best practices.\n\n## Setup",
        "output_index": "",
        "version": 205,
        "tags": [
          "Tactic: Initial Access",
          "Use Case: Identity and Access Audit",
          "Data Source: Okta"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://developer.okta.com/docs/reference/api/system-log/",
          "https://developer.okta.com/docs/reference/api/event-types/",
          "https://developer.okta.com/docs/reference/api/system-log/#issuer-object",
          "https://www.elastic.co/security-labs/testing-okta-visibility-and-detection-dorothy",
          "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection",
          "https://www.elastic.co/security-labs/monitoring-okta-threats-with-elastic-security",
          "https://www.elastic.co/security-labs/starter-guide-to-understanding-okta"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1133",
                "name": "External Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1133/"
              }
            ]
          }
        ],
        "setup": "The Okta Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.",
        "related_integrations": [
          {
            "package": "okta",
            "version": "^3.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "okta.actor.id",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.event_type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.security_context.is_proxy",
            "type": "boolean",
            "ecs": false
          }
        ],
        "id": "4f070810-7844-4e3f-8cff-600a46b51a69",
        "rule_id": "6f1bb4b2-7dc8-11ee-92b2-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.464Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.464Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset:okta.system and okta.event_type: (user.session.start or user.authentication.verify) and okta.security_context.is_proxy:true and not okta.actor.id: okta*\n",
        "new_terms_fields": [
          "okta.actor.id",
          "cloud.account.id"
        ],
        "history_window_start": "now-7d",
        "index": [
          "filebeat-*",
          "logs-okta*"
        ],
        "language": "kuery"
      },
      {
        "name": "WRITEDAC Access on Active Directory Object",
        "description": "Identifies the access on an object with WRITEDAC permissions. With the WRITEDAC permission, the user can perform a Write Discretionary Access Control List (WriteDACL) operation, which is used to modify the access control rules associated with a specific object within Active Directory. Attackers may abuse this privilege to grant themselves or other compromised accounts additional rights, ultimately compromising the target object, resulting in privilege escalation, lateral movement, and persistence.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 107,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Active Directory",
          "Use Case: Active Directory Monitoring",
          "Rule Type: BBR",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.blackhat.com/docs/us-17/wednesday/us-17-Robbins-An-ACE-Up-The-Sleeve-Designing-Active-Directory-DACL-Backdoors.pdf"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1222",
                "name": "File and Directory Permissions Modification",
                "reference": "https://attack.mitre.org/techniques/T1222/",
                "subtechnique": [
                  {
                    "id": "T1222.001",
                    "name": "Windows File and Directory Permissions Modification",
                    "reference": "https://attack.mitre.org/techniques/T1222/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe 'Audit Directory Service Access' logging policy must be configured for (Success, Failure).\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nPolicies >\nWindows Settings >\nSecurity Settings >\nAdvanced Audit Policies Configuration >\nAudit Policies >\nDS Access >\nAudit Directory Service Access (Success,Failure)\n```\n",
        "related_integrations": [
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.code",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "winlog.event_data.AccessMask",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "c3bfa73f-75b2-4b9b-85b7-a5697c582070",
        "rule_id": "f5861570-e39a-4b8a-9259-abd39f84cb97",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.468Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.468Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "winlogbeat-*",
          "logs-system.security*",
          "logs-windows.*"
        ],
        "query": "host.os.type: \"windows\" and event.action : (\"Directory Service Access\" or \"object-operation-performed\") and\n  event.code : \"4662\" and winlog.event_data.AccessMask:\"0x40000\"\n",
        "language": "kuery"
      },
      {
        "name": "PowerShell Script with Password Policy Discovery Capabilities",
        "description": "Identifies the use of Cmdlets and methods related to remote execution activities using WinRM. Attackers can abuse WinRM to perform lateral movement using built-in tools.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 107,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Tactic: Execution",
          "Data Source: PowerShell Logs",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1201",
                "name": "Password Policy Discovery",
                "reference": "https://attack.mitre.org/techniques/T1201/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.001",
                    "name": "PowerShell",
                    "reference": "https://attack.mitre.org/techniques/T1059/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe 'PowerShell Script Block Logging' logging policy must be enabled.\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nAdministrative Templates >\nWindows PowerShell >\nTurn on PowerShell Script Block Logging (Enable)\n```\n\nSteps to implement the logging policy via registry:\n\n```\nreg add \"hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\" /v EnableScriptBlockLogging /t REG_DWORD /d 1\n```\n",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "powershell.file.script_block_text",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "2b9a4da4-b70e-4936-86ca-1a32cd4644ee",
        "rule_id": "fe25d5bc-01fa-494a-95ff-535c29cc4c96",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.472Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.472Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "winlogbeat-*",
          "logs-windows.powershell*"
        ],
        "query": "event.category: \"process\" and host.os.type:windows and\n(\n  powershell.file.script_block_text: (\n    \"Get-ADDefaultDomainPasswordPolicy\" or\n    \"Get-ADFineGrainedPasswordPolicy\" or\n    \"Get-ADUserResultantPasswordPolicy\" or\n    \"Get-DomainPolicy\" or\n    \"Get-GPPPassword\" or\n    \"Get-PassPol\"\n  )\n  or\n  powershell.file.script_block_text: (\n    (\"defaultNamingContext\" or \"ActiveDirectory.DirectoryContext\" or \"ActiveDirectory.DirectorySearcher\") and\n    (\n      (\n        \".MinLengthPassword\" or\n        \".MinPasswordAge\" or\n        \".MaxPasswordAge\"\n      ) or\n      (\n        \"minPwdAge\" or\n        \"maxPwdAge\" or\n        \"minPwdLength\"\n      ) or\n      (\n        \"msDS-PasswordSettings\"\n      )\n    )\n  )\n) and not powershell.file.script_block_text : (\n    \"sentinelbreakpoints\" and \"Set-PSBreakpoint\" and \"PowerSploitIndicators\"\n  )\n  and not \n  (\n    powershell.file.script_block_text : (\"43c15630-959c-49e4-a977-758c5cc93408\" and \"CmdletsToExport\" and \"ActiveDirectory.Types.ps1xml\")\n  )\n  and not user.id : \"S-1-5-18\"\n",
        "language": "kuery"
      },
      {
        "name": "WMIC Remote Command",
        "description": "Identifies the use of wmic.exe to run commands on remote hosts. While this can be used by administrators legitimately, attackers can abuse this built-in utility to achieve lateral movement.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 107,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Lateral Movement",
          "Data Source: Elastic Defend",
          "Rule Type: BBR",
          "Data Source: Sysmon",
          "Data Source: Elastic Endgame",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1021",
                "name": "Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1021/",
                "subtechnique": [
                  {
                    "id": "T1021.006",
                    "name": "Windows Remote Management",
                    "reference": "https://attack.mitre.org/techniques/T1021/006/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1047",
                "name": "Windows Management Instrumentation",
                "reference": "https://attack.mitre.org/techniques/T1047/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "b4466385-4b7b-4154-a005-ee2a61679890",
        "rule_id": "f59668de-caa0-4b84-94c1-3a1549e1e798",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.476Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.476Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  process.name : \"WMIC.exe\" and\n  process.args : \"*node:*\" and\n  process.args : (\"call\", \"set\", \"get\") and\n  not process.args : (\"*/node:localhost*\", \"*/node:\\\"127.0.0.1\\\"*\", \"/node:127.0.0.1\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-system.security*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "Potential Disabling of AppArmor",
        "description": "This rule monitors for potential attempts to disable AppArmor. AppArmor is a Linux security module that enforces fine-grained access control policies to restrict the actions and resources that specific applications and processes can access. Adversaries may disable security tools to avoid possible detection of their tools and activities.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 7,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1562",
                "name": "Impair Defenses",
                "reference": "https://attack.mitre.org/techniques/T1562/",
                "subtechnique": [
                  {
                    "id": "T1562.001",
                    "name": "Disable or Modify Tools",
                    "reference": "https://attack.mitre.org/techniques/T1562/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "fd3e90d2-ad78-4840-a69d-fdaaa5a2644c",
        "rule_id": "fac52c69-2646-4e79-89c0-fd7653461010",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.479Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.479Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\", \"executed\", \"process_started\")\n and (\n  (process.name == \"systemctl\" and process.args in (\"stop\", \"disable\", \"kill\") and process.args in (\"apparmor\", \"apparmor.service\")) or\n  (process.name == \"service\" and process.args == \"apparmor\" and process.args == \"stop\") or \n  (process.name == \"chkconfig\" and process.args == \"apparmor\" and process.args == \"off\") or\n  (process.name == \"ln\" and process.args : \"/etc/apparmor.d/*\" and process.args == \"/etc/apparmor.d/disable/\")\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Network Activity Detected via Kworker",
        "description": "This rule monitors for network connections from a kworker process. kworker, or kernel worker, processes are part of the kernel's workqueue mechanism. They are responsible for executing work that has been scheduled to be done in kernel space, which might include tasks like handling interrupts, background activities, and other kernel-related tasks. Attackers may attempt to evade detection by masquerading as a kernel worker process.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 6,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Command and Control",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": []
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1014",
                "name": "Rootkit",
                "reference": "https://attack.mitre.org/techniques/T1014/"
              },
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": [
              {
                "id": "T1041",
                "name": "Exfiltration Over C2 Channel",
                "reference": "https://attack.mitre.org/techniques/T1041/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows\nthe Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest to select \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "destination.port",
            "type": "long",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "23f73109-ee85-4e5e-8e26-46091476f9d9",
        "rule_id": "25d917c4-aa3c-4111-974c-286c0312ff95",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.484Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.484Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "host.os.type:linux and event.category:network and event.action:(connection_attempted or connection_accepted) and \nprocess.name:kworker* and not destination.ip:(\n  10.0.0.0/8 or\n  127.0.0.0/8 or\n  169.254.0.0/16 or\n  172.16.0.0/12 or\n  192.168.0.0/16 or\n  224.0.0.0/4 or\n  \"::1\" or\n  \"FE80::/10\" or\n  \"FF00::/8\"\n) and not destination.port:(\"2049\" or \"111\" or \"892\" or \"597\")\n",
        "new_terms_fields": [
          "process.name",
          "host.id"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-endpoint.events.*"
        ],
        "language": "kuery"
      },
      {
        "name": "Systemd-udevd Rule File Creation",
        "description": "Monitors for the creation of rule files that are used by systemd-udevd to manage device nodes and handle kernel device events in the Linux operating system. Systemd-udevd can be exploited for persistence by adversaries by creating malicious udev rules that trigger on specific events, executing arbitrary commands or payloads whenever a certain device is plugged in or recognized by the system.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 7,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1037",
                "name": "Boot or Logon Initialization Scripts",
                "reference": "https://attack.mitre.org/techniques/T1037/"
              },
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows\nthe Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click Add integrations.\n- In the query bar, search for Elastic Defend and select the integration to see more details about it.\n- Click Add Elastic Defend.\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either Traditional Endpoints or Cloud Workloads.\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest to select \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in New agent policy name. If other agent policies already exist, you can click the Existing hosts tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click Save and Continue.\n- To complete the integration, select Add Elastic Agent to your hosts and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.original.extension",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "6de59949-607f-4c29-9ed2-784ce83a6c6a",
        "rule_id": "054db96b-fd34-43b3-9af2-587b3bd33964",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.487Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.487Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.action in (\"rename\", \"creation\") and \nprocess.executable != null and file.extension == \"rules\" and\nfile.path : (\n  \"/lib/udev/*\", \"/etc/udev/rules.d/*\", \"/usr/lib/udev/rules.d/*\", \"/run/udev/rules.d/*\", \"/usr/local/lib/udev/rules.d/*\"\n) and not (\n  process.executable in (\n    \"/bin/dpkg\", \"/usr/bin/dpkg\", \"/bin/dockerd\", \"/usr/bin/dockerd\", \"/usr/sbin/dockerd\", \"/bin/microdnf\",\n    \"/usr/bin/microdnf\", \"/bin/rpm\", \"/usr/bin/rpm\", \"/bin/snapd\", \"/usr/bin/snapd\", \"/bin/yum\", \"/usr/bin/yum\",\n    \"/bin/dnf\", \"/usr/bin/dnf\", \"/bin/podman\", \"/usr/bin/podman\", \"/bin/dnf-automatic\", \"/usr/bin/dnf-automatic\",\n    \"/bin/pacman\", \"/usr/bin/pacman\", \"/usr/bin/dpkg-divert\", \"/bin/dpkg-divert\", \"/sbin/apk\", \"/usr/sbin/apk\",\n    \"/usr/local/sbin/apk\", \"/usr/bin/apt\", \"/usr/sbin/pacman\", \"/bin/podman\", \"/usr/bin/podman\", \"/usr/bin/puppet\",\n    \"/bin/puppet\", \"/opt/puppetlabs/puppet/bin/puppet\", \"/usr/bin/chef-client\", \"/bin/chef-client\",\n    \"/bin/autossl_check\", \"/usr/bin/autossl_check\", \"/proc/self/exe\", \"/dev/fd/*\",  \"/usr/bin/pamac-daemon\",\n    \"/bin/pamac-daemon\", \"/usr/lib/snapd/snapd\", \"/usr/local/bin/dockerd\", \"/usr/libexec/netplan/generate\",\n    \"/lib/systemd/system-generators/netplan\", \"/lib/systemd/systemd\", \"/usr/bin/containerd\", \"/usr/sbin/sshd\",\n    \"/kaniko/executor\"\n  ) or\n  file.Ext.original.extension == \"dpkg-new\" or\n  process.executable : (\n    \"/nix/store/*\", \"/var/lib/dpkg/*\", \"/snap/*\", \"/dev/fd/*\", \"/usr/lib/*\", \"/usr/libexec/*\"\n  ) or\n  process.name in (\"systemd\", \"netplan\", \"apt-get\", \"vmware-config-tools.pl\", \"systemd-hwdb\") or\n  (process.name == \"sed\" and file.name : \"sed*\") or\n  (process.name == \"perl\" and file.name : \"e2scrub_all.tmp*\") \n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*"
        ]
      },
      {
        "name": "Stolen Credentials Used to Login to Okta Account After MFA Reset",
        "description": "Detects a sequence of suspicious activities on Windows hosts indicative of credential compromise, followed by efforts to undermine multi-factor authentication (MFA) and single sign-on (SSO) mechanisms for an Okta user account.",
        "risk_score": 73,
        "severity": "high",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Stolen Credentials Used to Login to Okta Account After MFA Reset\n\nThis rule detects a sequence of suspicious activities on Windows hosts indicative of credential compromise, followed by efforts to undermine multi-factor authentication (MFA) and single sign-on (SSO) mechanisms for an Okta user account.\n\nTypically, adversaries initially extract credentials from targeted endpoints through various means. Subsequently, leveraging social engineering, they may seek to reset the MFA credentials associated with an Okta account, especially in scenarios where Active Directory (AD) services are integrated with Okta. Successfully resetting MFA allows the unauthorized use of stolen credentials to gain access to the compromised Okta account. The attacker can then register their own device for MFA, paving the way for unfettered access to the user's Okta account and any associated SaaS applications. This is particularly alarming if the compromised account has administrative rights, as it could lead to widespread access to organizational resources and configurations.\n\n#### Possible investigation steps:\n- Identify the user account associated with the Okta login attempt by examining the `user.name` field.\n- Identify the endpoint for the Credential Access alert for this user by examining the `host.name` and `host.id` fields from the alert document.\n- Cross-examine the Okta user and endpoint user to confirm that they are the same person.\n- Reach out to the user to confirm if they have intentionally reset their MFA credentials recently or asked for help in doing so.\n- If the user is unaware of the MFA reset, incident response may be required immediately to prevent further compromise.\n\n### False positive analysis:\n- A Windows administrator may have triggered a low-fidelity credential access alert during a legitimate administrative action. Following this, the administrator may have reset the MFA credentials for themselves and then logged into the Okta console for AD directory services integration management.\n\n### Response and remediation:\n- If confirmed that the user did not intentionally have their MFA factor reset, deactivate the user account.\n- After deactivation, reset the user's password and MFA factor to regain control of the account.\n    - Ensure that all user sessions are stopped during this process.\n- Immediately reset the user's AD password as well if Okta does not sync back to AD.\n- Forensic analysis on the user's endpoint may be required to determine the root cause of the compromise and identify the scope of the compromise.\n- Review Okta system logs to identify any other suspicious activity associated with the user account, such as creation of a backup account.\n- With the device ID captured from the MFA factor reset, search across all Okta logs for any other activity associated with the device ID.\n\n## Setup",
        "output_index": "",
        "version": 205,
        "tags": [
          "Tactic: Persistence",
          "Use Case: Identity and Access Audit",
          "Data Source: Okta",
          "Data Source: Elastic Defend",
          "Rule Type: Higher-Order Rule",
          "Domain: Endpoint",
          "Domain: Cloud"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "6h",
        "from": "now-12h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "A Windows administrator may have triggered a low-fidelity credential access alert during a legitimate administrative action. Following this, the administrator may have reset the MFA credentials for themselves and then logged into the Okta console for AD directory services integration management."
        ],
        "references": [
          "https://developer.okta.com/docs/reference/api/system-log/",
          "https://developer.okta.com/docs/reference/api/event-types/",
          "https://www.elastic.co/security-labs/testing-okta-visibility-and-detection-dorothy",
          "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection",
          "https://www.elastic.co/security-labs/monitoring-okta-threats-with-elastic-security",
          "https://www.elastic.co/security-labs/starter-guide-to-understanding-okta"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1556",
                "name": "Modify Authentication Process",
                "reference": "https://attack.mitre.org/techniques/T1556/",
                "subtechnique": [
                  {
                    "id": "T1556.006",
                    "name": "Multi-Factor Authentication",
                    "reference": "https://attack.mitre.org/techniques/T1556/006/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "The Okta and Elastic Defend fleet integration structured data is required to be compatible with this rule. Directory services integration in Okta with AD synced is also required for this rule to be effective as it relies on triaging `user.name` from Okta and Elastic Defend events.",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "okta",
            "version": "^3.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "okta.event_type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "signal.rule.threat.tactic.name",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "user.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "b5914f1d-f513-4dd9-a92b-7af446ed25ef",
        "rule_id": "5610b192-7f18-11ee-825b-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.491Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.491Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by user.name with maxspan=12h\n    [any where host.os.type == \"windows\" and signal.rule.threat.tactic.name == \"Credential Access\"]\n    [any where event.dataset == \"okta.system\" and okta.event_type == \"user.mfa.factor.update\"]\n    [any where event.dataset == \"okta.system\" and okta.event_type: (\"user.session.start\", \"user.authentication*\")]\n",
        "language": "eql",
        "index": [
          "filebeat-*",
          "logs-okta*",
          ".alerts-security.*",
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Suspicious which Enumeration",
        "description": "This rule monitors for the usage of the which command with an unusual amount of process arguments. Attackers may leverage the which command to enumerate the system for useful installed utilities that may be used after compromising a system to escalate privileges or move latteraly across the network.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 7,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1082",
                "name": "System Information Discovery",
                "reference": "https://attack.mitre.org/techniques/T1082/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "ab5cf402-0d6f-4a94-ba68-6d36a2151efc",
        "rule_id": "5b18eef4-842c-4b47-970f-f08d24004bde",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.499Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.499Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and \nprocess.name == \"which\" and process.args_count >= 10 and not (\n  process.parent.name == \"jem\" or\n  process.parent.executable like (\"/vz/root/*\", \"/var/lib/docker/*\") or\n  process.args == \"--tty-only\"\n)\n\n/* potential tuning if rule would turn out to be noisy\nand process.args in (\"nmap\", \"nc\", \"ncat\", \"netcat\", nc.traditional\", \"gcc\", \"g++\", \"socat\") and \nprocess.parent.name in (\"bash\", \"dash\", \"ash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\")\n*/\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "GitHub Protected Branch Settings Changed",
        "description": "This rule detects setting modifications for protected branches of a GitHub repository. Branch protection rules can be used to enforce certain workflows or requirements before a contributor can push changes to a branch in your repository. Changes to these protected branch settings should be investigated and verified as legitimate activity. Unauthorized changes could be used to lower your organization's security posture and leave you exposed for future attacks.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 206,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1562",
                "name": "Impair Defenses",
                "reference": "https://attack.mitre.org/techniques/T1562/",
                "subtechnique": [
                  {
                    "id": "T1562.001",
                    "name": "Disable or Modify Tools",
                    "reference": "https://attack.mitre.org/techniques/T1562/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "github.category",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "ac04d9a7-bb39-42b4-838f-271bf40abec0",
        "rule_id": "07639887-da3a-4fbf-9532-8ce748ff8c50",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.495Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.495Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "configuration where event.dataset == \"github.audit\"\n  and github.category == \"protected_branch\" and event.type == \"change\"\n",
        "language": "eql",
        "index": [
          "logs-github.audit-*"
        ]
      },
      {
        "name": "New GitHub Owner Added",
        "description": "Detects when a new member is added to a GitHub organization as an owner. This role provides admin level privileges. Any new owner roles should be investigated to determine it's validity. Unauthorized owner roles could indicate compromise within your organization and provide unlimited access to data and settings.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 206,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Persistence",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1136",
                "name": "Create Account",
                "reference": "https://attack.mitre.org/techniques/T1136/",
                "subtechnique": [
                  {
                    "id": "T1136.003",
                    "name": "Cloud Account",
                    "reference": "https://attack.mitre.org/techniques/T1136/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "github.permission",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "eda9bcf8-006c-4b34-bc76-12dc9edc34e0",
        "rule_id": "24401eca-ad0b-4ff9-9431-487a8e183af9",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.503Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.503Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "iam where event.dataset == \"github.audit\" and event.action == \"org.add_member\" and github.permission == \"admin\"\n",
        "language": "eql",
        "index": [
          "logs-github.audit-*"
        ]
      },
      {
        "name": "Multiple Okta Sessions Detected for a Single User",
        "description": "Detects when a user has started multiple Okta sessions with the same user account and different session IDs. This may indicate that an attacker has stolen the user's session cookie and is using it to access the user's account from a different location.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "",
        "output_index": "",
        "version": 206,
        "tags": [
          "Use Case: Identity and Access Audit",
          "Data Source: Okta",
          "Tactic: Lateral Movement"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-30m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "A user may have multiple sessions open at the same time, such as on a mobile device and a laptop."
        ],
        "references": [
          "https://developer.okta.com/docs/reference/api/system-log/",
          "https://developer.okta.com/docs/reference/api/event-types/",
          "https://www.elastic.co/security-labs/testing-okta-visibility-and-detection-dorothy",
          "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection",
          "https://www.elastic.co/security-labs/monitoring-okta-threats-with-elastic-security",
          "https://www.elastic.co/security-labs/starter-guide-to-understanding-okta"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1550",
                "name": "Use Alternate Authentication Material",
                "reference": "https://attack.mitre.org/techniques/T1550/",
                "subtechnique": [
                  {
                    "id": "T1550.004",
                    "name": "Web Session Cookie",
                    "reference": "https://attack.mitre.org/techniques/T1550/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "The Okta Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.",
        "related_integrations": [
          {
            "package": "okta",
            "version": "^3.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "okta.actor.display_name",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.actor.id",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.authentication_context.external_session_id",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.event_type",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "b5116aa1-7229-4703-93eb-011678e7b93d",
        "rule_id": "621e92b6-7e54-11ee-bdc0-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.514Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.514Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "threshold",
        "query": "event.dataset:okta.system and okta.event_type:user.session.start and okta.authentication_context.external_session_id:*\n    and not (okta.actor.id: okta* or okta.actor.display_name: okta*)\n",
        "threshold": {
          "field": [
            "okta.actor.id"
          ],
          "value": 1,
          "cardinality": [
            {
              "field": "okta.authentication_context.external_session_id",
              "value": 3
            }
          ]
        },
        "index": [
          "filebeat-*",
          "logs-okta*"
        ],
        "language": "kuery"
      },
      {
        "name": "Potential Linux Tunneling and/or Port Forwarding",
        "description": "This rule monitors for a set of Linux utilities that can be used for tunneling and port forwarding. Attackers can leverage tunneling and port forwarding techniques to bypass network defenses, establish hidden communication channels, and gain unauthorized access to internal resources, facilitating data exfiltration, lateral movement, and remote control.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Potential Linux Tunneling and/or Port Forwarding\n\nAttackers can leverage many utilities to clandestinely tunnel network communications and evade security measures, potentially gaining unauthorized access to sensitive systems.\n\nThis rule looks for several utilities that are capable of setting up tunnel network communications by analyzing process names or command line arguments. \n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/master/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n> This investigation guide uses [placeholder fields](https://www.elastic.co/guide/en/security/current/osquery-placeholder-fields.html) to dynamically pass alert data into Osquery queries. Placeholder fields were introduced in Elastic Stack version 8.7.0. If you're using Elastic Stack version 8.6.0 or earlier, you'll need to manually adjust this investigation guide's queries to ensure they properly run.\n\n#### Possible investigation steps\n\n- Identify any signs of suspicious network activity or anomalies that may indicate protocol tunneling. This could include unexpected traffic patterns or unusual network behavior.\n  - Investigate listening ports and open sockets to look for potential protocol tunneling, reverse shells, or data exfiltration.\n    - !{osquery{\"label\":\"Osquery - Retrieve Listening Ports\",\"query\":\"SELECT pid, address, port, socket, protocol, path FROM listening_ports\"}}\n    - !{osquery{\"label\":\"Osquery - Retrieve Open Sockets\",\"query\":\"SELECT pid, family, remote_address, remote_port, socket, state FROM process_open_sockets\"}}\n- Identify the user account that performed the action, analyze it, and check whether it should perform this kind of action.\n  - !{osquery{\"label\":\"Osquery - Retrieve Information for a Specific User\",\"query\":\"SELECT * FROM users WHERE username = {{user.name}}\"}}\n- Investigate whether the user is currently logged in and active.\n  - !{osquery{\"label\":\"Osquery - Investigate the Account Authentication Status\",\"query\":\"SELECT * FROM logged_in_users WHERE user = {{user.name}}\"}}\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence and whether they are located in expected locations.\n  - !{osquery{\"label\":\"Osquery - Retrieve Running Processes by User\",\"query\":\"SELECT pid, username, name FROM processes p JOIN users u ON u.uid = p.uid ORDER BY username\"}}\n  - !{osquery{\"label\":\"Osquery - Retrieve Process Info\",\"query\":\"SELECT name, cmdline, parent, path, uid FROM processes\"}}\n- Investigate other alerts associated with the user/host during the past 48 hours.\n  - If scripts or executables were dropped, retrieve the files and determine if they are malicious:\n    - Use a private sandboxed malware analysis system to perform analysis.\n      - Observe and collect information about the following activities:\n        - Attempts to contact external domains and addresses.\n          - Check if the domain is newly registered or unexpected.\n          - Check the reputation of the domain or IP address.\n        - File access, modification, and creation activities.\n\n### Related rules\n\n- Potential Protocol Tunneling via Chisel Client - 3f12325a-4cc6-410b-8d4c-9fbbeb744cfd\n- Potential Protocol Tunneling via Chisel Server - ac8805f6-1e08-406c-962e-3937057fa86f\n- Potential Protocol Tunneling via EarthWorm - 9f1c4ca3-44b5-481d-ba42-32dc215a2769\n- Suspicious Utility Launched via ProxyChains - 6ace94ba-f02c-4d55-9f53-87d99b6f9af4\n- ProxyChains Activity - 4b868f1f-15ff-4ba3-8c11-d5a7a6356d37\n\n### False positive analysis\n\n- If this activity is related to new benign software installation activity, consider adding exceptions — preferably with a combination of user and command line conditions.\n- If this activity is related to a system administrator or developer who uses port tunneling/forwarding for benign purposes, consider adding exceptions for specific user accounts or hosts. \n- Try to understand the context of the execution by thinking about the user, machine, or business purpose. A small number of endpoints, such as servers with unique software, might appear unusual but satisfy a specific business need.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors, such as reverse shells, reverse proxies, or droppers, that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Leverage the incident response data and logging to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 7,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Command and Control",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://blog.bitsadmin.com/living-off-the-foreign-land-windows-as-offensive-platform",
          "https://book.hacktricks.xyz/generic-methodologies-and-resources/tunneling-and-port-forwarding"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1572",
                "name": "Protocol Tunneling",
                "reference": "https://attack.mitre.org/techniques/T1572/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a3dd0845-45b8-4b12-a77f-4550a0bf7451",
        "rule_id": "6ee947e9-de7e-4281-a55d-09289bdf947e",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.522Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.522Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and (\n  (\n    // gost & pivotnacci - spawned without process.parent.name\n    (process.name == \"gost\" and process.args : (\"-L*\", \"-C*\", \"-R*\")) or (process.name == \"pivotnacci\")) or (\n    // ssh\n    (process.name in (\"ssh\", \"sshd\") and (process.args in (\"-R\", \"-L\", \"-D\", \"-w\") and process.args_count >= 4 and \n     not process.args : \"chmod\")) or\n    // sshuttle\n    (process.name == \"sshuttle\" and process.args in (\"-r\", \"--remote\", \"-l\", \"--listen\") and process.args_count >= 4) or\n    // socat\n    (process.name == \"socat\" and process.args : (\"TCP4-LISTEN:*\", \"SOCKS*\") and process.args_count >= 3) or\n    // chisel\n    (process.name : \"chisel*\" and process.args in (\"client\", \"server\")) or\n    // iodine(d), dnscat, hans, ptunnel-ng, ssf, 3proxy & ngrok \n    (process.name in (\"iodine\", \"iodined\", \"dnscat\", \"hans\", \"hans-ubuntu\", \"ptunnel-ng\", \"ssf\", \"3proxy\", \"ngrok\"))\n  ) and process.parent.name in (\"bash\", \"dash\", \"ash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\")\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "Microsoft Management Console File from Unusual Path",
        "description": "Identifies attempts to open a Microsoft Management Console File from untrusted paths. Adversaries may use MSC files for initial access and execution.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 307,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: SentinelOne",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: System",
          "Data Source: Crowdstrike"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/grimresource"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.005",
                    "name": "Visual Basic",
                    "reference": "https://attack.mitre.org/techniques/T1059/005/"
                  },
                  {
                    "id": "T1059.007",
                    "name": "JavaScript",
                    "reference": "https://attack.mitre.org/techniques/T1059/007/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/",
                "subtechnique": [
                  {
                    "id": "T1218.014",
                    "name": "MMC",
                    "reference": "https://attack.mitre.org/techniques/T1218/014/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "crowdstrike",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "faee8ca4-765b-40d8-a016-fbaf88463b15",
        "rule_id": "7e23dfef-da2c-4d64-b11d-5f285b638853",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.526Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.526Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  process.executable : (\n    \"?:\\\\Windows\\\\System32\\\\mmc.exe\",\n    \"\\\\Device\\\\HarddiskVolume?\\\\Windows\\\\System32\\\\mmc.exe\"\n  ) and\n  process.args : \"*.msc\" and\n  not process.args : (\n        \"?:\\\\Windows\\\\System32\\\\*.msc\",\n        \"?:\\\\Windows\\\\SysWOW64\\\\*.msc\",\n        \"?:\\\\Program files\\\\*.msc\",\n        \"?:\\\\Program Files (x86)\\\\*.msc\"\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "winlogbeat-*",
          "logs-windows.*",
          "endgame-*",
          "logs-system.security*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-m365_defender.event-*",
          "logs-crowdstrike.fdr*"
        ]
      },
      {
        "name": "Suspicious ScreenConnect Client Child Process",
        "description": "Identifies suspicious processes being spawned by the ScreenConnect client processes. This activity may indicate execution abusing unauthorized access to the ScreenConnect remote access software.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 307,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Command and Control",
          "Resources: Investigation Guide",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon",
          "Data Source: SentinelOne",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: System",
          "Data Source: Crowdstrike"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.huntress.com/blog/slashandgrab-screen-connect-post-exploitation-in-the-wild-cve-2024-1709-cve-2024-1708"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1219",
                "name": "Remote Access Software",
                "reference": "https://attack.mitre.org/techniques/T1219/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "crowdstrike",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "7610a442-2013-4755-821e-29941d84aa49",
        "rule_id": "78de1aeb-5225-4067-b8cc-f4a1de8a8546",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.531Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.531Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  process.parent.name :\n                (\"ScreenConnect.ClientService.exe\",\n                 \"ScreenConnect.WindowsClient.exe\",\n                 \"ScreenConnect.WindowsBackstageShell.exe\",\n                 \"ScreenConnect.WindowsFileManager.exe\") and\n  (\n   (process.name : \"powershell.exe\" and\n    process.args : (\"-enc\", \"-ec\", \"-e\", \"*downloadstring*\", \"*Reflection.Assembly*\", \"*http*\")) or\n   (process.name : \"cmd.exe\" and process.args : \"/c\") or\n   (process.name : \"net.exe\" and process.args : \"/add\") or\n   (process.name : \"schtasks.exe\" and process.args : (\"/create\", \"-create\")) or\n   (process.name : \"sc.exe\" and process.args : \"create\") or\n   (process.name : \"rundll32.exe\" and not process.args : \"url.dll,FileProtocolHandler\") or\n   (process.name : \"msiexec.exe\" and process.args : (\"/i\", \"-i\") and\n    process.args : (\"/q\", \"/quiet\", \"/qn\", \"-q\", \"-quiet\", \"-qn\", \"-Q+\")) or\n   process.name : (\"mshta.exe\", \"certutil.exe\", \"bistadmin.exe\", \"certreq.exe\", \"wscript.exe\", \"cscript.exe\", \"curl.exe\",\n                   \"ssh.exe\", \"scp.exe\", \"wevtutil.exe\", \"wget.exe\", \"wmic.exe\")\n   )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "winlogbeat-*",
          "logs-windows.sysmon_operational-*",
          "logs-system.security*",
          "endgame-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-m365_defender.event-*",
          "logs-crowdstrike.fdr*"
        ]
      },
      {
        "name": "Potential Reverse Shell via UDP",
        "description": "This detection rule identifies suspicious network traffic patterns associated with UDP reverse shell activity. This activity consists of a sample of an execve, socket and connect syscall executed by the same process, where the auditd.data.a0-1 indicate a UDP connection, ending with an egress connection event. An attacker may establish a Linux UDP reverse shell to bypass traditional firewall restrictions and gain remote access to a target system covertly.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 7,
        "tags": [
          "Data Source: Auditd Manager",
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md",
          "https://www.elastic.co/security-labs/primer-on-persistence-mechanisms",
          "https://www.elastic.co/security-labs/linux-detection-engineering-with-auditd"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1071",
                "name": "Application Layer Protocol",
                "reference": "https://attack.mitre.org/techniques/T1071/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from one of the following integrations:\n- Auditbeat\n- Auditd Manager\n\n### Auditbeat Setup\nAuditbeat is a lightweight shipper that you can install on your servers to audit the activities of users and processes on your systems. For example, you can use Auditbeat to collect and centralize audit events from the Linux Audit Framework. You can also use Auditbeat to detect changes to critical files, like binaries and configuration files, and identify potential security policy violations.\n\n#### The following steps should be executed in order to add the Auditbeat on a Linux System:\n- Elastic provides repositories available for APT and YUM-based distributions. Note that we provide binary packages, but no source packages.\n- To install the APT and YUM repositories follow the setup instructions in this [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setup-repositories.html).\n- To run Auditbeat on Docker follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-docker.html).\n- To run Auditbeat on Kubernetes follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-kubernetes.html).\n- For complete “Setup and Run Auditbeat” information refer to the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setting-up-and-running.html).\n\n### Auditd Manager Integration Setup\nThe Auditd Manager Integration receives audit events from the Linux Audit Framework which is a part of the Linux kernel.\nAuditd Manager provides a user-friendly interface and automation capabilities for configuring and monitoring system auditing through the auditd daemon. With `auditd_manager`, administrators can easily define audit rules, track system events, and generate comprehensive audit reports, improving overall security and compliance in the system.\n\n#### The following steps should be executed in order to add the Elastic Agent System integration \"auditd_manager\" on a Linux System:\n- Go to the Kibana home page and click “Add integrations”.\n- In the query bar, search for “Auditd Manager” and select the integration to see more details about it.\n- Click “Add Auditd Manager”.\n- Configure the integration name and optionally add a description.\n- Review optional and advanced settings accordingly.\n- Add the newly installed “auditd manager” to an existing or a new agent policy, and deploy the agent on a Linux system from which auditd log files are desirable.\n- Click “Save and Continue”.\n- For more details on the integration refer to the [helper guide](https://docs.elastic.co/integrations/auditd_manager).\n\n#### Rule Specific Setup Note\nAuditd Manager subscribes to the kernel and receives events as they occur without any additional configuration.\nHowever, if more advanced configuration is required to detect specific behavior, audit rules can be added to the integration in either the \"audit rules\" configuration box or the \"auditd rule files\" box by specifying a file to read the audit rules from.\n- For this detection rule no additional audit rules are required to be added to the integration.\n",
        "related_integrations": [
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "auditd.data.a1",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "auditd.data.syscall",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "network.direction",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.pid",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.pid",
            "type": "long",
            "ecs": true
          }
        ],
        "id": "75b5de75-106a-4dc6-b8a9-338fb69d568c",
        "rule_id": "a5eb21b7-13cc-4b94-9fe2-29bb2914e037",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.534Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.534Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sample by host.id, process.pid, process.parent.pid\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"executed\" and process.name : (\n    \"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\", \"perl\", \"python*\", \"nc\", \"ncat\", \"netcat\", \"php*\",\n    \"ruby\", \"openssl\", \"awk\", \"telnet\", \"lua*\", \"socat\"\n    )]\n  [process where host.os.type == \"linux\" and auditd.data.syscall == \"socket\" and process.name : (\n    \"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\", \"perl\", \"python*\", \"nc\", \"ncat\", \"netcat\", \"php*\",\n    \"ruby\", \"openssl\", \"awk\", \"telnet\", \"lua*\", \"socat\"\n    ) and auditd.data.a1 == \"2\"]\n  [network where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"connected-to\" and\n   process.name : (\n    \"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\", \"perl\", \"python*\", \"nc\", \"ncat\", \"netcat\", \"php*\",\n    \"ruby\", \"openssl\", \"awk\", \"telnet\", \"lua*\", \"socat\"\n    ) and network.direction == \"egress\" and destination.ip != null and\n   not cidrmatch(destination.ip, \"127.0.0.0/8\", \"169.254.0.0/16\", \"224.0.0.0/4\", \"::1\")]\n",
        "language": "eql",
        "index": [
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Multiple Okta User Auth Events with Same Device Token Hash Behind a Proxy",
        "description": "Detects when Okta user authentication events are reported for multiple users with the same device token hash behind a proxy.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Multiple Okta User Auth Events with Same Device Token Hash Behind a Proxy\n\nThis rule detects when Okta user authentication events are reported for multiple users with the same device token hash behind a proxy. This may indicate that a shared device between users, or that a user is using a proxy to access multiple accounts for password spraying.\n\n#### Possible investigation steps:\n- Identify the users involved in this action by examining the `okta.actor.id`, `okta.actor.type`, `okta.actor.alternate_id`, and `okta.actor.display_name` fields.\n- Determine the device client used for these actions by analyzing `okta.client.ip`, `okta.client.user_agent.raw_user_agent`, `okta.client.zone`, `okta.client.device`, and `okta.client.id` fields.\n    - Since the device is behind a proxy, the `okta.client.ip` field will not be useful for determining the actual device IP address.\n- Review the `okta.request.ip_chain` field for more information about the geographic location of the proxy.\n- With Okta end users identified, review the `okta.debug_context.debug_data.dt_hash` field.\n    - Historical analysis should indicate if this device token hash is commonly associated with the user.\n- Review the `okta.event_type` field to determine the type of authentication event that occurred.\n    - If the event type is `user.authentication.sso`, the user may have legitimately started a session via a proxy for security or privacy reasons.\n    - If the event type is `user.authentication.password`, the user may be using a proxy to access multiple accounts for password spraying.\n- Examine the `okta.outcome.result` field to determine if the authentication was successful.\n- Review the past activities of the actor(s) involved in this action by checking their previous actions.\n- Evaluate the actions that happened just before and after this event in the `okta.event_type` field to help understand the full context of the activity.\n    - This may help determine the authentication and authorization actions that occurred between the user, Okta and application.\n\n### False positive analysis:\n- A user may have legitimately started a session via a proxy for security or privacy reasons.\n- Users may share an endpoint related to work or personal use in which separate Okta accounts are used.\n    - Architecturally, this shared endpoint may leverage a proxy for security or privacy reasons.\n    - Shared systems such as Kiosks and conference room computers may be used by multiple users.\n    - Shared working spaces may have a single endpoint that is used by multiple users.\n\n### Response and remediation:\n- Review the profile of the users involved in this action to determine if proxy usage may be expected.\n- If the user is legitimate and the authentication behavior is not suspicious based on device analysis, no action is required.\n- If the user is legitimate but the authentication behavior is suspicious, consider resetting passwords for the users involves and enabling multi-factor authentication (MFA).\n    - If MFA is already enabled, consider resetting MFA for the users.\n- If any of the users are not legitimate, consider deactivating the user's account.\n- Conduct a review of Okta policies and ensure they are in accordance with security best practices.\n- Check with internal IT teams to determine if the accounts involved recently had MFA reset at the request of the user.\n    - If so, confirm with the user this was a legitimate request.\n    - If so and this was not a legitimate request, consider deactivating the user's account temporarily.\n        - Reset passwords and reset MFA for the user.\n- If this is a false positive, consider adding the `okta.debug_context.debug_data.dt_hash` field to the `exceptions` list in the rule.\n    - This will prevent future occurrences of this event for this device from triggering the rule.\n",
        "output_index": "",
        "version": 206,
        "tags": [
          "Use Case: Identity and Access Audit",
          "Data Source: Okta",
          "Tactic: Credential Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "An Okta admnistrator may be logged into multiple accounts from the same host for legitimate reasons.",
          "Users may share an endpoint related to work or personal use in which separate Okta accounts are used.",
          "Shared systems such as Kiosks and conference room computers may be used by multiple users."
        ],
        "references": [
          "https://developer.okta.com/docs/reference/api/system-log/",
          "https://developer.okta.com/docs/reference/api/event-types/",
          "https://www.elastic.co/security-labs/testing-okta-visibility-and-detection-dorothy",
          "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection",
          "https://www.elastic.co/security-labs/monitoring-okta-threats-with-elastic-security",
          "https://www.elastic.co/security-labs/starter-guide-to-understanding-okta"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1110",
                "name": "Brute Force",
                "reference": "https://attack.mitre.org/techniques/T1110/",
                "subtechnique": [
                  {
                    "id": "T1110.003",
                    "name": "Password Spraying",
                    "reference": "https://attack.mitre.org/techniques/T1110/003/"
                  }
                ]
              },
              {
                "id": "T1110",
                "name": "Brute Force",
                "reference": "https://attack.mitre.org/techniques/T1110/",
                "subtechnique": [
                  {
                    "id": "T1110.004",
                    "name": "Credential Stuffing",
                    "reference": "https://attack.mitre.org/techniques/T1110/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "The Okta Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.",
        "related_integrations": [
          {
            "package": "okta",
            "version": "^3.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "okta.actor.id",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.debug_context.debug_data.dt_hash",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.event_type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.security_context.is_proxy",
            "type": "boolean",
            "ecs": false
          }
        ],
        "id": "ecacfa8c-afb7-438a-ba93-c6929e4e957a",
        "rule_id": "50887ba8-7ff7-11ee-a038-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.539Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.539Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "threshold",
        "query": "event.dataset:okta.system\n    and not okta.actor.id:okta* and okta.debug_context.debug_data.dt_hash:*\n    and okta.event_type:user.authentication* and okta.security_context.is_proxy:true\n",
        "threshold": {
          "field": [
            "okta.debug_context.debug_data.dt_hash"
          ],
          "value": 1,
          "cardinality": [
            {
              "field": "okta.actor.id",
              "value": 3
            }
          ]
        },
        "index": [
          "filebeat-*",
          "logs-okta*"
        ],
        "language": "kuery"
      },
      {
        "name": "Multiple Device Token Hashes for Single Okta Session",
        "description": "This rule detects when a specific Okta actor has multiple device token hashes for a single Okta session. This may indicate an authenticated session has been hijacked or is being used by multiple devices. Adversaries may hijack a session to gain unauthorized access to Okta admin console, applications, tenants, or other resources.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Multiple Device Token Hashes for Single Okta Session\n\nThis rule detects when a specific Okta actor has multiple device token hashes for a single Okta session. This may indicate an authenticated session has been hijacked or is being used by multiple devices. Adversaries may hijack a session to gain unauthorized access to Okta admin console, applications, tenants, or other resources.\n\n#### Possible investigation steps:\n- Since this is an ES|QL rule, the `okta.actor.alternate_id` and `okta.authentication_context.external_session_id` values can be used to pivot into the raw authentication events related to this alert.\n- Identify the users involved in this action by examining the `okta.actor.id`, `okta.actor.type`, `okta.actor.alternate_id`, and `okta.actor.display_name` fields.\n- Determine the device client used for these actions by analyzing `okta.client.ip`, `okta.client.user_agent.raw_user_agent`, `okta.client.zone`, `okta.client.device`, and `okta.client.id` fields.\n- With Okta end users identified, review the `okta.debug_context.debug_data.dt_hash` field.\n    - Historical analysis should indicate if this device token hash is commonly associated with the user.\n- Review the `okta.event_type` field to determine the type of authentication event that occurred.\n    - Authentication events have been filtered out to focus on Okta activity via established sessions.\n- Review the past activities of the actor(s) involved in this action by checking their previous actions.\n- Evaluate the actions that happened just before and after this event in the `okta.event_type` field to help understand the full context of the activity.\n    - This may help determine the authentication and authorization actions that occurred between the user, Okta and application.\n- Aggregate by `okta.actor.alternate_id` and `event.action` to determine the type of actions that are being performed by the actor(s) involved in this action.\n    - If various activity is reported that seems to indicate actions from separate users, consider deactivating the user's account temporarily.\n\n### False positive analysis:\n- It is very rare that a legitimate user would have multiple device token hashes for a single Okta session as DT hashes do not change after an authenticated session is established.\n\n### Response and remediation:\n- Consider stopping all sessions for the user(s) involved in this action.\n- If this does not appear to be a false positive, consider resetting passwords for the users involved and enabling multi-factor authentication (MFA).\n    - If MFA is already enabled, consider resetting MFA for the users.\n- If any of the users are not legitimate, consider deactivating the user's account.\n- Conduct a review of Okta policies and ensure they are in accordance with security best practices.\n- Check with internal IT teams to determine if the accounts involved recently had MFA reset at the request of the user.\n    - If so, confirm with the user this was a legitimate request.\n    - If so and this was not a legitimate request, consider deactivating the user's account temporarily.\n        - Reset passwords and reset MFA for the user.\n- Alternatively adding `okta.client.ip` or a CIDR range to the `exceptions` list can prevent future occurrences of this event from triggering the rule.\n    - This should be done with caution as it may prevent legitimate alerts from being generated.\n",
        "output_index": "",
        "version": 304,
        "tags": [
          "Use Case: Identity and Access Audit",
          "Data Source: Okta",
          "Tactic: Credential Access",
          "Domain: SaaS"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://developer.okta.com/docs/reference/api/system-log/",
          "https://developer.okta.com/docs/reference/api/event-types/",
          "https://www.elastic.co/security-labs/testing-okta-visibility-and-detection-dorothy",
          "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection",
          "https://support.okta.com/help/s/article/session-hijacking-attack-definition-damage-defense?language=en_US",
          "https://www.elastic.co/security-labs/monitoring-okta-threats-with-elastic-security",
          "https://www.elastic.co/security-labs/starter-guide-to-understanding-okta"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1539",
                "name": "Steal Web Session Cookie",
                "reference": "https://attack.mitre.org/techniques/T1539/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe Okta Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.",
        "related_integrations": [],
        "required_fields": [],
        "id": "ace107a3-1409-4894-885b-84b36bc31e29",
        "rule_id": "cc382a2e-7e52-11ee-9aac-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.543Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.543Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "FROM logs-okta*\n| WHERE\n    event.dataset == \"okta.system\"\n    // ignore authentication events where session and device token hash change often\n    AND NOT event.action IN (\n        \"policy.evaluate_sign_on\",\n        \"user.session.start\",\n        \"user.authentication.sso\"\n    )\n    // ignore Okta system events and only allow registered users\n    AND (\n        okta.actor.alternate_id != \"system@okta.com\"\n        AND okta.actor.alternate_id RLIKE \"[^@\\\\s]+\\\\@[^@\\\\s]+\"\n    )\n    AND okta.authentication_context.external_session_id != \"unknown\"\n| KEEP event.action, okta.actor.alternate_id, okta.authentication_context.external_session_id, okta.debug_context.debug_data.dt_hash\n| STATS\n    dt_hash_counts = COUNT_DISTINCT(okta.debug_context.debug_data.dt_hash) BY\n        okta.actor.alternate_id,\n        okta.authentication_context.external_session_id\n| WHERE\n    dt_hash_counts >= 2\n| SORT\n    dt_hash_counts DESC\n"
      },
      {
        "name": "Statistical Model Detected C2 Beaconing Activity",
        "description": "A statistical model has identified command-and-control (C2) beaconing activity. Beaconing can help attackers maintain stealthy communication with their C2 servers, receive instructions and payloads, exfiltrate data and maintain persistence in a network.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 6,
        "tags": [
          "Domain: Network",
          "Use Case: C2 Beaconing Detection",
          "Tactic: Command and Control"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-1h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/beaconing",
          "https://www.elastic.co/security-labs/identifying-beaconing-malware-using-elastic"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1102",
                "name": "Web Service",
                "reference": "https://attack.mitre.org/techniques/T1102/",
                "subtechnique": [
                  {
                    "id": "T1102.002",
                    "name": "Bidirectional Communication",
                    "reference": "https://attack.mitre.org/techniques/T1102/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Network Beaconing Identification integration assets to be installed, as well as network logs collected by the Elastic Defend or Network Packet Capture integrations.\n\n### Network Beaconing Identification Setup\nThe Network Beaconing Identification integration consists of a statistical framework to identify C2 beaconing activity in network logs.\n\n#### Prerequisite Requirements:\n- Fleet is required for Network Beaconing Identification.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Network events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) or [Network Packet Capture](https://docs.elastic.co/integrations/network_traffic) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To add the Network Packet Capture integration to an Elastic Agent policy, refer to [this](https://www.elastic.co/guide/en/fleet/current/add-integration-to-policy.html) guide.\n\n#### The following steps should be executed to install assets associated with the Network Beaconing Identification integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Network Beaconing Identification and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n",
        "related_integrations": [
          {
            "package": "beaconing",
            "version": "^1.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "network_traffic",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "beacon_stats.is_beaconing",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "4b56063e-b426-4ccd-95f0-1fb039cbdac5",
        "rule_id": "5397080f-34e5-449b-8e9c-4c8083d7ccc6",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.551Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.551Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "ml_beaconing.all"
        ],
        "query": "beacon_stats.is_beaconing: true and\nnot process.name: (\"WaAppAgent.exe\" or \"metricbeat.exe\" or \"packetbeat.exe\" or \"WindowsAzureGuestAgent.exe\" or \"HealthService.exe\" or \"Widgets.exe\" or \"lsass.exe\" or \"msedgewebview2.exe\" or \n                   \"MsMpEng.exe\" or \"OUTLOOK.EXE\" or \"msteams.exe\" or \"FileSyncHelper.exe\" or \"SearchProtocolHost.exe\" or \"Creative Cloud.exe\" or \"ms-teams.exe\" or \"ms-teamsupdate.exe\" or \n                   \"curl.exe\" or \"rundll32.exe\" or \"MsSense.exe\" or \"wermgr.exe\" or \"java\" or \"olk.exe\" or \"iexplore.exe\" or \"NetworkManager\" or \"packetbeat\" or \"Ssms.exe\" or \"NisSrv.exe\" or \n                   \"gamingservices.exe\" or \"appidcertstorecheck.exe\" or \"POWERPNT.EXE\" or \"miiserver.exe\" or \"Grammarly.Desktop.exe\" or \"SnagitEditor.exe\" or \"CRWindowsClientService.exe\" or\n                   \"agentbeat\" or \"dnf\" or \"yum\" or \"apt\"\n                  )\n",
        "language": "kuery"
      },
      {
        "name": "Okta User Sessions Started from Different Geolocations",
        "description": "Detects when a specific Okta actor has multiple sessions started from different geolocations. Adversaries may attempt to launch an attack by using a list of known usernames and passwords to gain unauthorized access to user accounts from different locations.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "\n## Triage and analysis\n\n### Investigating Okta User Sessions Started from Different Geolocations\n\nThis rule detects when a specific Okta actor has multiple sessions started from different geolocations. Adversaries may attempt to launch an attack by using a list of known usernames and passwords to gain unauthorized access to user accounts from different locations.\n\n#### Possible investigation steps:\n- Since this is an ES|QL rule, the `okta.actor.alternate_id` and `okta.client.id` values can be used to pivot into the raw authentication events related to this alert.\n- Identify the users involved in this action by examining the `okta.actor.id`, `okta.actor.type`, `okta.actor.alternate_id`, and `okta.actor.display_name` fields.\n- Determine the device client used for these actions by analyzing `okta.client.ip`, `okta.client.user_agent.raw_user_agent`, `okta.client.zone`, `okta.client.device`, and `okta.client.id` fields.\n- With Okta end users identified, review the `okta.debug_context.debug_data.dt_hash` field.\n    - Historical analysis should indicate if this device token hash is commonly associated with the user.\n- Review the `okta.event_type` field to determine the type of authentication event that occurred.\n    - If the event type is `user.authentication.sso`, the user may have legitimately started a session via a proxy for security or privacy reasons.\n    - If the event type is `user.authentication.password`, the user may be using a proxy to access multiple accounts for password spraying.\n    - If the event type is `user.session.start`, the source may have attempted to establish a session via the Okta authentication API.\n- Review the past activities of the actor(s) involved in this action by checking their previous actions.\n- Evaluate the actions that happened just before and after this event in the `okta.event_type` field to help understand the full context of the activity.\n    - This may help determine the authentication and authorization actions that occurred between the user, Okta and application.\n\n### False positive analysis:\n- It is very rare that a legitimate user would have multiple sessions started from different geo-located countries in a short time frame.\n\n### Response and remediation:\n- If the user is legitimate and the authentication behavior is not suspicious based on device analysis, no action is required.\n- If the user is legitimate but the authentication behavior is suspicious, consider resetting passwords for the users involves and enabling multi-factor authentication (MFA).\n    - If MFA is already enabled, consider resetting MFA for the users.\n- If any of the users are not legitimate, consider deactivating the user's account.\n- Conduct a review of Okta policies and ensure they are in accordance with security best practices.\n- Check with internal IT teams to determine if the accounts involved recently had MFA reset at the request of the user.\n    - If so, confirm with the user this was a legitimate request.\n    - If so and this was not a legitimate request, consider deactivating the user's account temporarily.\n        - Reset passwords and reset MFA for the user.\n- If this is a false positive, consider adding the `okta.debug_context.debug_data.dt_hash` field to the `exceptions` list in the rule.\n    - This will prevent future occurrences of this event for this device from triggering the rule.\n    - Alternatively adding `okta.client.ip` or a CIDR range to the `exceptions` list can prevent future occurrences of this event from triggering the rule.\n        - This should be done with caution as it may prevent legitimate alerts from being generated.\n",
        "output_index": "",
        "version": 303,
        "tags": [
          "Use Case: Identity and Access Audit",
          "Data Source: Okta",
          "Tactic: Initial Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-30m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://developer.okta.com/docs/reference/api/system-log/",
          "https://developer.okta.com/docs/reference/api/event-types/",
          "https://www.elastic.co/security-labs/testing-okta-visibility-and-detection-dorothy",
          "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection",
          "https://www.rezonate.io/blog/okta-logs-decoded-unveiling-identity-threats-through-threat-hunting/",
          "https://www.elastic.co/security-labs/monitoring-okta-threats-with-elastic-security",
          "https://www.elastic.co/security-labs/starter-guide-to-understanding-okta"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1078",
                "name": "Valid Accounts",
                "reference": "https://attack.mitre.org/techniques/T1078/",
                "subtechnique": [
                  {
                    "id": "T1078.004",
                    "name": "Cloud Accounts",
                    "reference": "https://attack.mitre.org/techniques/T1078/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "The Okta Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.\n",
        "related_integrations": [],
        "required_fields": [],
        "id": "b29ec955-c495-4a6e-82d1-09362ba7f81b",
        "rule_id": "2e56e1bc-867a-11ee-b13e-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.547Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.547Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "FROM logs-okta*\n| WHERE\n    event.dataset == \"okta.system\"\n    AND (event.action RLIKE \"user\\\\.authentication(.*)\" OR event.action == \"user.session.start\")\n    AND okta.security_context.is_proxy != true and okta.actor.id != \"unknown\"\n    AND event.outcome == \"success\"\n| KEEP event.action, okta.security_context.is_proxy, okta.actor.id, event.outcome, client.geo.country_name, okta.actor.alternate_id\n| STATS\n    geo_auth_counts = COUNT_DISTINCT(client.geo.country_name)\n    BY okta.actor.id, okta.actor.alternate_id\n| WHERE\n    geo_auth_counts >= 2\n"
      },
      {
        "name": "Potential Protocol Tunneling via Chisel Client",
        "description": "This rule monitors for common command line flags leveraged by the Chisel client utility followed by a connection attempt. Chisel is a command-line utility used for creating and managing TCP and UDP tunnels, enabling port forwarding and secure communication between machines. Attackers can abuse the Chisel utility to establish covert communication channels, bypass network restrictions, and carry out malicious activities by creating tunnels that allow unauthorized access to internal systems.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Potential Protocol Tunneling via Chisel Client\n\nAttackers can leverage `chisel` to clandestinely tunnel network communications and evade security measures, potentially gaining unauthorized access to sensitive systems.\n\nThis rule looks for a sequence of command line arguments that are consistent with `chisel` client tunneling behavior, followed by a network event by an uncommon process. \n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/master/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n> This investigation guide uses [placeholder fields](https://www.elastic.co/guide/en/security/current/osquery-placeholder-fields.html) to dynamically pass alert data into Osquery queries. Placeholder fields were introduced in Elastic Stack version 8.7.0. If you're using Elastic Stack version 8.6.0 or earlier, you'll need to manually adjust this investigation guide's queries to ensure they properly run.\n\n#### Possible investigation steps\n\n- Identify any signs of suspicious network activity or anomalies that may indicate protocol tunneling. This could include unexpected traffic patterns or unusual network behavior.\n  - Investigate listening ports and open sockets to look for potential protocol tunneling, reverse shells, or data exfiltration.\n    - !{osquery{\"label\":\"Osquery - Retrieve Listening Ports\",\"query\":\"SELECT pid, address, port, socket, protocol, path FROM listening_ports\"}}\n    - !{osquery{\"label\":\"Osquery - Retrieve Open Sockets\",\"query\":\"SELECT pid, family, remote_address, remote_port, socket, state FROM process_open_sockets\"}}\n- Identify the user account that performed the action, analyze it, and check whether it should perform this kind of action.\n  - !{osquery{\"label\":\"Osquery - Retrieve Information for a Specific User\",\"query\":\"SELECT * FROM users WHERE username = {{user.name}}\"}}\n- Investigate whether the user is currently logged in and active.\n  - !{osquery{\"label\":\"Osquery - Investigate the Account Authentication Status\",\"query\":\"SELECT * FROM logged_in_users WHERE user = {{user.name}}\"}}\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence and whether they are located in expected locations.\n  - !{osquery{\"label\":\"Osquery - Retrieve Running Processes by User\",\"query\":\"SELECT pid, username, name FROM processes p JOIN users u ON u.uid = p.uid ORDER BY username\"}}\n  - !{osquery{\"label\":\"Osquery - Retrieve Process Info\",\"query\":\"SELECT name, cmdline, parent, path, uid FROM processes\"}}\n- Investigate other alerts associated with the user/host during the past 48 hours.\n  - If scripts or executables were dropped, retrieve the files and determine if they are malicious:\n    - Use a private sandboxed malware analysis system to perform analysis.\n      - Observe and collect information about the following activities:\n        - Attempts to contact external domains and addresses.\n          - Check if the domain is newly registered or unexpected.\n          - Check the reputation of the domain or IP address.\n        - File access, modification, and creation activities.\n\n### Related rules\n\n- Potential Protocol Tunneling via Chisel Server - ac8805f6-1e08-406c-962e-3937057fa86f\n- Potential Linux Tunneling and/or Port Forwarding - 6ee947e9-de7e-4281-a55d-09289bdf947e\n- Potential Protocol Tunneling via EarthWorm - 9f1c4ca3-44b5-481d-ba42-32dc215a2769\n\n### False positive analysis\n\n- If this activity is related to new benign software installation activity, consider adding exceptions — preferably with a combination of user and command line conditions.\n- If this activity is related to a system administrator or developer who uses port tunneling for benign purposes, consider adding exceptions for specific user accounts or hosts. \n- Try to understand the context of the execution by thinking about the user, machine, or business purpose. A small number of endpoints, such as servers with unique software, might appear unusual but satisfy a specific business need.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors, such as reverse shells, reverse proxies, or droppers, that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Leverage the incident response data and logging to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 6,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Command and Control",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://blog.bitsadmin.com/living-off-the-foreign-land-windows-as-offensive-platform",
          "https://book.hacktricks.xyz/generic-methodologies-and-resources/tunneling-and-port-forwarding"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1572",
                "name": "Protocol Tunneling",
                "reference": "https://attack.mitre.org/techniques/T1572/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "f0319afd-927c-4f09-9a08-be004be34fc1",
        "rule_id": "3f12325a-4cc6-410b-8d4c-9fbbeb744cfd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.563Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.563Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, process.entity_id with maxspan=3s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and \n   process.args == \"client\" and process.args : (\"R*\", \"*:*\", \"*socks*\", \"*.*\") and process.args_count >= 4 and \n   process.parent.name in (\"bash\", \"dash\", \"ash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") and\n   not process.name in (\"velociraptor\", \"nbemmcmd\")]\n  [network where host.os.type == \"linux\" and event.action == \"connection_attempted\" and event.type == \"start\" and \n   destination.ip != null and destination.ip != \"127.0.0.1\" and destination.ip != \"::1\" and \n   not process.name : (\n     \"python*\", \"php*\", \"perl\", \"ruby\", \"lua*\", \"openssl\", \"nc\", \"netcat\", \"ncat\", \"telnet\", \"awk\", \"java\", \"telnet\",\n     \"ftp\", \"socat\", \"curl\", \"wget\", \"dpkg\", \"docker\", \"dockerd\", \"yum\", \"apt\", \"rpm\", \"dnf\", \"ssh\", \"sshd\")]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Binary Content Copy via Cmd.exe",
        "description": "Attackers may abuse cmd.exe commands to reassemble binary fragments into a malicious payload.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 106,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Tactic: Execution",
          "Data Source: Elastic Defend",
          "Rule Type: BBR",
          "Data Source: Sysmon",
          "Data Source: Elastic Endgame",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1140",
                "name": "Deobfuscate/Decode Files or Information",
                "reference": "https://attack.mitre.org/techniques/T1140/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.003",
                    "name": "Windows Command Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "05530ba7-cec6-44a9-a967-0ba64442c750",
        "rule_id": "53dedd83-1be7-430f-8026-363256395c8b",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.667Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.667Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  process.name : \"cmd.exe\" and (\n    (process.args : \"type\" and process.args : (\">\", \">>\")) or\n    (process.args : \"copy\" and process.args : \"/b\"))\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-system.security*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "File Staged in Root Folder of Recycle Bin",
        "description": "Identifies files written to the root of the Recycle Bin folder instead of subdirectories. Adversaries may place files in the root of the Recycle Bin in preparation for exfiltration or to evade defenses.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 106,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Collection",
          "Data Source: Elastic Defend",
          "Rule Type: BBR",
          "Data Source: Elastic Endgame",
          "Data Source: Sysmon"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0009",
              "name": "Collection",
              "reference": "https://attack.mitre.org/tactics/TA0009/"
            },
            "technique": [
              {
                "id": "T1074",
                "name": "Data Staged",
                "reference": "https://attack.mitre.org/techniques/T1074/",
                "subtechnique": [
                  {
                    "id": "T1074.001",
                    "name": "Local Data Staging",
                    "reference": "https://attack.mitre.org/techniques/T1074/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "784687dd-f20f-479f-86c9-d928cfbfaf3b",
        "rule_id": "57bccf1d-daf5-4e1a-9049-ff79b5254704",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.671Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.671Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"windows\" and event.type == \"creation\" and\n  file.path : \"?:\\\\$RECYCLE.BIN\\\\*\" and\n  not file.path : \"?:\\\\$RECYCLE.BIN\\\\*\\\\*\" and\n  not file.name : \"desktop.ini\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "Network Connection via Recently Compiled Executable",
        "description": "This rule monitors a sequence involving a program compilation event followed by its execution and a subsequent network connection event. This behavior can indicate the set up of a reverse tcp connection to a command-and-control server. Attackers may spawn reverse shells to establish persistence onto a target system.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 6,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1071",
                "name": "Application Layer Protocol",
                "reference": "https://attack.mitre.org/techniques/T1071/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "915af3d8-4074-402a-bf79-16c9cf4838b5",
        "rule_id": "64cfca9e-0f6f-4048-8251-9ec56a055e9e",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.676Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.676Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id with maxspan=1m\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and \n   process.name in (\"gcc\", \"g++\", \"cc\")] by process.args\n  [file where host.os.type == \"linux\" and event.action == \"creation\" and process.name == \"ld\"] by file.name\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\"] by process.name\n  [network where host.os.type == \"linux\" and event.action == \"connection_attempted\" and destination.ip != null and not (\n     cidrmatch(destination.ip, \"127.0.0.0/8\", \"169.254.0.0/16\", \"224.0.0.0/4\", \"::1\") or\n     process.name in (\"simpleX\", \"conftest\", \"ssh\", \"python\", \"ispnull\", \"pvtui\")\n   )] by process.name\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Unauthorized Scope for Public App OAuth2 Token Grant with Client Credentials",
        "description": "Identifies a failed OAuth 2.0 token grant attempt for a public client app using client credentials. This event is generated when a public client app attempts to exchange a client credentials grant for an OAuth 2.0 access token, but the request is denied due to the lack of required scopes. This could indicate compromised client credentials in which an adversary is attempting to obtain an access token for unauthorized scopes. This is a [New Terms](https://www.elastic.co/guide/en/security/master/rules-ui-create.html#create-new-terms-rule) rule where the `okta.actor.display_name` field value has not been seen in the last 14 days regarding this event.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 205,
        "tags": [
          "Domain: SaaS",
          "Data Source: Okta",
          "Use Case: Threat Detection",
          "Use Case: Identity and Access Audit",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.blog/news-insights/company-news/security-alert-stolen-oauth-user-tokens/",
          "https://developer.okta.com/docs/reference/api/event-types/",
          "https://www.elastic.co/security-labs/monitoring-okta-threats-with-elastic-security",
          "https://www.elastic.co/security-labs/starter-guide-to-understanding-okta"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1550",
                "name": "Use Alternate Authentication Material",
                "reference": "https://attack.mitre.org/techniques/T1550/",
                "subtechnique": [
                  {
                    "id": "T1550.001",
                    "name": "Application Access Token",
                    "reference": "https://attack.mitre.org/techniques/T1550/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "okta",
            "version": "^3.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "okta.actor.display_name",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.actor.type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.client.user_agent.raw_user_agent",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.debug_context.debug_data.flattened.grantType",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "okta.debug_context.debug_data.flattened.requestedScopes",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "okta.outcome.reason",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "okta.outcome.result",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "6eeedd61-2489-4727-ad36-cfd9e9cb1312",
        "rule_id": "6649e656-6f85-11ef-8876-f661ea17fbcc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.680Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.680Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset: okta.system\n    and event.action: \"app.oauth2.as.token.grant\"\n    and okta.actor.type: \"PublicClientApp\"\n    and okta.debug_context.debug_data.flattened.grantType: \"client_credentials\"\n    and okta.outcome.result: \"FAILURE\"\n    and not okta.client.user_agent.raw_user_agent: \"Okta-Integrations\"\n    and not okta.actor.display_name: (Okta* or Datadog)\n    and not okta.debug_context.debug_data.flattened.requestedScopes: (\"okta.logs.read\" or \"okta.eventHooks.read\" or \"okta.inlineHooks.read\")\n    and okta.outcome.reason: \"no_matching_scope\"\n",
        "new_terms_fields": [
          "okta.actor.display_name"
        ],
        "history_window_start": "now-14d",
        "index": [
          "filebeat-*",
          "logs-okta*"
        ],
        "language": "kuery"
      },
      {
        "name": "Potential Protocol Tunneling via Chisel Server",
        "description": "This rule monitors for common command line flags leveraged by the Chisel server utility followed by a received connection within a timespan of 1 minute. Chisel is a command-line utility used for creating and managing TCP and UDP tunnels, enabling port forwarding and secure communication between machines. Attackers can abuse the Chisel utility to establish covert communication channels, bypass network restrictions, and carry out malicious activities by creating tunnels that allow unauthorized access to internal systems.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Potential Protocol Tunneling via Chisel Server\n\nAttackers can leverage `chisel` to clandestinely tunnel network communications and evade security measures, potentially gaining unauthorized access to sensitive systems.\n\nThis rule looks for a sequence of command line arguments that are consistent with `chisel` server tunneling behavior, followed by a network event by an uncommon process. \n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/master/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n> This investigation guide uses [placeholder fields](https://www.elastic.co/guide/en/security/current/osquery-placeholder-fields.html) to dynamically pass alert data into Osquery queries. Placeholder fields were introduced in Elastic Stack version 8.7.0. If you're using Elastic Stack version 8.6.0 or earlier, you'll need to manually adjust this investigation guide's queries to ensure they properly run.\n\n#### Possible investigation steps\n\n- Identify any signs of suspicious network activity or anomalies that may indicate protocol tunneling. This could include unexpected traffic patterns or unusual network behavior.\n  - Investigate listening ports and open sockets to look for potential protocol tunneling, reverse shells, or data exfiltration.\n    - !{osquery{\"label\":\"Osquery - Retrieve Listening Ports\",\"query\":\"SELECT pid, address, port, socket, protocol, path FROM listening_ports\"}}\n    - !{osquery{\"label\":\"Osquery - Retrieve Open Sockets\",\"query\":\"SELECT pid, family, remote_address, remote_port, socket, state FROM process_open_sockets\"}}\n- Identify the user account that performed the action, analyze it, and check whether it should perform this kind of action.\n  - !{osquery{\"label\":\"Osquery - Retrieve Information for a Specific User\",\"query\":\"SELECT * FROM users WHERE username = {{user.name}}\"}}\n- Investigate whether the user is currently logged in and active.\n  - !{osquery{\"label\":\"Osquery - Investigate the Account Authentication Status\",\"query\":\"SELECT * FROM logged_in_users WHERE user = {{user.name}}\"}}\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence and whether they are located in expected locations.\n  - !{osquery{\"label\":\"Osquery - Retrieve Running Processes by User\",\"query\":\"SELECT pid, username, name FROM processes p JOIN users u ON u.uid = p.uid ORDER BY username\"}}\n  - !{osquery{\"label\":\"Osquery - Retrieve Process Info\",\"query\":\"SELECT name, cmdline, parent, path, uid FROM processes\"}}\n- Investigate other alerts associated with the user/host during the past 48 hours.\n  - If scripts or executables were dropped, retrieve the files and determine if they are malicious:\n    - Use a private sandboxed malware analysis system to perform analysis.\n      - Observe and collect information about the following activities:\n        - Attempts to contact external domains and addresses.\n          - Check if the domain is newly registered or unexpected.\n          - Check the reputation of the domain or IP address.\n        - File access, modification, and creation activities.\n\n### Related rules\n\n- Potential Protocol Tunneling via Chisel Client - 3f12325a-4cc6-410b-8d4c-9fbbeb744cfd\n- Potential Linux Tunneling and/or Port Forwarding - 6ee947e9-de7e-4281-a55d-09289bdf947e\n- Potential Protocol Tunneling via EarthWorm - 9f1c4ca3-44b5-481d-ba42-32dc215a2769\n\n### False positive analysis\n\n- If this activity is related to new benign software installation activity, consider adding exceptions — preferably with a combination of user and command line conditions.\n- If this activity is related to a system administrator or developer who uses port tunneling for benign purposes, consider adding exceptions for specific user accounts or hosts. \n- Try to understand the context of the execution by thinking about the user, machine, or business purpose. A small number of endpoints, such as servers with unique software, might appear unusual but satisfy a specific business need.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors, such as reverse shells, reverse proxies, or droppers, that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Leverage the incident response data and logging to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 6,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Command and Control",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://blog.bitsadmin.com/living-off-the-foreign-land-windows-as-offensive-platform",
          "https://book.hacktricks.xyz/generic-methodologies-and-resources/tunneling-and-port-forwarding"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1572",
                "name": "Protocol Tunneling",
                "reference": "https://attack.mitre.org/techniques/T1572/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d10d70a3-16c0-4857-a90f-bdfbc1f4dfa0",
        "rule_id": "ac8805f6-1e08-406c-962e-3937057fa86f",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.688Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.688Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, process.entity_id with maxspan=1m\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and \n   process.args == \"server\" and process.args in (\"--port\", \"-p\", \"--reverse\", \"--backend\", \"--socks5\") and \n   process.args_count >= 3 and process.parent.name in (\"bash\", \"dash\", \"ash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\")]\n  [network where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"connection_accepted\" and \n   destination.ip != null and destination.ip != \"127.0.0.1\" and destination.ip != \"::1\" and \n   not process.name : (\n     \"python*\", \"php*\", \"perl\", \"ruby\", \"lua*\", \"openssl\", \"nc\", \"netcat\", \"ncat\", \"telnet\", \"awk\", \"java\", \"telnet\",\n     \"ftp\", \"socat\", \"curl\", \"wget\", \"dpkg\", \"docker\", \"dockerd\", \"yum\", \"apt\", \"rpm\", \"dnf\", \"ssh\", \"sshd\", \"hugo\")]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "GitHub Owner Role Granted To User",
        "description": "This rule detects when a member is granted the organization owner role of a GitHub organization. This role provides admin level privileges. Any new owner role should be investigated to determine its validity. Unauthorized owner roles could indicate compromise within your organization and provide unlimited access to data and settings.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 206,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Persistence",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.003",
                    "name": "Additional Cloud Roles",
                    "reference": "https://attack.mitre.org/techniques/T1098/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "github.permission",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "12126260-c81f-4deb-823a-05836216e9d3",
        "rule_id": "9b343b62-d173-4cfd-bd8b-e6379f964ca4",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.684Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.684Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "iam where event.dataset == \"github.audit\" and event.action == \"org.update_member\" and github.permission == \"admin\"\n",
        "language": "eql",
        "index": [
          "logs-github.audit-*"
        ]
      },
      {
        "name": "Service Path Modification via sc.exe",
        "description": "Identifies attempts to modify a service path setting using sc.exe. Attackers may attempt to modify existing services for persistence or privilege escalation.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 106,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Rule Type: BBR",
          "Data Source: Sysmon",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1112",
                "name": "Modify Registry",
                "reference": "https://attack.mitre.org/techniques/T1112/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/",
                "subtechnique": [
                  {
                    "id": "T1543.003",
                    "name": "Windows Service",
                    "reference": "https://attack.mitre.org/techniques/T1543/003/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/",
                "subtechnique": [
                  {
                    "id": "T1543.003",
                    "name": "Windows Service",
                    "reference": "https://attack.mitre.org/techniques/T1543/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "dde9098d-cb88-45d0-875f-50aa6c4742a1",
        "rule_id": "c5677997-f75b-4cda-b830-a75920514096",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.692Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.692Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where event.type == \"start\" and process.name : \"sc.exe\" and\n  process.args : \"*config*\" and process.args : \"*binPath*\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-system.security*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "Suspicious Windows Process Cluster Spawned by a User",
        "description": "A machine learning job combination has detected a set of one or more suspicious Windows processes with unusually high scores for malicious probability. These process(es) have been classified as malicious in several ways. The process(es) were predicted to be malicious by the ProblemChild supervised ML model. If the anomaly contains a cluster of suspicious processes, each process has the same user name, and the aggregate score of the event cluster was calculated to be unusually high by an unsupervised ML model. Such a cluster often contains suspicious or malicious activity, possibly involving LOLbins, that may be resistant to detection using conventional search rules.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 107,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Living off the Land Attack Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-45m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/problemchild",
          "https://www.elastic.co/security-labs/detecting-living-off-the-land-attacks-with-new-elastic-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Living off the Land (LotL) Attack Detection integration assets to be installed, as well as Windows process events collected by integrations such as Elastic Defend or Winlogbeat.  \n\n### LotL Attack Detection Setup\nThe LotL Attack Detection integration detects living-off-the-land activity in Windows process events.\n\n#### Prerequisite Requirements:\n- Fleet is required for LotL Attack Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Windows process events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration or Winlogbeat(https://www.elastic.co/guide/en/beats/winlogbeat/current/_winlogbeat_overview.html).\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To set up and run Winlogbeat, follow [this](https://www.elastic.co/guide/en/beats/winlogbeat/current/winlogbeat-installation-configuration.html) guide.\n\n#### The following steps should be executed to install assets associated with the LotL Attack Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Living off the Land Attack Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "problemchild",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [],
        "id": "4db53c6b-4834-4c3f-b81f-f4136daebd89",
        "rule_id": "1224da6c-0326-4b4f-8454-68cdc5ae542b",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.008Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.008Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 75,
        "machine_learning_job_id": [
          "problem_child_high_sum_by_user"
        ]
      },
      {
        "name": "Linux init (PID 1) Secret Dump via GDB",
        "description": "This rule monitors for the potential memory dump of the init process (PID 1) through gdb. Attackers may leverage memory dumping techniques to attempt secret extraction from privileged processes. Tools that display this behavior include \"truffleproc\" and \"bash-memory-dump\". This behavior should not happen by default, and should be investigated thoroughly.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 6,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/controlplaneio/truffleproc",
          "https://github.com/hajzer/bash-memory-dump"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1003",
                "name": "OS Credential Dumping",
                "reference": "https://attack.mitre.org/techniques/T1003/",
                "subtechnique": [
                  {
                    "id": "T1003.007",
                    "name": "Proc Filesystem",
                    "reference": "https://attack.mitre.org/techniques/T1003/007/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "2d7f98c8-4496-4314-bda7-af0e4cc63564",
        "rule_id": "d4ff2f53-c802-4d2e-9fb9-9ecc08356c3f",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.011Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.011Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and \nprocess.name == \"gdb\" and process.args in (\"--pid\", \"-p\") and process.args == \"1\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "Potential curl CVE-2023-38545 Exploitation",
        "description": "Detects potential exploitation of curl CVE-2023-38545 by monitoring for vulnerable command line arguments in conjunction with an unusual command line length. A flaw in curl version <= 8.3 makes curl vulnerable to a heap based buffer overflow during the SOCKS5 proxy handshake. Upgrade to curl version >= 8.4 to patch this vulnerability. This exploit can be executed with and without the use of environment variables. For increased visibility, enable the collection of http_proxy, HTTPS_PROXY and ALL_PROXY environment variables based on the instructions provided in the setup guide of this rule.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 6,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Use Case: Vulnerability",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://curl.se/docs/CVE-2023-38545.html",
          "https://daniel.haxx.se/blog/2023/10/11/curl-8-4-0/",
          "https://twitter.com/_JohnHammond/status/1711986412554531015"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1203",
                "name": "Exploitation for Client Execution",
                "reference": "https://attack.mitre.org/techniques/T1203/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\nElastic Defend integration does not collect environment variable logging by default.\nIn order to capture this behavior, this rule requires a specific configuration option set within the advanced settings of the Elastic Defend integration.\n #### To set up environment variable capture for an Elastic Agent policy:\n- Go to “Security → Manage → Policies”.\n- Select an “Elastic Agent policy”.\n- Click “Show advanced settings”.\n- Scroll down or search for “linux.advanced.capture_env_vars”.\n- Enter the names of environment variables you want to capture, separated by commas.\n- For this rule the linux.advanced.capture_env_vars variable should be set to \"http_proxy,HTTPS_PROXY,ALL_PROXY\".\n- Click “Save”.\nAfter saving the integration change, the Elastic Agents running this policy will be updated and the rule will function properly.\nFor more information on capturing environment variables refer to the [helper guide](https://www.elastic.co/guide/en/security/current/environment-variable-capture.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.env_vars",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d7c0f8c0-1c55-49e7-b719-7e2f00e4a7d3",
        "rule_id": "f41296b4-9975-44d6-9486-514c6f635b2d",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.015Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.015Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and process.name == \"curl\" \nand (\n  process.args like (\"--socks5-hostname\", \"--proxy\", \"--preproxy\", \"socks5*\") or \n  process.env_vars like (\"http_proxy=socks5h://*\", \"HTTPS_PROXY=socks5h://*\", \"ALL_PROXY=socks5h://*\")\n) and length(process.command_line) > 255 and not (\n  process.parent.name in (\"cf-agent\", \"agent-run\", \"agent-check\", \"rudder\", \"agent-inventory\", \"cf-execd\") or\n  process.args like \"/opt/rudder/*\" or\n  process.parent.executable like (\"/vz/root/*\", \"/var/rudder/*\")\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Rare SMB Connection to the Internet",
        "description": "This rule detects rare internet network connections via the SMB protocol. SMB is commonly used to leak NTLM credentials via rogue UNC path injection.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 208,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Exfiltration",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: Sysmon",
          "Data Source: SentinelOne"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.securify.nl/en/blog/living-off-the-land-stealing-netntlm-hashes/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": [
              {
                "id": "T1048",
                "name": "Exfiltration Over Alternative Protocol",
                "reference": "https://attack.mitre.org/techniques/T1048/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "destination.port",
            "type": "long",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "network.transport",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pid",
            "type": "long",
            "ecs": true
          },
          {
            "name": "source.ip",
            "type": "ip",
            "ecs": true
          }
        ],
        "id": "e52b864f-192c-4cea-9e68-58f447cef034",
        "rule_id": "f580bf0a-2d23-43bb-b8e1-17548bb947ec",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.018Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.018Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.category:network and host.os.type:windows and process.pid:4 and \n  network.transport:tcp and destination.port:(139 or 445) and \n  source.ip:(\n    10.0.0.0/8 or\n    172.16.0.0/12 or\n    192.168.0.0/16\n  ) and\n  not destination.ip:(\n    10.0.0.0/8 or\n    127.0.0.0/8 or\n    169.254.0.0/16 or\n    172.16.0.0/12 or\n    192.0.0.0/24 or\n    192.0.0.0/29 or\n    192.0.0.8/32 or\n    192.0.0.9/32 or\n    192.0.0.10/32 or\n    192.0.0.170/32 or\n    192.0.0.171/32 or\n    192.0.2.0/24 or\n    192.31.196.0/24 or\n    192.52.193.0/24 or\n    192.168.0.0/16 or\n    192.88.99.0/24 or\n    224.0.0.0/4 or\n    100.64.0.0/10 or\n    192.175.48.0/24 or\n    198.18.0.0/15 or\n    198.51.100.0/24 or\n    203.0.113.0/24 or\n    240.0.0.0/4 or\n    \"::1\" or\n    \"FE80::/10\" or\n    \"FF00::/8\"\n  )\n",
        "new_terms_fields": [
          "destination.ip"
        ],
        "history_window_start": "now-7d",
        "index": [
          "logs-endpoint.events.network-*",
          "winlogbeat-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*"
        ],
        "language": "kuery"
      },
      {
        "name": "File Creation, Execution and Self-Deletion in Suspicious Directory",
        "description": "This rule monitors for the creation of a file, followed by its execution and self-deletion in a short timespan within a directory often used for malicious purposes by threat actors. This behavior is often used by malware to execute malicious code and delete itself to hide its tracks.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 5,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "ac7050a3-f77c-417e-8375-fd7c5aabcb3d",
        "rule_id": "09bc6c90-7501-494d-b015-5d988dc3f233",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.032Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.032Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, user.id with maxspan=1m\n  [file where host.os.type == \"linux\" and event.action == \"creation\" and \n   process.name in (\"curl\", \"wget\", \"fetch\", \"ftp\", \"sftp\", \"scp\", \"rsync\", \"ld\") and \n   file.path : (\"/dev/shm/*\", \"/run/shm/*\", \"/tmp/*\", \"/var/tmp/*\",\n     \"/run/*\", \"/var/run/*\", \"/var/www/*\", \"/proc/*/fd/*\")] by file.name\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and \n   process.parent.name in (\"bash\", \"dash\", \"ash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") and\n   not process.parent.executable like (\n     \"/tmp/VeeamApp*\", \"/tmp/rajh/spack-stage/*\", \"plz-out/bin/vault/bridge/test/e2e/base/bridge-dev\",\n     \"/usr/bin/ranlib\", \"/usr/bin/ar\", \"plz-out/bin/vault/bridge/test/e2e/base/local-k8s\"  \n   )] by process.name\n  [file where host.os.type == \"linux\" and event.action == \"deletion\" and not process.name in (\"rm\", \"ld\") and \n   file.path : (\"/dev/shm/*\", \"/run/shm/*\", \"/tmp/*\", \"/var/tmp/*\",\n     \"/run/*\", \"/var/run/*\", \"/var/www/*\", \"/proc/*/fd/*\")] by file.name\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Setcap setuid/setgid Capability Set",
        "description": "This rule monitors for the addition of the cap_setuid+ep or cap_setgid+ep capabilities via setcap. Setuid (Set User ID) and setgid (Set Group ID) are Unix-like OS features that enable processes to run with elevated privileges, based on the file owner or group. Threat actors can exploit these attributes to achieve persistence by creating malicious binaries, allowing them to maintain control over a compromised system with elevated permissions.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Setcap setuid/setgid Capability Set\n\nSetuid (Set User ID) and setgid (Set Group ID) are Unix-like OS features that enable processes to run with elevated privileges, based on the file owner or group.\n\nThreat actors can exploit these attributes to achieve persistence by creating malicious binaries, allowing them to maintain control over a compromised system with elevated permissions.\n\nThis rule monitors for the addition of the cap_setuid+ep or cap_setgid+ep capabilities via setcap.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/master/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n> This investigation guide uses [placeholder fields](https://www.elastic.co/guide/en/security/current/osquery-placeholder-fields.html) to dynamically pass alert data into Osquery queries. Placeholder fields were introduced in Elastic Stack version 8.7.0. If you're using Elastic Stack version 8.6.0 or earlier, you'll need to manually adjust this investigation guide's queries to ensure they properly run.\n\n#### Possible Investigation Steps\n\n- Investigate the file that was targeted by the addition of the setuid/setgid capability through OSQuery.\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence and whether they are located in expected locations.\n  - !{osquery{\"label\":\"Osquery - Retrieve Running Processes by User\",\"query\":\"SELECT pid, username, name FROM processes p JOIN users u ON u.uid = p.uid ORDER BY username\"}}\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Validate the activity is not related to planned patches, updates, network administrator activity, or legitimate software installations.\n- Investigate whether the altered scripts call other malicious scripts elsewhere on the file system. \n  - If scripts or executables were dropped, retrieve the files and determine if they are malicious:\n    - Use a private sandboxed malware analysis system to perform analysis.\n      - Observe and collect information about the following activities:\n        - Attempts to contact external domains and addresses.\n          - Check if the domain is newly registered or unexpected.\n          - Check the reputation of the domain or IP address.\n        - File access, modification, and creation activities.\n        - Cron jobs, services and other persistence mechanisms.\n            - !{osquery{\"label\":\"Osquery - Retrieve Crontab Information\",\"query\":\"SELECT * FROM crontab\"}}\n- Investigate abnormal behaviors by the subject process/user such as network connections, file modifications, and any other spawned child processes.\n  - Investigate listening ports and open sockets to look for potential command and control traffic or data exfiltration.\n    - !{osquery{\"label\":\"Osquery - Retrieve Listening Ports\",\"query\":\"SELECT pid, address, port, socket, protocol, path FROM listening_ports\"}}\n    - !{osquery{\"label\":\"Osquery - Retrieve Open Sockets\",\"query\":\"SELECT pid, family, remote_address, remote_port, socket, state FROM process_open_sockets\"}}\n  - Identify the user account that performed the action, analyze it, and check whether it should perform this kind of action.\n    - !{osquery{\"label\":\"Osquery - Retrieve Information for a Specific User\",\"query\":\"SELECT * FROM users WHERE username = {{user.name}}\"}}\n- Investigate whether the user is currently logged in and active.\n    - !{osquery{\"label\":\"Osquery - Investigate the Account Authentication Status\",\"query\":\"SELECT * FROM logged_in_users WHERE user = {{user.name}}\"}}\n\n### False Positive Analysis\n\n- If this activity is related to new benign software installation activity, consider adding exceptions — preferably with a combination of user and command line conditions.\n- If this activity is related to a system administrator that performed these actions for administrative purposes, consider adding exceptions for this specific administrator user account. \n- Try to understand the context of the execution by thinking about the user, machine, or business purpose. A small number of endpoints, such as servers with unique software, might appear unusual but satisfy a specific business need.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Leverage the incident response data and logging to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 6,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": []
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1548",
                "name": "Abuse Elevation Control Mechanism",
                "reference": "https://attack.mitre.org/techniques/T1548/",
                "subtechnique": [
                  {
                    "id": "T1548.001",
                    "name": "Setuid and Setgid",
                    "reference": "https://attack.mitre.org/techniques/T1548/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d3656e84-848c-42d0-99fb-4c62da153ed1",
        "rule_id": "f5c005d3-4e17-48b0-9cd7-444d48857f97",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.021Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.021Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and \nprocess.name == \"setcap\" and process.args : \"cap_set?id+ep\" and not (\n  process.parent.name in (\"jem\", \"vzctl\") or\n  process.args like \"/usr/bin/new?idmap\"\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "Statistical Model Detected C2 Beaconing Activity with High Confidence",
        "description": "A statistical model has identified command-and-control (C2) beaconing activity with high confidence. Beaconing can help attackers maintain stealthy communication with their C2 servers, receive instructions and payloads, exfiltrate data and maintain persistence in a network.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 5,
        "tags": [
          "Domain: Network",
          "Use Case: C2 Beaconing Detection",
          "Tactic: Command and Control"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-1h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/beaconing",
          "https://www.elastic.co/security-labs/identifying-beaconing-malware-using-elastic"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1102",
                "name": "Web Service",
                "reference": "https://attack.mitre.org/techniques/T1102/",
                "subtechnique": [
                  {
                    "id": "T1102.002",
                    "name": "Bidirectional Communication",
                    "reference": "https://attack.mitre.org/techniques/T1102/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Network Beaconing Identification integration assets to be installed, as well as network logs collected by the Elastic Defend or Network Packet Capture integrations.\n\n### Network Beaconing Identification Setup\nThe Network Beaconing Identification integration consists of a statistical framework to identify C2 beaconing activity in network logs.\n\n#### Prerequisite Requirements:\n- Fleet is required for Network Beaconing Identification.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Network events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) or [Network Packet Capture](https://docs.elastic.co/integrations/network_traffic) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To add the Network Packet Capture integration to an Elastic Agent policy, refer to [this](https://www.elastic.co/guide/en/fleet/current/add-integration-to-policy.html) guide.\n\n#### The following steps should be executed to install assets associated with the Network Beaconing Identification integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Network Beaconing Identification and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n",
        "related_integrations": [
          {
            "package": "beaconing",
            "version": "^1.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "network_traffic",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "beacon_stats.beaconing_score",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "75c361ee-ab9d-48cb-bb17-410f8d15be5f",
        "rule_id": "0ab319ef-92b8-4c7f-989b-5de93c852e93",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.035Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.035Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "ml_beaconing.all"
        ],
        "query": "beacon_stats.beaconing_score: 3\n",
        "language": "kuery"
      },
      {
        "name": "Potential Ransomware Behavior - High count of Readme files by System",
        "description": "This rule identifies a high number (20) of file creation event by the System virtual process from the same host and with same file name containing keywords similar to ransomware note files and all within a short time period.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n#### Possible investigation steps\n\n- Investigate the content of the readme files.\n- Investigate any file names with unusual extensions.\n- Investigate any incoming network connection to port 445 on this host.\n- Investigate any network logon events to this host.\n- Identify the total number and type of modified files by pid 4.\n- If the number of files is too high and source.ip connecting over SMB is unusual isolate the host and block the used credentials.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n\n### False positive analysis\n\n- Local file modification from a Kernel mode driver.\n\n### Related rules\n\n- Third-party Backup Files Deleted via Unexpected Process - 11ea6bec-ebde-4d71-a8e9-784948f8e3e9\n- Volume Shadow Copy Deleted or Resized via VssAdmin - b5ea4bfe-a1b2-421f-9d47-22a75a6f2921\n- Volume Shadow Copy Deletion via PowerShell - d99a037b-c8e2-47a5-97b9-170d076827c4\n- Volume Shadow Copy Deletion via WMIC - dc9c1f74-dac3-48e3-b47f-eb79db358f57\n- Potential Ransomware Note File Dropped via SMB - 02bab13d-fb14-4d7c-b6fe-4a28874d37c5\n- Suspicious File Renamed via SMB - 78e9b5d5-7c07-40a7-a591-3dbbf464c386\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Consider isolating the involved host to prevent destructive behavior, which is commonly associated with this activity.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- If any other destructive action was identified on the host, it is recommended to prioritize the investigation and look for ransomware preparation and execution activities.\n- If any backups were affected:\n  - Perform data recovery locally or restore the backups from replicated copies (cloud, other servers, etc.).\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 207,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Impact",
          "Resources: Investigation Guide",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: Sysmon",
          "Data Source: SentinelOne"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://news.sophos.com/en-us/2023/12/21/akira-again-the-ransomware-that-keeps-on-taking/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1485",
                "name": "Data Destruction",
                "reference": "https://attack.mitre.org/techniques/T1485/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1021",
                "name": "Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1021/",
                "subtechnique": [
                  {
                    "id": "T1021.002",
                    "name": "SMB/Windows Admin Shares",
                    "reference": "https://attack.mitre.org/techniques/T1021/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pid",
            "type": "long",
            "ecs": true
          }
        ],
        "id": "5f2fefc2-7fab-4a1d-aaf1-073e2623eb4d",
        "rule_id": "1397e1b9-0c90-4d24-8d7b-80598eb9bc9a",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.039Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.039Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "threshold",
        "query": "event.category:file and host.os.type:windows and process.pid:4 and event.action:creation and\n file.name:(*read*me* or *README* or *lock* or *LOCK* or *how*to* or *HOW*TO* or *@* or *recover* or *RECOVER* or *decrypt* or *DECRYPT* or *restore* or *RESTORE* or *FILES_BACK* or *files_back*)\n",
        "threshold": {
          "field": [
            "host.id",
            "file.name"
          ],
          "value": 20
        },
        "index": [
          "logs-endpoint.events.file-*",
          "winlogbeat-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*"
        ],
        "language": "kuery"
      },
      {
        "name": "Successful Application SSO from Rare Unknown Client Device",
        "description": "Detects successful single sign-on (SSO) events to Okta applications from an unrecognized or \"unknown\" client device, as identified by the user-agent string. This activity may be indicative of exploitation of a vulnerability in Okta's Classic Engine, which could allow an attacker to bypass application-specific sign-on policies, such as device or network restrictions. The vulnerability potentially enables unauthorized access to applications using only valid, stolen credentials, without requiring additional authentication factors.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: SaaS",
          "Data Source: Okta",
          "Use Case: Threat Detection",
          "Use Case: Identity and Access Audit",
          "Tactic: Initial Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://trust.okta.com/security-advisories/okta-classic-application-sign-on-policy-bypass-2024/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1078",
                "name": "Valid Accounts",
                "reference": "https://attack.mitre.org/techniques/T1078/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "okta",
            "version": "^3.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "okta.client.device",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "fd489330-d61e-4c38-8b57-ab9674105d8a",
        "rule_id": "1502a836-84b2-11ef-b026-f661ea17fbcc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.042Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.042Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset: \"okta.system\"\n    and event.action: \"user.authentication.sso\"\n    and event.outcome: \"success\"\n    and okta.client.device: (\"Unknown\" or \"unknown\")\n",
        "new_terms_fields": [
          "client.user.name",
          "okta.client.user_agent.raw_user_agent"
        ],
        "history_window_start": "now-14d",
        "index": [
          "filebeat-*",
          "logs-okta*"
        ],
        "language": "kuery"
      },
      {
        "name": "High Number of Okta Device Token Cookies Generated for Authentication",
        "description": "Detects when an Okta client address has a certain threshold of Okta user authentication events with multiple device token hashes generated for single user authentication. Adversaries may attempt to launch a credential stuffing or password spraying attack from the same device by using a list of known usernames and passwords to gain unauthorized access to user accounts.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating High Number of Okta Device Token Cookies Generated for Authentication\n\nThis rule detects when a certain threshold of Okta user authentication events are reported for multiple users from the same client address. Adversaries may attempt to launch a credential stuffing attack from the same device by using a list of known usernames and passwords to gain unauthorized access to user accounts. Note that Okta does not log unrecognized usernames supplied during authentication attempts, so this rule may not detect all credential stuffing attempts or may indicate a targeted attack.\n\n#### Possible investigation steps:\n- Since this is an ES|QL rule, the `okta.actor.alternate_id` and `okta.client.ip` values can be used to pivot into the raw authentication events related to this activity.\n- Identify the users involved in this action by examining the `okta.actor.id`, `okta.actor.type`, `okta.actor.alternate_id`, and `okta.actor.display_name` fields.\n- Determine the device client used for these actions by analyzing `okta.client.ip`, `okta.client.user_agent.raw_user_agent`, `okta.client.zone`, `okta.client.device`, and `okta.client.id` fields.\n- Review the `okta.security_context.is_proxy` field to determine if the device is a proxy.\n    - If the device is a proxy, this may indicate that a user is using a proxy to access multiple accounts for password spraying.\n- With the list of `okta.actor.alternate_id` values, review `event.outcome` results to determine if the authentication was successful.\n    - If the authentication was successful for any user, pivoting to `event.action` values for those users may provide additional context.\n- With Okta end users identified, review the `okta.debug_context.debug_data.dt_hash` field.\n    - Historical analysis should indicate if this device token hash is commonly associated with the user.\n- Review the `okta.event_type` field to determine the type of authentication event that occurred.\n    - If the event type is `user.authentication.sso`, the user may have legitimately started a session via a proxy for security or privacy reasons.\n    - If the event type is `user.authentication.password`, the user may be using a proxy to access multiple accounts for password spraying.\n    - If the event type is `user.session.start`, the source may have attempted to establish a session via the Okta authentication API.\n- Examine the `okta.outcome.result` field to determine if the authentication was successful.\n- Review the past activities of the actor(s) involved in this action by checking their previous actions.\n- Evaluate the actions that happened just before and after this event in the `okta.event_type` field to help understand the full context of the activity.\n    - This may help determine the authentication and authorization actions that occurred between the user, Okta and application.\n\n### False positive analysis:\n- A user may have legitimately started a session via a proxy for security or privacy reasons.\n- Users may share an endpoint related to work or personal use in which separate Okta accounts are used.\n    - Architecturally, this shared endpoint may leverage a proxy for security or privacy reasons.\n    - Shared systems such as Kiosks and conference room computers may be used by multiple users.\n    - Shared working spaces may have a single endpoint that is used by multiple users.\n\n### Response and remediation:\n- Review the profile of the users involved in this action to determine if proxy usage may be expected.\n- If the user is legitimate and the authentication behavior is not suspicious based on device analysis, no action is required.\n- If the user is legitimate but the authentication behavior is suspicious, consider resetting passwords for the users involves and enabling multi-factor authentication (MFA).\n    - If MFA is already enabled, consider resetting MFA for the users.\n- If any of the users are not legitimate, consider deactivating the user's account.\n- Conduct a review of Okta policies and ensure they are in accordance with security best practices.\n- Check with internal IT teams to determine if the accounts involved recently had MFA reset at the request of the user.\n    - If so, confirm with the user this was a legitimate request.\n    - If so and this was not a legitimate request, consider deactivating the user's account temporarily.\n        - Reset passwords and reset MFA for the user.\n- If this is a false positive, consider adding the `okta.debug_context.debug_data.dt_hash` field to the `exceptions` list in the rule.\n    - This will prevent future occurrences of this event for this device from triggering the rule.\n    - Alternatively adding `okta.client.ip` or a CIDR range to the `exceptions` list can prevent future occurrences of this event from triggering the rule.\n        - This should be done with caution as it may prevent legitimate alerts from being generated.\n",
        "output_index": "",
        "version": 203,
        "tags": [
          "Use Case: Identity and Access Audit",
          "Data Source: Okta",
          "Tactic: Credential Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Users may share an endpoint related to work or personal use in which separate Okta accounts are used.",
          "Shared systems such as Kiosks and conference room computers may be used by multiple users."
        ],
        "references": [
          "https://support.okta.com/help/s/article/How-does-the-Device-Token-work?language=en_US",
          "https://developer.okta.com/docs/reference/api/event-types/",
          "https://www.elastic.co/security-labs/testing-okta-visibility-and-detection-dorothy",
          "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection",
          "https://www.okta.com/resources/whitepaper-how-adaptive-mfa-can-help-in-mitigating-brute-force-attacks/",
          "https://www.elastic.co/security-labs/monitoring-okta-threats-with-elastic-security",
          "https://www.elastic.co/security-labs/starter-guide-to-understanding-okta"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1110",
                "name": "Brute Force",
                "reference": "https://attack.mitre.org/techniques/T1110/",
                "subtechnique": [
                  {
                    "id": "T1110.003",
                    "name": "Password Spraying",
                    "reference": "https://attack.mitre.org/techniques/T1110/003/"
                  }
                ]
              },
              {
                "id": "T1110",
                "name": "Brute Force",
                "reference": "https://attack.mitre.org/techniques/T1110/",
                "subtechnique": [
                  {
                    "id": "T1110.004",
                    "name": "Credential Stuffing",
                    "reference": "https://attack.mitre.org/techniques/T1110/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "The Okta Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.",
        "related_integrations": [],
        "required_fields": [],
        "id": "9ad0710b-0313-4c57-8421-3c6609689574",
        "rule_id": "23f18264-2d6d-11ef-9413-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.045Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.045Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "FROM logs-okta*\n| WHERE\n    event.dataset == \"okta.system\"\n    AND (event.action RLIKE \"user\\\\.authentication(.*)\" OR event.action == \"user.session.start\")\n    AND okta.debug_context.debug_data.request_uri == \"/api/v1/authn\"\n    AND okta.outcome.reason == \"INVALID_CREDENTIALS\"\n| KEEP event.action, okta.debug_context.debug_data.dt_hash, okta.client.ip, okta.actor.alternate_id, okta.debug_context.debug_data.request_uri, okta.outcome.reason\n| STATS\n    source_auth_count = COUNT_DISTINCT(okta.debug_context.debug_data.dt_hash)\n    BY okta.client.ip, okta.actor.alternate_id\n| WHERE\n    source_auth_count >= 30\n| SORT\n    source_auth_count DESC\n"
      },
      {
        "name": "Attempt to Clear Kernel Ring Buffer",
        "description": "Monitors for the deletion of the kernel ring buffer events through dmesg. Attackers may clear kernel ring buffer events to evade detection after installing a Linux kernel module (LKM).",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 5,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1070",
                "name": "Indicator Removal",
                "reference": "https://attack.mitre.org/techniques/T1070/",
                "subtechnique": [
                  {
                    "id": "T1070.002",
                    "name": "Clear Linux or Mac System Logs",
                    "reference": "https://attack.mitre.org/techniques/T1070/002/"
                  }
                ]
              },
              {
                "id": "T1562",
                "name": "Impair Defenses",
                "reference": "https://attack.mitre.org/techniques/T1562/",
                "subtechnique": [
                  {
                    "id": "T1562.001",
                    "name": "Disable or Modify Tools",
                    "reference": "https://attack.mitre.org/techniques/T1562/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "2ccd13c4-4c74-43e4-a3c5-c536321ceb82",
        "rule_id": "2724808c-ba5d-48b2-86d2-0002103df753",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.049Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.049Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\", \"executed\", \"process_started\")\n and process.name == \"dmesg\" and process.args == \"-c\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Shell Configuration Creation or Modification",
        "description": "This rule monitors the creation/alteration of a shell configuration file. Unix systems use shell configuration files to set environment variables, create aliases, and customize the user's environment. Adversaries may modify or add a shell configuration file to execute malicious code and gain persistence in the system. This behavior is consistent with the Kaiji malware family.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 5,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate user shell modification activity."
        ],
        "references": [
          "https://intezer.com/blog/research/kaiji-new-chinese-linux-malware-turning-to-golang/",
          "https://www.elastic.co/security-labs/primer-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/",
                "subtechnique": [
                  {
                    "id": "T1546.004",
                    "name": "Unix Shell Configuration Modification",
                    "reference": "https://attack.mitre.org/techniques/T1546/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.original.extension",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "f49e6e6c-db6c-41d3-9927-948f01681fee",
        "rule_id": "28f6f34b-8e16-487a-b5fd-9d22eb903db8",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.052Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.052Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.action in (\"rename\", \"creation\") and file.path : (\n  // system-wide configurations\n  \"/etc/profile\", \"/etc/profile.d/*\", \"/etc/bash.bashrc\", \"/etc/bash.bash_logout\", \"/etc/zsh/*\",\n  \"/etc/csh.cshrc\", \"/etc/csh.login\", \"/etc/fish/config.fish\", \"/etc/ksh.kshrc\",\n  // root and user configurations\n  \"/home/*/.profile\", \"/home/*/.bashrc\", \"/home/*/.bash_login\", \"/home/*/.bash_logout\", \"/home/*/.bash_profile\",\n  \"/root/.profile\", \"/root/.bashrc\", \"/root/.bash_login\", \"/root/.bash_logout\", \"/root/.bash_profile\",\n  \"/home/*/.zprofile\", \"/home/*/.zshrc\", \"/root/.zprofile\", \"/root/.zshrc\",\n  \"/home/*/.cshrc\", \"/home/*/.login\", \"/home/*/.logout\", \"/root/.cshrc\", \"/root/.login\", \"/root/.logout\",\n  \"/home/*/.config/fish/config.fish\", \"/root/.config/fish/config.fish\",\n  \"/home/*/.kshrc\", \"/root/.kshrc\"\n) and not (\n  process.executable in (\n    \"/bin/dpkg\", \"/usr/bin/dpkg\", \"/bin/dockerd\", \"/usr/bin/dockerd\", \"/usr/sbin/dockerd\", \"/bin/microdnf\",\n    \"/usr/bin/microdnf\", \"/bin/rpm\", \"/usr/bin/rpm\", \"/bin/snapd\", \"/usr/bin/snapd\", \"/bin/yum\", \"/usr/bin/yum\",\n    \"/bin/dnf\", \"/usr/bin/dnf\", \"/bin/podman\", \"/usr/bin/podman\", \"/bin/dnf-automatic\", \"/usr/bin/dnf-automatic\",\n    \"/bin/pacman\", \"/usr/bin/pacman\", \"/usr/bin/dpkg-divert\", \"/bin/dpkg-divert\", \"/sbin/apk\", \"/usr/sbin/apk\",\n    \"/usr/local/sbin/apk\", \"/usr/bin/apt\", \"/usr/sbin/pacman\", \"/bin/podman\", \"/usr/bin/podman\", \"/usr/bin/puppet\",\n    \"/bin/puppet\", \"/opt/puppetlabs/puppet/bin/puppet\", \"/usr/bin/chef-client\", \"/bin/chef-client\",\n    \"/bin/autossl_check\", \"/usr/bin/autossl_check\", \"/proc/self/exe\", \"/dev/fd/*\",  \"/usr/bin/pamac-daemon\",\n    \"/bin/pamac-daemon\", \"/usr/lib/snapd/snapd\", \"/usr/sbin/adduser\", \"/usr/sbin/useradd\", \"/usr/local/bin/dockerd\",\n    \"/usr/sbin/gdm\", \"/usr/bin/unzip\", \"/usr/bin/gnome-shell\", \"/sbin/mkhomedir_helper\", \"/usr/sbin/sshd\",\n    \"/opt/puppetlabs/puppet/bin/ruby\", \"/usr/bin/xfce4-session\", \"/usr/libexec/oddjob/mkhomedir\", \"/sbin/useradd\",\n    \"/usr/lib/systemd/systemd\", \"/usr/sbin/crond\", \"/usr/bin/pamac-daemon\", \"/usr/sbin/mkhomedir_helper\",\n    \"/opt/pbis/sbin/lwsmd\", \"/usr/sbin/oddjobd\"\n  ) or\n  file.extension in (\"swp\", \"swpx\", \"swx\", \"dpkg-remove\") or\n  file.Ext.original.extension == \"dpkg-new\" or\n  process.executable : (\n    \"/nix/store/*\", \"/var/lib/dpkg/*\", \"/tmp/vmis.*\", \"/snap/*\", \"/dev/fd/*\", \"/usr/lib/virtualbox/*\",\n    \"/usr/libexec/platform-python*\"\n  ) or\n  process.executable == null or\n  process.name in (\"adclient\", \"mkhomedir_helper\", \"teleport\", \"mkhomedir\", \"adduser\", \"desktopDaemon\") or\n  (process.name == \"sed\" and file.name : \"sed*\") or\n  (process.name == \"perl\" and file.name : \"e2scrub_all.tmp*\") \n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*"
        ]
      },
      {
        "name": "Accessing Outlook Data Files",
        "description": "Identifies commands containing references to Outlook data files extensions, which can potentially indicate the search, access, or modification of these files.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 105,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Collection",
          "Data Source: Elastic Defend",
          "Rule Type: BBR",
          "Data Source: Sysmon",
          "Data Source: Elastic Endgame",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0009",
              "name": "Collection",
              "reference": "https://attack.mitre.org/tactics/TA0009/"
            },
            "technique": [
              {
                "id": "T1114",
                "name": "Email Collection",
                "reference": "https://attack.mitre.org/techniques/T1114/",
                "subtechnique": [
                  {
                    "id": "T1114.001",
                    "name": "Local Email Collection",
                    "reference": "https://attack.mitre.org/techniques/T1114/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "c0db10ae-c987-476d-b986-c0d0edbe7282",
        "rule_id": "2e311539-cd88-4a85-a301-04f38795007c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.055Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.055Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and process.args : (\"*.ost\", \"*.pst\") and\n  not process.name : \"outlook.exe\" and\n  not (\n        process.name : \"rundll32.exe\" and\n        process.args : \"*davclnt.dll,DavSetCookie*\"\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-system.security*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "Unusual High Confidence Content Filter Blocks Detected",
        "description": "Detects repeated high-confidence 'BLOCKED' actions coupled with specific 'Content Filter' policy violation having codes such as 'MISCONDUCT', 'HATE', 'SEXUAL', INSULTS', 'PROMPT_ATTACK', 'VIOLENCE' indicating persistent misuse or attempts to probe the model's ethical boundaries.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Amazon Bedrock Guardrail High Confidence Content Filter Blocks.\n\nAmazon Bedrock Guardrail is a set of features within Amazon Bedrock designed to help businesses apply robust safety and privacy controls to their generative AI applications.\n\nIt enables users to set guidelines and filters that manage content quality, relevancy, and adherence to responsible AI practices.\n\nThrough Guardrail, organizations can enable Content filter for Hate, Insults, Sexual Violence and Misconduct along with Prompt Attack filters prompts \nto prevent the model from generating content on specific, undesired subjects, and they can establish thresholds for harmful content categories.\n\n#### Possible investigation steps\n\n- Identify the user account whose prompts caused high confidence content filter blocks and whether it should perform this kind of action.\n- Investigate other alerts associated with the user account during the past 48 hours.\n- Consider the time of day. If the user is a human (not a program or script), did the activity take place during a normal time of day?\n- Examine the account's prompts and responses in the last 24 hours.\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking Amazon Bedrock model access, prompts generated, and responses to the prompts by the account in the last 24 hours.\n\n### False positive analysis\n\n- Verify the user account that queried denied topics, is not testing any new model deployments or updated compliance policies in Amazon Bedrock guardrails.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Identify if the attacker is moving laterally and compromising other Amazon Bedrock Services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Review the permissions assigned to the implicated user group or role behind these requests to ensure they are authorized and expected to access bedrock and ensure that the least privilege principle is being followed.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 5,
        "tags": [
          "Domain: LLM",
          "Data Source: AWS Bedrock",
          "Data Source: AWS S3",
          "Use Case: Policy Violation",
          "Mitre Atlas: T0051",
          "Mitre Atlas: T0054"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "New model deployments.",
          "Testing updates to compliance policies."
        ],
        "references": [
          "https://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-components.html",
          "https://atlas.mitre.org/techniques/AML.T0051",
          "https://atlas.mitre.org/techniques/AML.T0054",
          "https://www.elastic.co/security-labs/elastic-advances-llm-security"
        ],
        "max_signals": 100,
        "threat": [],
        "setup": "## Setup\n\nThis rule requires that guardrails are configured in AWS Bedrock. For more information, see the AWS Bedrock documentation:\n\nhttps://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-create.html\n",
        "related_integrations": [],
        "required_fields": [],
        "id": "36423ba8-1297-4ccd-8348-62f256ca678d",
        "rule_id": "4f855297-c8e0-4097-9d97-d653f7e471c4",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.058Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.058Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws_bedrock.invocation-*\n| MV_EXPAND gen_ai.compliance.violation_code\n| MV_EXPAND gen_ai.policy.confidence\n| MV_EXPAND gen_ai.policy.name \n| where gen_ai.policy.action == \"BLOCKED\" and gen_ai.policy.name == \"content_policy\" and gen_ai.policy.confidence LIKE \"HIGH\" and gen_ai.compliance.violation_code IN (\"HATE\", \"MISCONDUCT\", \"SEXUAL\", \"INSULTS\", \"PROMPT_ATTACK\", \"VIOLENCE\")\n| keep user.id, gen_ai.compliance.violation_code\n| stats block_count_per_violation = count() by user.id, gen_ai.compliance.violation_code \n| SORT block_count_per_violation DESC \n| keep user.id, gen_ai.compliance.violation_code, block_count_per_violation\n| STATS violation_count = SUM(block_count_per_violation) by user.id\n| WHERE violation_count > 5 \n| SORT violation_count DESC \n"
      },
      {
        "name": "Potential Masquerading as Browser Process",
        "description": "Identifies suspicious instances of browser processes, such as unsigned or signed with unusual certificates, that can indicate an attempt to conceal malicious activity, bypass security features such as allowlists, or trick users into executing malware.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 5,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Tactic: Persistence",
          "Rule Type: BBR",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.001",
                    "name": "Invalid Code Signature",
                    "reference": "https://attack.mitre.org/techniques/T1036/001/"
                  },
                  {
                    "id": "T1036.005",
                    "name": "Match Legitimate Name or Location",
                    "reference": "https://attack.mitre.org/techniques/T1036/005/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1554",
                "name": "Compromise Host Software Binary",
                "reference": "https://attack.mitre.org/techniques/T1554/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.subject_name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "eef32054-00ae-4554-bd63-7eb7d0ebb1be",
        "rule_id": "5b9eb30f-87d6-45f4-9289-2bf2024f0376",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.062Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.062Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  (\n    /* Chrome Related Processes */\n    (process.name : (\n      \"chrome.exe\", \"GoogleUpdate.exe\", \"GoogleCrashHandler64.exe\", \"GoogleCrashHandler.exe\",\n      \"GoogleUpdateComRegisterShell64.exe\", \"GoogleUpdateSetup.exe\", \"GoogleUpdateOnDemand.exe\",\n      \"chrome_proxy.exe\", \"remote_assistance_host.exe\", \"remoting_native_messaging_host.exe\",\n      \"GoogleUpdateBroker.exe\"\n     ) and not\n      (process.code_signature.subject_name : (\"Google LLC\", \"Google Inc\") and process.code_signature.trusted == true)\n     and not\n      (\n        process.executable : (\n          \"?:\\\\Program Files\\\\HP\\\\Sure Click\\\\servers\\\\chrome.exe\",\n          \"?:\\\\Program Files\\\\HP\\\\Sure Click\\\\*\\\\servers\\\\chrome.exe\"\n        ) and\n        process.code_signature.subject_name : (\"Bromium, Inc.\") and process.code_signature.trusted == true\n      ) and not\n      (\n        process.executable : (\n          \"?:\\\\Program Files\\\\dynatrace\\\\synthetic\\\\Chrome-bin\\\\chrome.exe\"\n        ) and\n        process.code_signature.subject_name : (\"Dynatrace LLC\") and process.code_signature.trusted == true\n      ) and\n     not (\n       process.executable : (\n         \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\ms-playwright\\\\chromium-*\\\\chrome-win\\\\chrome.exe\",\n         \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Programs\\\\synthetics-recorder\\\\resources\\\\local-browsers\\\\chromium-*\\\\chrome-win\\\\chrome.exe\",\n         \"*\\\\node_modules\\\\puppeteer\\\\.local-chromium\\\\win64-*\\\\chrome-win\\\\chrome.exe\",\n         \"?:\\\\Program Files (x86)\\\\Invicti Professional Edition\\\\chromium\\\\chrome.exe\",\n         \"?:\\\\Program Files\\\\End2End, Inc\\\\ARMS Html Engine\\\\chrome.exe\",\n         \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\*BurpSuitePro\\\\burpbrowser\\\\*\\\\chrome.exe\",\n         \"?:\\\\Users\\\\*\\\\AppData\\\\Roaming\\\\*BurpSuite\\\\burpbrowser\\\\*\\\\chrome.exe\"\n       ) and process.args: (\n               \"--enable-features=NetworkService,NetworkServiceInProcess\",\n               \"--type=crashpad-handler\", \"--enable-automation\", \"--disable-xss-auditor\"\n             )\n     )\n    ) or\n\n    /* MS Edge Related Processes */\n    (process.name : (\n      \"msedge.exe\", \"MicrosoftEdgeUpdate.exe\", \"identity_helper.exe\", \"msedgewebview2.exe\",\n      \"MicrosoftEdgeWebview2Setup.exe\", \"MicrosoftEdge_X*.exe\", \"msedge_proxy.exe\",\n      \"MicrosoftEdgeUpdateCore.exe\", \"MicrosoftEdgeUpdateBroker.exe\", \"MicrosoftEdgeUpdateSetup_X*.exe\",\n      \"MicrosoftEdgeUpdateComRegisterShell64.exe\", \"msedgerecovery.exe\", \"MicrosoftEdgeUpdateSetup.exe\"\n     ) and not\n      (process.code_signature.subject_name : \"Microsoft Corporation\" and process.code_signature.trusted == true)\n     and not\n      (\n        process.name : \"msedgewebview2.exe\" and\n        process.code_signature.subject_name : (\"Bromium, Inc.\", \"Amazon.com Services LLC\", \"Code Systems Corporation\") and process.code_signature.trusted == true\n      )\n    ) or\n\n    /* Brave Related Processes */\n    (process.name : (\n      \"brave.exe\", \"BraveUpdate.exe\", \"BraveCrashHandler64.exe\", \"BraveCrashHandler.exe\",\n      \"BraveUpdateOnDemand.exe\", \"brave_vpn_helper.exe\", \"BraveUpdateSetup*.exe\",\n      \"BraveUpdateComRegisterShell64.exe\"\n     ) and not\n      (process.code_signature.subject_name : \"Brave Software, Inc.\" and process.code_signature.trusted == true)\n    ) or\n\n    /* Firefox Related Processes */\n    (process.name : (\n      \"firefox.exe\", \"pingsender.exe\", \"default-browser-agent.exe\", \"maintenanceservice.exe\",\n      \"plugin-container.exe\", \"maintenanceservice_tmp.exe\", \"maintenanceservice_installer.exe\",\n      \"minidump-analyzer.exe\"\n     ) and not\n      (process.code_signature.subject_name : \"Mozilla Corporation\" and process.code_signature.trusted == true)\n     and not\n      (\n        process.name : \"default-browser-agent.exe\" and\n        process.code_signature.subject_name : (\"WATERFOX LIMITED\") and process.code_signature.trusted == true\n      )\n    ) or\n\n    /* Island Related Processes */\n    (process.name : (\n      \"Island.exe\", \"IslandUpdate.exe\", \"IslandCrashHandler.exe\", \"IslandCrashHandler64.exe\",\n      \"IslandUpdateBroker.exe\", \"IslandUpdateOnDemand.exe\", \"IslandUpdateComRegisterShell64.exe\",\n      \"IslandUpdateSetup.exe\"\n     ) and not\n      (process.code_signature.subject_name : \"Island Technology Inc.\" and process.code_signature.trusted == true)\n    ) or\n\n    /* Opera Related Processes */\n    (process.name : (\n      \"opera.exe\", \"opera_*.exe\", \"browser_assistant.exe\"\n     ) and not\n      (process.code_signature.subject_name : (\"Opera Norway AS\", \"Opera Software AS\") and process.code_signature.trusted == true)\n    ) or\n\n    /* Whale Related Processes */\n    (process.name : (\n      \"whale.exe\", \"whale_update.exe\", \"wusvc.exe\"\n     ) and not\n      (process.code_signature.subject_name : \"NAVER Corp.\" and process.code_signature.trusted == true)\n    ) or\n\n    /* Chromium-based Browsers processes */\n    (process.name : (\n      \"chrmstp.exe\", \"notification_helper.exe\", \"elevation_service.exe\"\n     ) and not\n      (process.code_signature.subject_name : (\n        \"Island Technology Inc.\",\n        \"Citrix Systems, Inc.\",\n        \"Brave Software, Inc.\",\n        \"Google LLC\",\n        \"Google Inc\",\n        \"Microsoft Corporation\",\n        \"NAVER Corp.\",\n        \"AVG Technologies USA, LLC\",\n        \"Avast Software s.r.o.\",\n        \"PIRIFORM SOFTWARE LIMITED\",\n        \"NortonLifeLock Inc.\",\n        \"Opera Norway AS\"\n       ) and process.code_signature.trusted == true\n      )\n    )\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*"
        ]
      },
      {
        "name": "Interactive Logon by an Unusual Process",
        "description": "Identifies interactive logon attempt with alternate credentials and by an unusual process. Adversaries may create a new token to escalate privileges and bypass access controls.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 104,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://attack.mitre.org/techniques/T1134/002/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1134",
                "name": "Access Token Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1134/",
                "subtechnique": [
                  {
                    "id": "T1134.002",
                    "name": "Create Process with Token",
                    "reference": "https://attack.mitre.org/techniques/T1134/002/"
                  },
                  {
                    "id": "T1134.003",
                    "name": "Make and Impersonate Token",
                    "reference": "https://attack.mitre.org/techniques/T1134/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nAudit event 4624 is needed to trigger this rule.\n\nIf enabling an EQL rule on a non-elastic-agent index (such as beats) for versions <8.2,\nevents will not define `event.ingested` and default fallback for EQL rules was not added until version 8.2.\nHence for this rule to work effectively, users will need to add a custom ingest pipeline to populate\n`event.ingested` to @timestamp.\nFor more details on adding a custom ingest pipeline refer - https://www.elastic.co/guide/en/fleet/current/data-streams-pipeline-tutorial.html\n",
        "related_integrations": [
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "winlog.event_data.LogonProcessName",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "winlog.event_data.SubjectUserSid",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "winlog.event_data.TargetUserSid",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "winlog.logon.type",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "e1cd8b98-1125-47e3-bd6b-6b650a368f94",
        "rule_id": "61766ef9-48a5-4247-ad74-3349de7eb2ad",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.065Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.065Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "authentication where \n host.os.type : \"windows\" and winlog.event_data.LogonProcessName : \"Advapi*\" and \n winlog.logon.type == \"Interactive\" and winlog.event_data.SubjectUserSid : (\"S-1-5-21*\", \"S-1-12-*\") and \n winlog.event_data.TargetUserSid : (\"S-1-5-21*\", \"S-1-12-*\")  and process.executable : \"C:\\\\*\" and \n not startswith~(winlog.event_data.SubjectUserSid, winlog.event_data.TargetUserSid) and \n not process.executable : \n            (\"?:\\\\Windows\\\\System32\\\\winlogon.exe\", \n             \"?:\\\\Windows\\\\System32\\\\wininit.exe\", \n             \"?:\\\\Program Files\\\\*.exe\", \n             \"?:\\\\Program Files (x86)\\\\*.exe\", \n             \"?:\\\\Windows\\\\SysWOW64\\\\inetsrv\\\\w3wp.exe\", \n             \"?:\\\\Windows\\\\System32\\\\inetsrv\\\\w3wp.exe\", \n             \"?:\\\\Windows\\\\SysWOW64\\\\msiexec.exe\")\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-system.*",
          "logs-windows.*"
        ]
      },
      {
        "name": "AWS IAM User Created Access Keys For Another User",
        "description": "An adversary with access to a set of compromised credentials may attempt to persist or escalate privileges by creating a new set of credentials for an existing user. This rule looks for use of the IAM `CreateAccessKey` API operation to create new programmatic access keys for another IAM user.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating AWS IAM User Created Access Keys For Another User\n\nAWS access keys created for IAM users or root user are long-term credentials that provide programmatic access to AWS.\nWith access to the `iam:CreateAccessKey` permission, a set of compromised credentials could be used to create a new\nset of credentials for another user for privilege escalation or as a means of persistence. This rule uses [ES|QL](https://www.elastic.co/guide/en/security/master/rules-ui-create.html#create-esql-rule)\nto look for use of the `CreateAccessKey` operation where the user.name is different from the user.target.name.\n\n\n#### Possible investigation steps\n\n- Identify both related accounts and their role in the environment.\n- Review IAM permission policies for the user identities.\n- Identify the applications or users that should use these accounts.\n- Investigate other alerts associated with the accounts during the past 48 hours.\n- Investigate abnormal values in the `user_agent.original` field by comparing them with the intended and authorized usage and historical data. Suspicious user agent values include non-SDK, AWS CLI, custom user agents, etc.\n- Contact the account owners and confirm whether they are aware of this activity.\n- Considering the source IP address and geolocation of the user who issued the command:\n    - Do they look normal for the calling user?\n    - If the source is an EC2 IP address, is it associated with an EC2 instance in one of your accounts or is the source IP from an EC2 instance that's not under your control?\n    - If it is an authorized EC2 instance, is the activity associated with normal behavior for the instance role or roles? Are there any other alerts or signs of suspicious activity involving this instance?\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking servers, services, and data accessed by the account in the last 24 hours.\n    - Determine what other API calls were made by the user.\n    - Assess whether this behavior is prevalent in the environment by looking for similar occurrences involving other users.\n\n### False positive analysis\n\n- False positives may occur due to the intended usage of the IAM `CreateAccessKey` operation. Verify the `aws.cloudtrail.user_identity.arn` should use this operation against the `user.target.name` account.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n    - Rotate user credentials\n    - Remove the newly created credentials from the affected user(s)\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Assess the criticality of affected services and servers.\n    - Work with your IT team to identify and minimize the impact on users.\n    - Identify if the attacker is moving laterally and compromising other accounts, servers, or services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified.\n    - Rotate secrets or delete API keys as needed to revoke the attacker's access to the environment.\n    - Work with your IT teams to minimize the impact on business operations during these actions.\n- Remove unauthorized new accounts, and request password resets for other IAM users.\n- Consider enabling multi-factor authentication for users.\n- Review the permissions assigned to the implicated user to ensure that the least privilege principle is being followed.\n- Implement security best practices [outlined](https://aws.amazon.com/premiumsupport/knowledge-center/security-best-practices/) by AWS.\n- Take the actions needed to return affected systems, data, or services to their normal operational levels.\n- Identify the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "@timestamp",
            "user.name",
            "source.address",
            "aws.cloudtrail.user_identity.arn",
            "aws.cloudtrail.user_identity.type",
            "user_agent.original",
            "user.target.name",
            "event.action",
            "event.outcome",
            "cloud.region",
            "event.provider",
            "aws.cloudtrail.request_parameters",
            "aws.cloudtrail.response_elements"
          ]
        },
        "version": 5,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS IAM",
          "Use Case: Identity and Access Audit",
          "Tactic: Privilege Escalation",
          "Tactic: Persistence",
          "Resources: Investigation Guide"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "While this can be normal behavior, it should be investigated to ensure validity. Verify whether the user identity should be using the IAM `CreateAccessKey` for the targeted user."
        ],
        "references": [
          "https://hackingthe.cloud/aws/exploitation/iam_privilege_escalation/#iamcreateaccesskey",
          "https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-iam-persistence",
          "https://permiso.io/blog/lucr-3-scattered-spider-getting-saas-y-in-the-cloud",
          "https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateAccessKey.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.001",
                    "name": "Additional Cloud Credentials",
                    "reference": "https://attack.mitre.org/techniques/T1098/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.001",
                    "name": "Additional Cloud Credentials",
                    "reference": "https://attack.mitre.org/techniques/T1098/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [],
        "id": "e97b9c36-23e8-401e-8dfc-f6391ba252ba",
        "rule_id": "696015ef-718e-40ff-ac4a-cc2ba88dbeeb",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.068Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.068Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws.cloudtrail-* metadata _id, _version, _index\n| where event.provider == \"iam.amazonaws.com\"\n    and event.action == \"CreateAccessKey\"\n    and event.outcome == \"success\"\n    and user.name != user.target.name\n| keep\n    @timestamp,\n    cloud.region,\n    event.provider,\n    event.action,\n    event.outcome,\n    user.name,\n    source.address,\n    user.target.name,\n    user_agent.original,\n    aws.cloudtrail.request_parameters,\n    aws.cloudtrail.response_elements,\n    aws.cloudtrail.user_identity.arn,\n    aws.cloudtrail.user_identity.type\n"
      },
      {
        "name": "File Compressed or Archived into Common Format",
        "description": "Detects files being compressed or archived into common formats. This is a common technique used to obfuscate files to evade detection or to staging data for exfiltration.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 5,
        "tags": [
          "Data Source: Elastic Defend",
          "Domain: Endpoint",
          "OS: macOS",
          "OS: Windows",
          "Tactic: Collection",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://en.wikipedia.org/wiki/List_of_file_signatures"
        ],
        "max_signals": 1000,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0009",
              "name": "Collection",
              "reference": "https://attack.mitre.org/tactics/TA0009/"
            },
            "technique": [
              {
                "id": "T1074",
                "name": "Data Staged",
                "reference": "https://attack.mitre.org/techniques/T1074/",
                "subtechnique": [
                  {
                    "id": "T1074.001",
                    "name": "Local Data Staging",
                    "reference": "https://attack.mitre.org/techniques/T1074/001/"
                  }
                ]
              },
              {
                "id": "T1560",
                "name": "Archive Collected Data",
                "reference": "https://attack.mitre.org/techniques/T1560/",
                "subtechnique": [
                  {
                    "id": "T1560.001",
                    "name": "Archive via Utility",
                    "reference": "https://attack.mitre.org/techniques/T1560/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1132",
                "name": "Data Encoding",
                "reference": "https://attack.mitre.org/techniques/T1132/",
                "subtechnique": [
                  {
                    "id": "T1132.001",
                    "name": "Standard Encoding",
                    "reference": "https://attack.mitre.org/techniques/T1132/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1027",
                "name": "Obfuscated Files or Information",
                "reference": "https://attack.mitre.org/techniques/T1027/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.header_bytes",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.subject_name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "434e9791-fb28-4155-a3ff-37a2e8ce4207",
        "rule_id": "79124edf-30a8-4d48-95c4-11522cad94b1",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.071Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.071Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"windows\" and event.type in (\"creation\", \"change\") and process.executable != null and not user.id : (\"S-1-5-18\", \"S-1-5-17\") and\n file.Ext.header_bytes : (\n                          /* compression formats */\n                          \"1F9D*\",             /* tar zip, tar.z (Lempel-Ziv-Welch algorithm) */\n                          \"1FA0*\",             /* tar zip, tar.z (LZH algorithm) */\n                          \"425A68*\",           /* Bzip2 */\n                          \"524E4301*\",         /* Rob Northen Compression */\n                          \"524E4302*\",         /* Rob Northen Compression */\n                          \"4C5A4950*\",         /* LZIP */\n                          \"504B0*\",            /* ZIP */\n                          \"526172211A07*\",     /* RAR compressed */\n                          \"44434D0150413330*\", /* Windows Update Binary Delta Compression file */\n                          \"50413330*\",         /* Windows Update Binary Delta Compression file */\n                          \"377ABCAF271C*\",     /* 7-Zip */\n                          \"1F8B*\",             /* GZIP */\n                          \"FD377A585A00*\",     /* XZ, tar.xz */\n                          \"7801*\",\t           /* zlib: No Compression (no preset dictionary) */\n                          \"785E*\",\t           /* zlib: Best speed (no preset dictionary) */\n                          \"789C*\",\t           /* zlib: Default Compression (no preset dictionary) */\n                          \"78DA*\", \t           /* zlib: Best Compression (no preset dictionary) */\n                          \"7820*\",\t           /* zlib: No Compression (with preset dictionary) */\n                          \"787D*\",\t           /* zlib: Best speed (with preset dictionary) */\n                          \"78BB*\",\t           /* zlib: Default Compression (with preset dictionary) */\n                          \"78F9*\",\t           /* zlib: Best Compression (with preset dictionary) */\n                          \"62767832*\",         /* LZFSE */\n                          \"28B52FFD*\",         /* Zstandard, zst */\n                          \"5253564B44415441*\", /* QuickZip rs compressed archive */\n                          \"2A2A4143452A2A*\",   /* ACE */\n\n                          /* archive formats */\n                          \"2D686C302D*\",       /* lzh */\n                          \"2D686C352D*\",       /* lzh */\n                          \"303730373037*\",     /* cpio */\n                          \"78617221*\",         /* xar */\n                          \"4F4152*\",           /* oar */\n                          \"49536328*\"          /* cab archive */\n ) and\n not (\n   (\n     process.name : \"firefox.exe\" and\n     process.code_signature.subject_name : \"Mozilla Corporation\" and process.code_signature.trusted == true\n   ) or\n   (\n     process.name : \"wazuh-agent.exe\" and\n     process.code_signature.subject_name : \"Wazuh, Inc\" and process.code_signature.trusted == true and\n     file.name : (\"ossec-*.log.gz\", \"tmp-entry.gz\", \"tmp-entry\", \"last-entry.gz\")\n   ) or\n   (\n     process.name : (\"excel.exe\", \"winword.exe\", \"powerpnt.exe\") and\n     process.code_signature.subject_name : \"Microsoft Corporation\" and process.code_signature.trusted == true\n   ) or\n   (\n     process.name : \"OneDrive.exe\" and\n     process.code_signature.subject_name : \"Microsoft Corporation\" and process.code_signature.trusted == true and\n     (\n      file.extension : (\"xlsx\", \"docx\", \"pptx\", \"xlsm\") or\n      file.path : \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\logs\\\\*\"\n     )\n   ) or\n   (\n     process.name : \"Dropbox.exe\" and\n     process.code_signature.subject_name : \"Dropbox, Inc\" and process.code_signature.trusted == true and\n     file.name : \"store.bin\"\n   ) or\n   (\n     process.name : \"DellSupportAssistRemedationService.exe\" and\n     process.code_signature.subject_name : \"Dell Inc\" and process.code_signature.trusted == true and\n     file.extension : \"manifest\"\n   ) or\n   (\n     process.name : \"w3wp.exe\" and\n     process.code_signature.subject_name : \"Microsoft Windows\" and process.code_signature.trusted == true and\n     file.path : \"?:\\\\inetpub\\\\temp\\\\IIS Temporary Compressed Files\\\\*\"\n   )\n )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file-*"
        ]
      },
      {
        "name": "Potential Masquerading as System32 Executable",
        "description": "Identifies suspicious instances of default system32 executables, either unsigned or signed with non-MS certificates. This could indicate the attempt to masquerade as system executables or backdoored and resigned legitimate executables.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 5,
        "tags": [
          "Domain: Endpoint",
          "Data Source: Elastic Defend",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Tactic: Persistence",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.001",
                    "name": "Invalid Code Signature",
                    "reference": "https://attack.mitre.org/techniques/T1036/001/"
                  },
                  {
                    "id": "T1036.005",
                    "name": "Match Legitimate Name or Location",
                    "reference": "https://attack.mitre.org/techniques/T1036/005/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1554",
                "name": "Compromise Host Software Binary",
                "reference": "https://attack.mitre.org/techniques/T1554/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.exists",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.code_signature.status",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.subject_name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "8f7df4c2-f7af-48ee-b328-a84ade2f60b8",
        "rule_id": "79ce2c96-72f7-44f9-88ef-60fa1ac2ce47",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.081Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.081Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and \n  (process.code_signature.status : \"?*\" or process.code_signature.exists != null) and\n  process.name: (\n      \"agentactivationruntimestarter.exe\", \"agentservice.exe\", \"aitstatic.exe\", \"alg.exe\", \"apphostregistrationverifier.exe\", \"appidcertstorecheck.exe\", \"appidpolicyconverter.exe\", \"appidtel.exe\", \"applicationframehost.exe\", \"applysettingstemplatecatalog.exe\", \"applytrustoffline.exe\", \"approvechildrequest.exe\", \"appvclient.exe\", \"appvdllsurrogate.exe\", \"appvnice.exe\", \"appvshnotify.exe\", \"arp.exe\", \"assignedaccessguard.exe\", \"at.exe\", \"atbroker.exe\", \"attrib.exe\", \"audiodg.exe\", \"auditpol.exe\", \"authhost.exe\", \"autochk.exe\", \"autoconv.exe\", \"autofmt.exe\", \"axinstui.exe\", \"baaupdate.exe\", \"backgroundtaskhost.exe\", \"backgroundtransferhost.exe\", \"bcdboot.exe\", \"bcdedit.exe\", \"bdechangepin.exe\", \"bdehdcfg.exe\", \"bdeuisrv.exe\", \"bdeunlock.exe\", \"bioiso.exe\", \"bitlockerdeviceencryption.exe\", \"bitlockerwizard.exe\", \"bitlockerwizardelev.exe\", \"bitsadmin.exe\", \"bootcfg.exe\", \"bootim.exe\", \"bootsect.exe\", \"bridgeunattend.exe\", \"browserexport.exe\", \"browser_broker.exe\", \"bthudtask.exe\", \"bytecodegenerator.exe\", \"cacls.exe\", \"calc.exe\", \"camerasettingsuihost.exe\", \"castsrv.exe\", \"certenrollctrl.exe\", \"certreq.exe\", \"certutil.exe\", \"change.exe\", \"changepk.exe\", \"charmap.exe\", \"checknetisolation.exe\", \"chglogon.exe\", \"chgport.exe\", \"chgusr.exe\", \"chkdsk.exe\", \"chkntfs.exe\", \"choice.exe\", \"cidiag.exe\", \"cipher.exe\", \"cleanmgr.exe\", \"cliconfg.exe\", \"clip.exe\", \"clipup.exe\", \"cloudexperiencehostbroker.exe\", \"cloudnotifications.exe\", \"cmd.exe\", \"cmdkey.exe\", \"cmdl32.exe\", \"cmmon32.exe\", \"cmstp.exe\", \"cofire.exe\", \"colorcpl.exe\", \"comp.exe\", \"compact.exe\", \"compattelrunner.exe\", \"compmgmtlauncher.exe\", \"comppkgsrv.exe\", \"computerdefaults.exe\", \"conhost.exe\", \"consent.exe\", \"control.exe\", \"convert.exe\", \"convertvhd.exe\", \"coredpussvr.exe\", \"credentialenrollmentmanager.exe\", \"credentialuibroker.exe\", \"credwiz.exe\", \"cscript.exe\", \"csrss.exe\", \"ctfmon.exe\", \"cttune.exe\", \"cttunesvr.exe\", \"custominstallexec.exe\", \"customshellhost.exe\", \"dashost.exe\", \"dataexchangehost.exe\", \"datastorecachedumptool.exe\", \"dccw.exe\", \"dcomcnfg.exe\", \"ddodiag.exe\", \"defrag.exe\", \"deploymentcsphelper.exe\", \"desktopimgdownldr.exe\", \"devicecensus.exe\", \"devicecredentialdeployment.exe\", \"deviceeject.exe\", \"deviceenroller.exe\", \"devicepairingwizard.exe\", \"deviceproperties.exe\", \"dfdwiz.exe\", \"dfrgui.exe\", \"dialer.exe\", \"directxdatabaseupdater.exe\", \"diskpart.exe\", \"diskperf.exe\", \"diskraid.exe\", \"disksnapshot.exe\", \"dism.exe\", \"dispdiag.exe\", \"displayswitch.exe\", \"djoin.exe\", \"dllhost.exe\", \"dllhst3g.exe\", \"dmcertinst.exe\", \"dmcfghost.exe\", \"dmclient.exe\", \"dmnotificationbroker.exe\", \"dmomacpmo.exe\", \"dnscacheugc.exe\", \"doskey.exe\", \"dpapimig.exe\", \"dpiscaling.exe\", \"dpnsvr.exe\", \"driverquery.exe\", \"drvinst.exe\", \"dsmusertask.exe\", \"dsregcmd.exe\", \"dstokenclean.exe\", \"dusmtask.exe\", \"dvdplay.exe\", \"dwm.exe\", \"dwwin.exe\", \"dxdiag.exe\", \"dxgiadaptercache.exe\", \"dxpserver.exe\", \"eap3host.exe\", \"easeofaccessdialog.exe\", \"easinvoker.exe\", \"easpolicymanagerbrokerhost.exe\", \"edpcleanup.exe\", \"edpnotify.exe\", \"eduprintprov.exe\", \"efsui.exe\", \"ehstorauthn.exe\", \"eoaexperiences.exe\", \"esentutl.exe\", \"eudcedit.exe\", \"eventcreate.exe\", \"eventvwr.exe\", \"expand.exe\", \"extrac32.exe\", \"fc.exe\", \"fclip.exe\", \"fhmanagew.exe\", \"filehistory.exe\", \"find.exe\", \"findstr.exe\", \"finger.exe\", \"fixmapi.exe\", \"fltmc.exe\", \"fodhelper.exe\", \"fondue.exe\", \"fontdrvhost.exe\", \"fontview.exe\", \"forfiles.exe\", \"fsavailux.exe\", \"fsiso.exe\", \"fsquirt.exe\", \"fsutil.exe\", \"ftp.exe\", \"fvenotify.exe\", \"fveprompt.exe\", \"gamebarpresencewriter.exe\", \"gamepanel.exe\", \"genvalobj.exe\", \"getmac.exe\", \"gpresult.exe\", \"gpscript.exe\", \"gpupdate.exe\", \"grpconv.exe\", \"hdwwiz.exe\", \"help.exe\", \"hostname.exe\", \"hvax64.exe\", \"hvix64.exe\", \"hvsievaluator.exe\", \"icacls.exe\", \"icsentitlementhost.exe\", \"icsunattend.exe\", \"ie4uinit.exe\", \"ie4ushowie.exe\", \"iesettingsync.exe\", \"ieunatt.exe\", \"iexpress.exe\", \"immersivetpmvscmgrsvr.exe\", \"infdefaultinstall.exe\", \"inputswitchtoasthandler.exe\", \"iotstartup.exe\", \"ipconfig.exe\", \"iscsicli.exe\", \"iscsicpl.exe\", \"isoburn.exe\", \"klist.exe\", \"ksetup.exe\", \"ktmutil.exe\", \"label.exe\", \"languagecomponentsinstallercomhandler.exe\", \"launchtm.exe\", \"launchwinapp.exe\", \"legacynetuxhost.exe\", \"licensemanagershellext.exe\", \"licensingdiag.exe\", \"licensingui.exe\", \"locationnotificationwindows.exe\", \"locator.exe\", \"lockapphost.exe\", \"lockscreencontentserver.exe\", \"lodctr.exe\", \"logagent.exe\", \"logman.exe\", \"logoff.exe\", \"logonui.exe\", \"lpkinstall.exe\", \"lpksetup.exe\", \"lpremove.exe\", \"lsaiso.exe\", \"lsass.exe\", \"magnify.exe\", \"makecab.exe\", \"manage-bde.exe\", \"mavinject.exe\", \"mbaeparsertask.exe\", \"mblctr.exe\", \"mbr2gpt.exe\", \"mcbuilder.exe\", \"mdeserver.exe\", \"mdmagent.exe\", \"mdmappinstaller.exe\", \"mdmdiagnosticstool.exe\", \"mdres.exe\", \"mdsched.exe\", \"mfpmp.exe\", \"microsoft.uev.cscunpintool.exe\", \"microsoft.uev.synccontroller.exe\", \"microsoftedgebchost.exe\", \"microsoftedgecp.exe\", \"microsoftedgedevtools.exe\", \"microsoftedgesh.exe\", \"mmc.exe\", \"mmgaserver.exe\", \"mobsync.exe\", \"mountvol.exe\", \"mousocoreworker.exe\", \"mpnotify.exe\", \"mpsigstub.exe\", \"mrinfo.exe\", \"mschedexe.exe\", \"msconfig.exe\", \"msdt.exe\", \"msdtc.exe\", \"msfeedssync.exe\", \"msg.exe\", \"mshta.exe\", \"msiexec.exe\", \"msinfo32.exe\", \"mspaint.exe\", \"msra.exe\", \"msspellcheckinghost.exe\", \"mstsc.exe\", \"mtstocom.exe\", \"muiunattend.exe\", \"multidigimon.exe\", \"musnotification.exe\", \"musnotificationux.exe\", \"musnotifyicon.exe\", \"narrator.exe\", \"nbtstat.exe\", \"ndadmin.exe\", \"ndkping.exe\", \"net.exe\", \"net1.exe\", \"netbtugc.exe\", \"netcfg.exe\", \"netcfgnotifyobjecthost.exe\", \"netevtfwdr.exe\", \"nethost.exe\", \"netiougc.exe\", \"netplwiz.exe\", \"netsh.exe\", \"netstat.exe\", \"newdev.exe\", \"ngciso.exe\", \"nltest.exe\", \"notepad.exe\", \"nslookup.exe\", \"ntoskrnl.exe\", \"ntprint.exe\", \"odbcad32.exe\", \"odbcconf.exe\", \"ofdeploy.exe\", \"omadmclient.exe\", \"omadmprc.exe\", \"openfiles.exe\", \"openwith.exe\", \"optionalfeatures.exe\", \"osk.exe\", \"pacjsworker.exe\", \"packagedcwalauncher.exe\", \"packageinspector.exe\", \"passwordonwakesettingflyout.exe\", \"pathping.exe\", \"pcalua.exe\", \"pcaui.exe\", \"pcwrun.exe\", \"perfmon.exe\", \"phoneactivate.exe\", \"pickerhost.exe\", \"pinenrollmentbroker.exe\", \"ping.exe\", \"pkgmgr.exe\", \"pktmon.exe\", \"plasrv.exe\", \"pnpunattend.exe\", \"pnputil.exe\", \"poqexec.exe\", \"pospaymentsworker.exe\", \"powercfg.exe\", \"presentationhost.exe\", \"presentationsettings.exe\", \"prevhost.exe\", \"printbrmui.exe\", \"printfilterpipelinesvc.exe\", \"printisolationhost.exe\", \"printui.exe\", \"proquota.exe\", \"provlaunch.exe\", \"provtool.exe\", \"proximityuxhost.exe\", \"prproc.exe\", \"psr.exe\", \"pwlauncher.exe\", \"qappsrv.exe\", \"qprocess.exe\", \"query.exe\", \"quser.exe\", \"qwinsta.exe\", \"rasautou.exe\", \"rasdial.exe\", \"raserver.exe\", \"rasphone.exe\", \"rdpclip.exe\", \"rdpinit.exe\", \"rdpinput.exe\", \"rdpsa.exe\", \"rdpsaproxy.exe\", \"rdpsauachelper.exe\", \"rdpshell.exe\", \"rdpsign.exe\", \"rdrleakdiag.exe\", \"reagentc.exe\", \"recdisc.exe\", \"recover.exe\", \"recoverydrive.exe\", \"refsutil.exe\", \"reg.exe\", \"regedt32.exe\", \"regini.exe\", \"register-cimprovider.exe\", \"regsvr32.exe\", \"rekeywiz.exe\", \"relog.exe\", \"relpost.exe\", \"remoteapplifetimemanager.exe\", \"remoteposworker.exe\", \"repair-bde.exe\", \"replace.exe\", \"reset.exe\", \"resetengine.exe\", \"resmon.exe\", \"rmactivate.exe\", \"rmactivate_isv.exe\", \"rmactivate_ssp.exe\", \"rmactivate_ssp_isv.exe\", \"rmclient.exe\", \"rmttpmvscmgrsvr.exe\", \"robocopy.exe\", \"route.exe\", \"rpcping.exe\", \"rrinstaller.exe\", \"rstrui.exe\", \"runas.exe\", \"rundll32.exe\", \"runexehelper.exe\", \"runlegacycplelevated.exe\", \"runonce.exe\", \"runtimebroker.exe\", \"rwinsta.exe\", \"sc.exe\", \"schtasks.exe\", \"scriptrunner.exe\", \"sdbinst.exe\", \"sdchange.exe\", \"sdclt.exe\", \"sdiagnhost.exe\", \"searchfilterhost.exe\", \"searchindexer.exe\", \"searchprotocolhost.exe\", \"secedit.exe\", \"secinit.exe\", \"securekernel.exe\", \"securityhealthhost.exe\", \"securityhealthservice.exe\", \"securityhealthsystray.exe\", \"sensordataservice.exe\", \"services.exe\", \"sessionmsg.exe\", \"sethc.exe\", \"setspn.exe\", \"settingsynchost.exe\", \"setupcl.exe\", \"setupugc.exe\", \"setx.exe\", \"sfc.exe\", \"sgrmbroker.exe\", \"sgrmlpac.exe\", \"shellappruntime.exe\", \"shrpubw.exe\", \"shutdown.exe\", \"sigverif.exe\", \"sihclient.exe\", \"sihost.exe\", \"slidetoshutdown.exe\", \"slui.exe\", \"smartscreen.exe\", \"smss.exe\", \"sndvol.exe\", \"snippingtool.exe\", \"snmptrap.exe\", \"sort.exe\", \"spaceagent.exe\", \"spaceman.exe\", \"spatialaudiolicensesrv.exe\", \"spectrum.exe\", \"spoolsv.exe\", \"sppextcomobj.exe\", \"sppsvc.exe\", \"srdelayed.exe\", \"srtasks.exe\", \"stordiag.exe\", \"subst.exe\", \"svchost.exe\", \"sxstrace.exe\", \"syncappvpublishingserver.exe\", \"synchost.exe\", \"sysreseterr.exe\", \"systeminfo.exe\", \"systempropertiesadvanced.exe\", \"systempropertiescomputername.exe\", \"systempropertiesdataexecutionprevention.exe\", \"systempropertieshardware.exe\", \"systempropertiesperformance.exe\", \"systempropertiesprotection.exe\", \"systempropertiesremote.exe\", \"systemreset.exe\", \"systemsettingsadminflows.exe\", \"systemsettingsbroker.exe\", \"systemsettingsremovedevice.exe\", \"systemuwplauncher.exe\", \"systray.exe\", \"tabcal.exe\", \"takeown.exe\", \"tapiunattend.exe\", \"tar.exe\", \"taskhostw.exe\", \"taskkill.exe\", \"tasklist.exe\", \"taskmgr.exe\", \"tcblaunch.exe\", \"tcmsetup.exe\", \"tcpsvcs.exe\", \"thumbnailextractionhost.exe\", \"tieringengineservice.exe\", \"timeout.exe\", \"tokenbrokercookies.exe\", \"tpminit.exe\", \"tpmtool.exe\", \"tpmvscmgr.exe\", \"tpmvscmgrsvr.exe\", \"tracerpt.exe\", \"tracert.exe\", \"tscon.exe\", \"tsdiscon.exe\", \"tskill.exe\", \"tstheme.exe\", \"tswbprxy.exe\", \"ttdinject.exe\", \"tttracer.exe\", \"typeperf.exe\", \"tzsync.exe\", \"tzutil.exe\", \"ucsvc.exe\", \"uevagentpolicygenerator.exe\", \"uevappmonitor.exe\", \"uevtemplatebaselinegenerator.exe\", \"uevtemplateconfigitemgenerator.exe\", \"uimgrbroker.exe\", \"unlodctr.exe\", \"unregmp2.exe\", \"upfc.exe\", \"upgraderesultsui.exe\", \"upnpcont.exe\", \"upprinterinstaller.exe\", \"useraccountbroker.exe\", \"useraccountcontrolsettings.exe\", \"userinit.exe\", \"usoclient.exe\", \"utcdecoderhost.exe\", \"utilman.exe\", \"vaultcmd.exe\", \"vds.exe\", \"vdsldr.exe\", \"verclsid.exe\", \"verifier.exe\", \"verifiergui.exe\", \"vssadmin.exe\", \"vssvc.exe\", \"w32tm.exe\", \"waasmedicagent.exe\", \"waitfor.exe\", \"wallpaperhost.exe\", \"wbadmin.exe\", \"wbengine.exe\", \"wecutil.exe\", \"werfault.exe\", \"werfaultsecure.exe\", \"wermgr.exe\", \"wevtutil.exe\", \"wextract.exe\", \"where.exe\", \"whoami.exe\", \"wiaacmgr.exe\", \"wiawow64.exe\", \"wifitask.exe\", \"wimserv.exe\", \"winbiodatamodeloobe.exe\", \"windows.media.backgroundplayback.exe\", \"windows.warp.jitservice.exe\", \"windowsactiondialog.exe\", \"windowsupdateelevatedinstaller.exe\", \"wininit.exe\", \"winload.exe\", \"winlogon.exe\", \"winresume.exe\", \"winrs.exe\", \"winrshost.exe\", \"winrtnetmuahostserver.exe\", \"winsat.exe\", \"winver.exe\", \"wkspbroker.exe\", \"wksprt.exe\", \"wlanext.exe\", \"wlrmdr.exe\", \"wmpdmc.exe\", \"workfolders.exe\", \"wowreg32.exe\", \"wpcmon.exe\", \"wpctok.exe\", \"wpdshextautoplay.exe\", \"wpnpinst.exe\", \"wpr.exe\", \"write.exe\", \"wscadminui.exe\", \"wscollect.exe\", \"wscript.exe\", \"wsl.exe\", \"wsmanhttpconfig.exe\", \"wsmprovhost.exe\", \"wsqmcons.exe\", \"wsreset.exe\", \"wuapihost.exe\", \"wuauclt.exe\", \"wudfcompanionhost.exe\", \"wudfhost.exe\", \"wusa.exe\", \"wwahost.exe\", \"xblgamesavetask.exe\", \"xcopy.exe\", \"xwizard.exe\", \"aggregatorhost.exe\", \"diskusage.exe\", \"dtdump.exe\", \"ism.exe\", \"ndkperfcmd.exe\", \"ntkrla57.exe\", \"securekernella57.exe\", \"spaceutil.exe\", \"configure-smremoting.exe\", \"dcgpofix.exe\", \"dcpromo.exe\", \"dimc.exe\", \"diskshadow.exe\", \"drvcfg.exe\", \"escunattend.exe\", \"iashost.exe\", \"ktpass.exe\", \"lbfoadmin.exe\", \"netdom.exe\", \"rdspnf.exe\", \"rsopprov.exe\", \"sacsess.exe\", \"servermanager.exe\", \"servermanagerlauncher.exe\", \"setres.exe\", \"tsecimp.exe\", \"vssuirun.exe\", \"webcache.exe\", \"win32calc.exe\", \"certoc.exe\", \"sdndiagnosticstask.exe\", \"xpsrchvw.exe\"\n    ) and\n  not (\n    process.code_signature.subject_name in (\n      \"Microsoft Windows\",\n      \"Microsoft Corporation\",\n      \"Microsoft Windows Publisher\"\n    ) and process.code_signature.trusted == true\n  ) and not process.code_signature.status: (\"errorCode_endpoint*\", \"errorUntrustedRoot\", \"errorChaining\") and\n  not\n  (\n    process.executable: (\n      \"?:\\\\Program Files\\\\Git\\\\usr\\\\bin\\\\hostname.exe\",\n      \"?:\\\\Windows\\\\Temp\\\\{*}\\\\taskkill.exe\",\n      \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\{*}\\\\taskkill.exe\",\n      \"?:\\\\$WINDOWS.~BT\\\\NewOS\\\\Windows\\\\System32\\\\ie4ushowIE.exe\",\n      \"?:\\\\Program Files\\\\Git\\\\usr\\\\bin\\\\find.exe\",\n      \"?:\\\\Program Files (x86)\\\\Axence\\\\nVision Agent 2\\\\nss\\\\certutil.exe\"\n    )\n  ) and\n  not\n  (\n    (process.name: \"ucsvc.exe\" and process.code_signature.subject_name == \"Wellbia.com Co., Ltd.\" and process.code_signature.status: \"trusted\") or\n    (process.name: \"pnputil.exe\" and process.code_signature.subject_name: (\"Lenovo\", \"HP Inc.\", \"Dell Inc\") and process.code_signature.status: \"trusted\") or\n    (process.name: \"convert.exe\" and process.code_signature.subject_name: \"ImageMagick Studio LLC\" and process.code_signature.status: \"trusted\") or\n    (process.name: \"systeminfo.exe\" and process.code_signature.subject_name: \"Arctic Wolf Networks, Inc.\" and process.code_signature.status: \"trusted\") or\n    (\n      process.name: \"certutil.exe\" and\n      process.code_signature.subject_name: (\n        \"Intel(R) Online Connect Access\",\n        \"Fortinet Technologies (Canada) ULC\"\n      ) and process.code_signature.status: \"trusted\"\n    ) or\n    (\n      process.name: \"sfc.exe\" and\n      process.code_signature.subject_name: (\n        \"Cisco Systems, Inc.\",\n        \"CISCO SYSTEMS CANADA CO\"\n      ) and process.code_signature.status: \"trusted\"\n    )\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*"
        ]
      },
      {
        "name": "Potential WSUS Abuse for Lateral Movement",
        "description": "Identifies a potential Windows Server Update Services (WSUS) abuse to execute psexec to enable for lateral movement. WSUS is limited to executing Microsoft signed binaries, which limits the executables that can be used to tools published by Microsoft.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 205,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Lateral Movement",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon",
          "Data Source: SentinelOne",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: System",
          "Data Source: Crowdstrike"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.thehacker.recipes/a-d/movement/mitm-and-coerced-authentications/wsus-spoofing"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1210",
                "name": "Exploitation of Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1210/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "crowdstrike",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pe.original_file_name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "7d4606f8-68bc-4072-9428-a0f213d62785",
        "rule_id": "8e2485b6-a74f-411b-bf7f-38b819f3a846",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.085Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.085Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and process.parent.name : \"wuauclt.exe\" and\nprocess.executable : (\n    \"?:\\\\Windows\\\\SoftwareDistribution\\\\Download\\\\Install\\\\*\",\n    \"\\\\Device\\\\HarddiskVolume?\\\\Windows\\\\SoftwareDistribution\\\\Download\\\\Install\\\\*\"\n) and\n(process.name : \"psexec64.exe\" or ?process.pe.original_file_name : \"psexec.c\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-m365_defender.event-*",
          "logs-system.security-*",
          "winlogbeat-*",
          "logs-crowdstrike.fdr*"
        ]
      },
      {
        "name": "Bitsadmin Activity",
        "description": "Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism. Adversaries may abuse BITS to persist, download, execute, and even clean up after running malicious code.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 105,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Command and Control",
          "Data Source: Elastic Defend",
          "Rule Type: BBR",
          "Data Source: Sysmon",
          "Data Source: Elastic Endgame",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1105",
                "name": "Ingress Tool Transfer",
                "reference": "https://attack.mitre.org/techniques/T1105/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1197",
                "name": "BITS Jobs",
                "reference": "https://attack.mitre.org/techniques/T1197/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1197",
                "name": "BITS Jobs",
                "reference": "https://attack.mitre.org/techniques/T1197/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "aa6dc3ba-38ec-46bd-8d62-9e60611390c0",
        "rule_id": "8eec4df1-4b4b-4502-b6c3-c788714604c9",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.089Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.089Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  (\n   (process.name : \"bitsadmin.exe\" and process.args : (\n        \"*Transfer*\", \"*Create*\", \"AddFile\", \"*SetNotifyFlags*\", \"*SetNotifyCmdLine*\",\n        \"*SetMinRetryDelay*\", \"*SetCustomHeaders*\", \"*Resume*\")\n   ) or\n   (process.name : \"powershell.exe\" and process.args : (\n        \"*Start-BitsTransfer*\", \"*Add-BitsFile*\",\n        \"*Resume-BitsTransfer*\", \"*Set-BitsTransfer*\", \"*BITS.Manager*\")\n   )\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-system.security*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "Unusual Process Spawned by a Host",
        "description": "A machine learning job has detected a suspicious Windows process. This process has been classified as suspicious in two ways. It was predicted to be suspicious by the ProblemChild supervised ML model, and it was found to be an unusual process, on a host that does not commonly manifest malicious activity. Such a process may be an instance of suspicious or malicious activity, possibly involving LOLbins, that may be resistant to detection using conventional search rules.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 107,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Living off the Land Attack Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-45m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/problemchild",
          "https://www.elastic.co/security-labs/detecting-living-off-the-land-attacks-with-new-elastic-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Living off the Land (LotL) Attack Detection integration assets to be installed, as well as Windows process events collected by integrations such as Elastic Defend or Winlogbeat.  \n\n### LotL Attack Detection Setup\nThe LotL Attack Detection integration detects living-off-the-land activity in Windows process events.\n\n#### Prerequisite Requirements:\n- Fleet is required for LotL Attack Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Windows process events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration or Winlogbeat(https://www.elastic.co/guide/en/beats/winlogbeat/current/_winlogbeat_overview.html).\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To set up and run Winlogbeat, follow [this](https://www.elastic.co/guide/en/beats/winlogbeat/current/winlogbeat-installation-configuration.html) guide.\n\n#### The following steps should be executed to install assets associated with the LotL Attack Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Living off the Land Attack Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "problemchild",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [],
        "id": "7ea6d760-c350-4dfb-b830-023330af33a5",
        "rule_id": "56004189-4e69-4a39-b4a9-195329d226e9",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.095Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.095Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 75,
        "machine_learning_job_id": [
          "problem_child_rare_process_by_host"
        ]
      },
      {
        "name": "Unusual Process Spawned by a User",
        "description": "A machine learning job has detected a suspicious Windows process. This process has been classified as malicious in two ways. It was predicted to be malicious by the ProblemChild supervised ML model, and it was found to be suspicious given that its user context is unusual and does not commonly manifest malicious activity,by an unsupervised ML model. Such a process may be an instance of suspicious or malicious activity, possibly involving LOLbins, that may be resistant to detection using conventional search rules.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 107,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Living off the Land Attack Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-45m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/problemchild",
          "https://www.elastic.co/security-labs/detecting-living-off-the-land-attacks-with-new-elastic-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Living off the Land (LotL) Attack Detection integration assets to be installed, as well as Windows process events collected by integrations such as Elastic Defend or Winlogbeat.  \n\n### LotL Attack Detection Setup\nThe LotL Attack Detection integration detects living-off-the-land activity in Windows process events.\n\n#### Prerequisite Requirements:\n- Fleet is required for LotL Attack Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Windows process events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration or Winlogbeat(https://www.elastic.co/guide/en/beats/winlogbeat/current/_winlogbeat_overview.html).\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To set up and run Winlogbeat, follow [this](https://www.elastic.co/guide/en/beats/winlogbeat/current/winlogbeat-installation-configuration.html) guide.\n\n#### The following steps should be executed to install assets associated with the LotL Attack Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Living off the Land Attack Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "problemchild",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [],
        "id": "2d4e6712-9b65-4c39-835d-252e6cfd0cb6",
        "rule_id": "40155ee4-1e6a-4e4d-a63b-e8ba16980cfb",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.099Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.099Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 75,
        "machine_learning_job_id": [
          "problem_child_rare_process_by_user"
        ]
      },
      {
        "name": "Potential Evasion via Windows Filtering Platform",
        "description": "Identifies multiple Windows Filtering Platform block events and where the process name is related to an endpoint security software. Adversaries may add malicious WFP rules to prevent Endpoint security from sending telemetry.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 104,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/dsnezhkov/shutter/tree/main",
          "https://github.com/netero1010/EDRSilencer/tree/main",
          "https://www.mdsec.co.uk/2023/09/nighthawk-0-2-6-three-wise-monkeys/",
          "https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5157",
          "https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5152"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1562",
                "name": "Impair Defenses",
                "reference": "https://attack.mitre.org/techniques/T1562/",
                "subtechnique": [
                  {
                    "id": "T1562.004",
                    "name": "Disable or Modify System Firewall",
                    "reference": "https://attack.mitre.org/techniques/T1562/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe 'Filtering Platform Connection' logging policy must be configured for (Success, Failure).\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nPolicies >\nWindows Settings >\nSecurity Settings >\nAdvanced Audit Policies Configuration >\nAudit Policies >\nObject Access >\nFiltering Platform Connection (Success,Failure)\n```\n",
        "related_integrations": [
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "winlog.computer_name",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "13d8b45a-8315-4802-ad7a-68dc3a9f0b6e",
        "rule_id": "92d3a04e-6487-4b62-892d-70e640a590dc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.092Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.092Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by winlog.computer_name with maxspan=1m\n [network where host.os.type == \"windows\" and \n  event.action : (\"windows-firewall-packet-block\", \"windows-firewall-packet-drop\") and \n  process.name : (\n        \"bdagent.exe\", \"bdreinit.exe\", \"pdscan.exe\", \"pdiface.exe\", \"BDSubWiz.exe\", \"ProductAgentService.exe\",\n        \"ProductAgentUI.exe\", \"WatchDog.exe\", \"CarbonBlackClientSetup.exe\", \"TrGUI.exe\", \"TracCAPI.exe\", \"cpmsi_tool.exe\",\n        \"trac.exe\", \"vna_install64.exe\", \"vna_utils.exe\", \"TracSrvWrapper.exe\", \"vsmon.exe\", \"p95tray.exe\",\n        \"CybereasonRansomFreeServiceHost.exe\", \"CrAmTray.exe\", \"minionhost.exe\", \"CybereasonSensor.exe\", \"CylanceUI.exe\",\n        \"CylanceProtectSetup.exe\", \"cylancesvc.exe\", \"cyupdate.exe\", \"elastic-agent.exe\", \"elastic-endpoint.exe\",\n        \"egui.exe\", \"minodlogin.exe\", \"emu-rep.exe\", \"emu_install.exe\", \"emu-cci.exe\", \"emu-gui.exe\", \"emu-uninstall.exe\",\n        \"ndep.exe\", \"spike.exe\", \"ecls.exe\", \"ecmd.exe\", \"ecomserver.exe\", \"eeclnt.exe\", \"eh64.exe\", \"EHttpSrv.exe\",\n        \"xagt.exe\", \"collectoragent.exe\", \"FSAEConfig.exe\", \"uninstalldcagent.exe\", \"rmon.exe\", \"fccomint.exe\",\n        \"fclanguageselector.exe\", \"fortifw.exe\", \"fcreg.exe\", \"fortitray.exe\", \"fcappdb.exe\", \"fcwizard.exe\", \"submitv.exe\",\n        \"av_task.exe\", \"fortiwf.exe\", \"fortiwadbd.exe\", \"fcauth.exe\", \"fcdblog.exe\", \"fcmgr.exe\", \"fortiwad.exe\",\n        \"fortiproxy.exe\", \"fortiscand.exe\", \"fortivpnst.exe\", \"ipsec.exe\", \"fcwscd7.exe\", \"fcasc.exe\", \"fchelper.exe\",\n        \"forticlient.exe\",\"fcwsc.exe\", \"FortiClient.exe\", \"fmon.exe\", \"FSSOMA.exe\", \"FCVbltScan.exe\", \"FortiESNAC.exe\",\n        \"EPCUserAvatar.exe\", \"FortiAvatar.exe\", \"FortiClient_Diagnostic_Tool.exe\", \"FortiSSLVPNdaemon.exe\", \"avp.exe\",\n        \"FCConfig.exe\", \"avpsus.exe\", \"klnagent.exe\", \"klnsacwsrv.exe\", \"kl_platf.exe\", \"stpass.exe\", \"klnagwds.exe\",\n        \"mbae.exe\", \"mbae64.exe\", \"mbae-svc.exe\", \"mbae-uninstaller.exe\", \"mbaeLoader32.exe\", \"mbaeloader64.exe\",\n        \"mbam-dor.exe\", \"mbamgui.exe\", \"mbamservice.exe\", \"mbamtrayctrl.exe\", \"mbampt.exe\", \"mbamscheduler.exe\",\n        \"Coreinst.exe\", \"mbae-setup.exe\", \"mcupdate.exe\", \"ProtectedModuleHost.exe\", \"ESConfigTool.exe\", \"FWInstCheck.exe\",\n        \"FwWindowsFirewallHandler.exe\", \"mfeesp.exe\", \"mfefw.exe\", \"mfeProvisionModeUtility.exe\", \"mfetp.exe\", \"avpui.exe\", \n        \"WscAVExe.exe\", \"mcshield.exe\", \"McChHost.exe\", \"mfewc.exe\", \"mfewch.exe\", \"mfewcui.exe\", \"fwinfo.exe\",\n        \"mfecanary.exe\", \"mfefire.exe\", \"mfehidin.exe\", \"mfemms.exe\", \"mfevtps.exe\", \"mmsinfo.exe\", \"vtpinfo.exe\",\n        \"MarSetup.exe\", \"mctray.exe\", \"masvc.exe\", \"macmnsvc.exe\", \"McAPExe.exe\", \"McPvTray.exe\", \"mcods.exe\",\n        \"mcuicnt.exe\", \"mcuihost.exe\", \"xtray.exe\", \"McpService.exe\", \"epefprtrainer.exe\", \"mfeffcoreservice.exe\",\n        \"MfeEpeSvc.exe\", \"qualysagent.exe\", \"QualysProxy.exe\", \"QualysAgentUI.exe\", \"SVRTgui.exe\", \"SVRTcli.exe\",\n        \"SVRTcli.exe\", \"SVRTgui.exe\", \"SCTCleanupService.exe\", \"SVRTservice.exe\", \"native.exe\", \"SCTBootTasks.exe\",\n        \"ALMon.exe\", \"SAA.exe\", \"SUMService.exe\", \"ssp.exe\", \"SCFService.exe\", \"SCFManager.exe\", \"spa.exe\", \"cabarc.exe\",\n        \"sargui.exe\", \"sntpservice.exe\", \"McsClient.exe\", \"McsAgent.exe\", \"McsHeartbeat.exe\", \"SAVAdminService.exe\",\n        \"sav32cli.exe\", \"ForceUpdateAlongSideSGN.exe\", \"SAVCleanupService.exe\", \"SavMain.exe\", \"SavProgress.exe\", \n        \"SavProxy.exe\", \"SavService.exe\", \"swc_service.exe\", \"swi_di.exe\", \"swi_service.exe\", \"swi_filter.exe\",\n        \"ALUpdate.exe\", \"SophosUpdate.exe\", \"ALsvc.exe\", \"SophosAlert.exe\", \"osCheck.exe\", \"N360Downloader.exe\",\n        \"InstWrap.exe\", \"symbos.exe\", \"nss.exe\", \"symcorpui.exe\", \"isPwdSvc.exe\", \"ccsvchst.exe\", \"ntrmv.exe\",\n        \"pccntmon.exe\", \"AosUImanager.exe\", \"NTRTScan.exe\", \"TMAS_OL.exe\", \"TMAS_OLImp.exe\", \"TMAS_OLSentry.exe\",\n        \"ufnavi.exe\", \"Clnrbin.exe\", \"vizorhtmldialog.exe\", \"pwmConsole.exe\", \"PwmSvc.exe\", \"coreServiceShell.exe\",\n        \"ds_agent.exe\", \"SfCtlCom.exe\", \"MBAMHelper.exe\", \"cb.exe\", \"smc.exe\", \"tda.exe\", \"xagtnotif.exe\", \"ekrn.exe\",\n        \"dsa.exe\", \"Notifier.exe\", \"rphcp.exe\", \"lc_sensor.exe\", \"CSFalconService.exe\", \"CSFalconController.exe\",\n        \"SenseSampleUploader.exe\", \"windefend.exe\", \"MSASCui.exe\", \"MSASCuiL.exe\", \"msmpeng.exe\", \"msmpsvc.exe\",\n        \"MsSense.exe\", \"esensor.exe\", \"sentinelone.exe\", \"tmccsf.exe\", \"csfalconcontainer.exe\", \"sensecncproxy.exe\",\n        \"splunk.exe\", \"sysmon.exe\", \"sysmon64.exe\", \"taniumclient.exe\"\n    )] with runs=5\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-windows.network-*",
          "logs-system.security*"
        ]
      },
      {
        "name": "Attempted Private Key Access",
        "description": "Attackers may try to access private keys, e.g. ssh, in order to gain further authenticated access to the environment.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 106,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: Elastic Defend",
          "Rule Type: BBR",
          "Data Source: Sysmon",
          "Data Source: Elastic Endgame",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1552",
                "name": "Unsecured Credentials",
                "reference": "https://attack.mitre.org/techniques/T1552/",
                "subtechnique": [
                  {
                    "id": "T1552.004",
                    "name": "Private Keys",
                    "reference": "https://attack.mitre.org/techniques/T1552/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "32abf651-21d0-45b8-adc3-119284c08d70",
        "rule_id": "c55badd3-3e61-4292-836f-56209dc8a601",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.724Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.724Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  process.args : (\"*.pem *\", \"*.pem\", \"*.id_rsa*\") and\n  not process.args: (\"--tls-cert\", \"--ssl-cert\") and\n  not process.executable : (\n    \"?:\\\\ProgramData\\\\Logishrd\\\\LogiOptions\\\\Software\\\\*\\\\LogiLuUpdater.exe\",\n    \"?:\\\\Program Files\\\\Elastic\\\\Agent\\\\data\\\\*\\\\osqueryd.exe\",\n    \"?:\\\\Program Files\\\\Guardicore\\\\gc-controller.exe\",\n    \"?:\\\\Program Files\\\\Guardicore\\\\gc-deception-agent.exe\",\n    \"?:\\\\Program Files\\\\Guardicore\\\\gc-detection-agent.exe\",\n    \"?:\\\\Program Files\\\\Guardicore\\\\gc-enforcement-agent.exe\",\n    \"?:\\\\Program Files\\\\Guardicore\\\\gc-guest-agent.exe\",\n    \"?:\\\\Program Files\\\\Logi\\\\LogiBolt\\\\LogiBoltUpdater.exe\",\n    \"?:\\\\Program Files (x86)\\\\Schneider Electric EcoStruxure\\\\Building Operation 5.0\\\\Device Administrator\\\\Python\\\\python.exe\",\n    \"?:\\\\Program Files\\\\Splunk\\\\bin\\\\openssl.exe\",\n    \"?:\\\\Program Files\\\\SplunkUniversalForwarder\\\\bin\\\\openssl.exe\",\n    \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Logi\\\\LogiBolt\\\\LogiBoltUpdater.exe\",\n    \"?:\\\\Windows\\\\system32\\\\icacls.exe\",\n    \"?:\\\\Windows\\\\System32\\\\OpenSSH\\\\*\"\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-system.security*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "Network Activity Detected via cat",
        "description": "This rule monitors for the execution of the cat command, followed by a connection attempt by the same process. Cat is capable of transfering data via tcp/udp channels by redirecting its read output to a /dev/tcp or /dev/udp channel. This activity is highly suspicious, and should be investigated. Attackers may leverage this capability to transfer tools or files to another host in the network or exfiltrate data while attempting to evade detection in the process.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Network Activity Detected via cat\n\nAttackers may leverage the `cat` utility in conjunction with a listener to read all bytes of a file, and output the content to a `/dev/tcp` or `/dev/udp` channel to transfer/exfiltrate file contents to a remote system. \n\nThis rule looks for a sequence of a `cat` execution event followed by a network connection attempt by the same `cat` process. \n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/master/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n> This investigation guide uses [placeholder fields](https://www.elastic.co/guide/en/security/current/osquery-placeholder-fields.html) to dynamically pass alert data into Osquery queries. Placeholder fields were introduced in Elastic Stack version 8.7.0. If you're using Elastic Stack version 8.6.0 or earlier, you'll need to manually adjust this investigation guide's queries to ensure they properly run.\n\n#### Possible investigation steps\n\n- Identify any signs of suspicious network activity or anomalies that may indicate command and control activity or data exfiltration. This could include unexpected traffic patterns or unusual network behavior.\n  - Investigate listening ports and open sockets to look for potential protocol tunneling, reverse shells, or data exfiltration.\n    - !{osquery{\"label\":\"Osquery - Retrieve Listening Ports\",\"query\":\"SELECT pid, address, port, socket, protocol, path FROM listening_ports\"}}\n    - !{osquery{\"label\":\"Osquery - Retrieve Open Sockets\",\"query\":\"SELECT pid, family, remote_address, remote_port, socket, state FROM process_open_sockets\"}}\n- Identify the user account that performed the action, analyze it, and check whether it should perform this kind of action.\n  - !{osquery{\"label\":\"Osquery - Retrieve Information for a Specific User\",\"query\":\"SELECT * FROM users WHERE username = {{user.name}}\"}}\n- Investigate whether the user is currently logged in and active.\n  - !{osquery{\"label\":\"Osquery - Investigate the Account Authentication Status\",\"query\":\"SELECT * FROM logged_in_users WHERE user = {{user.name}}\"}}\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence and whether they are located in expected locations.\n  - !{osquery{\"label\":\"Osquery - Retrieve Running Processes by User\",\"query\":\"SELECT pid, username, name FROM processes p JOIN users u ON u.uid = p.uid ORDER BY username\"}}\n  - !{osquery{\"label\":\"Osquery - Retrieve Process Info\",\"query\":\"SELECT name, cmdline, parent, path, uid FROM processes\"}}\n- Investigate other alerts associated with the user/host during the past 48 hours.\n  - If scripts or executables were dropped, retrieve the files and determine if they are malicious:\n    - Use a private sandboxed malware analysis system to perform analysis.\n      - Observe and collect information about the following activities:\n        - Attempts to contact external domains and addresses.\n          - Check if the domain is newly registered or unexpected.\n          - Check the reputation of the domain or IP address.\n        - File access, modification, and creation activities.\n\n### Related rules\n\n- Suspicious Network Activity to the Internet by Previously Unknown Executable - 53617418-17b4-4e9c-8a2c-8deb8086ca4b\n\n### False positive analysis\n\n- If this activity is related to new benign software installation activity, consider adding exceptions — preferably with a combination of user and command line conditions.\n- Try to understand the context of the execution by thinking about the user, machine, or business purpose. A small number of endpoints, such as servers with unique software, might appear unusual but satisfy a specific business need.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors, such as reverse shells, reverse proxies, or droppers, that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Leverage the incident response data and logging to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 6,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Command and Control",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": []
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": []
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "5cea01c3-598a-4f33-ad97-2a26d6f3f5af",
        "rule_id": "afd04601-12fc-4149-9b78-9c3f8fe45d39",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:20.720Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:20.720Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, process.entity_id with maxspan=1s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.name == \"cat\" and process.parent.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\")]\n  [network where host.os.type == \"linux\" and event.action in (\"connection_attempted\", \"disconnect_received\") and\n   process.name == \"cat\" and not (destination.ip == null or destination.ip == \"0.0.0.0\" or cidrmatch(\n     destination.ip, \"10.0.0.0/8\", \"127.0.0.0/8\", \"169.254.0.0/16\", \"172.16.0.0/12\", \"192.0.0.0/24\", \"192.0.0.0/29\",\n     \"192.0.0.8/32\", \"192.0.0.9/32\", \"192.0.0.10/32\", \"192.0.0.170/32\", \"192.0.0.171/32\", \"192.0.2.0/24\",\n     \"192.31.196.0/24\", \"192.52.193.0/24\", \"192.168.0.0/16\", \"192.88.99.0/24\", \"224.0.0.0/4\", \"100.64.0.0/10\",\n     \"192.175.48.0/24\",\"198.18.0.0/15\", \"198.51.100.0/24\", \"203.0.113.0/24\", \"240.0.0.0/4\", \"::1\", \"FE80::/10\",\n     \"FF00::/8\"\n     )\n   )]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Suspicious Windows Process Cluster Spawned by a Host",
        "description": "A machine learning job combination has detected a set of one or more suspicious Windows processes with unusually high scores for malicious probability. These process(es) have been classified as malicious in several ways. The process(es) were predicted to be malicious by the ProblemChild supervised ML model. If the anomaly contains a cluster of suspicious processes, each process has the same host name, and the aggregate score of the event cluster was calculated to be unusually high by an unsupervised ML model. Such a cluster often contains suspicious or malicious activity, possibly involving LOLbins, that may be resistant to detection using conventional search rules.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 107,
        "tags": [
          "Use Case: Living off the Land Attack Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-45m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/problemchild",
          "https://www.elastic.co/security-labs/detecting-living-off-the-land-attacks-with-new-elastic-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Living off the Land (LotL) Attack Detection integration assets to be installed, as well as Windows process events collected by integrations such as Elastic Defend or Winlogbeat.  \n\n### LotL Attack Detection Setup\nThe LotL Attack Detection integration detects living-off-the-land activity in Windows process events.\n\n#### Prerequisite Requirements:\n- Fleet is required for LotL Attack Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Windows process events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration or Winlogbeat(https://www.elastic.co/guide/en/beats/winlogbeat/current/_winlogbeat_overview.html).\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To set up and run Winlogbeat, follow [this](https://www.elastic.co/guide/en/beats/winlogbeat/current/winlogbeat-installation-configuration.html) guide.\n\n#### The following steps should be executed to install assets associated with the LotL Attack Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Living off the Land Attack Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "problemchild",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [],
        "id": "6fab640c-e28b-460a-8b48-7736f61b4c7e",
        "rule_id": "bdfebe11-e169-42e3-b344-c5d2015533d3",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.210Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.210Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 75,
        "machine_learning_job_id": [
          "problem_child_high_sum_by_host"
        ]
      },
      {
        "name": "Unusual Process Spawned by a Parent Process",
        "description": "A machine learning job has detected a suspicious Windows process. This process has been classified as malicious in two ways. It was predicted to be malicious by the ProblemChild supervised ML model, and it was found to be an unusual child process name, for the parent process, by an unsupervised ML model. Such a process may be an instance of suspicious or malicious activity, possibly involving LOLbins, that may be resistant to detection using conventional search rules.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 107,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Living off the Land Attack Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-45m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/problemchild",
          "https://www.elastic.co/security-labs/detecting-living-off-the-land-attacks-with-new-elastic-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Living off the Land (LotL) Attack Detection integration assets to be installed, as well as Windows process events collected by integrations such as Elastic Defend or Winlogbeat.  \n\n### LotL Attack Detection Setup\nThe LotL Attack Detection integration detects living-off-the-land activity in Windows process events.\n\n#### Prerequisite Requirements:\n- Fleet is required for LotL Attack Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Windows process events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration or Winlogbeat(https://www.elastic.co/guide/en/beats/winlogbeat/current/_winlogbeat_overview.html).\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To set up and run Winlogbeat, follow [this](https://www.elastic.co/guide/en/beats/winlogbeat/current/winlogbeat-installation-configuration.html) guide.\n\n#### The following steps should be executed to install assets associated with the LotL Attack Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Living off the Land Attack Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "problemchild",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [],
        "id": "e86e76e7-1f45-4115-a845-0b295507d875",
        "rule_id": "ea09ff26-3902-4c53-bb8e-24b7a5d029dd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.214Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.214Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 75,
        "machine_learning_job_id": [
          "problem_child_rare_process_by_parent"
        ]
      },
      {
        "name": "Suspicious Windows Process Cluster Spawned by a Parent Process",
        "description": "A machine learning job combination has detected a set of one or more suspicious Windows processes with unusually high scores for malicious probability. These process(es) have been classified as malicious in several ways. The process(es) were predicted to be malicious by the ProblemChild supervised ML model. If the anomaly contains a cluster of suspicious processes, each process has the same parent process name, and the aggregate score of the event cluster was calculated to be unusually high by an unsupervised ML model. Such a cluster often contains suspicious or malicious activity, possibly involving LOLbins, that may be resistant to detection using conventional search rules.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 107,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Living off the Land Attack Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-45m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/problemchild",
          "https://www.elastic.co/security-labs/detecting-living-off-the-land-attacks-with-new-elastic-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Living off the Land (LotL) Attack Detection integration assets to be installed, as well as Windows process events collected by integrations such as Elastic Defend or Winlogbeat.  \n\n### LotL Attack Detection Setup\nThe LotL Attack Detection integration detects living-off-the-land activity in Windows process events.\n\n#### Prerequisite Requirements:\n- Fleet is required for LotL Attack Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Windows process events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration or Winlogbeat(https://www.elastic.co/guide/en/beats/winlogbeat/current/_winlogbeat_overview.html).\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To set up and run Winlogbeat, follow [this](https://www.elastic.co/guide/en/beats/winlogbeat/current/winlogbeat-installation-configuration.html) guide.\n\n#### The following steps should be executed to install assets associated with the LotL Attack Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Living off the Land Attack Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "problemchild",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [],
        "id": "72b894ea-53d2-431b-b91b-444a95fa56e3",
        "rule_id": "f5d9d36d-7c30-4cdb-a856-9f653c13d4e0",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:21.217Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:21.217Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 75,
        "machine_learning_job_id": [
          "problem_child_high_sum_by_parent"
        ]
      },
      {
        "name": "Multiple Okta User Authentication Events with Same Device Token Hash",
        "description": "Detects when a high number of Okta user authentication events are reported for multiple users in a short time frame. Adversaries may attempt to launch a credential stuffing or password spraying attack from the same device by using a list of known usernames and passwords to gain unauthorized access to user accounts.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Multiple Okta User Authentication Events with Same Device Token Hash\n\nThis rule detects when a high number of Okta user authentication events are reported for multiple users in a short time frame. Adversaries may attempt to launch a credential stuffing attack from the same device by using a list of known usernames and passwords to gain unauthorized access to user accounts. Note that Okta does not log unrecognized usernames supplied during authentication attempts, so this rule may not detect all credential stuffing attempts or may indicate a targeted attack.\n\n#### Possible investigation steps:\n- Since this is an ES|QL rule, the `okta.actor.alternate_id` and `okta.debug_context.debug_data.dt_hash` values can be used to pivot into the raw authentication events related to this activity.\n- Identify the users involved in this action by examining the `okta.actor.id`, `okta.actor.type`, `okta.actor.alternate_id`, and `okta.actor.display_name` fields.\n- Determine the device client used for these actions by analyzing `okta.client.ip`, `okta.client.user_agent.raw_user_agent`, `okta.client.zone`, `okta.client.device`, and `okta.client.id` fields.\n- Review the `okta.security_context.is_proxy` field to determine if the device is a proxy.\n    - If the device is a proxy, this may indicate that a user is using a proxy to access multiple accounts for password spraying.\n- With the list of `okta.actor.alternate_id` values, review `event.outcome` results to determine if the authentication was successful.\n    - If the authentication was successful for any user, pivoting to `event.action` values for those users may provide additional context.\n- With Okta end users identified, review the `okta.debug_context.debug_data.dt_hash` field.\n    - Historical analysis should indicate if this device token hash is commonly associated with the user.\n- Review the `okta.event_type` field to determine the type of authentication event that occurred.\n    - If the event type is `user.authentication.sso`, the user may have legitimately started a session via a proxy for security or privacy reasons.\n    - If the event type is `user.authentication.password`, the user may be using a proxy to access multiple accounts for password spraying.\n- Examine the `okta.outcome.result` field to determine if the authentication was successful.\n- Review the past activities of the actor(s) involved in this action by checking their previous actions.\n- Evaluate the actions that happened just before and after this event in the `okta.event_type` field to help understand the full context of the activity.\n    - This may help determine the authentication and authorization actions that occurred between the user, Okta and application.\n\n### False positive analysis:\n- A user may have legitimately started a session via a proxy for security or privacy reasons.\n- Users may share an endpoint related to work or personal use in which separate Okta accounts are used.\n    - Architecturally, this shared endpoint may leverage a proxy for security or privacy reasons.\n    - Shared systems such as Kiosks and conference room computers may be used by multiple users.\n    - Shared working spaces may have a single endpoint that is used by multiple users.\n\n### Response and remediation:\n- Review the profile of the users involved in this action to determine if proxy usage may be expected.\n- If the user is legitimate and the authentication behavior is not suspicious based on device analysis, no action is required.\n- If the user is legitimate but the authentication behavior is suspicious, consider resetting passwords for the users involves and enabling multi-factor authentication (MFA).\n    - If MFA is already enabled, consider resetting MFA for the users.\n- If any of the users are not legitimate, consider deactivating the user's account.\n- Conduct a review of Okta policies and ensure they are in accordance with security best practices.\n- Check with internal IT teams to determine if the accounts involved recently had MFA reset at the request of the user.\n    - If so, confirm with the user this was a legitimate request.\n    - If so and this was not a legitimate request, consider deactivating the user's account temporarily.\n        - Reset passwords and reset MFA for the user.\n- If this is a false positive, consider adding the `okta.debug_context.debug_data.dt_hash` field to the `exceptions` list in the rule.\n    - This will prevent future occurrences of this event for this device from triggering the rule.\n",
        "output_index": "",
        "version": 203,
        "tags": [
          "Use Case: Identity and Access Audit",
          "Data Source: Okta",
          "Tactic: Credential Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Users may share an endpoint related to work or personal use in which separate Okta accounts are used.",
          "Shared systems such as Kiosks and conference room computers may be used by multiple users."
        ],
        "references": [
          "https://support.okta.com/help/s/article/How-does-the-Device-Token-work?language=en_US",
          "https://developer.okta.com/docs/reference/api/event-types/",
          "https://www.elastic.co/security-labs/testing-okta-visibility-and-detection-dorothy",
          "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection",
          "https://www.okta.com/resources/whitepaper-how-adaptive-mfa-can-help-in-mitigating-brute-force-attacks/",
          "https://www.elastic.co/security-labs/monitoring-okta-threats-with-elastic-security",
          "https://www.elastic.co/security-labs/starter-guide-to-understanding-okta"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1110",
                "name": "Brute Force",
                "reference": "https://attack.mitre.org/techniques/T1110/",
                "subtechnique": [
                  {
                    "id": "T1110.003",
                    "name": "Password Spraying",
                    "reference": "https://attack.mitre.org/techniques/T1110/003/"
                  }
                ]
              },
              {
                "id": "T1110",
                "name": "Brute Force",
                "reference": "https://attack.mitre.org/techniques/T1110/",
                "subtechnique": [
                  {
                    "id": "T1110.004",
                    "name": "Credential Stuffing",
                    "reference": "https://attack.mitre.org/techniques/T1110/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "The Okta Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.",
        "related_integrations": [],
        "required_fields": [],
        "id": "6014dd7b-8288-4d8e-8300-4d6a10cb423d",
        "rule_id": "95b99adc-2cda-11ef-84e1-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.295Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.295Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "FROM logs-okta*\n| WHERE\n    event.dataset == \"okta.system\"\n    AND (event.action RLIKE \"user\\\\.authentication(.*)\" OR event.action == \"user.session.start\")\n    AND okta.debug_context.debug_data.dt_hash != \"-\"\n    AND okta.outcome.reason == \"INVALID_CREDENTIALS\"\n| KEEP event.action, okta.debug_context.debug_data.dt_hash, okta.actor.id, okta.actor.alternate_id, okta.outcome.reason\n| STATS\n    target_auth_count = COUNT_DISTINCT(okta.actor.id)\n    BY okta.debug_context.debug_data.dt_hash, okta.actor.alternate_id\n| WHERE\n    target_auth_count > 20\n| SORT\n    target_auth_count DESC\n"
      },
      {
        "name": "Multiple Okta User Authentication Events with Client Address",
        "description": "Detects when a certain threshold of Okta user authentication events are reported for multiple users from the same client address. Adversaries may attempt to launch a credential stuffing or password spraying attack from the same device by using a list of known usernames and passwords to gain unauthorized access to user accounts.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Multiple Okta User Authentication Events with Client Address\n\nThis rule detects when a certain threshold of Okta user authentication events are reported for multiple users from the same client address. Adversaries may attempt to launch a credential stuffing attack from the same device by using a list of known usernames and passwords to gain unauthorized access to user accounts. Note that Okta does not log unrecognized usernames supplied during authentication attempts, so this rule may not detect all credential stuffing attempts or may indicate a targeted attack.\n\n#### Possible investigation steps:\nSince this is an ES|QL rule, the `okta.actor.alternate_id` and `okta.client.ip` values can be used to pivot into the raw authentication events related to this activity.\n- Identify the users involved in this action by examining the `okta.actor.id`, `okta.actor.type`, `okta.actor.alternate_id`, and `okta.actor.display_name` fields.\n- Determine the device client used for these actions by analyzing `okta.client.ip`, `okta.client.user_agent.raw_user_agent`, `okta.client.zone`, `okta.client.device`, and `okta.client.id` fields.\n- Review the `okta.security_context.is_proxy` field to determine if the device is a proxy.\n    - If the device is a proxy, this may indicate that a user is using a proxy to access multiple accounts for password spraying.\n- With the list of `okta.actor.alternate_id` values, review `event.outcome` results to determine if the authentication was successful.\n    - If the authentication was successful for any user, pivoting to `event.action` values for those users may provide additional context.\n- With Okta end users identified, review the `okta.debug_context.debug_data.dt_hash` field.\n    - Historical analysis should indicate if this device token hash is commonly associated with the user.\n- Review the `okta.event_type` field to determine the type of authentication event that occurred.\n    - If the event type is `user.authentication.sso`, the user may have legitimately started a session via a proxy for security or privacy reasons.\n    - If the event type is `user.authentication.password`, the user may be using a proxy to access multiple accounts for password spraying.\n    - If the event type is `user.session.start`, the source may have attempted to establish a session via the Okta authentication API.\n- Examine the `okta.outcome.result` field to determine if the authentication was successful.\n- Review the past activities of the actor(s) involved in this action by checking their previous actions.\n- Evaluate the actions that happened just before and after this event in the `okta.event_type` field to help understand the full context of the activity.\n    - This may help determine the authentication and authorization actions that occurred between the user, Okta and application.\n\n### False positive analysis:\n- A user may have legitimately started a session via a proxy for security or privacy reasons.\n- Users may share an endpoint related to work or personal use in which separate Okta accounts are used.\n    - Architecturally, this shared endpoint may leverage a proxy for security or privacy reasons.\n    - Shared systems such as Kiosks and conference room computers may be used by multiple users.\n    - Shared working spaces may have a single endpoint that is used by multiple users.\n\n### Response and remediation:\n- Review the profile of the users involved in this action to determine if proxy usage may be expected.\n- If the user is legitimate and the authentication behavior is not suspicious based on device analysis, no action is required.\n- If the user is legitimate but the authentication behavior is suspicious, consider resetting passwords for the users involves and enabling multi-factor authentication (MFA).\n    - If MFA is already enabled, consider resetting MFA for the users.\n- If any of the users are not legitimate, consider deactivating the user's account.\n- Conduct a review of Okta policies and ensure they are in accordance with security best practices.\n- Check with internal IT teams to determine if the accounts involved recently had MFA reset at the request of the user.\n    - If so, confirm with the user this was a legitimate request.\n    - If so and this was not a legitimate request, consider deactivating the user's account temporarily.\n        - Reset passwords and reset MFA for the user.\n- If this is a false positive, consider adding the `okta.debug_context.debug_data.dt_hash` field to the `exceptions` list in the rule.\n    - This will prevent future occurrences of this event for this device from triggering the rule.\n    - Alternatively adding `okta.client.ip` or a CIDR range to the `exceptions` list can prevent future occurrences of this event from triggering the rule.\n        - This should be done with caution as it may prevent legitimate alerts from being generated.\n",
        "output_index": "",
        "version": 203,
        "tags": [
          "Use Case: Identity and Access Audit",
          "Data Source: Okta",
          "Tactic: Credential Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Users may share an endpoint related to work or personal use in which separate Okta accounts are used.",
          "Shared systems such as Kiosks and conference room computers may be used by multiple users."
        ],
        "references": [
          "https://support.okta.com/help/s/article/How-does-the-Device-Token-work?language=en_US",
          "https://developer.okta.com/docs/reference/api/event-types/",
          "https://www.elastic.co/security-labs/testing-okta-visibility-and-detection-dorothy",
          "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection",
          "https://www.okta.com/resources/whitepaper-how-adaptive-mfa-can-help-in-mitigating-brute-force-attacks/",
          "https://www.elastic.co/security-labs/monitoring-okta-threats-with-elastic-security",
          "https://www.elastic.co/security-labs/starter-guide-to-understanding-okta"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1110",
                "name": "Brute Force",
                "reference": "https://attack.mitre.org/techniques/T1110/",
                "subtechnique": [
                  {
                    "id": "T1110.003",
                    "name": "Password Spraying",
                    "reference": "https://attack.mitre.org/techniques/T1110/003/"
                  }
                ]
              },
              {
                "id": "T1110",
                "name": "Brute Force",
                "reference": "https://attack.mitre.org/techniques/T1110/",
                "subtechnique": [
                  {
                    "id": "T1110.004",
                    "name": "Credential Stuffing",
                    "reference": "https://attack.mitre.org/techniques/T1110/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "The Okta Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.",
        "related_integrations": [],
        "required_fields": [],
        "id": "84c36e3f-b5a2-462a-a6e7-bce46408ddc8",
        "rule_id": "94e734c0-2cda-11ef-84e1-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.291Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.291Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "FROM logs-okta*\n| WHERE\n    event.dataset == \"okta.system\"\n    AND (event.action == \"user.session.start\" OR event.action RLIKE \"user\\\\.authentication(.*)\")\n    AND okta.outcome.reason == \"INVALID_CREDENTIALS\"\n| KEEP okta.client.ip, okta.actor.alternate_id, okta.actor.id, event.action, okta.outcome.reason\n| STATS\n    source_auth_count = COUNT_DISTINCT(okta.actor.id)\n    BY okta.client.ip, okta.actor.alternate_id\n| WHERE\n    source_auth_count > 5\n| SORT\n    source_auth_count DESC\n"
      },
      {
        "name": "Suspicious File Creation via Kworker",
        "description": "This rule monitors for a file creation event originating from a kworker parent process. kworker, or kernel worker, processes are part of the kernel's workqueue mechanism. They are responsible for executing work that has been scheduled to be done in kernel space, which might include tasks like handling interrupts, background activities, and other kernel-related tasks. Attackers may attempt to evade detection by masquerading as a kernel worker process.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Suspicious File Creation via Kworker\n\nKworker, or kernel worker, processes are part of the kernel's workqueue mechanism. They are responsible for executing work that has been scheduled to be done in kernel space, which might include tasks like handling interrupts, background activities, and other kernel-related tasks.\n\nAttackers may attempt to evade detection by masquerading as a kernel worker process.\n\nThis rule monitors for suspicious file creation events through the kworker process. This is not common, and could indicate malicious behaviour.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/master/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n> This investigation guide uses [placeholder fields](https://www.elastic.co/guide/en/security/current/osquery-placeholder-fields.html) to dynamically pass alert data into Osquery queries. Placeholder fields were introduced in Elastic Stack version 8.7.0. If you're using Elastic Stack version 8.6.0 or earlier, you'll need to manually adjust this investigation guide's queries to ensure they properly run.\n\n#### Possible Investigation Steps\n\n- Investigate the file that was created or modified through OSQuery.\n  - !{osquery{\"label\":\"Osquery - Retrieve File Listing Information\",\"query\":\"SELECT * FROM file WHERE path = {{file.path}}\\n\"}}\n  - !{osquery{\"label\":\"Osquery - Retrieve Additional File Listing Information\",\"query\":\"SELECT f.path, u.username AS file_owner, g.groupname AS group_owner, datetime(f.atime, 'unixepoch') AS\\nfile_last_access_time, datetime(f.mtime, 'unixepoch') AS file_last_modified_time, datetime(f.ctime, 'unixepoch') AS\\nfile_last_status_change_time, datetime(f.btime, 'unixepoch') AS file_created_time, f.size AS size_bytes FROM file f LEFT\\nJOIN users u ON f.uid = u.uid LEFT JOIN groups g ON f.gid = g.gid WHERE path = {{file.path}}\\n\"}}\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence and whether they are located in expected locations.\n  - !{osquery{\"label\":\"Osquery - Retrieve Running Processes by User\",\"query\":\"SELECT pid, username, name FROM processes p JOIN users u ON u.uid = p.uid ORDER BY username\"}}\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Validate the activity is not related to planned patches, updates, network administrator activity, or legitimate software installations.\n- Investigate whether the altered scripts call other malicious scripts elsewhere on the file system. \n  - If scripts or executables were dropped, retrieve the files and determine if they are malicious:\n    - Use a private sandboxed malware analysis system to perform analysis.\n      - Observe and collect information about the following activities:\n        - Attempts to contact external domains and addresses.\n          - Check if the domain is newly registered or unexpected.\n          - Check the reputation of the domain or IP address.\n        - File access, modification, and creation activities.\n        - Cron jobs, services and other persistence mechanisms.\n            - !{osquery{\"label\":\"Osquery - Retrieve Crontab Information\",\"query\":\"SELECT * FROM crontab\"}}\n- Investigate abnormal behaviors by the subject process/user such as network connections, file modifications, and any other spawned child processes.\n  - Investigate listening ports and open sockets to look for potential command and control traffic or data exfiltration.\n    - !{osquery{\"label\":\"Osquery - Retrieve Listening Ports\",\"query\":\"SELECT pid, address, port, socket, protocol, path FROM listening_ports\"}}\n    - !{osquery{\"label\":\"Osquery - Retrieve Open Sockets\",\"query\":\"SELECT pid, family, remote_address, remote_port, socket, state FROM process_open_sockets\"}}\n  - Identify the user account that performed the action, analyze it, and check whether it should perform this kind of action.\n    - !{osquery{\"label\":\"Osquery - Retrieve Information for a Specific User\",\"query\":\"SELECT * FROM users WHERE username = {{user.name}}\"}}\n- Investigate whether the user is currently logged in and active.\n    - !{osquery{\"label\":\"Osquery - Investigate the Account Authentication Status\",\"query\":\"SELECT * FROM logged_in_users WHERE user = {{user.name}}\"}}\n\n### False Positive Analysis\n\n- If this activity is related to new benign software installation activity, consider adding exceptions — preferably with a combination of user and command line conditions.\n- If this activity is related to a system administrator that performed these actions for administrative purposes, consider adding exceptions for this specific administrator user account. \n- Try to understand the context of the execution by thinking about the user, machine, or business purpose. A small number of endpoints, such as servers with unique software, might appear unusual but satisfy a specific business need.\n\n### Related Rules\n\n- Suspicious Kworker UID Elevation - 7dfaaa17-425c-4fe7-bd36-83705fde7c2b\n- Network Activity Detected via Kworker - 25d917c4-aa3c-4111-974c-286c0312ff95\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Leverage the incident response data and logging to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 5,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1547",
                "name": "Boot or Logon Autostart Execution",
                "reference": "https://attack.mitre.org/techniques/T1547/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1014",
                "name": "Rootkit",
                "reference": "https://attack.mitre.org/techniques/T1014/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows\nthe Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click Add integrations.\n- In the query bar, search for Elastic Defend and select the integration to see more details about it.\n- Click Add Elastic Defend.\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either Traditional Endpoints or Cloud Workloads.\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest to select \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in New agent policy name. If other agent policies already exist, you can click the Existing hosts tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click Save and Continue.\n- To complete the integration, select Add Elastic Agent to your hosts and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a17c16a5-ec6b-4cf8-b908-c77f98acd1da",
        "rule_id": "ae343298-97bc-47bc-9ea2-5f2ad831c16e",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.307Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.307Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.action in (\"creation\", \"file_create_event\") and\n  process.name : \"kworker*\" and not (\n    (process.name : \"kworker*kcryptd*\") or\n    (file.path : (\n      \"/var/log/*\", \"/var/crash/*\", \"/var/run/*\", \"/var/lib/systemd/coredump/*\", \"/var/spool/*\",\n      \"/var/lib/nfs/nfsdcltrack/main.sqlite-journal\", \"/proc/*/cwd/core.*\", \"/var/run/apport.lock\",\n      \"/var/spool/abrt/ccpp-*\"\n      )\n    )\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "At.exe Command Lateral Movement",
        "description": "Identifies use of at.exe to interact with the task scheduler on remote hosts. Remote task creations, modifications or execution could be indicative of adversary lateral movement.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 105,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Lateral Movement",
          "Data Source: Elastic Defend",
          "Rule Type: BBR",
          "Data Source: Elastic Endgame",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1021",
                "name": "Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1021/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1053",
                "name": "Scheduled Task/Job",
                "reference": "https://attack.mitre.org/techniques/T1053/",
                "subtechnique": [
                  {
                    "id": "T1053.002",
                    "name": "At",
                    "reference": "https://attack.mitre.org/techniques/T1053/002/"
                  },
                  {
                    "id": "T1053.005",
                    "name": "Scheduled Task",
                    "reference": "https://attack.mitre.org/techniques/T1053/005/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "589c8cf6-039c-45c3-a6c8-04c250642394",
        "rule_id": "b483365c-98a8-40c0-92d8-0458ca25058a",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.311Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.311Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and process.name : \"at.exe\" and process.args : \"\\\\\\\\*\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "winlogbeat-*",
          "logs-windows.*",
          "endgame-*",
          "logs-system.security*"
        ]
      },
      {
        "name": "Machine Learning Detected DGA activity using a known SUNBURST DNS domain",
        "description": "A supervised machine learning model has identified a DNS question name that used by the SUNBURST malware and is predicted to be the result of a Domain Generation Algorithm.",
        "risk_score": 99,
        "severity": "critical",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 5,
        "tags": [
          "Domain: Network",
          "Domain: Endpoint",
          "Data Source: Elastic Defend",
          "Use Case: Domain Generation Algorithm Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Command and Control"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-10m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/dga",
          "https://www.elastic.co/security-labs/detect-domain-generation-algorithm-activity-with-new-kibana-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1568",
                "name": "Dynamic Resolution",
                "reference": "https://attack.mitre.org/techniques/T1568/",
                "subtechnique": [
                  {
                    "id": "T1568.002",
                    "name": "Domain Generation Algorithms",
                    "reference": "https://attack.mitre.org/techniques/T1568/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Domain Generation Algorithm (DGA) Detection integration assets to be installed, as well as DNS events collected by integrations such as Elastic Defend, Network Packet Capture, or Packetbeat.  \n\n### DGA Detection Setup\nThe DGA Detection integration consists of an ML-based framework to detect DGA activity in DNS events.\n\n#### Prerequisite Requirements:\n- Fleet is required for DGA Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- DNS events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint), [Network Packet Capture](https://docs.elastic.co/integrations/network_traffic) integration, or [Packetbeat](https://www.elastic.co/guide/en/beats/packetbeat/current/packetbeat-overview.html).\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To add the Network Packet Capture integration to an Elastic Agent policy, refer to [this](https://www.elastic.co/guide/en/fleet/current/add-integration-to-policy.html) guide.\n- To set up and run Packetbeat, follow [this](https://www.elastic.co/guide/en/beats/packetbeat/current/setting-up-and-running.html) guide.\n\n#### The following steps should be executed to install assets associated with the DGA Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Domain Generation Algorithm Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Configure the ingest pipeline**.\n",
        "related_integrations": [
          {
            "package": "dga",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "network_traffic",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "dns.question.registered_domain",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "ml_is_dga.malicious_prediction",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "22805412-d8ce-46a3-bbee-182c4feed62a",
        "rule_id": "bcaa15ce-2d41-44d7-a322-918f9db77766",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.314Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.314Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "logs-endpoint.events.*",
          "logs-network_traffic.*"
        ],
        "query": "ml_is_dga.malicious_prediction:1 and dns.question.registered_domain:avsvmcloud.com\n",
        "language": "kuery"
      },
      {
        "name": "Potential Defense Evasion via CMSTP.exe",
        "description": "The Microsoft Connection Manager Profile Installer (CMSTP.exe) is a command-line program to install Connection Manager service profiles, which accept installation information file (INF) files. Adversaries may abuse CMSTP to proxy the execution of malicious code by supplying INF files that contain malicious commands.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 105,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Rule Type: BBR",
          "Data Source: Sysmon",
          "Data Source: Elastic Endgame",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://attack.mitre.org/techniques/T1218/003/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/",
                "subtechnique": [
                  {
                    "id": "T1218.003",
                    "name": "CMSTP",
                    "reference": "https://attack.mitre.org/techniques/T1218/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a4e5a482-2f32-40f3-a91f-bd011c756b14",
        "rule_id": "bd3d058d-5405-4cee-b890-337f09366ba2",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.318Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.318Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  process.name : \"cmstp.exe\" and process.args == \"/s\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-system.security*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "Machine Learning Detected a DNS Request With a High DGA Probability Score",
        "description": "A supervised machine learning model has identified a DNS question name with a high probability of sourcing from a Domain Generation Algorithm (DGA), which could indicate command and control network activity.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 5,
        "tags": [
          "Domain: Network",
          "Domain: Endpoint",
          "Data Source: Elastic Defend",
          "Use Case: Domain Generation Algorithm Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Command and Control"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-10m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/dga",
          "https://www.elastic.co/security-labs/detect-domain-generation-algorithm-activity-with-new-kibana-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1568",
                "name": "Dynamic Resolution",
                "reference": "https://attack.mitre.org/techniques/T1568/",
                "subtechnique": [
                  {
                    "id": "T1568.002",
                    "name": "Domain Generation Algorithms",
                    "reference": "https://attack.mitre.org/techniques/T1568/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Domain Generation Algorithm (DGA) Detection integration assets to be installed, as well as DNS events collected by integrations such as Elastic Defend, Network Packet Capture, or Packetbeat.  \n\n### DGA Detection Setup\nThe DGA Detection integration consists of an ML-based framework to detect DGA activity in DNS events.\n\n#### Prerequisite Requirements:\n- Fleet is required for DGA Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- DNS events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint), [Network Packet Capture](https://docs.elastic.co/integrations/network_traffic) integration, or [Packetbeat](https://www.elastic.co/guide/en/beats/packetbeat/current/packetbeat-overview.html).\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To add the Network Packet Capture integration to an Elastic Agent policy, refer to [this](https://www.elastic.co/guide/en/fleet/current/add-integration-to-policy.html) guide.\n- To set up and run Packetbeat, follow [this](https://www.elastic.co/guide/en/beats/packetbeat/current/setting-up-and-running.html) guide.\n\n#### The following steps should be executed to install assets associated with the DGA Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Domain Generation Algorithm Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Configure the ingest pipeline**.\n",
        "related_integrations": [
          {
            "package": "dga",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "network_traffic",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "ml_is_dga.malicious_probability",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "bdb20d15-eb49-4892-8902-f574301bc080",
        "rule_id": "da7f5803-1cd4-42fd-a890-0173ae80ac69",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.321Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.321Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "logs-endpoint.events.*",
          "logs-network_traffic.*"
        ],
        "query": "ml_is_dga.malicious_probability > 0.98\n",
        "language": "kuery"
      },
      {
        "name": "Suspicious Execution from INET Cache",
        "description": "Identifies the execution of a process with arguments pointing to the INetCache Folder. Adversaries may deliver malicious content via WININET during initial access.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Initial Access",
          "Tactic: Command and Control",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: System",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: Sysmon",
          "Data Source: SentinelOne",
          "Data Source: Crowdstrike"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.trendmicro.com/en_us/research/24/b/cve202421412-water-hydra-targets-traders-with-windows-defender-s.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1566",
                "name": "Phishing",
                "reference": "https://attack.mitre.org/techniques/T1566/",
                "subtechnique": [
                  {
                    "id": "T1566.001",
                    "name": "Spearphishing Attachment",
                    "reference": "https://attack.mitre.org/techniques/T1566/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1105",
                "name": "Ingress Tool Transfer",
                "reference": "https://attack.mitre.org/techniques/T1105/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "crowdstrike",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "80751735-b7be-4e98-9221-12e573ba4916",
        "rule_id": "dca6b4b0-ae70-44eb-bb7a-ce6db502ee78",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.332Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.332Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and  \n  process.parent.name : (\"explorer.exe\", \"winrar.exe\", \"7zFM.exe\", \"Bandizip.exe\") and\n  (\n    process.args : \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Microsoft\\\\Windows\\\\INetCache\\\\IE\\\\*\" or\n    process.executable : (\n      \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Microsoft\\\\Windows\\\\INetCache\\\\IE\\\\*\",\n      \"\\\\Device\\\\HarddiskVolume?\\\\Users\\\\*\\\\AppData\\\\Local\\\\Microsoft\\\\Windows\\\\INetCache\\\\IE\\\\*\"\n    )\n  )\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-endpoint.events.process-*",
          "logs-windows.forwarded*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-system.security*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-crowdstrike.fdr*"
        ]
      },
      {
        "name": "Potentially Suspicious Process Started via tmux or screen",
        "description": "This rule monitors for the execution of suspicious commands via screen and tmux. When launching a command and detaching directly, the commands will be executed in the background via its parent process. Attackers may leverage screen or tmux to execute commands while attempting to evade detection.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 5,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "5a714361-ffa9-4f73-9137-2eac5c3e3793",
        "rule_id": "e0cc3807-e108-483c-bf66-5a4fbe0d7e89",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.336Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.336Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and \nprocess.parent.name in (\"screen\", \"tmux\") and process.name like (\n  \"nmap\", \"nc\", \"ncat\", \"netcat\", \"socat\", \"nc.openbsd\", \"ngrok\", \"ping\", \"java\", \"php*\", \"perl\", \"ruby\", \"lua*\",\n  \"openssl\", \"telnet\", \"wget\", \"curl\", \"id\"\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "First Time Seen NewCredentials Logon Process",
        "description": "Identifies a new credentials logon type performed by an unusual process. This may indicate the existence of an access token forging capability that are often abused to bypass access control restrictions.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 105,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/pt/blog/how-attackers-abuse-access-token-manipulation"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1134",
                "name": "Access Token Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1134/",
                "subtechnique": [
                  {
                    "id": "T1134.001",
                    "name": "Token Impersonation/Theft",
                    "reference": "https://attack.mitre.org/techniques/T1134/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "winlog.event_data.LogonProcessName",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "winlog.event_data.SubjectUserName",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "winlog.logon.type",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "ccd0f86c-fbb2-4270-ad83-f52172eadac1",
        "rule_id": "e468f3f6-7c4c-45bb-846a-053738b3fe5d",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.339Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.339Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.category:\"authentication\" and host.os.type:\"windows\" and winlog.logon.type:\"NewCredentials\" and winlog.event_data.LogonProcessName:(Advapi* or \"Advapi  \") and not winlog.event_data.SubjectUserName:*$ and not process.executable :???\\\\Program?Files*\n",
        "new_terms_fields": [
          "process.executable"
        ],
        "history_window_start": "now-7d",
        "index": [
          "winlogbeat-*",
          "logs-system.*",
          "logs-windows.*"
        ],
        "language": "kuery"
      },
      {
        "name": "Suspicious WMI Event Subscription Created",
        "description": "Detects the creation of a WMI Event Subscription. Attackers can abuse this mechanism for persistence or to elevate to SYSTEM privileges.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 206,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Sysmon"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.blackhat.com/docs/us-15/materials/us-15-Graeber-Abusing-Windows-Management-Instrumentation-WMI-To-Build-A-Persistent%20Asynchronous-And-Fileless-Backdoor-wp.pdf",
          "https://medium.com/threatpunter/detecting-removing-wmi-persistence-60ccbb7dff96"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/",
                "subtechnique": [
                  {
                    "id": "T1546.003",
                    "name": "Windows Management Instrumentation Event Subscription",
                    "reference": "https://attack.mitre.org/techniques/T1546/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.code",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "winlog.event_data.Consumer",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "winlog.event_data.Operation",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "888478e3-2f34-400c-94e1-1520e9d83794",
        "rule_id": "e72f87d0-a70e-4f8d-8443-a6407bc34643",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.343Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.343Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where event.dataset == \"windows.sysmon_operational\" and event.code == \"21\" and\n    winlog.event_data.Operation : \"Created\" and winlog.event_data.Consumer : (\"*subscription:CommandLineEventConsumer*\", \"*subscription:ActiveScriptEventConsumer*\")\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-windows.sysmon_operational-*"
        ]
      },
      {
        "name": "Service Path Modification",
        "description": "Identifies attempts to modify a service path by an unusual process. Attackers may attempt to modify existing services for persistence or privilege escalation.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 105,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Rule Type: BBR",
          "Data Source: Sysmon"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1112",
                "name": "Modify Registry",
                "reference": "https://attack.mitre.org/techniques/T1112/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/",
                "subtechnique": [
                  {
                    "id": "T1543.003",
                    "name": "Windows Service",
                    "reference": "https://attack.mitre.org/techniques/T1543/003/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/",
                "subtechnique": [
                  {
                    "id": "T1543.003",
                    "name": "Windows Service",
                    "reference": "https://attack.mitre.org/techniques/T1543/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "registry.path",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a54a48c9-c52a-49bc-8027-1af7ab2b243a",
        "rule_id": "f243fe39-83a4-46f3-a3b6-707557a102df",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.346Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.346Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "registry where host.os.type == \"windows\" and event.type == \"change\" and\n  registry.path : (\n    \"HKLM\\\\SYSTEM\\\\*ControlSet*\\\\Services\\\\*\\\\ImagePath\",\n    \"\\\\REGISTRY\\\\MACHINE\\\\SYSTEM\\\\*ControlSet*\\\\Services\\\\*\\\\ImagePath\"\n  ) and not (\n    process.executable : (\n      \"?:\\\\Program Files\\\\*.exe\",\n      \"?:\\\\Program Files (x86)\\\\*.exe\",\n      \"?:\\\\Windows\\\\System32\\\\services.exe\",\n      \"?:\\\\Windows\\\\WinSxS\\\\*\"\n    )\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.registry-*",
          "endgame-*",
          "logs-windows.sysmon_operational-*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "Machine Learning Detected a DNS Request Predicted to be a DGA Domain",
        "description": "A supervised machine learning model has identified a DNS question name that is predicted to be the result of a Domain Generation Algorithm (DGA), which could indicate command and control network activity.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 5,
        "tags": [
          "Domain: Network",
          "Domain: Endpoint",
          "Data Source: Elastic Defend",
          "Use Case: Domain Generation Algorithm Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Command and Control"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-10m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/dga",
          "https://www.elastic.co/security-labs/detect-domain-generation-algorithm-activity-with-new-kibana-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1568",
                "name": "Dynamic Resolution",
                "reference": "https://attack.mitre.org/techniques/T1568/",
                "subtechnique": [
                  {
                    "id": "T1568.002",
                    "name": "Domain Generation Algorithms",
                    "reference": "https://attack.mitre.org/techniques/T1568/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Domain Generation Algorithm (DGA) Detection integration assets to be installed, as well as DNS events collected by integrations such as Elastic Defend, Network Packet Capture, or Packetbeat.  \n\n### DGA Detection Setup\nThe DGA Detection integration consists of an ML-based framework to detect DGA activity in DNS events.\n\n#### Prerequisite Requirements:\n- Fleet is required for DGA Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- DNS events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint), [Network Packet Capture](https://docs.elastic.co/integrations/network_traffic) integration, or [Packetbeat](https://www.elastic.co/guide/en/beats/packetbeat/current/packetbeat-overview.html).\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To add the Network Packet Capture integration to an Elastic Agent policy, refer to [this](https://www.elastic.co/guide/en/fleet/current/add-integration-to-policy.html) guide.\n- To set up and run Packetbeat, follow [this](https://www.elastic.co/guide/en/beats/packetbeat/current/setting-up-and-running.html) guide.\n\n#### The following steps should be executed to install assets associated with the DGA Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Domain Generation Algorithm Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Configure the ingest pipeline**.\n",
        "related_integrations": [
          {
            "package": "dga",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "network_traffic",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "dns.question.registered_domain",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "ml_is_dga.malicious_prediction",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "1e24b28c-e96b-4cdf-9935-a5c3773c8867",
        "rule_id": "f3403393-1fd9-4686-8f6e-596c58bc00b4",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.349Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.349Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "logs-endpoint.events.*",
          "logs-network_traffic.*"
        ],
        "query": "ml_is_dga.malicious_prediction:1 and not dns.question.registered_domain:avsvmcloud.com\n",
        "language": "kuery"
      },
      {
        "name": "Potential DGA Activity",
        "description": "A population analysis machine learning job detected potential DGA (domain generation algorithm) activity. Such activity is often used by malware command and control (C2) channels. This machine learning job looks for a source IP address making DNS requests that have an aggregate high probability of being DGA activity.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 5,
        "tags": [
          "Use Case: Domain Generation Algorithm Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Command and Control"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-45m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/dga",
          "https://www.elastic.co/security-labs/detect-domain-generation-algorithm-activity-with-new-kibana-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1568",
                "name": "Dynamic Resolution",
                "reference": "https://attack.mitre.org/techniques/T1568/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Domain Generation Algorithm (DGA) Detection integration assets to be installed, as well as DNS events collected by integrations such as Elastic Defend, Network Packet Capture, or Packetbeat.  \n\n### DGA Detection Setup\nThe DGA Detection integration consists of an ML-based framework to detect DGA activity in DNS events.\n\n#### Prerequisite Requirements:\n- Fleet is required for DGA Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- DNS events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint), [Network Packet Capture](https://docs.elastic.co/integrations/network_traffic) integration, or [Packetbeat](https://www.elastic.co/guide/en/beats/packetbeat/current/packetbeat-overview.html).\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To add the Network Packet Capture integration to an Elastic Agent policy, refer to [this](https://www.elastic.co/guide/en/fleet/current/add-integration-to-policy.html) guide.\n- To set up and run Packetbeat, follow [this](https://www.elastic.co/guide/en/beats/packetbeat/current/setting-up-and-running.html) guide.\n\n#### The following steps should be executed to install assets associated with the DGA Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Domain Generation Algorithm Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n\n### Anomaly Detection Setup\nBefore you can enable this rule, you'll need to enable the corresponding Anomaly Detection job. \n- Go to the Kibana homepage. Under Analytics, click Machine Learning.\n- Under Anomaly Detection, click Jobs, and then click \"Create job\". Select the Data View containing your enriched DNS events. For example, this would be `logs-endpoint.events.*` if you used Elastic Defend to collect events, or `logs-network_traffic.*` if you used Network Packet Capture.\n- If the selected Data View contains events that match the query in [this](https://github.com/elastic/integrations/blob/main/packages/dga/kibana/ml_module/dga-ml.json) configuration file, you will see a card for DGA under \"Use preconfigured jobs\".\n- Keep the default settings and click \"Create jobs\" to start the anomaly detection job and datafeed.\n",
        "related_integrations": [
          {
            "package": "dga",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "network_traffic",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [],
        "id": "fca9d3db-2420-49f1-ae08-1500378035f2",
        "rule_id": "ff0d807d-869b-4a0d-a493-52bc46d2f1b1",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.356Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.356Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 70,
        "machine_learning_job_id": [
          "dga_high_sum_probability"
        ]
      },
      {
        "name": "Potential Masquerading as System32 DLL",
        "description": "Identifies suspicious instances of default system32 DLLs either unsigned or signed with non-MS certificates. This can potentially indicate the attempt to masquerade as system DLLs, perform DLL Search Order Hijacking or backdoor and resign legitimate DLLs.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 105,
        "tags": [
          "Domain: Endpoint",
          "Data Source: Elastic Defend",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Tactic: Persistence",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.001",
                    "name": "Invalid Code Signature",
                    "reference": "https://attack.mitre.org/techniques/T1036/001/"
                  },
                  {
                    "id": "T1036.005",
                    "name": "Match Legitimate Name or Location",
                    "reference": "https://attack.mitre.org/techniques/T1036/005/"
                  }
                ]
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/",
                "subtechnique": [
                  {
                    "id": "T1574.001",
                    "name": "DLL Search Order Hijacking",
                    "reference": "https://attack.mitre.org/techniques/T1574/001/"
                  },
                  {
                    "id": "T1574.002",
                    "name": "DLL Side-Loading",
                    "reference": "https://attack.mitre.org/techniques/T1574/002/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1554",
                "name": "Compromise Host Software Binary",
                "reference": "https://attack.mitre.org/techniques/T1554/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "dll.Ext.relative_file_creation_time",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "dll.code_signature.status",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "dll.code_signature.subject_name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "dll.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "dll.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "dll.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "8fd1600c-c949-4769-9086-1d32d90012d4",
        "rule_id": "fb01d790-9f74-4e76-97dd-b4b0f7bf6435",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.352Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.352Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "library where event.action == \"load\" and dll.Ext.relative_file_creation_time <= 3600 and\n    not (\n      dll.path : (\n        \"?:\\\\Windows\\\\System32\\\\*\",\n        \"?:\\\\Windows\\\\SysWOW64\\\\*\",\n        \"?:\\\\Windows\\\\SystemTemp\\\\*\",\n        \"?:\\\\$WINDOWS.~BT\\\\NewOS\\\\Windows\\\\WinSxS\\\\*\",\n        \"?:\\\\$WINDOWS.~BT\\\\NewOS\\\\Windows\\\\System32\\\\*\",\n        \"?:\\\\$WINDOWS.~BT\\\\Sources\\\\*\",\n        \"?:\\\\$WINDOWS.~BT\\\\Work\\\\*\",\n        \"?:\\\\Windows\\\\WinSxS\\\\*\",\n        \"?:\\\\Windows\\\\SoftwareDistribution\\\\Download\\\\*\",\n        \"?:\\\\Windows\\\\assembly\\\\NativeImages_v*\"\n      )\n    ) and\n    not (\n      dll.code_signature.subject_name in (\n        \"Microsoft Windows\",\n        \"Microsoft Corporation\",\n        \"Microsoft Windows Hardware Abstraction Layer Publisher\",\n        \"Microsoft Windows Publisher\",\n        \"Microsoft Windows 3rd party Component\",\n        \"Microsoft 3rd Party Application Component\"\n      ) and dll.code_signature.trusted == true\n    ) and not dll.code_signature.status : (\"errorCode_endpoint*\", \"errorUntrustedRoot\", \"errorChaining\") and\n    dll.name : (\n      \"aadauthhelper.dll\", \"aadcloudap.dll\", \"aadjcsp.dll\", \"aadtb.dll\", \"aadwamextension.dll\", \"aarsvc.dll\", \"abovelockapphost.dll\", \"accessibilitycpl.dll\", \"accountaccessor.dll\", \"accountsrt.dll\", \"acgenral.dll\", \"aclayers.dll\", \"acledit.dll\", \"aclui.dll\", \"acmigration.dll\", \"acppage.dll\", \"acproxy.dll\", \"acspecfc.dll\", \"actioncenter.dll\", \"actioncentercpl.dll\", \"actionqueue.dll\", \"activationclient.dll\", \"activeds.dll\", \"activesynccsp.dll\", \"actxprxy.dll\", \"acwinrt.dll\", \"acxtrnal.dll\", \"adaptivecards.dll\", \"addressparser.dll\", \"adhapi.dll\", \"adhsvc.dll\", \"admtmpl.dll\", \"adprovider.dll\", \"adrclient.dll\", \"adsldp.dll\", \"adsldpc.dll\", \"adsmsext.dll\", \"adsnt.dll\", \"adtschema.dll\", \"advancedemojids.dll\", \"advapi32.dll\", \"advapi32res.dll\", \"advpack.dll\", \"aeevts.dll\", \"aeinv.dll\", \"aepic.dll\", \"ajrouter.dll\", \"altspace.dll\", \"amsi.dll\", \"amsiproxy.dll\", \"amstream.dll\", \"apds.dll\", \"aphostclient.dll\", \"aphostres.dll\", \"aphostservice.dll\", \"apisampling.dll\", \"apisetschema.dll\", \"apmon.dll\", \"apmonui.dll\", \"appcontracts.dll\", \"appextension.dll\", \"apphelp.dll\", \"apphlpdm.dll\", \"appidapi.dll\", \"appidsvc.dll\", \"appinfo.dll\", \"appinfoext.dll\", \"applicationframe.dll\", \"applockercsp.dll\", \"appmgmts.dll\", \"appmgr.dll\", \"appmon.dll\", \"appointmentapis.dll\", \"appraiser.dll\", \"appreadiness.dll\", \"apprepapi.dll\", \"appresolver.dll\", \"appsruprov.dll\", \"appvcatalog.dll\", \"appvclientps.dll\", \"appvetwclientres.dll\", \"appvintegration.dll\", \"appvmanifest.dll\", \"appvpolicy.dll\", \"appvpublishing.dll\", \"appvreporting.dll\", \"appvscripting.dll\", \"appvsentinel.dll\", \"appvstreamingux.dll\", \"appvstreammap.dll\", \"appvterminator.dll\", \"appxalluserstore.dll\", \"appxpackaging.dll\", \"appxsip.dll\", \"appxsysprep.dll\", \"archiveint.dll\", \"asferror.dll\", \"aspnet_counters.dll\", \"asycfilt.dll\", \"atl.dll\", \"atlthunk.dll\", \"atmlib.dll\", \"audioeng.dll\", \"audiohandlers.dll\", \"audiokse.dll\", \"audioses.dll\", \"audiosrv.dll\", \"auditcse.dll\", \"auditpolcore.dll\", \"auditpolmsg.dll\", \"authbroker.dll\", \"authbrokerui.dll\", \"authentication.dll\", \"authext.dll\", \"authfwcfg.dll\", \"authfwgp.dll\", \"authfwsnapin.dll\", \"authfwwizfwk.dll\", \"authhostproxy.dll\", \"authui.dll\", \"authz.dll\", \"autopilot.dll\", \"autopilotdiag.dll\", \"autoplay.dll\", \"autotimesvc.dll\", \"avicap32.dll\", \"avifil32.dll\", \"avrt.dll\", \"axinstsv.dll\", \"azroles.dll\", \"azroleui.dll\", \"azsqlext.dll\", \"basecsp.dll\", \"basesrv.dll\", \"batmeter.dll\", \"bcastdvrbroker.dll\", \"bcastdvrclient.dll\", \"bcastdvrcommon.dll\", \"bcd.dll\", \"bcdprov.dll\", \"bcdsrv.dll\", \"bcp47langs.dll\", \"bcp47mrm.dll\", \"bcrypt.dll\", \"bcryptprimitives.dll\", \"bdehdcfglib.dll\", \"bderepair.dll\", \"bdesvc.dll\", \"bdesysprep.dll\", \"bdeui.dll\", \"bfe.dll\", \"bi.dll\", \"bidispl.dll\", \"bindfltapi.dll\", \"bingasds.dll\", \"bingfilterds.dll\", \"bingmaps.dll\", \"biocredprov.dll\", \"bisrv.dll\", \"bitlockercsp.dll\", \"bitsigd.dll\", \"bitsperf.dll\", \"bitsproxy.dll\", \"biwinrt.dll\", \"blbevents.dll\", \"blbres.dll\", \"blb_ps.dll\", \"bluetoothapis.dll\", \"bnmanager.dll\", \"bootmenuux.dll\", \"bootstr.dll\", \"bootux.dll\", \"bootvid.dll\", \"bridgeres.dll\", \"brokerlib.dll\", \"browcli.dll\", \"browserbroker.dll\", \"browseui.dll\", \"btagservice.dll\", \"bthavctpsvc.dll\", \"bthavrcp.dll\", \"bthavrcpappsvc.dll\", \"bthci.dll\", \"bthpanapi.dll\", \"bthradiomedia.dll\", \"bthserv.dll\", \"bthtelemetry.dll\", \"btpanui.dll\", \"bwcontexthandler.dll\", \"cabapi.dll\", \"cabinet.dll\", \"cabview.dll\", \"callbuttons.dll\", \"cameracaptureui.dll\", \"capauthz.dll\", \"capiprovider.dll\", \"capisp.dll\", \"captureservice.dll\", \"castingshellext.dll\", \"castlaunch.dll\", \"catsrv.dll\", \"catsrvps.dll\", \"catsrvut.dll\", \"cbdhsvc.dll\", \"cca.dll\", \"cdd.dll\", \"cdosys.dll\", \"cdp.dll\", \"cdprt.dll\", \"cdpsvc.dll\", \"cdpusersvc.dll\", \"cemapi.dll\", \"certca.dll\", \"certcli.dll\", \"certcredprovider.dll\", \"certenc.dll\", \"certenroll.dll\", \"certenrollui.dll\", \"certmgr.dll\", \"certpkicmdlet.dll\", \"certpoleng.dll\", \"certprop.dll\", \"cewmdm.dll\", \"cfgbkend.dll\", \"cfgmgr32.dll\", \"cfgspcellular.dll\", \"cfgsppolicy.dll\", \"cflapi.dll\", \"cfmifs.dll\", \"cfmifsproxy.dll\", \"chakra.dll\", \"chakradiag.dll\", \"chakrathunk.dll\", \"chartv.dll\", \"chatapis.dll\", \"chkwudrv.dll\", \"chsstrokeds.dll\", \"chtbopomofods.dll\", \"chtcangjieds.dll\", \"chthkstrokeds.dll\", \"chtquickds.dll\", \"chxapds.dll\", \"chxdecoder.dll\", \"chxhapds.dll\", \"chxinputrouter.dll\", \"chxranker.dll\", \"ci.dll\", \"cic.dll\", \"cimfs.dll\", \"circoinst.dll\", \"ciwmi.dll\", \"clb.dll\", \"clbcatq.dll\", \"cldapi.dll\", \"cleanpccsp.dll\", \"clfsw32.dll\", \"cliconfg.dll\", \"clipboardserver.dll\", \"clipc.dll\", \"clipsvc.dll\", \"clipwinrt.dll\", \"cloudap.dll\", \"cloudidsvc.dll\", \"clrhost.dll\", \"clusapi.dll\", \"cmcfg32.dll\", \"cmdext.dll\", \"cmdial32.dll\", \"cmgrcspps.dll\", \"cmifw.dll\", \"cmintegrator.dll\", \"cmlua.dll\", \"cmpbk32.dll\", \"cmstplua.dll\", \"cmutil.dll\", \"cngcredui.dll\", \"cngprovider.dll\", \"cnvfat.dll\", \"cofiredm.dll\", \"colbact.dll\", \"colorcnv.dll\", \"colorui.dll\", \"combase.dll\", \"comcat.dll\", \"comctl32.dll\", \"comdlg32.dll\", \"coml2.dll\", \"comppkgsup.dll\", \"compstui.dll\", \"computecore.dll\", \"computenetwork.dll\", \"computestorage.dll\", \"comrepl.dll\", \"comres.dll\", \"comsnap.dll\", \"comsvcs.dll\", \"comuid.dll\", \"configmanager2.dll\", \"conhostv1.dll\", \"connect.dll\", \"consentux.dll\", \"consentuxclient.dll\", \"console.dll\", \"consolelogon.dll\", \"contactapis.dll\", \"container.dll\", \"coredpus.dll\", \"coreglobconfig.dll\", \"coremas.dll\", \"coremessaging.dll\", \"coremmres.dll\", \"coreshell.dll\", \"coreshellapi.dll\", \"coreuicomponents.dll\", \"correngine.dll\", \"courtesyengine.dll\", \"cpfilters.dll\", \"creddialogbroker.dll\", \"credprovhelper.dll\", \"credprovhost.dll\", \"credprovs.dll\", \"credprovslegacy.dll\", \"credssp.dll\", \"credui.dll\", \"crypt32.dll\", \"cryptbase.dll\", \"cryptcatsvc.dll\", \"cryptdlg.dll\", \"cryptdll.dll\", \"cryptext.dll\", \"cryptnet.dll\", \"cryptngc.dll\", \"cryptowinrt.dll\", \"cryptsp.dll\", \"cryptsvc.dll\", \"crypttpmeksvc.dll\", \"cryptui.dll\", \"cryptuiwizard.dll\", \"cryptxml.dll\", \"cscapi.dll\", \"cscdll.dll\", \"cscmig.dll\", \"cscobj.dll\", \"cscsvc.dll\", \"cscui.dll\", \"csplte.dll\", \"cspproxy.dll\", \"csrsrv.dll\", \"cxcredprov.dll\", \"c_g18030.dll\", \"c_gsm7.dll\", \"c_is2022.dll\", \"c_iscii.dll\", \"d2d1.dll\", \"d3d10.dll\", \"d3d10core.dll\", \"d3d10level9.dll\", \"d3d10warp.dll\", \"d3d10_1.dll\", \"d3d10_1core.dll\", \"d3d11.dll\", \"d3d11on12.dll\", \"d3d12.dll\", \"d3d12core.dll\", \"d3d8thk.dll\", \"d3d9.dll\", \"d3d9on12.dll\", \"d3dscache.dll\", \"dab.dll\", \"dabapi.dll\", \"daconn.dll\", \"dafbth.dll\", \"dafdnssd.dll\", \"dafescl.dll\", \"dafgip.dll\", \"dafiot.dll\", \"dafipp.dll\", \"dafmcp.dll\", \"dafpos.dll\", \"dafprintprovider.dll\", \"dafupnp.dll\", \"dafwcn.dll\", \"dafwfdprovider.dll\", \"dafwiprov.dll\", \"dafwsd.dll\", \"damediamanager.dll\", \"damm.dll\", \"das.dll\", \"dataclen.dll\", \"datusage.dll\", \"davclnt.dll\", \"davhlpr.dll\", \"davsyncprovider.dll\", \"daxexec.dll\", \"dbgcore.dll\", \"dbgeng.dll\", \"dbghelp.dll\", \"dbgmodel.dll\", \"dbnetlib.dll\", \"dbnmpntw.dll\", \"dciman32.dll\", \"dcntel.dll\", \"dcomp.dll\", \"ddaclsys.dll\", \"ddcclaimsapi.dll\", \"ddds.dll\", \"ddisplay.dll\", \"ddoiproxy.dll\", \"ddores.dll\", \"ddpchunk.dll\", \"ddptrace.dll\", \"ddputils.dll\", \"ddp_ps.dll\", \"ddraw.dll\", \"ddrawex.dll\", \"defragproxy.dll\", \"defragres.dll\", \"defragsvc.dll\", \"deploymentcsps.dll\", \"deskadp.dll\", \"deskmon.dll\", \"desktopshellext.dll\", \"devenum.dll\", \"deviceaccess.dll\", \"devicecenter.dll\", \"devicecredential.dll\", \"devicepairing.dll\", \"deviceuxres.dll\", \"devinv.dll\", \"devmgr.dll\", \"devobj.dll\", \"devpropmgr.dll\", \"devquerybroker.dll\", \"devrtl.dll\", \"dfdts.dll\", \"dfscli.dll\", \"dfshim.dll\", \"dfsshlex.dll\", \"dggpext.dll\", \"dhcpcmonitor.dll\", \"dhcpcore.dll\", \"dhcpcore6.dll\", \"dhcpcsvc.dll\", \"dhcpcsvc6.dll\", \"dhcpsapi.dll\", \"diagcpl.dll\", \"diagnosticlogcsp.dll\", \"diagperf.dll\", \"diagsvc.dll\", \"diagtrack.dll\", \"dialclient.dll\", \"dialserver.dll\", \"dictationmanager.dll\", \"difxapi.dll\", \"dimsjob.dll\", \"dimsroam.dll\", \"dinput.dll\", \"dinput8.dll\", \"direct2ddesktop.dll\", \"directml.dll\", \"discan.dll\", \"dismapi.dll\", \"dispbroker.dll\", \"dispex.dll\", \"display.dll\", \"displaymanager.dll\", \"dlnashext.dll\", \"dmappsres.dll\", \"dmcfgutils.dll\", \"dmcmnutils.dll\", \"dmcsps.dll\", \"dmdlgs.dll\", \"dmdskmgr.dll\", \"dmdskres.dll\", \"dmdskres2.dll\", \"dmenrollengine.dll\", \"dmintf.dll\", \"dmiso8601utils.dll\", \"dmloader.dll\", \"dmocx.dll\", \"dmoleaututils.dll\", \"dmpushproxy.dll\", \"dmpushroutercore.dll\", \"dmrcdecoder.dll\", \"dmrserver.dll\", \"dmsynth.dll\", \"dmusic.dll\", \"dmutil.dll\", \"dmvdsitf.dll\", \"dmwappushsvc.dll\", \"dmwmicsp.dll\", \"dmxmlhelputils.dll\", \"dnsapi.dll\", \"dnscmmc.dll\", \"dnsext.dll\", \"dnshc.dll\", \"dnsrslvr.dll\", \"docprop.dll\", \"dolbydecmft.dll\", \"domgmt.dll\", \"dosettings.dll\", \"dosvc.dll\", \"dot3api.dll\", \"dot3cfg.dll\", \"dot3conn.dll\", \"dot3dlg.dll\", \"dot3gpclnt.dll\", \"dot3gpui.dll\", \"dot3hc.dll\", \"dot3mm.dll\", \"dot3msm.dll\", \"dot3svc.dll\", \"dot3ui.dll\", \"dpapi.dll\", \"dpapiprovider.dll\", \"dpapisrv.dll\", \"dpnaddr.dll\", \"dpnathlp.dll\", \"dpnet.dll\", \"dpnhpast.dll\", \"dpnhupnp.dll\", \"dpnlobby.dll\", \"dps.dll\", \"dpx.dll\", \"drprov.dll\", \"drt.dll\", \"drtprov.dll\", \"drttransport.dll\", \"drvsetup.dll\", \"drvstore.dll\", \"dsauth.dll\", \"dsccore.dll\", \"dsccoreconfprov.dll\", \"dsclient.dll\", \"dscproxy.dll\", \"dsctimer.dll\", \"dsdmo.dll\", \"dskquota.dll\", \"dskquoui.dll\", \"dsound.dll\", \"dsparse.dll\", \"dsprop.dll\", \"dsquery.dll\", \"dsreg.dll\", \"dsregtask.dll\", \"dsrole.dll\", \"dssec.dll\", \"dssenh.dll\", \"dssvc.dll\", \"dsui.dll\", \"dsuiext.dll\", \"dswave.dll\", \"dtsh.dll\", \"ducsps.dll\", \"dui70.dll\", \"duser.dll\", \"dusmapi.dll\", \"dusmsvc.dll\", \"dwmapi.dll\", \"dwmcore.dll\", \"dwmghost.dll\", \"dwminit.dll\", \"dwmredir.dll\", \"dwmscene.dll\", \"dwrite.dll\", \"dxcore.dll\", \"dxdiagn.dll\", \"dxgi.dll\", \"dxgwdi.dll\", \"dxilconv.dll\", \"dxmasf.dll\", \"dxp.dll\", \"dxpps.dll\", \"dxptasksync.dll\", \"dxtmsft.dll\", \"dxtrans.dll\", \"dxva2.dll\", \"dynamoapi.dll\", \"eapp3hst.dll\", \"eappcfg.dll\", \"eappcfgui.dll\", \"eappgnui.dll\", \"eapphost.dll\", \"eappprxy.dll\", \"eapprovp.dll\", \"eapputil.dll\", \"eapsimextdesktop.dll\", \"eapsvc.dll\", \"eapteapauth.dll\", \"eapteapconfig.dll\", \"eapteapext.dll\", \"easconsent.dll\", \"easwrt.dll\", \"edgeangle.dll\", \"edgecontent.dll\", \"edgehtml.dll\", \"edgeiso.dll\", \"edgemanager.dll\", \"edpauditapi.dll\", \"edpcsp.dll\", \"edptask.dll\", \"edputil.dll\", \"eeprov.dll\", \"eeutil.dll\", \"efsadu.dll\", \"efscore.dll\", \"efsext.dll\", \"efslsaext.dll\", \"efssvc.dll\", \"efsutil.dll\", \"efswrt.dll\", \"ehstorapi.dll\", \"ehstorpwdmgr.dll\", \"ehstorshell.dll\", \"els.dll\", \"elscore.dll\", \"elshyph.dll\", \"elslad.dll\", \"elstrans.dll\", \"emailapis.dll\", \"embeddedmodesvc.dll\", \"emojids.dll\", \"encapi.dll\", \"energy.dll\", \"energyprov.dll\", \"energytask.dll\", \"enrollmentapi.dll\", \"enterpriseapncsp.dll\", \"enterprisecsps.dll\", \"enterpriseetw.dll\", \"eqossnap.dll\", \"errordetails.dll\", \"errordetailscore.dll\", \"es.dll\", \"esclprotocol.dll\", \"esclscan.dll\", \"esclwiadriver.dll\", \"esdsip.dll\", \"esent.dll\", \"esentprf.dll\", \"esevss.dll\", \"eshims.dll\", \"etwrundown.dll\", \"euiccscsp.dll\", \"eventaggregation.dll\", \"eventcls.dll\", \"evr.dll\", \"execmodelclient.dll\", \"execmodelproxy.dll\", \"explorerframe.dll\", \"exsmime.dll\", \"extrasxmlparser.dll\", \"f3ahvoas.dll\", \"facilitator.dll\", \"familysafetyext.dll\", \"faultrep.dll\", \"fcon.dll\", \"fdbth.dll\", \"fdbthproxy.dll\", \"fddevquery.dll\", \"fde.dll\", \"fdeploy.dll\", \"fdphost.dll\", \"fdpnp.dll\", \"fdprint.dll\", \"fdproxy.dll\", \"fdrespub.dll\", \"fdssdp.dll\", \"fdwcn.dll\", \"fdwnet.dll\", \"fdwsd.dll\", \"feclient.dll\", \"ffbroker.dll\", \"fhcat.dll\", \"fhcfg.dll\", \"fhcleanup.dll\", \"fhcpl.dll\", \"fhengine.dll\", \"fhevents.dll\", \"fhshl.dll\", \"fhsrchapi.dll\", \"fhsrchph.dll\", \"fhsvc.dll\", \"fhsvcctl.dll\", \"fhtask.dll\", \"fhuxadapter.dll\", \"fhuxapi.dll\", \"fhuxcommon.dll\", \"fhuxgraphics.dll\", \"fhuxpresentation.dll\", \"fidocredprov.dll\", \"filemgmt.dll\", \"filterds.dll\", \"findnetprinters.dll\", \"firewallapi.dll\", \"flightsettings.dll\", \"fltlib.dll\", \"fluencyds.dll\", \"fmapi.dll\", \"fmifs.dll\", \"fms.dll\", \"fntcache.dll\", \"fontext.dll\", \"fontprovider.dll\", \"fontsub.dll\", \"fphc.dll\", \"framedyn.dll\", \"framedynos.dll\", \"frameserver.dll\", \"frprov.dll\", \"fsutilext.dll\", \"fthsvc.dll\", \"fundisc.dll\", \"fveapi.dll\", \"fveapibase.dll\", \"fvecerts.dll\", \"fvecpl.dll\", \"fveskybackup.dll\", \"fveui.dll\", \"fvewiz.dll\", \"fwbase.dll\", \"fwcfg.dll\", \"fwmdmcsp.dll\", \"fwpolicyiomgr.dll\", \"fwpuclnt.dll\", \"fwremotesvr.dll\", \"gameinput.dll\", \"gamemode.dll\", \"gamestreamingext.dll\", \"gameux.dll\", \"gamingtcui.dll\", \"gcdef.dll\", \"gdi32.dll\", \"gdi32full.dll\", \"gdiplus.dll\", \"generaltel.dll\", \"geocommon.dll\", \"geolocation.dll\", \"getuname.dll\", \"glmf32.dll\", \"globinputhost.dll\", \"glu32.dll\", \"gmsaclient.dll\", \"gpapi.dll\", \"gpcsewrappercsp.dll\", \"gpedit.dll\", \"gpprefcl.dll\", \"gpprnext.dll\", \"gpscript.dll\", \"gpsvc.dll\", \"gptext.dll\", \"graphicscapture.dll\", \"graphicsperfsvc.dll\", \"groupinghc.dll\", \"hal.dll\", \"halextpl080.dll\", \"hascsp.dll\", \"hashtagds.dll\", \"hbaapi.dll\", \"hcproviders.dll\", \"hdcphandler.dll\", \"heatcore.dll\", \"helppaneproxy.dll\", \"hgcpl.dll\", \"hhsetup.dll\", \"hid.dll\", \"hidcfu.dll\", \"hidserv.dll\", \"hlink.dll\", \"hmkd.dll\", \"hnetcfg.dll\", \"hnetcfgclient.dll\", \"hnetmon.dll\", \"hologramworld.dll\", \"holoshellruntime.dll\", \"holoshextensions.dll\", \"hotplug.dll\", \"hrtfapo.dll\", \"httpapi.dll\", \"httpprxc.dll\", \"httpprxm.dll\", \"httpprxp.dll\", \"httpsdatasource.dll\", \"htui.dll\", \"hvhostsvc.dll\", \"hvloader.dll\", \"hvsigpext.dll\", \"hvsocket.dll\", \"hydrogen.dll\", \"ia2comproxy.dll\", \"ias.dll\", \"iasacct.dll\", \"iasads.dll\", \"iasdatastore.dll\", \"iashlpr.dll\", \"iasmigplugin.dll\", \"iasnap.dll\", \"iaspolcy.dll\", \"iasrad.dll\", \"iasrecst.dll\", \"iassam.dll\", \"iassdo.dll\", \"iassvcs.dll\", \"icfupgd.dll\", \"icm32.dll\", \"icmp.dll\", \"icmui.dll\", \"iconcodecservice.dll\", \"icsigd.dll\", \"icsvc.dll\", \"icsvcext.dll\", \"icu.dll\", \"icuin.dll\", \"icuuc.dll\", \"idctrls.dll\", \"idlisten.dll\", \"idndl.dll\", \"idstore.dll\", \"ieadvpack.dll\", \"ieapfltr.dll\", \"iedkcs32.dll\", \"ieframe.dll\", \"iemigplugin.dll\", \"iepeers.dll\", \"ieproxy.dll\", \"iernonce.dll\", \"iertutil.dll\", \"iesetup.dll\", \"iesysprep.dll\", \"ieui.dll\", \"ifmon.dll\", \"ifsutil.dll\", \"ifsutilx.dll\", \"igddiag.dll\", \"ihds.dll\", \"ikeext.dll\", \"imagehlp.dll\", \"imageres.dll\", \"imagesp1.dll\", \"imapi.dll\", \"imapi2.dll\", \"imapi2fs.dll\", \"imgutil.dll\", \"imm32.dll\", \"implatsetup.dll\", \"indexeddblegacy.dll\", \"inetcomm.dll\", \"inetmib1.dll\", \"inetpp.dll\", \"inetppui.dll\", \"inetres.dll\", \"inked.dll\", \"inkobjcore.dll\", \"inproclogger.dll\", \"input.dll\", \"inputcloudstore.dll\", \"inputcontroller.dll\", \"inputhost.dll\", \"inputservice.dll\", \"inputswitch.dll\", \"inseng.dll\", \"installservice.dll\", \"internetmail.dll\", \"internetmailcsp.dll\", \"invagent.dll\", \"iologmsg.dll\", \"iphlpapi.dll\", \"iphlpsvc.dll\", \"ipnathlp.dll\", \"ipnathlpclient.dll\", \"ippcommon.dll\", \"ippcommonproxy.dll\", \"iprtprio.dll\", \"iprtrmgr.dll\", \"ipsecsnp.dll\", \"ipsecsvc.dll\", \"ipsmsnap.dll\", \"ipxlatcfg.dll\", \"iri.dll\", \"iscsicpl.dll\", \"iscsidsc.dll\", \"iscsied.dll\", \"iscsiexe.dll\", \"iscsilog.dll\", \"iscsium.dll\", \"iscsiwmi.dll\", \"iscsiwmiv2.dll\", \"ism.dll\", \"itircl.dll\", \"itss.dll\", \"iuilp.dll\", \"iumbase.dll\", \"iumcrypt.dll\", \"iumdll.dll\", \"iumsdk.dll\", \"iyuv_32.dll\", \"joinproviderol.dll\", \"joinutil.dll\", \"jpmapcontrol.dll\", \"jpndecoder.dll\", \"jpninputrouter.dll\", \"jpnranker.dll\", \"jpnserviceds.dll\", \"jscript.dll\", \"jscript9.dll\", \"jscript9diag.dll\", \"jsproxy.dll\", \"kbd101.dll\", \"kbd101a.dll\", \"kbd101b.dll\", \"kbd101c.dll\", \"kbd103.dll\", \"kbd106.dll\", \"kbd106n.dll\", \"kbda1.dll\", \"kbda2.dll\", \"kbda3.dll\", \"kbdadlm.dll\", \"kbdal.dll\", \"kbdarme.dll\", \"kbdarmph.dll\", \"kbdarmty.dll\", \"kbdarmw.dll\", \"kbdax2.dll\", \"kbdaze.dll\", \"kbdazel.dll\", \"kbdazst.dll\", \"kbdbash.dll\", \"kbdbe.dll\", \"kbdbene.dll\", \"kbdbgph.dll\", \"kbdbgph1.dll\", \"kbdbhc.dll\", \"kbdblr.dll\", \"kbdbr.dll\", \"kbdbu.dll\", \"kbdbug.dll\", \"kbdbulg.dll\", \"kbdca.dll\", \"kbdcan.dll\", \"kbdcher.dll\", \"kbdcherp.dll\", \"kbdcr.dll\", \"kbdcz.dll\", \"kbdcz1.dll\", \"kbdcz2.dll\", \"kbdda.dll\", \"kbddiv1.dll\", \"kbddiv2.dll\", \"kbddv.dll\", \"kbddzo.dll\", \"kbdes.dll\", \"kbdest.dll\", \"kbdfa.dll\", \"kbdfar.dll\", \"kbdfc.dll\", \"kbdfi.dll\", \"kbdfi1.dll\", \"kbdfo.dll\", \"kbdfr.dll\", \"kbdfthrk.dll\", \"kbdgae.dll\", \"kbdgeo.dll\", \"kbdgeoer.dll\", \"kbdgeome.dll\", \"kbdgeooa.dll\", \"kbdgeoqw.dll\", \"kbdgkl.dll\", \"kbdgn.dll\", \"kbdgr.dll\", \"kbdgr1.dll\", \"kbdgrlnd.dll\", \"kbdgthc.dll\", \"kbdhau.dll\", \"kbdhaw.dll\", \"kbdhe.dll\", \"kbdhe220.dll\", \"kbdhe319.dll\", \"kbdheb.dll\", \"kbdhebl3.dll\", \"kbdhela2.dll\", \"kbdhela3.dll\", \"kbdhept.dll\", \"kbdhu.dll\", \"kbdhu1.dll\", \"kbdibm02.dll\", \"kbdibo.dll\", \"kbdic.dll\", \"kbdinasa.dll\", \"kbdinbe1.dll\", \"kbdinbe2.dll\", \"kbdinben.dll\", \"kbdindev.dll\", \"kbdinen.dll\", \"kbdinguj.dll\", \"kbdinhin.dll\", \"kbdinkan.dll\", \"kbdinmal.dll\", \"kbdinmar.dll\", \"kbdinori.dll\", \"kbdinpun.dll\", \"kbdintam.dll\", \"kbdintel.dll\", \"kbdinuk2.dll\", \"kbdir.dll\", \"kbdit.dll\", \"kbdit142.dll\", \"kbdiulat.dll\", \"kbdjav.dll\", \"kbdjpn.dll\", \"kbdkaz.dll\", \"kbdkhmr.dll\", \"kbdkni.dll\", \"kbdkor.dll\", \"kbdkurd.dll\", \"kbdkyr.dll\", \"kbdla.dll\", \"kbdlao.dll\", \"kbdlisub.dll\", \"kbdlisus.dll\", \"kbdlk41a.dll\", \"kbdlt.dll\", \"kbdlt1.dll\", \"kbdlt2.dll\", \"kbdlv.dll\", \"kbdlv1.dll\", \"kbdlvst.dll\", \"kbdmac.dll\", \"kbdmacst.dll\", \"kbdmaori.dll\", \"kbdmlt47.dll\", \"kbdmlt48.dll\", \"kbdmon.dll\", \"kbdmonmo.dll\", \"kbdmonst.dll\", \"kbdmyan.dll\", \"kbdne.dll\", \"kbdnec.dll\", \"kbdnec95.dll\", \"kbdnecat.dll\", \"kbdnecnt.dll\", \"kbdnepr.dll\", \"kbdnko.dll\", \"kbdno.dll\", \"kbdno1.dll\", \"kbdnso.dll\", \"kbdntl.dll\", \"kbdogham.dll\", \"kbdolch.dll\", \"kbdoldit.dll\", \"kbdosa.dll\", \"kbdosm.dll\", \"kbdpash.dll\", \"kbdphags.dll\", \"kbdpl.dll\", \"kbdpl1.dll\", \"kbdpo.dll\", \"kbdro.dll\", \"kbdropr.dll\", \"kbdrost.dll\", \"kbdru.dll\", \"kbdru1.dll\", \"kbdrum.dll\", \"kbdsf.dll\", \"kbdsg.dll\", \"kbdsl.dll\", \"kbdsl1.dll\", \"kbdsmsfi.dll\", \"kbdsmsno.dll\", \"kbdsn1.dll\", \"kbdsora.dll\", \"kbdsorex.dll\", \"kbdsors1.dll\", \"kbdsorst.dll\", \"kbdsp.dll\", \"kbdsw.dll\", \"kbdsw09.dll\", \"kbdsyr1.dll\", \"kbdsyr2.dll\", \"kbdtaile.dll\", \"kbdtajik.dll\", \"kbdtam99.dll\", \"kbdtat.dll\", \"kbdth0.dll\", \"kbdth1.dll\", \"kbdth2.dll\", \"kbdth3.dll\", \"kbdtifi.dll\", \"kbdtifi2.dll\", \"kbdtiprc.dll\", \"kbdtiprd.dll\", \"kbdtt102.dll\", \"kbdtuf.dll\", \"kbdtuq.dll\", \"kbdturme.dll\", \"kbdtzm.dll\", \"kbdughr.dll\", \"kbdughr1.dll\", \"kbduk.dll\", \"kbdukx.dll\", \"kbdur.dll\", \"kbdur1.dll\", \"kbdurdu.dll\", \"kbdus.dll\", \"kbdusa.dll\", \"kbdusl.dll\", \"kbdusr.dll\", \"kbdusx.dll\", \"kbduzb.dll\", \"kbdvntc.dll\", \"kbdwol.dll\", \"kbdyak.dll\", \"kbdyba.dll\", \"kbdycc.dll\", \"kbdycl.dll\", \"kd.dll\", \"kdcom.dll\", \"kdcpw.dll\", \"kdhvcom.dll\", \"kdnet.dll\", \"kdnet_uart16550.dll\", \"kdscli.dll\", \"kdstub.dll\", \"kdusb.dll\", \"kd_02_10df.dll\", \"kd_02_10ec.dll\", \"kd_02_1137.dll\", \"kd_02_14e4.dll\", \"kd_02_15b3.dll\", \"kd_02_1969.dll\", \"kd_02_19a2.dll\", \"kd_02_1af4.dll\", \"kd_02_8086.dll\", \"kd_07_1415.dll\", \"kd_0c_8086.dll\", \"kerbclientshared.dll\", \"kerberos.dll\", \"kernel32.dll\", \"kernelbase.dll\", \"keycredmgr.dll\", \"keyiso.dll\", \"keymgr.dll\", \"knobscore.dll\", \"knobscsp.dll\", \"ksuser.dll\", \"ktmw32.dll\", \"l2gpstore.dll\", \"l2nacp.dll\", \"l2sechc.dll\", \"laprxy.dll\", \"legacynetux.dll\", \"lfsvc.dll\", \"libcrypto.dll\", \"licensemanager.dll\", \"licensingcsp.dll\", \"licensingdiagspp.dll\", \"licensingwinrt.dll\", \"licmgr10.dll\", \"linkinfo.dll\", \"lltdapi.dll\", \"lltdres.dll\", \"lltdsvc.dll\", \"lmhsvc.dll\", \"loadperf.dll\", \"localsec.dll\", \"localspl.dll\", \"localui.dll\", \"locationapi.dll\", \"lockappbroker.dll\", \"lockcontroller.dll\", \"lockscreendata.dll\", \"loghours.dll\", \"logoncli.dll\", \"logoncontroller.dll\", \"lpasvc.dll\", \"lpk.dll\", \"lsasrv.dll\", \"lscshostpolicy.dll\", \"lsm.dll\", \"lsmproxy.dll\", \"lstelemetry.dll\", \"luainstall.dll\", \"luiapi.dll\", \"lz32.dll\", \"magnification.dll\", \"maintenanceui.dll\", \"manageci.dll\", \"mapconfiguration.dll\", \"mapcontrolcore.dll\", \"mapgeocoder.dll\", \"mapi32.dll\", \"mapistub.dll\", \"maprouter.dll\", \"mapsbtsvc.dll\", \"mapsbtsvcproxy.dll\", \"mapscsp.dll\", \"mapsstore.dll\", \"mapstoasttask.dll\", \"mapsupdatetask.dll\", \"mbaeapi.dll\", \"mbaeapipublic.dll\", \"mbaexmlparser.dll\", \"mbmediamanager.dll\", \"mbsmsapi.dll\", \"mbussdapi.dll\", \"mccsengineshared.dll\", \"mccspal.dll\", \"mciavi32.dll\", \"mcicda.dll\", \"mciqtz32.dll\", \"mciseq.dll\", \"mciwave.dll\", \"mcrecvsrc.dll\", \"mdmcommon.dll\", \"mdmdiagnostics.dll\", \"mdminst.dll\", \"mdmmigrator.dll\", \"mdmregistration.dll\", \"memorydiagnostic.dll\", \"messagingservice.dll\", \"mf.dll\", \"mf3216.dll\", \"mfaacenc.dll\", \"mfasfsrcsnk.dll\", \"mfaudiocnv.dll\", \"mfc42.dll\", \"mfc42u.dll\", \"mfcaptureengine.dll\", \"mfcore.dll\", \"mfcsubs.dll\", \"mfds.dll\", \"mfdvdec.dll\", \"mferror.dll\", \"mfh263enc.dll\", \"mfh264enc.dll\", \"mfksproxy.dll\", \"mfmediaengine.dll\", \"mfmjpegdec.dll\", \"mfmkvsrcsnk.dll\", \"mfmp4srcsnk.dll\", \"mfmpeg2srcsnk.dll\", \"mfnetcore.dll\", \"mfnetsrc.dll\", \"mfperfhelper.dll\", \"mfplat.dll\", \"mfplay.dll\", \"mfps.dll\", \"mfreadwrite.dll\", \"mfsensorgroup.dll\", \"mfsrcsnk.dll\", \"mfsvr.dll\", \"mftranscode.dll\", \"mfvdsp.dll\", \"mfvfw.dll\", \"mfwmaaec.dll\", \"mgmtapi.dll\", \"mi.dll\", \"mibincodec.dll\", \"midimap.dll\", \"migisol.dll\", \"miguiresource.dll\", \"mimefilt.dll\", \"mimofcodec.dll\", \"minstoreevents.dll\", \"miracastinputmgr.dll\", \"miracastreceiver.dll\", \"mirrordrvcompat.dll\", \"mispace.dll\", \"mitigationclient.dll\", \"miutils.dll\", \"mlang.dll\", \"mmcbase.dll\", \"mmcndmgr.dll\", \"mmcshext.dll\", \"mmdevapi.dll\", \"mmgaclient.dll\", \"mmgaproxystub.dll\", \"mmres.dll\", \"mobilenetworking.dll\", \"modemui.dll\", \"modernexecserver.dll\", \"moricons.dll\", \"moshost.dll\", \"moshostclient.dll\", \"moshostcore.dll\", \"mosstorage.dll\", \"mp3dmod.dll\", \"mp43decd.dll\", \"mp4sdecd.dll\", \"mpeval.dll\", \"mpg4decd.dll\", \"mpr.dll\", \"mprapi.dll\", \"mprddm.dll\", \"mprdim.dll\", \"mprext.dll\", \"mprmsg.dll\", \"mpssvc.dll\", \"mpunits.dll\", \"mrmcorer.dll\", \"mrmdeploy.dll\", \"mrmindexer.dll\", \"mrt100.dll\", \"mrt_map.dll\", \"msaatext.dll\", \"msac3enc.dll\", \"msacm32.dll\", \"msafd.dll\", \"msajapi.dll\", \"msalacdecoder.dll\", \"msalacencoder.dll\", \"msamrnbdecoder.dll\", \"msamrnbencoder.dll\", \"msamrnbsink.dll\", \"msamrnbsource.dll\", \"msasn1.dll\", \"msauddecmft.dll\", \"msaudite.dll\", \"msauserext.dll\", \"mscandui.dll\", \"mscat32.dll\", \"msclmd.dll\", \"mscms.dll\", \"mscoree.dll\", \"mscorier.dll\", \"mscories.dll\", \"msctf.dll\", \"msctfmonitor.dll\", \"msctfp.dll\", \"msctfui.dll\", \"msctfuimanager.dll\", \"msdadiag.dll\", \"msdart.dll\", \"msdelta.dll\", \"msdmo.dll\", \"msdrm.dll\", \"msdtckrm.dll\", \"msdtclog.dll\", \"msdtcprx.dll\", \"msdtcspoffln.dll\", \"msdtctm.dll\", \"msdtcuiu.dll\", \"msdtcvsp1res.dll\", \"msfeeds.dll\", \"msfeedsbs.dll\", \"msflacdecoder.dll\", \"msflacencoder.dll\", \"msftedit.dll\", \"msheif.dll\", \"mshtml.dll\", \"mshtmldac.dll\", \"mshtmled.dll\", \"mshtmler.dll\", \"msi.dll\", \"msicofire.dll\", \"msidcrl40.dll\", \"msident.dll\", \"msidle.dll\", \"msidntld.dll\", \"msieftp.dll\", \"msihnd.dll\", \"msiltcfg.dll\", \"msimg32.dll\", \"msimsg.dll\", \"msimtf.dll\", \"msisip.dll\", \"msiso.dll\", \"msiwer.dll\", \"mskeyprotcli.dll\", \"mskeyprotect.dll\", \"msls31.dll\", \"msmpeg2adec.dll\", \"msmpeg2enc.dll\", \"msmpeg2vdec.dll\", \"msobjs.dll\", \"msoert2.dll\", \"msopusdecoder.dll\", \"mspatcha.dll\", \"mspatchc.dll\", \"msphotography.dll\", \"msports.dll\", \"msprivs.dll\", \"msrahc.dll\", \"msrating.dll\", \"msrawimage.dll\", \"msrdc.dll\", \"msrdpwebaccess.dll\", \"msrle32.dll\", \"msscntrs.dll\", \"mssecuser.dll\", \"mssign32.dll\", \"mssip32.dll\", \"mssitlb.dll\", \"mssph.dll\", \"mssprxy.dll\", \"mssrch.dll\", \"mssvp.dll\", \"mstask.dll\", \"mstextprediction.dll\", \"mstscax.dll\", \"msutb.dll\", \"msv1_0.dll\", \"msvcirt.dll\", \"msvcp110_win.dll\", \"msvcp120_clr0400.dll\", \"msvcp140_clr0400.dll\", \"msvcp60.dll\", \"msvcp_win.dll\", \"msvcr100_clr0400.dll\", \"msvcr120_clr0400.dll\", \"msvcrt.dll\", \"msvfw32.dll\", \"msvidc32.dll\", \"msvidctl.dll\", \"msvideodsp.dll\", \"msvp9dec.dll\", \"msvproc.dll\", \"msvpxenc.dll\", \"mswb7.dll\", \"mswebp.dll\", \"mswmdm.dll\", \"mswsock.dll\", \"msxml3.dll\", \"msxml3r.dll\", \"msxml6.dll\", \"msxml6r.dll\", \"msyuv.dll\", \"mtcmodel.dll\", \"mtf.dll\", \"mtfappserviceds.dll\", \"mtfdecoder.dll\", \"mtffuzzyds.dll\", \"mtfserver.dll\", \"mtfspellcheckds.dll\", \"mtxclu.dll\", \"mtxdm.dll\", \"mtxex.dll\", \"mtxoci.dll\", \"muifontsetup.dll\", \"mycomput.dll\", \"mydocs.dll\", \"napcrypt.dll\", \"napinsp.dll\", \"naturalauth.dll\", \"naturallanguage6.dll\", \"navshutdown.dll\", \"ncaapi.dll\", \"ncasvc.dll\", \"ncbservice.dll\", \"ncdautosetup.dll\", \"ncdprop.dll\", \"nci.dll\", \"ncobjapi.dll\", \"ncrypt.dll\", \"ncryptprov.dll\", \"ncryptsslp.dll\", \"ncsi.dll\", \"ncuprov.dll\", \"nddeapi.dll\", \"ndfapi.dll\", \"ndfetw.dll\", \"ndfhcdiscovery.dll\", \"ndishc.dll\", \"ndproxystub.dll\", \"nduprov.dll\", \"negoexts.dll\", \"netapi32.dll\", \"netbios.dll\", \"netcenter.dll\", \"netcfgx.dll\", \"netcorehc.dll\", \"netdiagfx.dll\", \"netdriverinstall.dll\", \"netevent.dll\", \"netfxperf.dll\", \"neth.dll\", \"netid.dll\", \"netiohlp.dll\", \"netjoin.dll\", \"netlogon.dll\", \"netman.dll\", \"netmsg.dll\", \"netplwiz.dll\", \"netprofm.dll\", \"netprofmsvc.dll\", \"netprovfw.dll\", \"netprovisionsp.dll\", \"netsetupapi.dll\", \"netsetupengine.dll\", \"netsetupshim.dll\", \"netsetupsvc.dll\", \"netshell.dll\", \"nettrace.dll\", \"netutils.dll\", \"networkexplorer.dll\", \"networkhelper.dll\", \"networkicon.dll\", \"networkproxycsp.dll\", \"networkstatus.dll\", \"networkuxbroker.dll\", \"newdev.dll\", \"nfcradiomedia.dll\", \"ngccredprov.dll\", \"ngcctnr.dll\", \"ngcctnrsvc.dll\", \"ngcisoctnr.dll\", \"ngckeyenum.dll\", \"ngcksp.dll\", \"ngclocal.dll\", \"ngcpopkeysrv.dll\", \"ngcprocsp.dll\", \"ngcrecovery.dll\", \"ngcsvc.dll\", \"ngctasks.dll\", \"ninput.dll\", \"nlaapi.dll\", \"nlahc.dll\", \"nlasvc.dll\", \"nlhtml.dll\", \"nlmgp.dll\", \"nlmproxy.dll\", \"nlmsprep.dll\", \"nlsbres.dll\", \"nlsdata0000.dll\", \"nlsdata0009.dll\", \"nlsdl.dll\", \"nlslexicons0009.dll\", \"nmadirect.dll\", \"normaliz.dll\", \"npmproxy.dll\", \"npsm.dll\", \"nrpsrv.dll\", \"nshhttp.dll\", \"nshipsec.dll\", \"nshwfp.dll\", \"nsi.dll\", \"nsisvc.dll\", \"ntasn1.dll\", \"ntdll.dll\", \"ntdsapi.dll\", \"ntlanman.dll\", \"ntlanui2.dll\", \"ntlmshared.dll\", \"ntmarta.dll\", \"ntprint.dll\", \"ntshrui.dll\", \"ntvdm64.dll\", \"objsel.dll\", \"occache.dll\", \"ocsetapi.dll\", \"odbc32.dll\", \"odbcbcp.dll\", \"odbcconf.dll\", \"odbccp32.dll\", \"odbccr32.dll\", \"odbccu32.dll\", \"odbcint.dll\", \"odbctrac.dll\", \"oemlicense.dll\", \"offfilt.dll\", \"officecsp.dll\", \"offlinelsa.dll\", \"offlinesam.dll\", \"offreg.dll\", \"ole32.dll\", \"oleacc.dll\", \"oleacchooks.dll\", \"oleaccrc.dll\", \"oleaut32.dll\", \"oledlg.dll\", \"oleprn.dll\", \"omadmagent.dll\", \"omadmapi.dll\", \"onebackuphandler.dll\", \"onex.dll\", \"onexui.dll\", \"opcservices.dll\", \"opengl32.dll\", \"ortcengine.dll\", \"osbaseln.dll\", \"osksupport.dll\", \"osuninst.dll\", \"p2p.dll\", \"p2pgraph.dll\", \"p2pnetsh.dll\", \"p2psvc.dll\", \"packager.dll\", \"panmap.dll\", \"pautoenr.dll\", \"pcacli.dll\", \"pcadm.dll\", \"pcaevts.dll\", \"pcasvc.dll\", \"pcaui.dll\", \"pcpksp.dll\", \"pcsvdevice.dll\", \"pcwum.dll\", \"pcwutl.dll\", \"pdh.dll\", \"pdhui.dll\", \"peerdist.dll\", \"peerdistad.dll\", \"peerdistcleaner.dll\", \"peerdistsh.dll\", \"peerdistsvc.dll\", \"peopleapis.dll\", \"peopleband.dll\", \"perceptiondevice.dll\", \"perfctrs.dll\", \"perfdisk.dll\", \"perfnet.dll\", \"perfos.dll\", \"perfproc.dll\", \"perfts.dll\", \"phoneom.dll\", \"phoneproviders.dll\", \"phoneservice.dll\", \"phoneserviceres.dll\", \"phoneutil.dll\", \"phoneutilres.dll\", \"photowiz.dll\", \"pickerplatform.dll\", \"pid.dll\", \"pidgenx.dll\", \"pifmgr.dll\", \"pimstore.dll\", \"pkeyhelper.dll\", \"pktmonapi.dll\", \"pku2u.dll\", \"pla.dll\", \"playlistfolder.dll\", \"playsndsrv.dll\", \"playtodevice.dll\", \"playtomanager.dll\", \"playtomenu.dll\", \"playtoreceiver.dll\", \"ploptin.dll\", \"pmcsnap.dll\", \"pngfilt.dll\", \"pnidui.dll\", \"pnpclean.dll\", \"pnppolicy.dll\", \"pnpts.dll\", \"pnpui.dll\", \"pnpxassoc.dll\", \"pnpxassocprx.dll\", \"pnrpauto.dll\", \"pnrphc.dll\", \"pnrpnsp.dll\", \"pnrpsvc.dll\", \"policymanager.dll\", \"polstore.dll\", \"posetup.dll\", \"posyncservices.dll\", \"pots.dll\", \"powercpl.dll\", \"powrprof.dll\", \"ppcsnap.dll\", \"prauthproviders.dll\", \"prflbmsg.dll\", \"printui.dll\", \"printwsdahost.dll\", \"prm0009.dll\", \"prncache.dll\", \"prnfldr.dll\", \"prnntfy.dll\", \"prntvpt.dll\", \"profapi.dll\", \"profext.dll\", \"profprov.dll\", \"profsvc.dll\", \"profsvcext.dll\", \"propsys.dll\", \"provcore.dll\", \"provdatastore.dll\", \"provdiagnostics.dll\", \"provengine.dll\", \"provhandlers.dll\", \"provisioningcsp.dll\", \"provmigrate.dll\", \"provops.dll\", \"provplugineng.dll\", \"provsysprep.dll\", \"provthrd.dll\", \"proximitycommon.dll\", \"proximityservice.dll\", \"prvdmofcomp.dll\", \"psapi.dll\", \"pshed.dll\", \"psisdecd.dll\", \"psmsrv.dll\", \"pstask.dll\", \"pstorec.dll\", \"ptpprov.dll\", \"puiapi.dll\", \"puiobj.dll\", \"pushtoinstall.dll\", \"pwlauncher.dll\", \"pwrshplugin.dll\", \"pwsso.dll\", \"qasf.dll\", \"qcap.dll\", \"qdv.dll\", \"qdvd.dll\", \"qedit.dll\", \"qedwipes.dll\", \"qmgr.dll\", \"query.dll\", \"quiethours.dll\", \"qwave.dll\", \"racengn.dll\", \"racpldlg.dll\", \"radardt.dll\", \"radarrs.dll\", \"radcui.dll\", \"rasadhlp.dll\", \"rasapi32.dll\", \"rasauto.dll\", \"raschap.dll\", \"raschapext.dll\", \"rasctrs.dll\", \"rascustom.dll\", \"rasdiag.dll\", \"rasdlg.dll\", \"rasgcw.dll\", \"rasman.dll\", \"rasmans.dll\", \"rasmbmgr.dll\", \"rasmediamanager.dll\", \"rasmm.dll\", \"rasmontr.dll\", \"rasplap.dll\", \"rasppp.dll\", \"rastapi.dll\", \"rastls.dll\", \"rastlsext.dll\", \"rdbui.dll\", \"rdpbase.dll\", \"rdpcfgex.dll\", \"rdpcore.dll\", \"rdpcorets.dll\", \"rdpencom.dll\", \"rdpendp.dll\", \"rdpnano.dll\", \"rdpsaps.dll\", \"rdpserverbase.dll\", \"rdpsharercom.dll\", \"rdpudd.dll\", \"rdpviewerax.dll\", \"rdsappxhelper.dll\", \"rdsdwmdr.dll\", \"rdvvmtransport.dll\", \"rdxservice.dll\", \"rdxtaskfactory.dll\", \"reagent.dll\", \"reagenttask.dll\", \"recovery.dll\", \"regapi.dll\", \"regctrl.dll\", \"regidle.dll\", \"regsvc.dll\", \"reguwpapi.dll\", \"reinfo.dll\", \"remotepg.dll\", \"remotewipecsp.dll\", \"reportingcsp.dll\", \"resampledmo.dll\", \"resbparser.dll\", \"reseteng.dll\", \"resetengine.dll\", \"resetengonline.dll\", \"resourcemapper.dll\", \"resutils.dll\", \"rgb9rast.dll\", \"riched20.dll\", \"riched32.dll\", \"rjvmdmconfig.dll\", \"rmapi.dll\", \"rmclient.dll\", \"rnr20.dll\", \"roamingsecurity.dll\", \"rometadata.dll\", \"rotmgr.dll\", \"rpcepmap.dll\", \"rpchttp.dll\", \"rpcns4.dll\", \"rpcnsh.dll\", \"rpcrt4.dll\", \"rpcrtremote.dll\", \"rpcss.dll\", \"rsaenh.dll\", \"rshx32.dll\", \"rstrtmgr.dll\", \"rtffilt.dll\", \"rtm.dll\", \"rtmediaframe.dll\", \"rtmmvrortc.dll\", \"rtutils.dll\", \"rtworkq.dll\", \"rulebasedds.dll\", \"samcli.dll\", \"samlib.dll\", \"samsrv.dll\", \"sas.dll\", \"sbe.dll\", \"sbeio.dll\", \"sberes.dll\", \"sbservicetrigger.dll\", \"scansetting.dll\", \"scardbi.dll\", \"scarddlg.dll\", \"scardsvr.dll\", \"scavengeui.dll\", \"scdeviceenum.dll\", \"scecli.dll\", \"scesrv.dll\", \"schannel.dll\", \"schedcli.dll\", \"schedsvc.dll\", \"scksp.dll\", \"scripto.dll\", \"scrobj.dll\", \"scrptadm.dll\", \"scrrun.dll\", \"sdcpl.dll\", \"sdds.dll\", \"sdengin2.dll\", \"sdfhost.dll\", \"sdhcinst.dll\", \"sdiageng.dll\", \"sdiagprv.dll\", \"sdiagschd.dll\", \"sdohlp.dll\", \"sdrsvc.dll\", \"sdshext.dll\", \"searchfolder.dll\", \"sechost.dll\", \"seclogon.dll\", \"secproc.dll\", \"secproc_isv.dll\", \"secproc_ssp.dll\", \"secproc_ssp_isv.dll\", \"secur32.dll\", \"security.dll\", \"semgrps.dll\", \"semgrsvc.dll\", \"sendmail.dll\", \"sens.dll\", \"sensapi.dll\", \"sensorsapi.dll\", \"sensorscpl.dll\", \"sensorservice.dll\", \"sensorsnativeapi.dll\", \"sensorsutilsv2.dll\", \"sensrsvc.dll\", \"serialui.dll\", \"servicinguapi.dll\", \"serwvdrv.dll\", \"sessenv.dll\", \"setbcdlocale.dll\", \"settingmonitor.dll\", \"settingsync.dll\", \"settingsynccore.dll\", \"setupapi.dll\", \"setupcl.dll\", \"setupcln.dll\", \"setupetw.dll\", \"sfc.dll\", \"sfc_os.dll\", \"sgrmenclave.dll\", \"shacct.dll\", \"shacctprofile.dll\", \"sharedpccsp.dll\", \"sharedrealitysvc.dll\", \"sharehost.dll\", \"sharemediacpl.dll\", \"shcore.dll\", \"shdocvw.dll\", \"shell32.dll\", \"shellstyle.dll\", \"shfolder.dll\", \"shgina.dll\", \"shimeng.dll\", \"shimgvw.dll\", \"shlwapi.dll\", \"shpafact.dll\", \"shsetup.dll\", \"shsvcs.dll\", \"shunimpl.dll\", \"shutdownext.dll\", \"shutdownux.dll\", \"shwebsvc.dll\", \"signdrv.dll\", \"simauth.dll\", \"simcfg.dll\", \"skci.dll\", \"slc.dll\", \"slcext.dll\", \"slwga.dll\", \"smartscreenps.dll\", \"smbhelperclass.dll\", \"smbwmiv2.dll\", \"smiengine.dll\", \"smphost.dll\", \"smsroutersvc.dll\", \"sndvolsso.dll\", \"snmpapi.dll\", \"socialapis.dll\", \"softkbd.dll\", \"softpub.dll\", \"sortwindows61.dll\", \"sortwindows62.dll\", \"spacebridge.dll\", \"spacecontrol.dll\", \"spatializerapo.dll\", \"spatialstore.dll\", \"spbcd.dll\", \"speechpal.dll\", \"spfileq.dll\", \"spinf.dll\", \"spmpm.dll\", \"spnet.dll\", \"spoolss.dll\", \"spopk.dll\", \"spp.dll\", \"sppc.dll\", \"sppcext.dll\", \"sppcomapi.dll\", \"sppcommdlg.dll\", \"sppinst.dll\", \"sppnp.dll\", \"sppobjs.dll\", \"sppwinob.dll\", \"sppwmi.dll\", \"spwinsat.dll\", \"spwizeng.dll\", \"spwizimg.dll\", \"spwizres.dll\", \"spwmp.dll\", \"sqlsrv32.dll\", \"sqmapi.dll\", \"srchadmin.dll\", \"srclient.dll\", \"srcore.dll\", \"srevents.dll\", \"srh.dll\", \"srhelper.dll\", \"srm.dll\", \"srmclient.dll\", \"srmlib.dll\", \"srmscan.dll\", \"srmshell.dll\", \"srmstormod.dll\", \"srmtrace.dll\", \"srm_ps.dll\", \"srpapi.dll\", \"srrstr.dll\", \"srumapi.dll\", \"srumsvc.dll\", \"srvcli.dll\", \"srvsvc.dll\", \"srwmi.dll\", \"sscore.dll\", \"sscoreext.dll\", \"ssdm.dll\", \"ssdpapi.dll\", \"ssdpsrv.dll\", \"sspicli.dll\", \"sspisrv.dll\", \"ssshim.dll\", \"sstpsvc.dll\", \"starttiledata.dll\", \"startupscan.dll\", \"stclient.dll\", \"sti.dll\", \"sti_ci.dll\", \"stobject.dll\", \"storageusage.dll\", \"storagewmi.dll\", \"storewuauth.dll\", \"storprop.dll\", \"storsvc.dll\", \"streamci.dll\", \"structuredquery.dll\", \"sud.dll\", \"svf.dll\", \"svsvc.dll\", \"swprv.dll\", \"sxproxy.dll\", \"sxs.dll\", \"sxshared.dll\", \"sxssrv.dll\", \"sxsstore.dll\", \"synccenter.dll\", \"synccontroller.dll\", \"synchostps.dll\", \"syncproxy.dll\", \"syncreg.dll\", \"syncres.dll\", \"syncsettings.dll\", \"syncutil.dll\", \"sysclass.dll\", \"sysfxui.dll\", \"sysmain.dll\", \"sysntfy.dll\", \"syssetup.dll\", \"systemcpl.dll\", \"t2embed.dll\", \"tabbtn.dll\", \"tabbtnex.dll\", \"tabsvc.dll\", \"tapi3.dll\", \"tapi32.dll\", \"tapilua.dll\", \"tapimigplugin.dll\", \"tapiperf.dll\", \"tapisrv.dll\", \"tapisysprep.dll\", \"tapiui.dll\", \"taskapis.dll\", \"taskbarcpl.dll\", \"taskcomp.dll\", \"taskschd.dll\", \"taskschdps.dll\", \"tbauth.dll\", \"tbs.dll\", \"tcbloader.dll\", \"tcpipcfg.dll\", \"tcpmib.dll\", \"tcpmon.dll\", \"tcpmonui.dll\", \"tdh.dll\", \"tdlmigration.dll\", \"tellib.dll\", \"termmgr.dll\", \"termsrv.dll\", \"tetheringclient.dll\", \"tetheringmgr.dll\", \"tetheringservice.dll\", \"tetheringstation.dll\", \"textshaping.dll\", \"themecpl.dll\", \"themeservice.dll\", \"themeui.dll\", \"threadpoolwinrt.dll\", \"thumbcache.dll\", \"timebrokerclient.dll\", \"timebrokerserver.dll\", \"timesync.dll\", \"timesynctask.dll\", \"tlscsp.dll\", \"tokenbinding.dll\", \"tokenbroker.dll\", \"tokenbrokerui.dll\", \"tpmcertresources.dll\", \"tpmcompc.dll\", \"tpmtasks.dll\", \"tpmvsc.dll\", \"tquery.dll\", \"traffic.dll\", \"transportdsa.dll\", \"trie.dll\", \"trkwks.dll\", \"tsbyuv.dll\", \"tscfgwmi.dll\", \"tserrredir.dll\", \"tsf3gip.dll\", \"tsgqec.dll\", \"tsmf.dll\", \"tspkg.dll\", \"tspubwmi.dll\", \"tssessionux.dll\", \"tssrvlic.dll\", \"tsworkspace.dll\", \"ttdloader.dll\", \"ttdplm.dll\", \"ttdrecord.dll\", \"ttdrecordcpu.dll\", \"ttlsauth.dll\", \"ttlscfg.dll\", \"ttlsext.dll\", \"tvratings.dll\", \"twext.dll\", \"twinapi.dll\", \"twinui.dll\", \"txflog.dll\", \"txfw32.dll\", \"tzautoupdate.dll\", \"tzres.dll\", \"tzsyncres.dll\", \"ubpm.dll\", \"ucmhc.dll\", \"ucrtbase.dll\", \"ucrtbase_clr0400.dll\", \"ucrtbase_enclave.dll\", \"udhisapi.dll\", \"udwm.dll\", \"ueficsp.dll\", \"uexfat.dll\", \"ufat.dll\", \"uiamanager.dll\", \"uianimation.dll\", \"uiautomationcore.dll\", \"uicom.dll\", \"uireng.dll\", \"uiribbon.dll\", \"uiribbonres.dll\", \"ulib.dll\", \"umb.dll\", \"umdmxfrm.dll\", \"umpdc.dll\", \"umpnpmgr.dll\", \"umpo-overrides.dll\", \"umpo.dll\", \"umpoext.dll\", \"umpowmi.dll\", \"umrdp.dll\", \"unattend.dll\", \"unenrollhook.dll\", \"unimdmat.dll\", \"uniplat.dll\", \"unistore.dll\", \"untfs.dll\", \"updateagent.dll\", \"updatecsp.dll\", \"updatepolicy.dll\", \"upnp.dll\", \"upnphost.dll\", \"upshared.dll\", \"urefs.dll\", \"urefsv1.dll\", \"ureg.dll\", \"url.dll\", \"urlmon.dll\", \"usbcapi.dll\", \"usbceip.dll\", \"usbmon.dll\", \"usbperf.dll\", \"usbpmapi.dll\", \"usbtask.dll\", \"usbui.dll\", \"user32.dll\", \"usercpl.dll\", \"userdataservice.dll\", \"userdatatimeutil.dll\", \"userenv.dll\", \"userinitext.dll\", \"usermgr.dll\", \"usermgrcli.dll\", \"usermgrproxy.dll\", \"usoapi.dll\", \"usocoreps.dll\", \"usosvc.dll\", \"usp10.dll\", \"ustprov.dll\", \"utcutil.dll\", \"utildll.dll\", \"uudf.dll\", \"uvcmodel.dll\", \"uwfcfgmgmt.dll\", \"uwfcsp.dll\", \"uwfservicingapi.dll\", \"uxinit.dll\", \"uxlib.dll\", \"uxlibres.dll\", \"uxtheme.dll\", \"vac.dll\", \"van.dll\", \"vault.dll\", \"vaultcds.dll\", \"vaultcli.dll\", \"vaultroaming.dll\", \"vaultsvc.dll\", \"vbsapi.dll\", \"vbscript.dll\", \"vbssysprep.dll\", \"vcardparser.dll\", \"vdsbas.dll\", \"vdsdyn.dll\", \"vdsutil.dll\", \"vdsvd.dll\", \"vds_ps.dll\", \"verifier.dll\", \"vertdll.dll\", \"vfuprov.dll\", \"vfwwdm32.dll\", \"vhfum.dll\", \"vid.dll\", \"videohandlers.dll\", \"vidreszr.dll\", \"virtdisk.dll\", \"vmbuspipe.dll\", \"vmdevicehost.dll\", \"vmictimeprovider.dll\", \"vmrdvcore.dll\", \"voiprt.dll\", \"vpnike.dll\", \"vpnikeapi.dll\", \"vpnsohdesktop.dll\", \"vpnv2csp.dll\", \"vscmgrps.dll\", \"vssapi.dll\", \"vsstrace.dll\", \"vss_ps.dll\", \"w32time.dll\", \"w32topl.dll\", \"waasassessment.dll\", \"waasmediccapsule.dll\", \"waasmedicps.dll\", \"waasmedicsvc.dll\", \"wabsyncprovider.dll\", \"walletproxy.dll\", \"walletservice.dll\", \"wavemsp.dll\", \"wbemcomn.dll\", \"wbiosrvc.dll\", \"wci.dll\", \"wcimage.dll\", \"wcmapi.dll\", \"wcmcsp.dll\", \"wcmsvc.dll\", \"wcnapi.dll\", \"wcncsvc.dll\", \"wcneapauthproxy.dll\", \"wcneappeerproxy.dll\", \"wcnnetsh.dll\", \"wcnwiz.dll\", \"wc_storage.dll\", \"wdc.dll\", \"wdi.dll\", \"wdigest.dll\", \"wdscore.dll\", \"webauthn.dll\", \"webcamui.dll\", \"webcheck.dll\", \"webclnt.dll\", \"webio.dll\", \"webservices.dll\", \"websocket.dll\", \"wecapi.dll\", \"wecsvc.dll\", \"wephostsvc.dll\", \"wer.dll\", \"werconcpl.dll\", \"wercplsupport.dll\", \"werenc.dll\", \"weretw.dll\", \"wersvc.dll\", \"werui.dll\", \"wevtapi.dll\", \"wevtfwd.dll\", \"wevtsvc.dll\", \"wfapigp.dll\", \"wfdprov.dll\", \"wfdsconmgr.dll\", \"wfdsconmgrsvc.dll\", \"wfhc.dll\", \"whealogr.dll\", \"whhelper.dll\", \"wiaaut.dll\", \"wiadefui.dll\", \"wiadss.dll\", \"wiarpc.dll\", \"wiascanprofiles.dll\", \"wiaservc.dll\", \"wiashext.dll\", \"wiatrace.dll\", \"wificloudstore.dll\", \"wificonfigsp.dll\", \"wifidisplay.dll\", \"wimgapi.dll\", \"win32spl.dll\", \"win32u.dll\", \"winbio.dll\", \"winbiodatamodel.dll\", \"winbioext.dll\", \"winbrand.dll\", \"wincorlib.dll\", \"wincredprovider.dll\", \"wincredui.dll\", \"windowmanagement.dll\", \"windowscodecs.dll\", \"windowscodecsext.dll\", \"windowscodecsraw.dll\", \"windowsiotcsp.dll\", \"windowslivelogin.dll\", \"winethc.dll\", \"winhttp.dll\", \"winhttpcom.dll\", \"winhvemulation.dll\", \"winhvplatform.dll\", \"wininet.dll\", \"wininetlui.dll\", \"wininitext.dll\", \"winipcfile.dll\", \"winipcsecproc.dll\", \"winipsec.dll\", \"winlangdb.dll\", \"winlogonext.dll\", \"winmde.dll\", \"winml.dll\", \"winmm.dll\", \"winmmbase.dll\", \"winmsipc.dll\", \"winnlsres.dll\", \"winnsi.dll\", \"winreagent.dll\", \"winrnr.dll\", \"winrscmd.dll\", \"winrsmgr.dll\", \"winrssrv.dll\", \"winrttracing.dll\", \"winsatapi.dll\", \"winscard.dll\", \"winsetupui.dll\", \"winshfhc.dll\", \"winsku.dll\", \"winsockhc.dll\", \"winsqlite3.dll\", \"winsrpc.dll\", \"winsrv.dll\", \"winsrvext.dll\", \"winsta.dll\", \"winsync.dll\", \"winsyncmetastore.dll\", \"winsyncproviders.dll\", \"wintrust.dll\", \"wintypes.dll\", \"winusb.dll\", \"wirednetworkcsp.dll\", \"wisp.dll\", \"wkscli.dll\", \"wkspbrokerax.dll\", \"wksprtps.dll\", \"wkssvc.dll\", \"wlanapi.dll\", \"wlancfg.dll\", \"wlanconn.dll\", \"wlandlg.dll\", \"wlangpui.dll\", \"wlanhc.dll\", \"wlanhlp.dll\", \"wlanmediamanager.dll\", \"wlanmm.dll\", \"wlanmsm.dll\", \"wlanpref.dll\", \"wlanradiomanager.dll\", \"wlansec.dll\", \"wlansvc.dll\", \"wlansvcpal.dll\", \"wlanui.dll\", \"wlanutil.dll\", \"wldap32.dll\", \"wldp.dll\", \"wlgpclnt.dll\", \"wlidcli.dll\", \"wlidcredprov.dll\", \"wlidfdp.dll\", \"wlidnsp.dll\", \"wlidprov.dll\", \"wlidres.dll\", \"wlidsvc.dll\", \"wmadmod.dll\", \"wmadmoe.dll\", \"wmalfxgfxdsp.dll\", \"wmasf.dll\", \"wmcodecdspps.dll\", \"wmdmlog.dll\", \"wmdmps.dll\", \"wmdrmsdk.dll\", \"wmerror.dll\", \"wmi.dll\", \"wmiclnt.dll\", \"wmicmiplugin.dll\", \"wmidcom.dll\", \"wmidx.dll\", \"wmiprop.dll\", \"wmitomi.dll\", \"wmnetmgr.dll\", \"wmp.dll\", \"wmpdui.dll\", \"wmpdxm.dll\", \"wmpeffects.dll\", \"wmphoto.dll\", \"wmploc.dll\", \"wmpps.dll\", \"wmpshell.dll\", \"wmsgapi.dll\", \"wmspdmod.dll\", \"wmspdmoe.dll\", \"wmvcore.dll\", \"wmvdecod.dll\", \"wmvdspa.dll\", \"wmvencod.dll\", \"wmvsdecd.dll\", \"wmvsencd.dll\", \"wmvxencd.dll\", \"woftasks.dll\", \"wofutil.dll\", \"wordbreakers.dll\", \"workfoldersgpext.dll\", \"workfoldersres.dll\", \"workfoldersshell.dll\", \"workfolderssvc.dll\", \"wosc.dll\", \"wow64.dll\", \"wow64cpu.dll\", \"wow64win.dll\", \"wpbcreds.dll\", \"wpc.dll\", \"wpcapi.dll\", \"wpcdesktopmonsvc.dll\", \"wpcproxystubs.dll\", \"wpcrefreshtask.dll\", \"wpcwebfilter.dll\", \"wpdbusenum.dll\", \"wpdshext.dll\", \"wpdshserviceobj.dll\", \"wpdsp.dll\", \"wpd_ci.dll\", \"wpnapps.dll\", \"wpnclient.dll\", \"wpncore.dll\", \"wpninprc.dll\", \"wpnprv.dll\", \"wpnservice.dll\", \"wpnsruprov.dll\", \"wpnuserservice.dll\", \"wpportinglibrary.dll\", \"wpprecorderum.dll\", \"wptaskscheduler.dll\", \"wpx.dll\", \"ws2help.dll\", \"ws2_32.dll\", \"wscapi.dll\", \"wscinterop.dll\", \"wscisvif.dll\", \"wsclient.dll\", \"wscproxystub.dll\", \"wscsvc.dll\", \"wsdapi.dll\", \"wsdchngr.dll\", \"wsdprintproxy.dll\", \"wsdproviderutil.dll\", \"wsdscanproxy.dll\", \"wsecedit.dll\", \"wsepno.dll\", \"wshbth.dll\", \"wshcon.dll\", \"wshelper.dll\", \"wshext.dll\", \"wshhyperv.dll\", \"wship6.dll\", \"wshqos.dll\", \"wshrm.dll\", \"wshtcpip.dll\", \"wshunix.dll\", \"wslapi.dll\", \"wsmagent.dll\", \"wsmauto.dll\", \"wsmplpxy.dll\", \"wsmres.dll\", \"wsmsvc.dll\", \"wsmwmipl.dll\", \"wsnmp32.dll\", \"wsock32.dll\", \"wsplib.dll\", \"wsp_fs.dll\", \"wsp_health.dll\", \"wsp_sr.dll\", \"wtsapi32.dll\", \"wuapi.dll\", \"wuaueng.dll\", \"wuceffects.dll\", \"wudfcoinstaller.dll\", \"wudfplatform.dll\", \"wudfsmcclassext.dll\", \"wudfx.dll\", \"wudfx02000.dll\", \"wudriver.dll\", \"wups.dll\", \"wups2.dll\", \"wuuhext.dll\", \"wuuhosdeployment.dll\", \"wvc.dll\", \"wwaapi.dll\", \"wwaext.dll\", \"wwanapi.dll\", \"wwancfg.dll\", \"wwanhc.dll\", \"wwanprotdim.dll\", \"wwanradiomanager.dll\", \"wwansvc.dll\", \"wwapi.dll\", \"xamltilerender.dll\", \"xaudio2_8.dll\", \"xaudio2_9.dll\", \"xblauthmanager.dll\", \"xblgamesave.dll\", \"xblgamesaveext.dll\", \"xblgamesaveproxy.dll\", \"xboxgipsvc.dll\", \"xboxgipsynthetic.dll\", \"xboxnetapisvc.dll\", \"xinput1_4.dll\", \"xinput9_1_0.dll\", \"xinputuap.dll\", \"xmlfilter.dll\", \"xmllite.dll\", \"xmlprovi.dll\", \"xolehlp.dll\", \"xpsgdiconverter.dll\", \"xpsprint.dll\", \"xpspushlayer.dll\", \"xpsrasterservice.dll\", \"xpsservices.dll\", \"xwizards.dll\", \"xwreg.dll\", \"xwtpdui.dll\", \"xwtpw32.dll\", \"zipcontainer.dll\", \"zipfldr.dll\", \"bootsvc.dll\", \"halextintcpsedma.dll\", \"icsvcvss.dll\", \"ieproxydesktop.dll\", \"lsaadt.dll\", \"nlansp_c.dll\", \"nrtapi.dll\", \"opencl.dll\", \"pfclient.dll\", \"pnpdiag.dll\", \"prxyqry.dll\", \"rdpnanotransport.dll\", \"servicingcommon.dll\", \"sortwindows63.dll\", \"sstpcfg.dll\", \"tdhres.dll\", \"umpodev.dll\", \"utcapi.dll\", \"windlp.dll\", \"wow64base.dll\", \"wow64con.dll\", \"blbuires.dll\", \"bpainst.dll\", \"cbclient.dll\", \"certadm.dll\", \"certocm.dll\", \"certpick.dll\", \"csdeployres.dll\", \"dsdeployres.dll\", \"eapa3hst.dll\", \"eapacfg.dll\", \"eapahost.dll\", \"elsext.dll\", \"encdump.dll\", \"escmigplugin.dll\", \"fsclient.dll\", \"fsdeployres.dll\", \"fssminst.dll\", \"fssmres.dll\", \"fssprov.dll\", \"ipamapi.dll\", \"kpssvc.dll\", \"lbfoadminlib.dll\", \"mintdh.dll\", \"mmci.dll\", \"mmcico.dll\", \"mprsnap.dll\", \"mstsmhst.dll\", \"mstsmmc.dll\", \"muxinst.dll\", \"personax.dll\", \"rassfm.dll\", \"rasuser.dll\", \"rdmsinst.dll\", \"rdmsres.dll\", \"rtrfiltr.dll\", \"sacsvr.dll\", \"scrdenrl.dll\", \"sdclient.dll\", \"sharedstartmodel.dll\", \"smsrouter.dll\", \"spwizimg_svr.dll\", \"sqlcecompact40.dll\", \"sqlceoledb40.dll\", \"sqlceqp40.dll\", \"sqlcese40.dll\", \"srvmgrinst.dll\", \"svrmgrnc.dll\", \"tapisnap.dll\", \"tlsbrand.dll\", \"tsec.dll\", \"tsprop.dll\", \"tspubiconhelper.dll\", \"tssdjet.dll\", \"tsuserex.dll\", \"ualapi.dll\", \"ualsvc.dll\", \"umcres.dll\", \"updatehandlers.dll\", \"usocore.dll\", \"vssui.dll\", \"wsbappres.dll\", \"wsbonline.dll\", \"wsmselpl.dll\", \"wsmselrr.dll\", \"xpsfilt.dll\", \"xpsshhdr.dll\"\n    ) and\n    not (\n      (\n        dll.name : \"icuuc.dll\" and dll.code_signature.subject_name in (\n          \"Valve\", \"Valve Corp.\", \"Avanquest Software (7270356 Canada Inc)\", \"Adobe Inc.\"\n        ) and dll.code_signature.trusted == true\n      ) or\n      (\n        dll.name : (\"timeSync.dll\", \"appInfo.dll\") and dll.code_signature.subject_name in (\n          \"VMware Inc.\", \"VMware, Inc.\"\n        ) and dll.code_signature.trusted == true\n      ) or\n      (\n        dll.name : \"libcrypto.dll\" and dll.code_signature.subject_name in (\n          \"NoMachine S.a.r.l.\", \"Oculus VR, LLC\"\n        ) and dll.code_signature.trusted == true\n      ) or\n      (\n        dll.name : \"ucrtbase.dll\" and dll.code_signature.subject_name in (\n          \"Proofpoint, Inc.\", \"Rapid7 LLC\", \"Eclipse.org Foundation, Inc.\", \"Amazon.com Services LLC\", \"Windows Phone\"\n        ) and dll.code_signature.trusted == true\n      ) or\n      (\n        dll.name : (\"libcrypto.dll\", \"wmi.dll\", \"geolocation.dll\", \"kerberos.dll\") and\n        dll.code_signature.subject_name == \"Bitdefender SRL\" and dll.code_signature.trusted == true\n      ) or\n      (dll.name : \"ICMP.dll\" and dll.code_signature.subject_name == \"Paessler AG\" and dll.code_signature.trusted == true) or\n      (dll.name : \"dbghelp.dll\" and dll.code_signature.trusted == true) or\n      (dll.name : \"DirectML.dll\" and dll.code_signature.subject_name == \"Adobe Inc.\" and dll.code_signature.trusted == true) or\n      (dll.name : \"icsvc.dll\" and dll.code_signature.subject_name in (\"Dell Inc\", \"Dell Technologies Inc.\") and dll.code_signature.trusted == true) or\n      (dll.name : \"offreg.dll\" and dll.code_signature.subject_name == \"Malwarebytes Inc.\" and dll.code_signature.trusted == true) or\n      (dll.name : \"AppMgr.dll\" and dll.code_signature.subject_name == \"Autodesk, Inc\" and dll.code_signature.trusted == true) or\n      (dll.name : (\"SsShim.dll\", \"Msi.dll\", \"wdscore.dll\") and process.name : \"DismHost.exe\" and dll.path : \"C:\\\\Windows\\\\Temp\\\\*\") or\n      (\n        dll.path : (\n          \"?:\\\\Windows\\\\SystemApps\\\\*\\\\dxgi.dll\",\n          \"?:\\\\Windows\\\\SystemApps\\\\*\\\\wincorlib.dll\",\n          \"?:\\\\Windows\\\\dxgi.dll\",\n          \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\LINE\\\\bin\\\\current\\\\dbghelp.dll\"\n        )\n      )\n    )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.library-*"
        ]
      },
      {
        "name": "First Occurrence of GitHub User Interaction with Private Repo",
        "description": "Detects a new private repo interaction for a GitHub user not seen in the last 14 days.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Execution",
          "Rule Type: BBR",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1648",
                "name": "Serverless Execution",
                "reference": "https://attack.mitre.org/techniques/T1648/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "github.repo",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "github.repository_public",
            "type": "boolean",
            "ecs": false
          },
          {
            "name": "user.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "862289e1-bc20-4914-b0b1-777421318abb",
        "rule_id": "01c49712-25bc-49d2-a27d-d7ce52f5dc49",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.359Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.359Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset:\"github.audit\" and event.category:\"configuration\" and\ngithub.repo:* and user.name:* and \ngithub.repository_public:false\n",
        "new_terms_fields": [
          "user.name",
          "github.repo"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-github.audit-*"
        ],
        "language": "kuery"
      },
      {
        "name": "First Occurrence of GitHub Repo Interaction From a New IP",
        "description": "Detects an interaction with a private GitHub repository from a new IP address not seen in the last 14 days.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Execution",
          "Rule Type: BBR",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1648",
                "name": "Serverless Execution",
                "reference": "https://attack.mitre.org/techniques/T1648/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "github.actor_ip",
            "type": "ip",
            "ecs": false
          },
          {
            "name": "github.repo",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "github.repository_public",
            "type": "boolean",
            "ecs": false
          }
        ],
        "id": "78b160b6-80cf-49b6-9cfa-8c002145db73",
        "rule_id": "0294f105-d7af-4a02-ae90-35f56763ffa2",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.362Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.362Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset:\"github.audit\" and event.category:\"configuration\" and\ngithub.actor_ip:* and github.repo:* and \ngithub.repository_public:false\n",
        "new_terms_fields": [
          "github.repo",
          "github.actor_ip"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-github.audit-*"
        ],
        "language": "kuery"
      },
      {
        "name": "Tainted Kernel Module Load",
        "description": "This rule monitors the syslog log file for messages related to instances of a tainted kernel module load. Rootkits often leverage kernel modules as their main defense evasion technique. Detecting tainted kernel module loads is crucial for ensuring system security and integrity, as malicious or unauthorized modules can compromise the kernel and lead to system vulnerabilities or unauthorized access.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1547",
                "name": "Boot or Logon Autostart Execution",
                "reference": "https://attack.mitre.org/techniques/T1547/",
                "subtechnique": [
                  {
                    "id": "T1547.006",
                    "name": "Kernel Modules and Extensions",
                    "reference": "https://attack.mitre.org/techniques/T1547/006/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1014",
                "name": "Rootkit",
                "reference": "https://attack.mitre.org/techniques/T1014/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from one of the following integrations:\n- Filebeat\n\n### Filebeat Setup\nFilebeat is a lightweight shipper for forwarding and centralizing log data. Installed as an agent on your servers, Filebeat monitors the log files or locations that you specify, collects log events, and forwards them either to Elasticsearch or Logstash for indexing.\n\n#### The following steps should be executed in order to add the Filebeat for the Linux System:\n- Elastic provides repositories available for APT and YUM-based distributions. Note that we provide binary packages, but no source packages.\n- To install the APT and YUM repositories follow the setup instructions in this [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/setup-repositories.html).\n- To run Filebeat on Docker follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/running-on-docker.html).\n- To run Filebeat on Kubernetes follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/running-on-kubernetes.html).\n- For quick start information for Filebeat refer to the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/8.11/filebeat-installation-configuration.html).\n- For complete Setup and Run Filebeat information refer to the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/setting-up-and-running.html).\n\n#### Rule Specific Setup Note\n- This rule requires the Filebeat System Module to be enabled.\n- The system module collects and parses logs created by the system logging service of common Unix/Linux based distributions.\n- To run the system module of Filebeat on Linux follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html).\n",
        "related_integrations": [
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "message",
            "type": "match_only_text",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "b58ce7df-a9e8-434b-99c8-c751ec8ec62b",
        "rule_id": "05cad2fb-200c-407f-b472-02ea8c9e5e4a",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.366Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.366Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "logs-system.syslog-*"
        ],
        "query": "host.os.type:linux and event.dataset:\"system.syslog\" and process.name:kernel and \nmessage:\"module verification failed: signature and/or required key missing - tainting kernel\"\n",
        "language": "kuery"
      },
      {
        "name": "Unusual Remote File Size",
        "description": "A machine learning job has detected an unusually high file size shared by a remote host indicating potential lateral movement activity. One of the primary goals of attackers after gaining access to a network is to locate and exfiltrate valuable information. Instead of multiple small transfers that can raise alarms, attackers might choose to bundle data into a single large file transfer.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Lateral Movement Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Lateral Movement"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-90m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/lmd",
          "https://www.elastic.co/blog/detecting-lateral-movement-activity-a-new-kibana-integration",
          "https://www.elastic.co/blog/remote-desktop-protocol-connections-elastic-security"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1210",
                "name": "Exploitation of Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1210/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Lateral Movement Detection integration assets to be installed, as well as file and Windows RDP process events collected by the Elastic Defend integration.  \n\n### Lateral Movement Detection Setup\nThe Lateral Movement Detection integration detects lateral movement activity by identifying abnormalities in file and Windows RDP events. Anomalies are detected using Elastic's Anomaly Detection feature.\n\n#### Prerequisite Requirements:\n- Fleet is required for Lateral Movement Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- File events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n#### The following steps should be executed to install assets associated with the Lateral Movement Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Lateral Movement Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "lmd",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [],
        "id": "3dc752a4-0b89-4949-8d80-0afdc7e23915",
        "rule_id": "0678bc9c-b71a-433b-87e6-2f664b6b3131",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.369Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.369Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 70,
        "machine_learning_job_id": [
          "lmd_high_file_size_remote_file_transfer"
        ]
      },
      {
        "name": "Member Removed From GitHub Organization",
        "description": "A member was removed or their invitation to join was removed from a GitHub Organization.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Impact",
          "Rule Type: BBR",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1531",
                "name": "Account Access Removal",
                "reference": "https://attack.mitre.org/techniques/T1531/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "29fb6c4d-2c2a-4862-b6be-af3d15bbd4e2",
        "rule_id": "095b6a58-8f88-4b59-827c-ab584ad4e759",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.372Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.372Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "configuration where event.dataset == \"github.audit\" and event.action == \"org.remove_member\"\n",
        "language": "eql",
        "index": [
          "logs-github.audit-*"
        ]
      },
      {
        "name": "Yum Package Manager Plugin File Creation",
        "description": "Detects file creation events in the plugin directories for the Yum package manager. In Linux, Yum (Yellowdog Updater, Modified) is a command-line utility used for handling packages on (by default) Fedora-based systems, providing functions for installing, updating, upgrading, and removing software along with managing package repositories. Attackers can backdoor Yum to gain persistence by injecting malicious code into plugins that Yum runs, thereby ensuring continued unauthorized access or control each time Yum is used for package management.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/linux/local/yum_package_manager_persistence.rb",
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/"
              },
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/",
                "subtechnique": [
                  {
                    "id": "T1546.016",
                    "name": "Installer Packages",
                    "reference": "https://attack.mitre.org/techniques/T1546/016/"
                  }
                ]
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.original.name",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d636f795-dbfb-42ba-b433-1cc4ff1e73e4",
        "rule_id": "0b15bcad-aff1-4250-a5be-5d1b7eb56d07",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.376Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.376Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.action in (\"rename\", \"creation\") and\nfile.path : (\"/usr/lib/yum-plugins/*\", \"/etc/yum/pluginconf.d/*\") and not (\n  process.executable in (\n    \"/bin/dockerd\", \"/usr/bin/dockerd\", \"/usr/sbin/dockerd\", \"/bin/microdnf\", \"/usr/bin/microdnf\", \"/bin/rpm\",\n    \"/usr/bin/rpm\", \"/bin/snapd\", \"/usr/bin/snapd\", \"/bin/yum\", \"/usr/bin/yum\", \"/bin/dnf\", \"/usr/bin/dnf\",\n    \"/bin/podman\", \"/usr/bin/podman\", \"/bin/dnf-automatic\", \"/usr/bin/dnf-automatic\", \"/sbin/apk\", \"/usr/sbin/apk\",\n    \"/usr/local/sbin/apk\", \"/bin/podman\", \"/usr/bin/podman\", \"/usr/bin/puppet\", \"/bin/puppet\",\n    \"/opt/puppetlabs/puppet/bin/puppet\", \"/usr/bin/chef-client\", \"/bin/chef-client\", \"/bin/autossl_check\",\n    \"/usr/bin/autossl_check\", \"/proc/self/exe\", \"/dev/fd/*\", \"/usr/lib/snapd/snapd\", \"/usr/local/bin/dockerd\",\n    \"/usr/libexec/netplan/generate\"\n  ) or\n  process.name == \"yumBackend.py\" or\n  file.extension in (\"swp\", \"swpx\", \"swx\") or\n  file.Ext.original.name like \".ansible*\" or\n  file.name like \".ansible_tmp*\" or\n  process.executable : (\n    \"/nix/store/*\", \"/var/lib/dpkg/*\", \"/tmp/vmis.*\", \"/snap/*\", \"/dev/fd/*\", \"/usr/lib/*\", \"/usr/libexec/*\",\n    \"/etc/kernel/*\"\n  ) or\n  process.executable == null or\n  (process.name == \"sed\" and file.name : \"sed*\") or\n  (process.name == \"perl\" and file.name : \"e2scrub_all.tmp*\") \n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*"
        ]
      },
      {
        "name": "Attempt to Establish VScode Remote Tunnel",
        "description": "Detects the execution of the VScode portable binary with the tunnel command line option indicating an attempt to establish a remote tunnel session to Github or a remote VScode instance.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 104,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Command and Control",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon",
          "Data Source: SentinelOne",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: System",
          "Data Source: Crowdstrike"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://badoption.eu/blog/2023/01/31/code_c2.html",
          "https://code.visualstudio.com/docs/remote/tunnels"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1219",
                "name": "Remote Access Software",
                "reference": "https://attack.mitre.org/techniques/T1219/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "crowdstrike",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "5aab315b-11a0-4552-82f2-0a19095c3b12",
        "rule_id": "0b96dfd8-5b8c-4485-9a1c-69ff7839786a",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.388Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.388Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  process.args : \"tunnel\" and (process.args : \"--accept-server-license-terms\" or process.name : \"code*.exe\") and \n  not (process.name == \"code-tunnel.exe\" and process.args == \"status\" and process.parent.name == \"Code.exe\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "winlogbeat-*",
          "logs-windows.sysmon_operational-*",
          "logs-system.security*",
          "endgame-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-m365_defender.event-*",
          "logs-crowdstrike.fdr*"
        ]
      },
      {
        "name": "First Occurrence of User Agent For a GitHub Personal Access Token (PAT)",
        "description": "Detects a new user agent used for a GitHub PAT not previously seen in the last 14 days.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Initial Access",
          "Rule Type: BBR",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1078",
                "name": "Valid Accounts",
                "reference": "https://attack.mitre.org/techniques/T1078/",
                "subtechnique": [
                  {
                    "id": "T1078.004",
                    "name": "Cloud Accounts",
                    "reference": "https://attack.mitre.org/techniques/T1078/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "github.hashed_token",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "github.programmatic_access_type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "github.user_agent",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "cab9a6e7-0668-4481-8bf7-dac98f679123",
        "rule_id": "0e4367a0-a483-439d-ad2e-d90500b925fd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.395Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.395Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset:\"github.audit\" and event.category:\"configuration\" and\ngithub.user_agent:* and github.hashed_token:* and\ngithub.programmatic_access_type:(\"OAuth access token\" or \"Fine-grained personal access token\")\n",
        "new_terms_fields": [
          "github.hashed_token",
          "github.user_agent"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-github.audit-*"
        ],
        "language": "kuery"
      },
      {
        "name": "AWS Bedrock Guardrails Detected Multiple Violations by a Single User Over a Session",
        "description": "Identifies multiple violations of AWS Bedrock guardrails by the same user in the same account over a session. Multiple violations implies that a user may be intentionally attempting to cirvumvent security controls, access sensitive information, or possibly exploit a vulnerability in the system.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Amazon Bedrock Guardrail Multiple Policy Violations by a Single User Over a Session.\n\nAmazon Bedrock Guardrail is a set of features within Amazon Bedrock designed to help businesses apply robust safety and privacy controls to their generative AI applications.\n\nIt enables users to set guidelines and filters that manage content quality, relevancy, and adherence to responsible AI practices.\n\nThrough Guardrail, organizations can define \"denied topics\" to prevent the model from generating content on specific, undesired subjects,\nand they can establish thresholds for harmful content categories, including hate speech, violence, or offensive language.\n\n#### Possible investigation steps\n\n- Identify the user account that caused multiple policy violations over a session and whether it should perform this kind of action.\n- Investigate the user activity that might indicate a potential brute force attack.\n- Investigate other alerts associated with the user account during the past 48 hours.\n- Consider the time of day. If the user is a human (not a program or script), did the activity take place during a normal time of day?\n- Examine the account's prompts and responses in the last 24 hours.\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking Amazon Bedrock model access, prompts generated, and responses to the prompts by the account in the last 24 hours.\n\n### False positive analysis\n\n- Verify the user account that caused multiple policy violations by a single user over session, is not testing any new model deployments or updated compliance policies in Amazon Bedrock guardrails.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Identify if the attacker is moving laterally and compromising other Amazon Bedrock Services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Review the permissions assigned to the implicated user group or role behind these requests to ensure they are authorized and expected to access bedrock and ensure that the least privilege principle is being followed.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: LLM",
          "Data Source: AWS Bedrock",
          "Data Source: AWS S3",
          "Resources: Investigation Guide",
          "Use Case: Policy Violation",
          "Mitre Atlas: T0051",
          "Mitre Atlas: T0054"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate misunderstanding by users or overly strict policies"
        ],
        "references": [
          "https://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-components.html",
          "https://atlas.mitre.org/techniques/AML.T0051",
          "https://atlas.mitre.org/techniques/AML.T0054",
          "https://www.elastic.co/security-labs/elastic-advances-llm-security"
        ],
        "max_signals": 100,
        "threat": [],
        "setup": "## Setup\n\nThis rule requires that guardrails are configured in AWS Bedrock. For more information, see the AWS Bedrock documentation:\n\nhttps://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-create.html\n",
        "related_integrations": [],
        "required_fields": [],
        "id": "18476401-7c0f-4304-b331-a8ac8aa777cc",
        "rule_id": "0cd2f3e6-41da-40e6-b28b-466f688f00a6",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.391Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.391Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws_bedrock.invocation-*\n| where gen_ai.compliance.violation_detected\n| keep user.id, gen_ai.request.model.id, cloud.account.id\n| stats violations = count(*) by user.id, gen_ai.request.model.id, cloud.account.id\n| where violations > 1\n| sort violations desc\n"
      },
      {
        "name": "Office Test Registry Persistence",
        "description": "Identifies the modification of the Microsoft Office \"Office Test\" Registry key, a registry location that can be used to specify a DLL which will be executed every time an MS Office application is started. Attackers can abuse this to gain persistence on a compromised host.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 103,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: SentinelOne"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://unit42.paloaltonetworks.com/unit42-technical-walkthrough-office-test-persistence-method-used-in-recent-sofacy-attacks/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1137",
                "name": "Office Application Startup",
                "reference": "https://attack.mitre.org/techniques/T1137/",
                "subtechnique": [
                  {
                    "id": "T1137.002",
                    "name": "Office Test",
                    "reference": "https://attack.mitre.org/techniques/T1137/002/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1112",
                "name": "Modify Registry",
                "reference": "https://attack.mitre.org/techniques/T1112/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "registry.path",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "cb892b69-9feb-4d74-a3b4-f8022e037c7e",
        "rule_id": "14dab405-5dd9-450c-8106-72951af2391f",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.398Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.398Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "registry where host.os.type == \"windows\" and event.action != \"deletion\" and\n    registry.path : \"*\\\\Software\\\\Microsoft\\\\Office Test\\\\Special\\\\Perf\\\\*\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.registry-*",
          "logs-m365_defender.event-*",
          "endgame-*",
          "logs-sentinel_one_cloud_funnel.*"
        ]
      },
      {
        "name": "Spike in Number of Connections Made to a Destination IP",
        "description": "A machine learning job has detected a high count of source IPs establishing an RDP connection with a single destination IP. Attackers might use multiple compromised systems to attack a target to ensure redundancy in case a source IP gets detected and blocked.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Lateral Movement Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Lateral Movement"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-12h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/lmd",
          "https://www.elastic.co/blog/detecting-lateral-movement-activity-a-new-kibana-integration",
          "https://www.elastic.co/blog/remote-desktop-protocol-connections-elastic-security"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1210",
                "name": "Exploitation of Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1210/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Lateral Movement Detection integration assets to be installed, as well as file and Windows RDP process events collected by the Elastic Defend integration.  \n\n### Lateral Movement Detection Setup\nThe Lateral Movement Detection integration detects lateral movement activity by identifying abnormalities in file and Windows RDP events. Anomalies are detected using Elastic's Anomaly Detection feature.\n\n#### Prerequisite Requirements:\n- Fleet is required for Lateral Movement Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Windows RDP process events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n#### The following steps should be executed to install assets associated with the Lateral Movement Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Lateral Movement Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "lmd",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [],
        "id": "b60826bc-e727-4f5d-aee2-48b254ca17dc",
        "rule_id": "18a5dd9a-e3fa-4996-99b1-ae533b8f27fc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.401Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.401Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 70,
        "machine_learning_job_id": [
          "lmd_high_rdp_distinct_count_source_ip_for_destination"
        ]
      },
      {
        "name": "Potential Persistence via File Modification",
        "description": "This rule leverages the File Integrity Monitoring (FIM) integration to detect file modifications of files that are commonly used for persistence on Linux systems. The rule detects modifications to files that are commonly used for cron jobs, systemd services, message-of-the-day (MOTD), SSH configurations, shell configurations, runtime control, init daemon, passwd/sudoers/shadow files, Systemd udevd, and XDG/KDE autostart entries. To leverage this rule, the paths specified in the query need to be added to the FIM policy in the Elastic Security app.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Privilege Escalation",
          "Data Source: File Integrity Monitoring"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/primer-on-persistence-mechanisms",
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1037",
                "name": "Boot or Logon Initialization Scripts",
                "reference": "https://attack.mitre.org/techniques/T1037/",
                "subtechnique": [
                  {
                    "id": "T1037.004",
                    "name": "RC Scripts",
                    "reference": "https://attack.mitre.org/techniques/T1037/004/"
                  }
                ]
              },
              {
                "id": "T1136",
                "name": "Create Account",
                "reference": "https://attack.mitre.org/techniques/T1136/",
                "subtechnique": [
                  {
                    "id": "T1136.001",
                    "name": "Local Account",
                    "reference": "https://attack.mitre.org/techniques/T1136/001/"
                  }
                ]
              },
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/",
                "subtechnique": [
                  {
                    "id": "T1543.002",
                    "name": "Systemd Service",
                    "reference": "https://attack.mitre.org/techniques/T1543/002/"
                  }
                ]
              },
              {
                "id": "T1556",
                "name": "Modify Authentication Process",
                "reference": "https://attack.mitre.org/techniques/T1556/"
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/",
                "subtechnique": [
                  {
                    "id": "T1574.006",
                    "name": "Dynamic Linker Hijacking",
                    "reference": "https://attack.mitre.org/techniques/T1574/006/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1053",
                "name": "Scheduled Task/Job",
                "reference": "https://attack.mitre.org/techniques/T1053/",
                "subtechnique": [
                  {
                    "id": "T1053.003",
                    "name": "Cron",
                    "reference": "https://attack.mitre.org/techniques/T1053/003/"
                  }
                ]
              },
              {
                "id": "T1548",
                "name": "Abuse Elevation Control Mechanism",
                "reference": "https://attack.mitre.org/techniques/T1548/",
                "subtechnique": [
                  {
                    "id": "T1548.003",
                    "name": "Sudo and Sudo Caching",
                    "reference": "https://attack.mitre.org/techniques/T1548/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from the Elastic File Integrity Monitoring (FIM) integration.\n\n### Elastic FIM Integration Setup\nTo configure the Elastic FIM integration, follow these steps:\n\n1. Install and configure the Elastic Agent on your Linux system. You can refer to the [Elastic Agent documentation](https://www.elastic.co/guide/en/fleet/current/elastic-agent-installation.html) for detailed instructions.\n2. Once the Elastic Agent is installed, navigate to the Elastic Security app in Kibana.\n3. In the Kibana home page, click on \"Integrations\" in the left sidebar.\n4. Search for \"File Integrity Monitoring\" in the search bar and select the integration.\n5. Provide a name and optional description for the integration.\n6. Select the appropriate agent policy for your Linux system or create a new one.\n7. Configure the FIM policy by specifying the paths that you want to monitor for file modifications. You can use the same paths mentioned in the `query` field of the rule. Note that FIM does not accept wildcards in the paths, so you need to specify the exact paths you want to monitor.\n8. Save the configuration and the Elastic Agent will start monitoring the specified paths for file modifications.\n\nFor more details on configuring the Elastic FIM integration, you can refer to the [Elastic FIM documentation](https://docs.elastic.co/integrations/fim).\n",
        "related_integrations": [
          {
            "package": "fim",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "fffe1fcd-39bd-4cee-b59e-920b71721dac",
        "rule_id": "192657ba-ab0e-4901-89a2-911d611eee98",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.405Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.405Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.dataset == \"fim.event\" and event.action == \"updated\" and\nfile.path : (\n  // cron, anacron & at\n  \"/etc/cron.d/*\", \"/etc/cron.daily/*\", \"/etc/cron.hourly/*\", \"/etc/cron.monthly/*\",\n  \"/etc/cron.weekly/*\", \"/etc/crontab\", \"/var/spool/cron/crontabs/*\", \"/etc/cron.allow\",\n  \"/etc/cron.deny\",  \"/var/spool/anacron/*\", \"/var/spool/cron/atjobs/*\",\n\n  // systemd services & timers\n  \"/etc/systemd/system/*\", \"/usr/local/lib/systemd/system/*\", \"/lib/systemd/system/*\",\n  \"/usr/lib/systemd/system/*\", \"/home/*/.config/systemd/user/*\", \"/home/*/.local/share/systemd/user/*\",\n  \"/root/.config/systemd/user/*\", \"/root/.local/share/systemd/user/*\",\n\n  // LD_PRELOAD\n  \"/etc/ld.so.preload\", \"/etc/ld.so.conf.d/*\", \"/etc/ld.so.conf\",\n\n  // message-of-the-day (MOTD)\n  \"/etc/update-motd.d/*\",\n\n  // SSH\n  \"/home/*/.ssh/*\", \"/root/.ssh/*\", \"/etc/ssh/*\",\n\n  // system-wide shell configurations\n  \"/etc/profile\", \"/etc/profile.d/*\", \"/etc/bash.bashrc\", \"/etc/zsh/*\", \"/etc/csh.cshrc\",\n  \"/etc/csh.login\", \"/etc/fish/config.fish\", \"/etc/ksh.kshrc\",\n\n  // root and user shell configurations\n  \"/home/*/.profile\", \"/home/*/.bashrc\", \"/home/*/.bash_login\", \"/home/*/.bash_logout\",\n  \"/root/.profile\", \"/root/.bashrc\", \"/root/.bash_login\", \"/root/.bash_logout\",\n  \"/home/*/.zprofile\", \"/home/*/.zshrc\", \"/root/.zprofile\", \"/root/.zshrc\",\n  \"/home/*/.cshrc\", \"/home/*/.login\", \"/home/*/.logout\", \"/root/.cshrc\", \"/root/.login\", \"/root/.logout\",\n  \"/home/*/.config/fish/config.fish\", \"/root/.config/fish/config.fish\",\n  \"/home/*/.kshrc\", \"/root/.kshrc\",\n\n  // runtime control\n  \"/etc/rc.common\", \"/etc/rc.local\",\n\n  // System V init/Upstart\n  \"/etc/init.d/*\", \"/etc/init/*\",\n\n  // passwd/sudoers/shadow\n  \"/etc/passwd\", \"/etc/shadow\", \"/etc/sudoers\", \"/etc/sudoers.d/*\",\n\n  // Systemd udevd\n  \"/lib/udev/*\", \"/etc/udev/rules.d/*\", \"/usr/lib/udev/rules.d/*\", \"/run/udev/rules.d/*\", \"/usr/local/lib/udev/rules.d/*\",\n\n  // XDG/KDE autostart entries\n  \"/home/*/.config/autostart/*\", \"/root/.config/autostart/*\", \"/etc/xdg/autostart/*\", \"/usr/share/autostart/*\",\n  \"/home/*/.kde/Autostart/*\", \"/root/.kde/Autostart/*\",\n  \"/home/*/.kde4/Autostart/*\", \"/root/.kde4/Autostart/*\",\n  \"/home/*/.kde/share/autostart/*\", \"/root/.kde/share/autostart/*\",\n  \"/home/*/.kde4/share/autostart/*\", \"/root/.kde4/share/autostart/*\",\n  \"/home/*/.local/share/autostart/*\", \"/root/.local/share/autostart/*\",\n  \"/home/*/.config/autostart-scripts/*\", \"/root/.config/autostart-scripts/*\"\n) and not (\n  file.path : (\n    \"/var/spool/cron/crontabs/tmp.*\", \"/run/udev/rules.d/*rules.*\", \"/home/*/.ssh/known_hosts.*\", \"/root/.ssh/known_hosts.*\"\n  ) or\n  file.extension in (\"dpkg-new\", \"dpkg-remove\", \"SEQ\")\n)\n",
        "language": "eql",
        "index": [
          "logs-fim.event-*",
          "auditbeat-*"
        ]
      },
      {
        "name": "Potential Privilege Escalation via Recently Compiled Executable",
        "description": "This rule monitors a sequence involving a program compilation event followed by its execution and a subsequent alteration of UID permissions to root privileges. This behavior can potentially indicate the execution of a kernel or software privilege escalation exploit.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Use Case: Vulnerability",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "53f741a4-b7f3-4c2b-8bbc-961e821fa7cb",
        "rule_id": "193549e8-bb9e-466a-a7f9-7e783f5cb5a6",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.408Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.408Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id with maxspan=1m\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and \n   process.name in (\"gcc\", \"g++\", \"cc\") and user.id != \"0\"] by process.args\n  [file where host.os.type == \"linux\" and event.action == \"creation\" and event.type == \"creation\" and \n   process.name == \"ld\" and user.id != \"0\"] by file.name\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and \n   user.id != \"0\"] by process.name\n  [process where host.os.type == \"linux\" and event.action in (\"uid_change\", \"guid_change\") and event.type == \"change\" and \n   user.id == \"0\"] by process.name\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "New GitHub App Installed",
        "description": "This rule detects when a new GitHub App has been installed in your organization account. GitHub Apps extend GitHub's functionality both within and outside of GitHub. When an app is installed it is granted permissions to read or modify your repository and organization data. Only trusted apps should be installed and any newly installed apps should be investigated to verify their legitimacy. Unauthorized app installation could lower your organization's security posture and leave you exposed for future attacks.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1072",
                "name": "Software Deployment Tools",
                "reference": "https://attack.mitre.org/techniques/T1072/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "47e2ef2c-471f-4833-be22-02990f14e149",
        "rule_id": "1ca62f14-4787-4913-b7af-df11745a49da",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.414Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.414Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "configuration where event.dataset == \"github.audit\" and event.action == \"integration_installation.create\"\n",
        "language": "eql",
        "index": [
          "logs-github.audit-*"
        ]
      },
      {
        "name": "Spike in Number of Processes in an RDP Session",
        "description": "A machine learning job has detected unusually high number of processes started in a single RDP session. Executing a large number of processes remotely on other machines can be an indicator of lateral movement activity.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Lateral Movement Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Lateral Movement"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-12h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/lmd",
          "https://www.elastic.co/blog/detecting-lateral-movement-activity-a-new-kibana-integration",
          "https://www.elastic.co/blog/remote-desktop-protocol-connections-elastic-security"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1210",
                "name": "Exploitation of Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1210/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Lateral Movement Detection integration assets to be installed, as well as file and Windows RDP process events collected by the Elastic Defend integration.  \n\n### Lateral Movement Detection Setup\nThe Lateral Movement Detection integration detects lateral movement activity by identifying abnormalities in file and Windows RDP events. Anomalies are detected using Elastic's Anomaly Detection feature.\n\n#### Prerequisite Requirements:\n- Fleet is required for Lateral Movement Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Windows RDP process events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n#### The following steps should be executed to install assets associated with the Lateral Movement Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Lateral Movement Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "lmd",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [],
        "id": "1e0015e4-02ec-4b13-b2b9-54ea63007394",
        "rule_id": "19e9daf3-f5c5-4bc2-a9af-6b1e97098f03",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.411Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.411Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 70,
        "machine_learning_job_id": [
          "lmd_high_sum_rdp_number_of_processes"
        ]
      },
      {
        "name": "Potential Linux Hack Tool Launched",
        "description": "Monitors for the execution of different processes that might be used by attackers for malicious intent. An alert from this rule should be investigated further, as hack tools are commonly used by blue teamers and system administrators as well.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows\nthe Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest to select \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "bbc98f0e-2bd0-45c0-b9ed-4873e0974104",
        "rule_id": "1df1152b-610a-4f48-9d7a-504f6ee5d9da",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.417Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.417Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and\nevent.action in (\"exec\", \"exec_event\", \"executed\", \"process_started\") and\nprocess.name in~ (\n  // exploitation frameworks\n  \"crackmapexec\", \"msfconsole\", \"msfvenom\", \"sliver-client\", \"sliver-server\", \"havoc\",\n  // network scanners (nmap left out to reduce noise)\n  \"zenmap\", \"nuclei\", \"netdiscover\", \"legion\",\n  // web enumeration\n  \"gobuster\", \"dirbuster\", \"dirb\", \"wfuzz\", \"ffuf\", \"whatweb\", \"eyewitness\",\n  // web vulnerability scanning\n  \"wpscan\", \"joomscan\", \"droopescan\", \"nikto\", \n  // exploitation tools\n  \"sqlmap\", \"commix\", \"yersinia\",\n  // cracking and brute forcing\n  \"john\", \"hashcat\", \"hydra\", \"ncrack\", \"cewl\", \"fcrackzip\", \"rainbowcrack\",\n  // host and network\n  \"linenum.sh\", \"linpeas.sh\", \"pspy32\", \"pspy32s\", \"pspy64\", \"pspy64s\", \"binwalk\", \"evil-winrm\",\n  \"linux-exploit-suggester-2.pl\", \"linux-exploit-suggester.sh\", \"panix.sh\"\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Creation of a DNS-Named Record",
        "description": "Active Directory Integrated DNS (ADIDNS) is one of the core components of AD DS, leveraging AD's access control and replication to maintain domain consistency. It stores DNS zones as AD objects, a feature that, while robust, introduces some security issues because of the default permission (Any authenticated users) to create DNS-named records. Attackers can perform Dynamic Spoofing attacks, where they monitor LLMNR/NBT-NS requests and create DNS-named records to target systems that are requested from multiple systems. They can also create specific records to target specific services, such as wpad, for spoofing attacks.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 103,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: Active Directory",
          "Use Case: Active Directory Monitoring",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.netspi.com/blog/technical/network-penetration-testing/adidns-revisited/",
          "https://www.thehacker.recipes/a-d/movement/mitm-and-coerced-authentications/wpad-spoofing"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1557",
                "name": "Adversary-in-the-Middle",
                "reference": "https://attack.mitre.org/techniques/T1557/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe 'Audit Directory Service Changes' logging policy must be configured for (Success, Failure).\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nPolicies >\nWindows Settings >\nSecurity Settings >\nAdvanced Audit Policies Configuration >\nAudit Policies >\nDS Access >\nAudit Directory Service Changes (Success,Failure)\n```\n\nThe above policy does not cover the target object by default (we still need it to be configured to generate events), so we need to set up an AuditRule using https://github.com/OTRF/Set-AuditRule.\n\n```\nSet-AuditRule -AdObjectPath 'AD:\\CN=MicrosoftDNS,DC=DomainDNSZones,DC=Domain,DC=com' -WellKnownSidType WorldSid -Rights CreateChild -InheritanceFlags Descendents -AttributeGUID e0fa1e8c-9b45-11d0-afdd-00c04fd930c9 -AuditFlags Success\n```\n",
        "related_integrations": [
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.code",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "winlog.event_data.ObjectClass",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "winlog.event_data.SubjectUserName",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "dd8055ec-7196-4d2f-9d98-bca9dc9136ef",
        "rule_id": "1e1b2e7e-b8f5-45e5-addc-66cc1224ffbc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.421Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.421Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where host.os.type == \"windows\" and event.action in (\"Directory Service Changes\", \"directory-service-object-modified\") and\n    event.code == \"5137\" and winlog.event_data.ObjectClass == \"dnsNode\" and\n    not winlog.event_data.SubjectUserName : \"*$\"\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-system.*",
          "logs-windows.*"
        ]
      },
      {
        "name": "First Occurrence of Private Repo Event from Specific GitHub Personal Access Token (PAT)",
        "description": "Detects a new private repo interaction for a GitHub PAT not seen in the last 14 days.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Execution",
          "Rule Type: BBR",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1648",
                "name": "Serverless Execution",
                "reference": "https://attack.mitre.org/techniques/T1648/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "github.hashed_token",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "github.programmatic_access_type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "github.repo",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "github.repository_public",
            "type": "boolean",
            "ecs": false
          }
        ],
        "id": "4169e570-47b9-4d33-a64a-067112d19398",
        "rule_id": "1e9b271c-8caa-4e20-aed8-e91e34de9283",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.424Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.424Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset:\"github.audit\" and event.category:\"configuration\" and\ngithub.repo:* and github.hashed_token:* and\ngithub.programmatic_access_type:(\"OAuth access token\" or \"Fine-grained personal access token\") and \ngithub.repository_public:false\n",
        "new_terms_fields": [
          "github.hashed_token",
          "github.repo"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-github.audit-*"
        ],
        "language": "kuery"
      },
      {
        "name": "Unusual Process Execution on WBEM Path",
        "description": "Identifies unusual processes running from the WBEM path, uncommon outside WMI-related Windows processes.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 104,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Rule Type: BBR",
          "Data Source: Elastic Endgame",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a59e8cff-fa39-4e67-8625-80ed2380e8af",
        "rule_id": "1f460f12-a3cf-4105-9ebb-f788cc63f365",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.427Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.427Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  process.executable : (\"?:\\\\Windows\\\\System32\\\\wbem\\\\*\", \"?:\\\\Windows\\\\SysWow64\\\\wbem\\\\*\") and\n  not process.name : (\n    \"mofcomp.exe\",\n    \"scrcons.exe\",\n    \"unsecapp.exe\",\n    \"wbemtest.exe\",\n    \"winmgmt.exe\",\n    \"wmiadap.exe\",\n    \"wmiapsrv.exe\",\n    \"wmic.exe\",\n    \"wmiprvse.exe\"\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-system.security*",
          "winlogbeat-*",
          "logs-windows.*",
          "endgame-*"
        ]
      },
      {
        "name": "Mofcomp Activity",
        "description": "Managed Object Format (MOF) files can be compiled locally or remotely through mofcomp.exe. Attackers may leverage MOF files to build their own namespaces and classes into the Windows Management Instrumentation (WMI) repository, or establish persistence using WMI Event Subscription.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: Elastic Endgame",
          "Data Source: System",
          "Data Source: Crowdstrike"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1047",
                "name": "Windows Management Instrumentation",
                "reference": "https://attack.mitre.org/techniques/T1047/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/",
                "subtechnique": [
                  {
                    "id": "T1546.003",
                    "name": "Windows Management Instrumentation Event Subscription",
                    "reference": "https://attack.mitre.org/techniques/T1546/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "crowdstrike",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "dcf55cea-f79c-4197-bfe6-03530cd58ce9",
        "rule_id": "210d4430-b371-470e-b879-80b7182aa75e",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.439Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.439Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  process.name : \"mofcomp.exe\" and process.args : \"*.mof\" and\n  not user.id : \"S-1-5-18\" and\n  not\n  (\n    process.parent.name : \"ScenarioEngine.exe\" and\n    process.args : (\n      \"*\\\\MSSQL\\\\Binn\\\\*.mof\",\n      \"*\\\\Microsoft SQL Server\\\\???\\\\Shared\\\\*.mof\",\n      \"*\\\\OLAP\\\\bin\\\\*.mof\"\n    )\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-m365_defender.event-*",
          "endgame-*",
          "logs-system.security-*",
          "logs-crowdstrike.fdr*"
        ]
      },
      {
        "name": "Potential PowerShell HackTool Script by Author",
        "description": "Detects known PowerShell offensive tooling author's name in PowerShell scripts. Attackers commonly use out-of-the-box offensive tools without modifying the code, which may still contain the author artifacts. This rule identifies common author handles found in popular PowerShell scripts used for red team exercises.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 104,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: PowerShell Logs"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/atc-project/atc-data/blob/master/docs/Logging_Policies/LP_0109_windows_powershell_script_block_log.md"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.001",
                    "name": "PowerShell",
                    "reference": "https://attack.mitre.org/techniques/T1059/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe 'PowerShell Script Block Logging' logging policy must be enabled.\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nAdministrative Templates >\nWindows PowerShell >\nTurn on PowerShell Script Block Logging (Enable)\n```\n\nSteps to implement the logging policy via registry:\n\n```\nreg add \"hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\" /v EnableScriptBlockLogging /t REG_DWORD /d 1\n```\n",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "powershell.file.script_block_text",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "fa91d8ec-ca02-47f0-8e7a-f348b07faad1",
        "rule_id": "2553a9af-52a4-4a05-bb03-85b2a479a0a0",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.442Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.442Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "winlogbeat-*",
          "logs-windows.powershell*"
        ],
        "query": "host.os.type:windows and event.category:process and\n  powershell.file.script_block_text : (\n      \"mattifestation\" or \"JosephBialek\" or\n      \"harmj0y\" or \"ukstufus\" or\n      \"SecureThisShit\" or \"Matthew Graeber\" or\n      \"secabstraction\" or \"mgeeky\" or\n      \"oddvarmoe\" or \"am0nsec\" or\n      \"obscuresec\" or \"sixdub\" or\n      \"darkoperator\" or \"funoverip\" or\n      \"rvrsh3ll\" or \"kevin_robertson\" or\n      \"dafthack\" or \"r4wd3r\" or\n      \"danielhbohannon\" or \"OneLogicalMyth\" or\n      \"cobbr_io\" or \"xorrior\" or\n      \"PetrMedonos\" or \"citronneur\" or\n      \"eladshamir\" or \"RastaMouse\" or\n      \"enigma0x3\" or \"FuzzySec\" or\n      \"424f424f\" or \"jaredhaight\" or\n      \"fullmetalcache\" or \"Hubbl3\" or\n      \"curi0usJack\" or \"Cx01N\" or\n      \"itm4n\" or \"nurfed1\" or\n      \"cfalta\" or \"Scott Sutherland\" or\n      \"_nullbind\" or \"_tmenochet\" or\n      \"jaredcatkinson\" or \"ChrisTruncer\" or\n      \"monoxgas\" or \"TheRealWover\" or\n      \"splinter_code\"\n  )\n",
        "language": "kuery"
      },
      {
        "name": "Potential Reverse Shell via Background Process",
        "description": "Monitors for the execution of background processes with process arguments capable of opening a socket in the /dev/tcp channel. This may indicate the creation of a backdoor reverse connection, and should be investigated further.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1071",
                "name": "Application Layer Protocol",
                "reference": "https://attack.mitre.org/techniques/T1071/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "0d19a628-56ea-434a-b977-2e8a2cca922c",
        "rule_id": "259be2d8-3b1a-4c2c-a0eb-0c8e77f35e39",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.446Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.446Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and \nprocess.name in (\"setsid\", \"nohup\") and process.args : \"*/dev/tcp/*0>&1*\" and \nprocess.parent.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "Privilege Escalation via SUID/SGID",
        "description": "Identifies instances where a process is executed with user/group ID 0 (root), and a real user/group ID that is not 0. This is indicative of a process that has been granted SUID/SGID permissions, allowing it to run with elevated privileges. Attackers may leverage a misconfiguration for exploitation in order to escalate their privileges to root, or establish a backdoor for persistence.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 105,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Tactic: Persistence",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://gtfobins.github.io/#+suid",
          "https://www.elastic.co/security-labs/primer-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              },
              {
                "id": "T1548",
                "name": "Abuse Elevation Control Mechanism",
                "reference": "https://attack.mitre.org/techniques/T1548/",
                "subtechnique": [
                  {
                    "id": "T1548.001",
                    "name": "Setuid and Setgid",
                    "reference": "https://attack.mitre.org/techniques/T1548/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.group.id",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.real_group.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.real_user.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a8ef820a-2dbd-4caf-a838-4f326ae9b514",
        "rule_id": "28eb3afe-131d-48b0-a8fc-9784f3d54f3c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.449Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.449Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and (\n  (process.user.id == \"0\" and process.real_user.id != \"0\") or \n  (process.group.id == \"0\" and process.real_group.id != \"0\")\n) and (\n  process.name in (\n    \"aa-exec\", \"ab\", \"agetty\", \"alpine\", \"ar\", \"arj\", \"arp\", \"as\", \"ascii-xfr\", \"ash\", \"aspell\",\n    \"atobm\", \"awk\", \"base32\", \"base64\", \"basenc\", \"basez\", \"bash\", \"bc\", \"bridge\", \"busctl\",\n    \"busybox\", \"bzip2\", \"cabal\", \"capsh\", \"cat\", \"choom\", \"chown\", \"chroot\", \"clamscan\", \"cmp\",\n    \"column\", \"comm\", \"cp\", \"cpio\", \"cpulimit\", \"csh\", \"csplit\", \"csvtool\", \"cupsfilter\", \"curl\",\n    \"cut\", \"dash\", \"date\", \"dd\", \"debugfs\", \"dialog\", \"diff\", \"dig\", \"distcc\", \"dmsetup\", \"docker\",\n    \"dosbox\", \"ed\", \"efax\", \"elvish\", \"emacs\", \"env\", \"eqn\", \"espeak\", \"expand\", \"expect\", \"file\",\n    \"find\", \"fish\", \"flock\", \"fmt\", \"fold\", \"gawk\", \"gcore\", \"gdb\", \"genie\", \"genisoimage\", \"gimp\",\n    \"grep\", \"gtester\", \"gzip\", \"hd\", \"head\", \"hexdump\", \"highlight\", \"hping3\", \"iconv\", \"install\",\n    \"ionice\", \"ispell\", \"jjs\", \"join\", \"jq\", \"jrunscript\", \"julia\", \"ksh\", \"ksshell\", \"kubectl\",\n    \"ld.so\", \"less\", \"links\", \"logsave\", \"look\", \"lua\", \"make\", \"mawk\", \"minicom\", \"more\",\n    \"mosquitto\", \"msgattrib\", \"msgcat\", \"msgconv\", \"msgfilter\", \"msgmerge\", \"msguniq\", \"multitime\",\n    \"mv\", \"nasm\", \"nawk\", \"ncftp\", \"nft\", \"nice\", \"nl\", \"nm\", \"nmap\", \"node\", \"nohup\", \"ntpdate\",\n    \"od\", \"openssl\", \"openvpn\", \"pandoc\", \"paste\", \"perf\", \"perl\", \"pexec\", \"pg\", \"php\", \"pidstat\",\n    \"pr\", \"ptx\", \"python\", \"rc\", \"readelf\", \"restic\", \"rev\", \"rlwrap\", \"rsync\", \"rtorrent\",\n    \"run-parts\", \"rview\", \"rvim\", \"sash\", \"scanmem\", \"sed\", \"setarch\", \"setfacl\", \"setlock\", \"shuf\",\n    \"soelim\", \"softlimit\", \"sort\", \"sqlite3\", \"ss\", \"ssh-agent\", \"ssh-keygen\", \"ssh-keyscan\",\n    \"sshpass\", \"start-stop-daemon\", \"stdbuf\", \"strace\", \"strings\", \"sysctl\", \"systemctl\", \"tac\",\n    \"tail\", \"taskset\", \"tbl\", \"tclsh\", \"tee\", \"terraform\", \"tftp\", \"tic\", \"time\", \"timeout\", \"troff\",\n    \"ul\", \"unexpand\", \"uniq\", \"unshare\", \"unsquashfs\", \"unzip\", \"update-alternatives\", \"uudecode\",\n    \"uuencode\", \"vagrant\", \"varnishncsa\", \"view\", \"vigr\", \"vim\", \"vimdiff\", \"vipw\", \"w3m\", \"watch\",\n    \"wc\", \"wget\", \"whiptail\", \"xargs\", \"xdotool\", \"xmodmap\", \"xmore\", \"xxd\", \"xz\", \"yash\", \"zsh\",\n    \"zsoelim\"\n  ) or \n  process.name == \"ip\" and (\n    (process.args == \"-force\" and process.args in (\"-batch\", \"-b\")) or (process.args == \"exec\")\n  )\n) and not process.parent.name == \"spine\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "GitHub Repository Deleted",
        "description": "This rule detects when a GitHub repository is deleted within your organization. Repositories are a critical component used within an organization to manage work, collaborate with others and release products to the public. Any delete action against a repository should be investigated to determine it's validity. Unauthorized deletion of organization repositories could cause irreversible loss of intellectual property and indicate compromise within your organization.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 203,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Impact",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1485",
                "name": "Data Destruction",
                "reference": "https://attack.mitre.org/techniques/T1485/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.module",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "9654806f-a384-4ffc-b863-bc460b6cf350",
        "rule_id": "345889c4-23a8-4bc0-b7ca-756bd17ce83b",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.455Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.455Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "configuration where event.module == \"github\" and event.dataset == \"github.audit\" and event.action == \"repo.destroy\"\n",
        "language": "eql",
        "index": [
          "logs-github.audit-*"
        ]
      },
      {
        "name": "Linux SSH X11 Forwarding",
        "description": "This rule monitors for X11 forwarding via SSH. X11 forwarding is a feature that allows users to run graphical applications on a remote server and display the application's graphical user interface on their local machine. Attackers can abuse X11 forwarding for tunneling their GUI-based tools, pivot through compromised systems, and create covert communication channels, enabling lateral movement and facilitating remote control of systems within a network.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Potential Linux SSH X11 Forwarding\n\nAttackers can leverage SSH X11 forwarding to capture a user's graphical desktop session and potentially execute unauthorized GUI applications remotely.\n\nThis rule looks for the execution of SSH in conjunction with command line arguments that are capable of setting up X11 forwarding. \n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/master/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n> This investigation guide uses [placeholder fields](https://www.elastic.co/guide/en/security/current/osquery-placeholder-fields.html) to dynamically pass alert data into Osquery queries. Placeholder fields were introduced in Elastic Stack version 8.7.0. If you're using Elastic Stack version 8.6.0 or earlier, you'll need to manually adjust this investigation guide's queries to ensure they properly run.\n\n#### Possible investigation steps\n\n- Identify any signs of suspicious network activity or anomalies that may indicate network forwarding activity. This could include unexpected traffic patterns or unusual network behavior.\n  - Investigate listening ports and open sockets to look for potential protocol tunneling, reverse shells, or data exfiltration.\n    - !{osquery{\"label\":\"Osquery - Retrieve Listening Ports\",\"query\":\"SELECT pid, address, port, socket, protocol, path FROM listening_ports\"}}\n    - !{osquery{\"label\":\"Osquery - Retrieve Open Sockets\",\"query\":\"SELECT pid, family, remote_address, remote_port, socket, state FROM process_open_sockets\"}}\n- Identify the user account that performed the action, analyze it, and check whether it should perform this kind of action.\n  - !{osquery{\"label\":\"Osquery - Retrieve Information for a Specific User\",\"query\":\"SELECT * FROM users WHERE username = {{user.name}}\"}}\n- Investigate whether the user is currently logged in and active.\n  - !{osquery{\"label\":\"Osquery - Investigate the Account Authentication Status\",\"query\":\"SELECT * FROM logged_in_users WHERE user = {{user.name}}\"}}\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence and whether they are located in expected locations.\n  - !{osquery{\"label\":\"Osquery - Retrieve Running Processes by User\",\"query\":\"SELECT pid, username, name FROM processes p JOIN users u ON u.uid = p.uid ORDER BY username\"}}\n  - !{osquery{\"label\":\"Osquery - Retrieve Process Info\",\"query\":\"SELECT name, cmdline, parent, path, uid FROM processes\"}}\n- Investigate other alerts associated with the user/host during the past 48 hours.\n  - If scripts or executables were dropped, retrieve the files and determine if they are malicious:\n    - Use a private sandboxed malware analysis system to perform analysis.\n      - Observe and collect information about the following activities:\n        - Attempts to contact external domains and addresses.\n          - Check if the domain is newly registered or unexpected.\n          - Check the reputation of the domain or IP address.\n        - File access, modification, and creation activities.\n\n### Related rules\n\n- Potential Linux Tunneling and/or Port Forwarding - 6ee947e9-de7e-4281-a55d-09289bdf947e\n\n### False positive analysis\n\n- If this activity is related to new benign software installation activity, consider adding exceptions — preferably with a combination of user and command line conditions.\n- If this activity is related to a system administrator or developer who uses port tunneling/forwarding for benign purposes, consider adding exceptions for specific user accounts or hosts. \n- Try to understand the context of the execution by thinking about the user, machine, or business purpose. A small number of endpoints, such as servers with unique software, might appear unusual but satisfy a specific business need.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors, such as reverse shells, reverse proxies, or droppers, that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Leverage the incident response data and logging to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Command and Control",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://book.hacktricks.xyz/generic-methodologies-and-resources/tunneling-and-port-forwarding"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1572",
                "name": "Protocol Tunneling",
                "reference": "https://attack.mitre.org/techniques/T1572/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "8c9c70bb-385d-4f30-bc92-4c092a7d916c",
        "rule_id": "29f0cf93-d17c-4b12-b4f3-a433800539fa",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.452Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.452Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and\nprocess.name in (\"ssh\", \"sshd\") and process.args in (\"-X\", \"-Y\") and process.args_count >= 3 and \nprocess.parent.name in (\"bash\", \"dash\", \"ash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "Spike in Bytes Sent to an External Device",
        "description": "A machine learning job has detected high bytes of data written to an external device. In a typical operational setting, there is usually a predictable pattern or a certain range of data that is written to external devices. An unusually large amount of data being written is anomalous and can signal illicit data copying or transfer activities.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Data Exfiltration Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Exfiltration"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-2h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/ded",
          "https://www.elastic.co/blog/detect-data-exfiltration-activity-with-kibanas-new-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": [
              {
                "id": "T1052",
                "name": "Exfiltration Over Physical Medium",
                "reference": "https://attack.mitre.org/techniques/T1052/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Data Exfiltration Detection integration assets to be installed, as well as network and file events collected by integrations such as Elastic Defend and Network Packet Capture (for network events only).  \n\n### Data Exfiltration Detection Setup\nThe Data Exfiltration Detection integration detects data exfiltration activity by identifying abnormalities in network and file events. Anomalies are detected using Elastic's Anomaly Detection feature. \n\n#### Prerequisite Requirements:\n- Fleet is required for Data Exfiltration Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- File events collected by the Elastic Defend integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n#### The following steps should be executed to install assets associated with the Data Exfiltration Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Data Exfiltration Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "ded",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [],
        "id": "52557eb4-569b-48a1-b011-2c1c83a1a6b9",
        "rule_id": "35a3b253-eea8-46f0-abd3-68bdd47e6e3d",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.459Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.459Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 75,
        "machine_learning_job_id": [
          "ded_high_bytes_written_to_external_device"
        ]
      },
      {
        "name": "High Mean of Process Arguments in an RDP Session",
        "description": "A machine learning job has detected unusually high number of process arguments in an RDP session. Executing sophisticated attacks such as lateral movement can involve the use of complex commands, obfuscation mechanisms, redirection and piping, which in turn increases the number of arguments in a command.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Lateral Movement Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Lateral Movement"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-12h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/lmd",
          "https://www.elastic.co/blog/detecting-lateral-movement-activity-a-new-kibana-integration",
          "https://www.elastic.co/blog/remote-desktop-protocol-connections-elastic-security"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1210",
                "name": "Exploitation of Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1210/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Lateral Movement Detection integration assets to be installed, as well as file and Windows RDP process events collected by the Elastic Defend integration.  \n\n### Lateral Movement Detection Setup\nThe Lateral Movement Detection integration detects lateral movement activity by identifying abnormalities in file and Windows RDP events. Anomalies are detected using Elastic's Anomaly Detection feature.\n\n#### Prerequisite Requirements:\n- Fleet is required for Lateral Movement Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Windows RDP process events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n#### The following steps should be executed to install assets associated with the Lateral Movement Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Lateral Movement Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "lmd",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [],
        "id": "d0a3e1dd-d1e3-42e6-b422-38de337b3d71",
        "rule_id": "36c48a0c-c63a-4cbc-aee1-8cac87db31a9",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.462Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.462Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 70,
        "machine_learning_job_id": [
          "lmd_high_mean_rdp_process_args"
        ]
      },
      {
        "name": "First Occurrence of IP Address For GitHub User",
        "description": "Detects a new IP address used for a GitHub user not previously seen in the last 14 days.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Initial Access",
          "Rule Type: BBR",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1078",
                "name": "Valid Accounts",
                "reference": "https://attack.mitre.org/techniques/T1078/",
                "subtechnique": [
                  {
                    "id": "T1078.004",
                    "name": "Cloud Accounts",
                    "reference": "https://attack.mitre.org/techniques/T1078/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "github.actor_ip",
            "type": "ip",
            "ecs": false
          },
          {
            "name": "user.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "0f52dc48-63f6-4e6b-9115-6925d6fa728b",
        "rule_id": "3af4cb9b-973f-4c54-be2b-7623c0e21b2b",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.605Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.605Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset:\"github.audit\" and event.category:\"configuration\" and\ngithub.actor_ip:* and user.name:*\n",
        "new_terms_fields": [
          "user.name",
          "github.actor_ip"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-github.audit-*"
        ],
        "language": "kuery"
      },
      {
        "name": "ScreenConnect Server Spawning Suspicious Processes",
        "description": "Identifies suspicious processes being spawned by the ScreenConnect server process (ScreenConnect.Service.exe). This activity may indicate exploitation activity or access to an existing web shell backdoor.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 203,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Initial Access",
          "Tactic: Execution",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon",
          "Data Source: System",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: SentinelOne",
          "Data Source: Crowdstrike"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://blackpointcyber.com/resources/blog/breaking-through-the-screen/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1190",
                "name": "Exploit Public-Facing Application",
                "reference": "https://attack.mitre.org/techniques/T1190/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.001",
                    "name": "PowerShell",
                    "reference": "https://attack.mitre.org/techniques/T1059/001/"
                  },
                  {
                    "id": "T1059.003",
                    "name": "Windows Command Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "crowdstrike",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pe.original_file_name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "65cd6d28-bbce-4dce-b75b-b987f805eed1",
        "rule_id": "3d00feab-e203-4acc-a463-c3e15b7e9a73",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.609Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.609Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  process.parent.name : \"ScreenConnect.Service.exe\" and\n  (process.name : (\"cmd.exe\", \"powershell.exe\", \"pwsh.exe\", \"powershell_ise.exe\", \"csc.exe\") or\n  ?process.pe.original_file_name in (\"cmd.exe\", \"powershell.exe\", \"pwsh.dll\", \"powershell_ise.exe\"))\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "winlogbeat-*",
          "logs-windows.forwarded*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-system.security*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-crowdstrike.fdr*"
        ]
      },
      {
        "name": "Spike in Number of Connections Made from a Source IP",
        "description": "A machine learning job has detected a high count of destination IPs establishing an RDP connection with a single source IP. Once an attacker has gained access to one system, they might attempt to access more in the network in search of valuable assets, data, or further access points.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Lateral Movement Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Lateral Movement"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-12h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/lmd",
          "https://www.elastic.co/blog/detecting-lateral-movement-activity-a-new-kibana-integration",
          "https://www.elastic.co/blog/remote-desktop-protocol-connections-elastic-security"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1210",
                "name": "Exploitation of Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1210/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Lateral Movement Detection integration assets to be installed, as well as file and Windows RDP process events collected by the Elastic Defend integration.  \n\n### Lateral Movement Detection Setup\nThe Lateral Movement Detection integration detects lateral movement activity by identifying abnormalities in file and Windows RDP events. Anomalies are detected using Elastic's Anomaly Detection feature.\n\n#### Prerequisite Requirements:\n- Fleet is required for Lateral Movement Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Windows RDP process events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n#### The following steps should be executed to install assets associated with the Lateral Movement Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Lateral Movement Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "lmd",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [],
        "id": "81b36e09-0209-47fb-a5e9-1b18ad1f7413",
        "rule_id": "3e0561b5-3fac-4461-84cc-19163b9aaa61",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.612Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.612Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 70,
        "machine_learning_job_id": [
          "lmd_high_rdp_distinct_count_destination_ip_for_source"
        ]
      },
      {
        "name": "Kernel Driver Load",
        "description": "Detects the loading of a Linux kernel module through system calls. Threat actors may leverage Linux kernel modules to load a rootkit on a system providing them with complete control and the ability to hide from security products. As other rules monitor for the addition of Linux kernel modules through system utilities or .ko files, this rule covers the gap that evasive rootkits leverage by monitoring for kernel module additions on the lowest level through auditd_manager.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Data Source: Auditd Manager",
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1547",
                "name": "Boot or Logon Autostart Execution",
                "reference": "https://attack.mitre.org/techniques/T1547/",
                "subtechnique": [
                  {
                    "id": "T1547.006",
                    "name": "Kernel Modules and Extensions",
                    "reference": "https://attack.mitre.org/techniques/T1547/006/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1014",
                "name": "Rootkit",
                "reference": "https://attack.mitre.org/techniques/T1014/"
              }
            ]
          }
        ],
        "setup": "## Setup\nThis rule requires the use of the `auditd_manager` integration. `Auditd_manager` is a tool designed to simplify and enhance the management of the audit subsystem in Linux systems. It provides a user-friendly interface and automation capabilities for configuring and monitoring system auditing through the auditd daemon. With `auditd_manager`, administrators can easily define audit rules, track system events, and generate comprehensive audit reports, improving overall security and compliance in the system. The following steps should be executed in order to install and deploy `auditd_manager` on a Linux system. \n\n```\nKibana -->\nManagement -->\nIntegrations -->\nAuditd Manager -->\nAdd Auditd Manager\n```\n\n`Auditd_manager` subscribes to the kernel and receives events as they occur without any additional configuration. However, if more advanced configuration is required to detect specific behavior, audit rules can be added to the integration in either the \"audit rules\" configuration box or the \"auditd rule files\" box by specifying a file to read the audit rules from. \n\nFor this detection rule to trigger, the following additional audit rules are required to be added to the integration:\n```\n-a always,exit -F arch=b64 -S finit_module -S init_module -S delete_module -F auid!=-1 -k modules\n-a always,exit -F arch=b32 -S finit_module -S init_module -S delete_module -F auid!=-1 -k modules\n```\n\nAdd the newly installed `auditd manager` to an agent policy, and deploy the agent on a Linux system from which auditd log files are desirable.\n",
        "related_integrations": [
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "auditd.data.syscall",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "3c68ebe3-862b-4b21-81b0-2a10bf79d0b3",
        "rule_id": "3e12a439-d002-4944-bc42-171c0dcb9b96",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.615Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.615Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "driver where host.os.type == \"linux\" and event.action == \"loaded-kernel-module\" and\nauditd.data.syscall in (\"init_module\", \"finit_module\")\n",
        "language": "eql",
        "index": [
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Unusual Time or Day for an RDP Session",
        "description": "A machine learning job has detected an RDP session started at an usual time or weekday. An RDP session at an unusual time could be followed by other suspicious activities, so catching this is a good first step in detecting a larger attack.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Lateral Movement Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Lateral Movement"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-12h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/lmd",
          "https://www.elastic.co/blog/detecting-lateral-movement-activity-a-new-kibana-integration",
          "https://www.elastic.co/blog/remote-desktop-protocol-connections-elastic-security"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1210",
                "name": "Exploitation of Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1210/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Lateral Movement Detection integration assets to be installed, as well as file and Windows RDP process events collected by the Elastic Defend integration.  \n\n### Lateral Movement Detection Setup\nThe Lateral Movement Detection integration detects lateral movement activity by identifying abnormalities in file and Windows RDP events. Anomalies are detected using Elastic's Anomaly Detection feature.\n\n#### Prerequisite Requirements:\n- Fleet is required for Lateral Movement Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Windows RDP process events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n#### The following steps should be executed to install assets associated with the Lateral Movement Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Lateral Movement Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "lmd",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [],
        "id": "52d64c98-9ee8-4e1c-8942-d7f3a101259d",
        "rule_id": "3f4e2dba-828a-452a-af35-fe29c5e78969",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.619Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.619Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 70,
        "machine_learning_job_id": [
          "lmd_unusual_time_weekday_rdp_session_start"
        ]
      },
      {
        "name": "First Occurrence of User-Agent For a GitHub User",
        "description": "Detects a new user agent used for a GitHub user not previously seen in the last 14 days.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Initial Access",
          "Rule Type: BBR",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1078",
                "name": "Valid Accounts",
                "reference": "https://attack.mitre.org/techniques/T1078/",
                "subtechnique": [
                  {
                    "id": "T1078.004",
                    "name": "Cloud Accounts",
                    "reference": "https://attack.mitre.org/techniques/T1078/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "github.user_agent",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "user.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "afb4acb8-8189-4f1d-b3a2-95bd4faa19b6",
        "rule_id": "41761cd3-380f-4d4d-89f3-46d6853ee35d",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.630Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.630Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset:\"github.audit\" and event.category:\"configuration\" and\ngithub.user_agent:* and user.name:*\n",
        "new_terms_fields": [
          "user.name",
          "github.user_agent"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-github.audit-*"
        ],
        "language": "kuery"
      },
      {
        "name": "Suspicious Communication App Child Process",
        "description": "Identifies suspicious child processes of communications apps, which can indicate a potential masquerading as the communication app or the exploitation of a vulnerability on the application causing it to execute code.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 5,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Tactic: Persistence",
          "Rule Type: BBR",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.001",
                    "name": "Invalid Code Signature",
                    "reference": "https://attack.mitre.org/techniques/T1036/001/"
                  },
                  {
                    "id": "T1036.005",
                    "name": "Match Legitimate Name or Location",
                    "reference": "https://attack.mitre.org/techniques/T1036/005/"
                  }
                ]
              },
              {
                "id": "T1055",
                "name": "Process Injection",
                "reference": "https://attack.mitre.org/techniques/T1055/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1554",
                "name": "Compromise Host Software Binary",
                "reference": "https://attack.mitre.org/techniques/T1554/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.subject_name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "c380111f-eae6-4138-af8f-6838e0f17699",
        "rule_id": "adbfa3ee-777e-4747-b6b0-7bd645f30880",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.634Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.634Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  (\n    /* Slack */\n    (process.parent.name : \"slack.exe\" and not\n      (\n        (\n          process.executable : (\n            \"?:\\\\Program Files\\\\*\",\n            \"?:\\\\Program Files (x86)\\\\*\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Island\\\\Island\\\\Application\\\\Island.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Roaming\\\\Zoom\\\\bin*\\\\Zoom.exe\",\n            \"?:\\\\Windows\\\\System32\\\\rundll32.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Mozilla Firefox\\\\firefox.exe\",\n            \"?:\\\\Windows\\\\System32\\\\notepad.exe\",\n            \"?:\\\\Windows\\\\System32\\\\WerFault.exe\",\n            \"?:\\\\Windows\\\\SysWOW64\\\\WerFault.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Programs\\\\Opera\\\\opera.exe\"\n          ) and process.code_signature.trusted == true  \n        ) or\n        (\n          process.code_signature.subject_name : (\n            \"Slack Technologies, Inc.\",\n            \"Slack Technologies, LLC\"\n          ) and process.code_signature.trusted == true\n        ) or\n        (\n          (process.name : \"powershell.exe\" and process.command_line : \"powershell.exe -c Invoke-WebRequest -Uri https://slackb.com/*\") or\n          (process.name : \"cmd.exe\" and process.command_line : \"C:\\\\WINDOWS\\\\system32\\\\cmd.exe /d /s /c \\\"%windir%\\\\System32\\\\rundll32.exe User32.dll,SetFocus 0\\\"\")\n        )\n      )\n    ) or\n\n    /* WebEx */\n    (process.parent.name : (\"CiscoCollabHost.exe\", \"WebexHost.exe\") and not\n      (\n        (\n          process.executable : (\n            \"?:\\\\Program Files\\\\*\",\n            \"?:\\\\Program Files (x86)\\\\*\",\n            \"?:\\\\Windows\\\\System32\\\\WerFault.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Mozilla Firefox\\\\firefox.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Programs\\\\Opera\\\\opera.exe\"\n          ) and process.code_signature.trusted == true  \n        ) or\n        (\n          process.code_signature.subject_name : (\n            \"Cisco Systems, Inc.\",\n            \"Cisco WebEx LLC\",\n            \"Cisco Systems Inc.\"\n          ) and process.code_signature.trusted == true\n        )\n      )\n    ) or\n\n    /* Teams */\n    (process.parent.name : \"Teams.exe\" and not\n      (\n        (\n          process.executable : (\n            \"?:\\\\Program Files\\\\*\",\n            \"?:\\\\Program Files (x86)\\\\*\",\n            \"?:\\\\Windows\\\\System32\\\\WerFault.exe\",\n            \"?:\\\\Windows\\\\SysWOW64\\\\WerFault.exe\",\n            \"?:\\\\Windows\\\\BrowserCore\\\\BrowserCore.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Mozilla Firefox\\\\firefox.exe\"\n          ) and process.code_signature.trusted == true  \n        ) or\n        (\n          process.code_signature.subject_name : (\n            \"Microsoft Corporation\",\n            \"Microsoft 3rd Party Application Component\"\n          ) and process.code_signature.trusted == true\n        ) or\n        (\n          (process.name : \"taskkill.exe\" and process.args : \"Teams.exe\")\n        )\n      )\n    ) or\n\n    /* Discord */\n    (process.parent.name : \"Discord.exe\" and not\n      (\n        (\n          process.executable : (\n            \"?:\\\\Program Files\\\\*\",\n            \"?:\\\\Program Files (x86)\\\\*\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\",\n            \"?:\\\\Windows\\\\System32\\\\reg.exe\",\n            \"?:\\\\Windows\\\\SysWOW64\\\\reg.exe\",\n            \"?:\\\\Windows\\\\System32\\\\WerFault.exe\",\n            \"?:\\\\Windows\\\\SysWOW64\\\\WerFault.exe\"\n          ) and process.code_signature.trusted == true  \n        ) or\n        (\n          process.code_signature.subject_name : (\n            \"Discord Inc.\"\n          ) and process.code_signature.trusted == true\n        ) or\n        (\n          process.name : \"cmd.exe\" and \n          (\n            process.command_line : (\n              \"C:\\\\WINDOWS\\\\system32\\\\cmd.exe /d /s /c \\\"chcp\\\"\",\n              \"C:\\\\WINDOWS\\\\system32\\\\cmd.exe /q /d /s /c \\\"C:\\\\Program^ Files\\\\NVIDIA^ Corporation\\\\NVSMI\\\\nvidia-smi.exe\\\"\"\n            ) or\n            process.args : (\n              \"C:\\\\WINDOWS/System32/nvidia-smi.exe\",\n              \"C:\\\\WINDOWS\\\\System32\\\\nvidia-smi.exe\",\n              \"C:\\\\Windows\\\\System32\\\\DriverStore\\\\FileRepository/*/nvidia-smi.exe*\"\n            )\n          )\n        )\n      )\n    ) or\n\n    /* WhatsApp */\n    (process.parent.name : \"Whatsapp.exe\" and not\n      (\n        (\n          process.executable : (\n            \"?:\\\\Program Files\\\\*\",\n            \"?:\\\\Program Files (x86)\\\\*\",\n            \"?:\\\\Windows\\\\System32\\\\WerFault.exe\",\n            \"?:\\\\Windows\\\\System32\\\\reg.exe\",\n            \"?:\\\\Windows\\\\SysWOW64\\\\reg.exe\"\n          ) and process.code_signature.trusted == true  \n        ) or\n        (\n          process.code_signature.subject_name : (\n            \"WhatsApp LLC\",\n            \"WhatsApp, Inc\",\n            \"24803D75-212C-471A-BC57-9EF86AB91435\"\n          ) and process.code_signature.trusted == true\n        ) or\n        (\n          (process.name : \"cmd.exe\" and process.command_line : \"C:\\\\Windows\\\\system32\\\\cmd.exe /d /s /c \\\"C:\\\\Windows\\\\system32\\\\wbem\\\\wmic.exe*\")\n        )\n      )\n    ) or\n\n    /* Zoom */\n    (process.parent.name : \"Zoom.exe\" and not\n      (\n        (\n          process.executable : (\n            \"?:\\\\Program Files\\\\*\",\n            \"?:\\\\Program Files (x86)\\\\*\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Island\\\\Island\\\\Application\\\\Island.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Mozilla Firefox\\\\firefox.exe\",\n            \"?:\\\\Windows\\\\System32\\\\WerFault.exe\"\n          ) and process.code_signature.trusted == true  \n        ) or\n        (\n          process.code_signature.subject_name : (\n            \"Zoom Video Communications, Inc.\"\n          ) and process.code_signature.trusted == true\n        )\n      )\n    ) or\n\n    /* Outlook */\n    (process.parent.name : \"outlook.exe\" and not\n      (\n        (\n          process.executable : (\n            \"?:\\\\Program Files\\\\*\",\n            \"?:\\\\Program Files (x86)\\\\*\",\n            \"?:\\\\Windows\\\\System32\\\\WerFault.exe\",\n            \"?:\\\\Windows\\\\SysWOW64\\\\WerFault.exe\",\n            \"?:\\\\Windows\\\\system32\\\\wermgr.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Microsoft\\\\Teams\\\\current\\\\Teams.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\NewOutlookInstall\\\\NewOutlookInstaller.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Island\\\\Island\\\\Application\\\\Island.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Mozilla Firefox\\\\firefox.exe\",\n            \"?:\\\\Users\\\\*\\\\AppData\\\\Roaming\\\\Zoom\\\\bin\\\\Zoom.exe\",\n            \"?:\\\\Windows\\\\System32\\\\IME\\\\SHARED\\\\IMEWDBLD.EXE\",\n            \"?:\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\x64\\\\*\",\n            \"?:\\\\Windows\\\\System32\\\\prevhost.exe\",\n            \"?:\\\\Windows\\\\System32\\\\dwwin.exe\",\n            \"?:\\\\Windows\\\\System32\\\\mspaint.exe\",\n            \"?:\\\\Windows\\\\SysWOW64\\\\mspaint.exe\",\n            \"?:\\\\Windows\\\\System32\\\\notepad.exe\",\n            \"?:\\\\Windows\\\\SysWOW64\\\\notepad.exe\",\n            \"?:\\\\Windows\\\\System32\\\\smartscreen.exe\",\n            \"?:\\\\Windows\\\\explorer.exe\",\n            \"?:\\\\Windows\\\\splwow64.exe\"\n          ) and process.code_signature.trusted == true  \n        ) or\n        (\n          process.name : \"rundll32.exe\" and\n          process.args : \"*hpmsn???.dll,MonitorPrintJobStatus*\"\n        )\n      )\n    ) or\n\n    /* Thunderbird */\n    (process.parent.name : \"thunderbird.exe\" and not\n      (\n        (\n          process.executable : (\n            \"?:\\\\Program Files\\\\*\",\n            \"?:\\\\Program Files (x86)\\\\*\",\n            \"?:\\\\Windows\\\\System32\\\\WerFault.exe\",\n            \"?:\\\\Windows\\\\splwow64.exe\"\n          ) and process.code_signature.trusted == true  \n        ) or\n        (\n          process.code_signature.subject_name : (\n            \"Mozilla Corporation\"\n          ) and process.code_signature.trusted == true\n        )\n      )\n    )\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*"
        ]
      },
      {
        "name": "GitHub User Blocked From Organization",
        "description": "A GitHub user was blocked from access to an organization.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Impact",
          "Rule Type: BBR",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1531",
                "name": "Account Access Removal",
                "reference": "https://attack.mitre.org/techniques/T1531/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "c2e37507-7e45-4e7e-b143-6432b460ea2a",
        "rule_id": "4030c951-448a-4017-a2da-ed60f6d14f4f",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:22.641Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:22.641Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "configuration where event.dataset == \"github.audit\" and event.action == \"org.block_user\"\n",
        "language": "eql",
        "index": [
          "logs-github.audit-*"
        ]
      },
      {
        "name": "ProxyChains Activity",
        "description": "This rule monitors for the execution of the ProxyChains utility. ProxyChains is a command-line tool that enables the routing of network connections through intermediary proxies, enhancing anonymity and enabling access to restricted resources. Attackers can exploit the ProxyChains utility to hide their true source IP address, evade detection, and perform malicious activities through a chain of proxy servers, potentially masking their identity and intentions.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating ProxyChains Activity\n\nAttackers can leverage `proxychains` to obfuscate their origin and bypass network defenses by routing their malicious traffic through multiple intermediary servers.\n\nThis rule looks for processes spawned through `proxychains` by analyzing `proxychains` process execution.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/master/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n> This investigation guide uses [placeholder fields](https://www.elastic.co/guide/en/security/current/osquery-placeholder-fields.html) to dynamically pass alert data into Osquery queries. Placeholder fields were introduced in Elastic Stack version 8.7.0. If you're using Elastic Stack version 8.6.0 or earlier, you'll need to manually adjust this investigation guide's queries to ensure they properly run.\n\n#### Possible investigation steps\n\n- Identify any signs of suspicious network activity or anomalies that may indicate network obfuscation. This could include unexpected traffic patterns or unusual network behavior.\n  - Investigate listening ports and open sockets to look for potential protocol tunneling, reverse shells, or data exfiltration.\n    - !{osquery{\"label\":\"Osquery - Retrieve Listening Ports\",\"query\":\"SELECT pid, address, port, socket, protocol, path FROM listening_ports\"}}\n    - !{osquery{\"label\":\"Osquery - Retrieve Open Sockets\",\"query\":\"SELECT pid, family, remote_address, remote_port, socket, state FROM process_open_sockets\"}}\n- Identify the user account that performed the action, analyze it, and check whether it should perform this kind of action.\n  - !{osquery{\"label\":\"Osquery - Retrieve Information for a Specific User\",\"query\":\"SELECT * FROM users WHERE username = {{user.name}}\"}}\n- Investigate whether the user is currently logged in and active.\n  - !{osquery{\"label\":\"Osquery - Investigate the Account Authentication Status\",\"query\":\"SELECT * FROM logged_in_users WHERE user = {{user.name}}\"}}\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence and whether they are located in expected locations.\n  - !{osquery{\"label\":\"Osquery - Retrieve Running Processes by User\",\"query\":\"SELECT pid, username, name FROM processes p JOIN users u ON u.uid = p.uid ORDER BY username\"}}\n  - !{osquery{\"label\":\"Osquery - Retrieve Process Info\",\"query\":\"SELECT name, cmdline, parent, path, uid FROM processes\"}}\n- Investigate other alerts associated with the user/host during the past 48 hours.\n  - If scripts or executables were dropped, retrieve the files and determine if they are malicious:\n    - Use a private sandboxed malware analysis system to perform analysis.\n      - Observe and collect information about the following activities:\n        - Attempts to contact external domains and addresses.\n          - Check if the domain is newly registered or unexpected.\n          - Check the reputation of the domain or IP address.\n        - File access, modification, and creation activities.\n\n### Related rules\n\n- Suspicious Utility Launched via ProxyChains - 6ace94ba-f02c-4d55-9f53-87d99b6f9af4\n- Potential Protocol Tunneling via Chisel Client - 3f12325a-4cc6-410b-8d4c-9fbbeb744cfd\n- Potential Protocol Tunneling via Chisel Server - ac8805f6-1e08-406c-962e-3937057fa86f\n- Potential Linux Tunneling and/or Port Forwarding - 6ee947e9-de7e-4281-a55d-09289bdf947e\n- Potential Protocol Tunneling via EarthWorm - 9f1c4ca3-44b5-481d-ba42-32dc215a2769\n\n### False positive analysis\n\n- If this activity is related to new benign software installation activity, consider adding exceptions — preferably with a combination of user and command line conditions.\n- If this activity is related to a system administrator or developer who uses this utility for benign purposes, consider adding exceptions for specific user accounts or hosts. \n- Try to understand the context of the execution by thinking about the user, machine, or business purpose. A small number of endpoints, such as servers with unique software, might appear unusual but satisfy a specific business need.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors, such as reverse shells, reverse proxies, or droppers, that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Leverage the incident response data and logging to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Command and Control",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://blog.bitsadmin.com/living-off-the-foreign-land-windows-as-offensive-platform"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1572",
                "name": "Protocol Tunneling",
                "reference": "https://attack.mitre.org/techniques/T1572/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "9dc7e142-6775-4230-8eb3-7109c26c5bd9",
        "rule_id": "4b868f1f-15ff-4ba3-8c11-d5a7a6356d37",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.358Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.358Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\", \"executed\", \"process_started\")\n and process.name == \"proxychains\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Unusual Process Writing Data to an External Device",
        "description": "A machine learning job has detected a rare process writing data to an external device. Malicious actors often use benign-looking processes to mask their data exfiltration activities. The discovery of such a process that has no legitimate reason to write data to external devices can indicate exfiltration.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Data Exfiltration Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Exfiltration"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-2h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/ded",
          "https://www.elastic.co/blog/detect-data-exfiltration-activity-with-kibanas-new-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": [
              {
                "id": "T1052",
                "name": "Exfiltration Over Physical Medium",
                "reference": "https://attack.mitre.org/techniques/T1052/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Data Exfiltration Detection integration assets to be installed, as well as network and file events collected by integrations such as Elastic Defend and Network Packet Capture (for network events only).  \n\n### Data Exfiltration Detection Setup\nThe Data Exfiltration Detection integration detects data exfiltration activity by identifying abnormalities in network and file events. Anomalies are detected using Elastic's Anomaly Detection feature. \n\n#### Prerequisite Requirements:\n- Fleet is required for Data Exfiltration Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- File events collected by the Elastic Defend integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n#### The following steps should be executed to install assets associated with the Data Exfiltration Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Data Exfiltration Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "ded",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [],
        "id": "2abdd445-8111-47f5-bc17-86b42d6971fe",
        "rule_id": "4b95ecea-7225-4690-9938-2a2c0bad9c99",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.361Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.361Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 75,
        "machine_learning_job_id": [
          "ded_rare_process_writing_to_external_device"
        ]
      },
      {
        "name": "Service DACL Modification via sc.exe",
        "description": "Identifies DACL modifications to deny access to a service, making it unstoppable, or hide it from system and users.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Resources: Investigation Guide",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon",
          "Data Source: SentinelOne",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: Crowdstrike"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://blogs.jpcert.or.jp/en/2024/07/mirrorface-attack-against-japanese-organisations.html",
          "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_sc_sdset_deny_service_access.yml",
          "https://learn.microsoft.com/en-us/windows/win32/secauthz/sid-strings",
          "https://www.sans.org/blog/red-team-tactics-hiding-windows-services/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1564",
                "name": "Hide Artifacts",
                "reference": "https://attack.mitre.org/techniques/T1564/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/",
                "subtechnique": [
                  {
                    "id": "T1543.003",
                    "name": "Windows Service",
                    "reference": "https://attack.mitre.org/techniques/T1543/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "crowdstrike",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pe.original_file_name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "6a33da99-96b7-4c16-8a38-1caa4058a474",
        "rule_id": "5188c68e-d3de-4e96-994d-9e242269446f",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.364Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.364Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  (process.name : \"sc.exe\" or ?process.pe.original_file_name : \"sc.exe\") and\n  process.args : \"sdset\" and process.args : \"*D;*\" and\n  process.args : (\"*;IU*\", \"*;SU*\", \"*;BA*\", \"*;SY*\", \"*;WD*\")\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-endpoint.events.process-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-m365_defender.event-*",
          "logs-crowdstrike.fdr*"
        ]
      },
      {
        "name": "DNS Global Query Block List Modified or Disabled",
        "description": "Identifies changes to the DNS Global Query Block List (GQBL), a security feature that prevents the resolution of certain DNS names often exploited in attacks like WPAD spoofing. Attackers with certain privileges, such as DNSAdmins, can modify or disable the GQBL, allowing exploitation of hosts running WPAD with default settings for privilege escalation and lateral movement.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 203,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: SentinelOne",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://cube0x0.github.io/Pocing-Beyond-DA/",
          "https://www.thehacker.recipes/ad/movement/mitm-and-coerced-authentications/wpad-spoofing",
          "https://www.netspi.com/blog/technical-blog/network-penetration-testing/adidns-revisited/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1562",
                "name": "Impair Defenses",
                "reference": "https://attack.mitre.org/techniques/T1562/",
                "subtechnique": [
                  {
                    "id": "T1562.001",
                    "name": "Disable or Modify Tools",
                    "reference": "https://attack.mitre.org/techniques/T1562/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1557",
                "name": "Adversary-in-the-Middle",
                "reference": "https://attack.mitre.org/techniques/T1557/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "registry.data.strings",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "registry.value",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "4bb7a938-9057-475e-9ff0-1a791dd7df81",
        "rule_id": "57bfa0a9-37c0-44d6-b724-54bf16787492",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.368Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.368Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "registry where host.os.type == \"windows\" and event.type == \"change\" and\n(\n  (registry.value : \"EnableGlobalQueryBlockList\" and registry.data.strings : (\"0\", \"0x00000000\")) or\n  (registry.value : \"GlobalQueryBlockList\" and not registry.data.strings : \"wpad\")\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.registry-*",
          "logs-windows.sysmon_operational-*",
          "winlogbeat-*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*",
          "endgame-*"
        ]
      },
      {
        "name": "Unsigned DLL loaded by DNS Service",
        "description": "Identifies unusual DLLs loaded by the DNS Server process, potentially indicating the abuse of the ServerLevelPluginDll functionality. This can lead to privilege escalation and remote code execution with SYSTEM privileges.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 103,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://cube0x0.github.io/Pocing-Beyond-DA/",
          "https://adsecurity.org/?p=4064",
          "https://github.com/gtworek/PSBits/tree/master/ServerLevelPluginDll"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "dll.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.code_signature.status",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "0227ab86-4246-465c-a8fd-5da06044ff98",
        "rule_id": "5d676480-9655-4507-adc6-4eec311efff8",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.371Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.371Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where host.os.type == \"windows\" and event.category : (\"library\", \"process\") and\n  event.type : (\"start\", \"change\") and event.action : (\"load\", \"Image loaded*\") and\n  process.executable : \"?:\\\\windows\\\\system32\\\\dns.exe\" and \n  not ?dll.code_signature.trusted == true and\n  not file.code_signature.status == \"Valid\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.library-*",
          "logs-windows.sysmon_operational-*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "AWS S3 Bucket Enumeration or Brute Force",
        "description": "Identifies a high number of failed S3 operations from a single source and account (or anonymous account) within a short timeframe. This activity can be indicative of attempting to cause an increase in billing to an account for excessive random operations, cause resource exhaustion, or enumerating bucket names for discovery.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating AWS S3 Bucket Enumeration or Brute Force\n\nAWS S3 buckets can be be brute forced to cause financial impact against the resource owner. What makes this even riskier is that even private, locked down buckets can still trigger a potential cost, even with an \"Access Denied\", while also being accessible from unauthenticated, anonymous accounts. This also appears to work on several or all [operations](https://docs.aws.amazon.com/cli/latest/reference/s3api/) (GET, PUT, list-objects, etc.). Additionally, buckets are trivially discoverable by default as long as the bucket name is known, making it vulnerable to enumeration for discovery.\n\nAttackers may attempt to enumerate names until a valid bucket is discovered and then pivot to cause financial impact, enumerate for more information, or brute force in other ways to attempt to exfil data.\n\n#### Possible investigation steps\n\n- Examine the history of the operation requests from the same `source.address` and `cloud.account.id` to determine if there is other suspicious activity.\n- Review similar requests and look at the `user.agent` info to ascertain the source of the requests (though do not overly rely on this since it is controlled by the requestor).\n- Review other requests to the same `aws.s3.object.key` as well as other `aws.s3.object.key` accessed by the same `cloud.account.id` or `source.address`.\n- Investigate other alerts associated with the user account during the past 48 hours.\n- Validate the activity is not related to planned patches, updates, or network administrator activity.\n- Examine the request parameters. These may indicate the source of the program or the nature of the task being performed when the error occurred.\n    - Check whether the error is related to unsuccessful attempts to enumerate or access objects, data, or secrets.\n- Considering the source IP address and geolocation of the user who issued the command:\n    - Do they look normal for the calling user?\n    - If the source is an EC2 IP address, is it associated with an EC2 instance in one of your accounts or is the source IP from an EC2 instance that's not under your control?\n    - If it is an authorized EC2 instance, is the activity associated with normal behavior for the instance role or roles? Are there any other alerts or signs of suspicious activity involving this instance?\n- Consider the time of day. If the user is a human (not a program or script), did the activity take place during a normal time of day?\n- Contact the account owner and confirm whether they are aware of this activity if suspicious.\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking servers, services, and data accessed by the account in the last 24 hours.\n\n### False positive analysis\n\n- Verify the `source.address` and `cloud.account.id` - there are some valid operations from within AWS directly that can cause failures and false positives. Additionally, failed automation can also caeuse false positives, but should be identifiable by reviewing the `source.address` and `cloud.account.id`.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Assess the criticality of affected services and servers.\n    - Work with your IT team to identify and minimize the impact on users.\n    - Identify if the attacker is moving laterally and compromising other accounts, servers, or services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords or delete API keys as needed to revoke the attacker's access to the environment. Work with your IT teams to minimize the impact on business operations during these actions.\n- Check if unauthorized new users were created, remove unauthorized new accounts, and request password resets for other IAM users.\n- Consider enabling multi-factor authentication for users.\n- Review the permissions assigned to the implicated user to ensure that the least privilege principle is being followed.\n- Implement security best practices [outlined](https://aws.amazon.com/premiumsupport/knowledge-center/security-best-practices/) by AWS.\n- Take the actions needed to return affected systems, data, or services to their normal operational levels.\n- Identify the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n- Check for PutBucketPolicy event actions as well to see if they have been tampered with. While we monitor for denied, a single successful action to add a backdoor into the bucket via policy updates (however they got permissions) may be critical to identify during TDIR.\n\n",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "source.address",
            "tls.client.server_name",
            "cloud.account.id",
            "failed_requests"
          ]
        },
        "version": 4,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS S3",
          "Resources: Investigation Guide",
          "Use Case: Log Auditing",
          "Tactic: Impact"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Known or internal account IDs or automation"
        ],
        "references": [
          "https://medium.com/@maciej.pocwierz/how-an-empty-s3-bucket-can-make-your-aws-bill-explode-934a383cb8b1",
          "https://docs.aws.amazon.com/cli/latest/reference/s3api/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1657",
                "name": "Financial Theft",
                "reference": "https://attack.mitre.org/techniques/T1657/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1580",
                "name": "Cloud Infrastructure Discovery",
                "reference": "https://attack.mitre.org/techniques/T1580/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0009",
              "name": "Collection",
              "reference": "https://attack.mitre.org/tactics/TA0009/"
            },
            "technique": [
              {
                "id": "T1530",
                "name": "Data from Cloud Storage",
                "reference": "https://attack.mitre.org/techniques/T1530/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [],
        "id": "db875ce0-3e67-44ca-8fe9-666f3e66d23b",
        "rule_id": "5f0234fd-7f21-42af-8391-511d5fd11d5c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.374Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.374Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws.cloudtrail*\n| where event.provider == \"s3.amazonaws.com\" and aws.cloudtrail.error_code == \"AccessDenied\"\n// keep only relevant fields\n| keep tls.client.server_name, source.address, cloud.account.id\n| stats failed_requests = count(*) by tls.client.server_name, source.address, cloud.account.id\n  // can modify the failed request count or tweak time window to fit environment\n  // can add `not cloud.account.id in (KNOWN)` or specify in exceptions\n| where failed_requests > 40\n"
      },
      {
        "name": "Potential File Download via a Headless Browser",
        "description": "Identifies the use of a browser to download a file from a remote URL and from a suspicious parent process. Adversaries may use browsers to avoid ingress tool transfer restrictions.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Potential File Download via a Headless Browser\n\n- Investigate the process execution chain (parent process tree).\n- Investigate the process network and file events.\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Contact the account owner and confirm whether they are aware of this activity.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 203,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Command and Control",
          "Resources: Investigation Guide",
          "Data Source: Windows",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: System",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: SentinelOne",
          "Data Source: Sysmon",
          "Data Source: Crowdstrike"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://lolbas-project.github.io/lolbas/Binaries/Msedge/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1105",
                "name": "Ingress Tool Transfer",
                "reference": "https://attack.mitre.org/techniques/T1105/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "crowdstrike",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "5d51fc37-758c-4810-827a-fb5a5278a1a0",
        "rule_id": "5f2f463e-6997-478c-8405-fb41cc283281",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.377Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.377Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n process.name : (\"chrome.exe\", \"msedge.exe\", \"brave.exe\", \"browser.exe\", \"dragon.exe\", \"vivaldi.exe\") and\n  (process.args : \"--headless*\" or process.args : \"data:text/html;base64,*\") and\n  process.parent.name :\n     (\"cmd.exe\", \"powershell.exe\", \"wscript.exe\", \"cscript.exe\", \"mshta.exe\", \"conhost.exe\", \"msiexec.exe\",\n      \"explorer.exe\", \"rundll32.exe\", \"winword.exe\", \"excel.exe\", \"onenote.exe\", \"hh.exe\", \"powerpnt.exe\", \"forfiles.exe\",\n      \"pcalua.exe\", \"wmiprvse.exe\")\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-endpoint.events.process-*",
          "logs-windows.forwarded*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-system.security*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-crowdstrike.fdr*"
        ]
      },
      {
        "name": "New User Added To GitHub Organization",
        "description": "A new user was added to a GitHub organization.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Persistence",
          "Rule Type: BBR",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.001",
                    "name": "Additional Cloud Credentials",
                    "reference": "https://attack.mitre.org/techniques/T1098/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "94017fd2-24a2-4e0b-a8db-1f7b2f22ecee",
        "rule_id": "61336fe6-c043-4743-ab6e-41292f439603",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.380Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.380Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "configuration where event.dataset == \"github.audit\" and event.action == \"org.add_member\"\n",
        "language": "eql",
        "index": [
          "logs-github.audit-*"
        ]
      },
      {
        "name": "GitHub Repo Created",
        "description": "A new GitHub repository was created.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Execution",
          "Rule Type: BBR",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1648",
                "name": "Serverless Execution",
                "reference": "https://attack.mitre.org/techniques/T1648/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "073ee3a1-ae43-49dc-baea-58fc9df239a2",
        "rule_id": "6cea88e4-6ce2-4238-9981-a54c140d6336",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.384Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.384Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "configuration where event.dataset == \"github.audit\" and event.action == \"repo.create\"\n",
        "language": "eql",
        "index": [
          "logs-github.audit-*"
        ]
      },
      {
        "name": "Potential Privilege Escalation via CVE-2023-4911",
        "description": "This rule detects potential privilege escalation attempts through Looney Tunables (CVE-2023-4911). Looney Tunables is a buffer overflow vulnerability in GNU C Library's dynamic loader's processing of the GLIBC_TUNABLES environment variable.",
        "risk_score": 73,
        "severity": "high",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Use Case: Vulnerability",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://blog.qualys.com/vulnerabilities-threat-research/2023/10/03/cve-2023-4911-looney-tunables-local-privilege-escalation-in-the-glibcs-ld-so"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\nElastic Defend integration does not collect environment variable logging by default.\nIn order to capture this behavior, this rule requires a specific configuration option set within the advanced settings of the Elastic Defend integration.\n #### To set up environment variable capture for an Elastic Agent policy:\n- Go to “Security → Manage → Policies”.\n- Select an “Elastic Agent policy”.\n- Click “Show advanced settings”.\n- Scroll down or search for “linux.advanced.capture_env_vars”.\n- Enter the names of environment variables you want to capture, separated by commas.\n- For this rule the linux.advanced.capture_env_vars variable should be set to \"GLIBC_TUNABLES\".\n- Click “Save”.\nAfter saving the integration change, the Elastic Agents running this policy will be updated and the rule will function properly.\nFor more information on capturing environment variables refer to the [helper guide](https://www.elastic.co/guide/en/security/current/environment-variable-capture.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.env_vars",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "f53e5aaf-b111-43b0-a6fe-f35ff822c88a",
        "rule_id": "6d8685a1-94fa-4ef7-83de-59302e7c4ca8",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.387Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.387Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, process.parent.entity_id, process.executable with maxspan=5s\n [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and \n  process.env_vars : \"*GLIBC_TUNABLES=glibc.*=glibc.*=*\"] with runs=5\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Suspicious JetBrains TeamCity Child Process",
        "description": "Identifies suspicious processes being spawned by the JetBrain TeamCity process. This activity could be related to JetBrains remote code execution vulnerabilities.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 203,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Initial Access",
          "Data Source: Elastic Endgame",
          "Use Case: Vulnerability",
          "Data Source: Elastic Defend",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: System",
          "Data Source: Sysmon",
          "Data Source: SentinelOne"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Powershell and Windows Command Shell are often observed as legit child processes of the Jetbrains TeamCity service and may require further tuning."
        ],
        "references": [
          "https://www.trendmicro.com/en_us/research/24/c/teamcity-vulnerability-exploits-lead-to-jasmin-ransomware.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1190",
                "name": "Exploit Public-Facing Application",
                "reference": "https://attack.mitre.org/techniques/T1190/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.001",
                    "name": "PowerShell",
                    "reference": "https://attack.mitre.org/techniques/T1059/001/"
                  },
                  {
                    "id": "T1059.003",
                    "name": "Windows Command Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "50e4b816-a3ad-4ec8-a6c8-48091fe1b252",
        "rule_id": "730ed57d-ae0f-444f-af50-78708b57edd5",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.400Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.400Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  process.parent.executable :\n                 (\"?:\\\\TeamCity\\\\jre\\\\bin\\\\java.exe\",\n                  \"?:\\\\Program Files\\\\TeamCity\\\\jre\\\\bin\\\\java.exe\",\n                  \"?:\\\\Program Files (x86)\\\\TeamCity\\\\jre\\\\bin\\\\java.exe\",\n                  \"?:\\\\TeamCity\\\\BuildAgent\\\\jre\\\\bin\\\\java.exe\") and\n  process.name : (\"cmd.exe\", \"powershell.exe\", \"msiexec.exe\", \"certutil.exe\", \"bitsadmin.exe\", \"wmic.exe\", \"curl.exe\", \"ssh.exe\",\n                   \"rundll32.exe\", \"regsvr32.exe\", \"mshta.exe\", \"certreq.exe\", \"net.exe\", \"nltest.exe\", \"whoami.exe\", \"hostname.exe\",\n                   \"tasklist.exe\", \"arp.exe\", \"nbtstat.exe\", \"netstat.exe\", \"reg.exe\", \"tasklist.exe\", \"Microsoft.Workflow.Compiler.exe\",\n                   \"arp.exe\", \"atbroker.exe\", \"bginfo.exe\", \"bitsadmin.exe\", \"cdb.exe\", \"cmstp.exe\", \"control.exe\", \"cscript.exe\", \"csi.exe\",\n                   \"dnx.exe\", \"dsget.exe\", \"dsquery.exe\", \"forfiles.exe\", \"fsi.exe\", \"ftp.exe\", \"gpresult.exe\", \"ieexec.exe\", \"iexpress.exe\",\n                   \"installutil.exe\", \"ipconfig.exe\",\"msxsl.exe\", \"netsh.exe\", \"odbcconf.exe\", \"ping.exe\", \"pwsh.exe\", \"qprocess.exe\",\n                   \"quser.exe\", \"qwinsta.exe\", \"rcsi.exe\", \"regasm.exe\", \"regsvcs.exe\", \"regsvr32.exe\", \"sc.exe\", \"schtasks.exe\",\n                   \"systeminfo.exe\", \"tracert.exe\", \"wmic.exe\", \"wscript.exe\",\"xwizard.exe\", \"explorer.exe\", \"msdt.exe\") and\n not (process.name : \"powershell.exe\" and process.args : \"-ExecutionPolicy\" and process.args : \"?:\\\\TeamCity\\\\buildAgent\\\\work\\\\*.ps1\") and\n not (process.name : \"cmd.exe\" and process.args : \"dir\" and process.args : \"/-c\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "winlogbeat-*",
          "logs-windows.forwarded*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-system.security*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*"
        ]
      },
      {
        "name": "UID Elevation from Previously Unknown Executable",
        "description": "Monitors for the elevation of regular user permissions to root permissions through a previously unknown executable. Attackers may attempt to evade detection by hijacking the execution flow and hooking certain functions/syscalls through a rootkit in order to provide easy access to root via a special modified command.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/",
                "subtechnique": [
                  {
                    "id": "T1574.013",
                    "name": "KernelCallbackTable",
                    "reference": "https://attack.mitre.org/techniques/T1574/013/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1014",
                "name": "Rootkit",
                "reference": "https://attack.mitre.org/techniques/T1014/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows\nthe Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click Add integrations.\n- In the query bar, search for Elastic Defend and select the integration to see more details about it.\n- Click Add Elastic Defend.\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either Traditional Endpoints or Cloud Workloads.\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest to select \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in New agent policy name. If other agent policies already exist, you can click the Existing hosts tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click Save and Continue.\n- To complete the integration, select Add Elastic Agent to your hosts and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "aff1236d-08d6-4ea1-b5cc-88dda87377a6",
        "rule_id": "7787362c-90ff-4b1a-b313-8808b1020e64",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.404Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.404Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "host.os.type:\"linux\" and event.category:\"process\" and event.action:\"uid_change\" and event.type:\"change\" and user.id:\"0\"\nand process.parent.name:(\"bash\" or \"dash\" or \"sh\" or \"tcsh\" or \"csh\" or \"zsh\" or \"ksh\" or \"fish\") and not (\n  process.executable:(\n    /bin/* or /usr/bin/* or /sbin/* or /usr/sbin/* or /snap/* or /tmp/newroot/* or /var/lib/docker/* or /usr/local/* or\n    /opt/psa/admin/* or /usr/lib/snapd/snap-confine or /opt/dynatrace/* or /opt/microsoft/* or\n    /var/lib/snapd/snap/bin/node or /opt/gitlab/embedded/sbin/logrotate or /etc/apt/universal-hooks/* or\n    /opt/puppetlabs/puppet/bin/puppet or /opt/cisco/* or /run/k3s/containerd/* or /usr/lib/postfix/sbin/master or\n    /usr/libexec/postfix/local or /var/lib/snapd/snap/bin/postgresql* or /opt/puppetlabs/puppet/bin/ruby\n  ) or\n  process.name:(\n    \"bash\" or \"dash\" or \"sh\" or \"tcsh\" or \"csh\" or \"zsh\" or \"ksh\" or \"fish\" or \"sudo\" or \"su\" or \"apt\" or \"apt-get\" or\n    \"aptitude\" or \"squid\" or \"snap\" or \"fusermount\" or \"pkexec\" or \"umount\" or \"master\" or \"omsbaseline\" or \"dzdo\" or\n    \"sandfly\" or \"logrotate\"\n  ) or\n  process.args:/usr/bin/python*\n)\n",
        "new_terms_fields": [
          "process.executable"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-endpoint.events.*"
        ],
        "language": "kuery"
      },
      {
        "name": "Potential Execution via XZBackdoor",
        "description": "It identifies potential malicious shell executions through remote SSH and detects cases where the sshd service suddenly terminates soon after successful execution, suggesting suspicious behavior similar to the XZ backdoor.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Tactic: Persistence",
          "Tactic: Lateral Movement",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/amlweems/xzbot",
          "https://access.redhat.com/security/cve/CVE-2024-3094",
          "https://www.elastic.co/security-labs/500ms-to-midnight"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1556",
                "name": "Modify Authentication Process",
                "reference": "https://attack.mitre.org/techniques/T1556/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1021",
                "name": "Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1021/",
                "subtechnique": [
                  {
                    "id": "T1021.004",
                    "name": "SSH",
                    "reference": "https://attack.mitre.org/techniques/T1021/004/"
                  }
                ]
              },
              {
                "id": "T1563",
                "name": "Remote Service Session Hijacking",
                "reference": "https://attack.mitre.org/techniques/T1563/",
                "subtechnique": [
                  {
                    "id": "T1563.001",
                    "name": "SSH Hijacking",
                    "reference": "https://attack.mitre.org/techniques/T1563/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.exit_code",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.pid",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.pid",
            "type": "long",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "2586d5fe-49f1-4ead-b04e-0cae6574185d",
        "rule_id": "7afc6cc9-8800-4c7f-be6b-b688d2dea248",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.407Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.407Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, user.id with maxspan=1s\n [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and process.name == \"sshd\" and\n    process.args == \"-D\" and process.args == \"-R\"] by process.pid, process.entity_id\n [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and process.parent.name == \"sshd\" and \n  process.executable != null and not (\n    process.executable in (\"/usr/sbin/sshd\", \"/usr/sbin/unix_chkpwd\", \"/usr/bin/google_authorized_keys\", \"/usr/bin/fipscheck\") or\n    process.args like (\"rsync*\", \"systemctl*\", \"/usr/sbin/unix_chkpwd\", \"/usr/bin/google_authorized_keys\", \"/usr/sbin/aad_certhandler*\") or\n    process.command_line like \"sh -c /usr/bin/env -i PATH=*\"\n  )] by process.parent.pid, process.parent.entity_id\n [process where host.os.type == \"linux\" and event.action == \"end\" and process.name == \"sshd\" and process.exit_code != 0] by process.pid, process.entity_id\n [network where host.os.type == \"linux\" and event.type == \"end\" and event.action == \"disconnect_received\" and process.name == \"sshd\"] by process.pid, process.entity_id\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "APT Package Manager Configuration File Creation",
        "description": "Detects file creation events in the configuration directory for the APT package manager. In Linux, APT (Advanced Package Tool) is a command-line utility used for handling packages on (by default) Debian-based systems, providing functions for installing, updating, upgrading, and removing software along with managing package repositories. Attackers can backdoor APT to gain persistence by injecting malicious code into scripts that APT runs, thereby ensuring continued unauthorized access or control each time APT is used for package management.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://packetstormsecurity.com/files/152668/APT-Package-Manager-Persistence.html",
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/"
              },
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/",
                "subtechnique": [
                  {
                    "id": "T1546.016",
                    "name": "Installer Packages",
                    "reference": "https://attack.mitre.org/techniques/T1546/016/"
                  }
                ]
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.original.extension",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "5acca3eb-151f-43c8-b074-3be00e6ac0b4",
        "rule_id": "7c2e1297-7664-42bc-af11-6d5d35220b6b",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.411Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.411Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.action in (\"rename\", \"creation\") and\nfile.path : \"/etc/apt/apt.conf.d/*\" and not (\n  process.executable in (\n    \"/bin/dpkg\", \"/usr/bin/dpkg\", \"/bin/dockerd\", \"/usr/bin/dockerd\", \"/usr/sbin/dockerd\", \"/bin/microdnf\",\n    \"/usr/bin/microdnf\", \"/bin/rpm\", \"/usr/bin/rpm\", \"/bin/snapd\", \"/usr/bin/snapd\", \"/bin/yum\", \"/usr/bin/yum\",\n    \"/bin/dnf\", \"/usr/bin/dnf\", \"/bin/podman\", \"/usr/bin/podman\", \"/bin/dnf-automatic\", \"/usr/bin/dnf-automatic\",\n    \"/bin/pacman\", \"/usr/bin/pacman\", \"/usr/bin/dpkg-divert\", \"/bin/dpkg-divert\", \"/sbin/apk\", \"/usr/sbin/apk\",\n    \"/usr/local/sbin/apk\", \"/usr/bin/apt\", \"/usr/sbin/pacman\", \"/bin/podman\", \"/usr/bin/podman\", \"/usr/bin/puppet\",\n    \"/bin/puppet\", \"/opt/puppetlabs/puppet/bin/puppet\", \"/usr/bin/chef-client\", \"/bin/chef-client\",\n    \"/bin/autossl_check\", \"/usr/bin/autossl_check\", \"/proc/self/exe\", \"/dev/fd/*\",  \"/usr/bin/pamac-daemon\",\n    \"/bin/pamac-daemon\", \"/usr/lib/snapd/snapd\", \"/usr/local/bin/dockerd\", \"/usr/libexec/netplan/generate\",\n    \"/usr/local/bin/apt-get\", \"/usr/bin/apt-get\"\n  ) or\n  file.path :(\"/etc/apt/apt.conf.d/*.tmp*\") or\n  file.extension in (\"swp\", \"swpx\", \"swx\", \"dpkg-remove\") or\n  file.Ext.original.extension == \"dpkg-new\" or\n  process.executable : (\n    \"/nix/store/*\", \"/var/lib/dpkg/*\", \"/tmp/vmis.*\", \"/snap/*\", \"/dev/fd/*\", \"/usr/lib/*\", \"/usr/libexec/*\",\n    \"/etc/kernel/*\"\n  ) or\n  process.executable == null or\n  process.name in (\"pveupdate\", \"perl\") or\n  (process.name == \"sed\" and file.name : \"sed*\") or\n  (process.name == \"perl\" and file.name : \"e2scrub_all.tmp*\") \n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*"
        ]
      },
      {
        "name": "Unusual Process Extension",
        "description": "Identifies processes running with unusual extensions that are not typically valid for Windows executables.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.008",
                    "name": "Masquerade File Type",
                    "reference": "https://attack.mitre.org/techniques/T1036/008/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.subject_name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d73aa153-b01f-4368-8178-13649b457a8e",
        "rule_id": "800e01be-a7a4-46d0-8de9-69f3c9582b44",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.414Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.414Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  process.executable : \"?*\" and \n  not process.name : (\"*.exe\", \"*.com\", \"*.scr\", \"*.tmp\", \"*.dat\") and\n  not process.executable : \n    (\n      \"MemCompression\",\n      \"Registry\",\n      \"vmmem\",\n      \"vmmemWSL\",\n      \"?:\\\\Program Files\\\\Dell\\\\SupportAssistAgent\\\\*.p5x\",\n      \"?:\\\\Program Files\\\\Docker\\\\Docker\\\\com.docker.service\",\n      \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Intel\\\\AGS\\\\Libs\\\\AGSRunner.bin\",\n      \"\\\\Device\\\\Mup\\\\*\\\\Software Management\\\\Select.Html.dep\",\n      \"?:\\\\DJJApplications\\\\MedicalRecords\\\\bin\\\\Select.Html.dep\",\n      \"?:\\\\ProgramData\\\\Software Management\\\\Select.Html.dep\",\n      \"?:\\\\Program Files (x86)\\\\EnCase Applications\\\\Examiner Service\\\\EnCase64\\\\enhkey.dll\",\n      \"?:\\\\Program Files (x86)\\\\Panda Security\\\\WAC\\\\PSNAEInj64.dll\",\n      \"?:\\\\Program Files (x86)\\\\Johnson Controls\\\\LicenseActivator\\\\crp32002.ngn\"\n    ) and\n  not (\n    (process.name : \"C9632CF058AE4321B6B0B5EA39B710FE\" and process.code_signature.subject_name == \"Dell Inc\") or\n    (process.name : \"*.upd\" and process.code_signature.subject_name == \"Bloomberg LP\") or\n    (process.name: \"FD552E21-686E-413C-931D-3B82A9D29F3B\" and process.code_signature.subject_name: \"Adobe Inc.\") or\n    (process.name: \"3B91051C-AE82-43C9-BCEF-0309CD2DD9EB\" and process.code_signature.subject_name: \"McAfee, LLC\") or\n    (process.name: \"soffice.bin\" and process.code_signature.subject_name: \"The Document Foundation\") or\n    (process.name: (\"VeeamVixProxy_*\", \"{????????-????-????-????-????????????}\") and process.code_signature.subject_name: \"Veeam Software Group GmbH\") or\n    (process.name: \"1cv8p64.bin\" and process.code_signature.subject_name: \"LLC 1C-Soft\") or\n    (process.name: \"AGSRunner.bin\" and process.code_signature.subject_name: \"Intel Corporation\")\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*"
        ]
      },
      {
        "name": "Suspicious Troubleshooting Pack Cabinet Execution",
        "description": "Identifies the execution of the Microsoft Diagnostic Wizard to open a diagcab file from a suspicious path and with an unusual parent process. This may indicate an attempt to execute malicious Troubleshooting Pack Cabinet files.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 104,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Rule Type: BBR",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://irsl.medium.com/the-trouble-with-microsofts-troubleshooters-6e32fc80b8bd"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pe.original_file_name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "558887d9-c151-456f-b369-da532af75c7b",
        "rule_id": "808291d3-e918-4a3a-86cd-73052a0c9bdc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.417Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.417Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.action == \"start\" and\n  (process.name : \"msdt.exe\" or ?process.pe.original_file_name == \"msdt.exe\") and process.args : \"/cab\" and\n  process.parent.name : (\n    \"firefox.exe\", \"chrome.exe\", \"msedge.exe\", \"explorer.exe\", \"brave.exe\", \"whale.exe\", \"browser.exe\",\n    \"dragon.exe\", \"vivaldi.exe\", \"opera.exe\", \"iexplore\", \"firefox.exe\", \"waterfox.exe\", \"iexplore.exe\",\n    \"winrar.exe\", \"winrar.exe\", \"7zFM.exe\", \"outlook.exe\", \"winword.exe\", \"excel.exe\"\n  ) and\n  process.args : (\n    \"?:\\\\Users\\\\*\",\n    \"\\\\\\\\*\",\n    \"http*\",\n    \"ftp://*\"\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-system.security*",
          "winlogbeat-*",
          "logs-windows.*",
          "endgame-*"
        ]
      },
      {
        "name": "Unusual Remote File Extension",
        "description": "An anomaly detection job has detected a remote file transfer with a rare extension, which could indicate potential lateral movement activity on the host.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Lateral Movement Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Lateral Movement"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-90m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/lmd",
          "https://www.elastic.co/blog/detecting-lateral-movement-activity-a-new-kibana-integration",
          "https://www.elastic.co/blog/remote-desktop-protocol-connections-elastic-security"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1210",
                "name": "Exploitation of Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1210/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Lateral Movement Detection integration assets to be installed, as well as file and Windows RDP process events collected by the Elastic Defend integration.  \n\n### Lateral Movement Detection Setup\nThe Lateral Movement Detection integration detects lateral movement activity by identifying abnormalities in file and Windows RDP events. Anomalies are detected using Elastic's Anomaly Detection feature.\n\n#### Prerequisite Requirements:\n- Fleet is required for Lateral Movement Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- File events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n#### The following steps should be executed to install assets associated with the Lateral Movement Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Lateral Movement Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "lmd",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [],
        "id": "376d5d77-e8a4-4cc0-8987-c32e1263d693",
        "rule_id": "814d96c7-2068-42aa-ba8e-fe0ddd565e2e",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.420Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.420Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 70,
        "machine_learning_job_id": [
          "lmd_rare_file_extension_remote_transfer"
        ]
      },
      {
        "name": "Potential WPAD Spoofing via DNS Record Creation",
        "description": "Identifies the creation of a DNS record that is potentially meant to enable WPAD spoofing. Attackers can disable the Global Query Block List (GQBL) and create a \"wpad\" record to exploit hosts running WPAD with default settings for privilege escalation and lateral movement.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 103,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: Active Directory",
          "Use Case: Active Directory Monitoring",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.thehacker.recipes/ad/movement/mitm-and-coerced-authentications/wpad-spoofing#through-adidns-spoofing",
          "https://cube0x0.github.io/Pocing-Beyond-DA/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1557",
                "name": "Adversary-in-the-Middle",
                "reference": "https://attack.mitre.org/techniques/T1557/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe 'Audit Directory Service Changes' logging policy must be configured for (Success, Failure).\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nPolicies >\nWindows Settings >\nSecurity Settings >\nAdvanced Audit Policies Configuration >\nAudit Policies >\nDS Access >\nAudit Directory Service Changes (Success,Failure)\n```\n\nThe above policy does not cover the target object by default (we still need it to be configured to generate events), so we need to set up an AuditRule using https://github.com/OTRF/Set-AuditRule.\n\n```\nSet-AuditRule -AdObjectPath 'AD:\\CN=MicrosoftDNS,DC=DomainDNSZones,DC=Domain,DC=com' -WellKnownSidType WorldSid -Rights CreateChild -InheritanceFlags Descendents -AttributeGUID e0fa1e8c-9b45-11d0-afdd-00c04fd930c9 -AuditFlags Success\n```\n",
        "related_integrations": [
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.code",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "winlog.event_data.ObjectDN",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "8c31f27e-6055-4fb0-a42f-871dcb3b44e8",
        "rule_id": "894326d2-56c0-4342-b553-4abfaf421b5b",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.424Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.424Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where host.os.type == \"windows\" and event.action in (\"Directory Service Changes\", \"directory-service-object-modified\") and\n    event.code == \"5137\" and winlog.event_data.ObjectDN : \"DC=wpad,*\"\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-system.*",
          "logs-windows.*"
        ]
      },
      {
        "name": "GitHub PAT Access Revoked",
        "description": "Access to private GitHub organization resources was revoked for a PAT.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Impact",
          "Rule Type: BBR",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1531",
                "name": "Account Access Removal",
                "reference": "https://attack.mitre.org/techniques/T1531/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "f4827e80-f06a-42a6-a305-2589d94eb1f0",
        "rule_id": "8a0fd93a-7df8-410d-8808-4cc5e340f2b9",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.427Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.427Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "configuration where event.dataset == \"github.audit\" and event.action == \"personal_access_token.access_revoked\"\n",
        "language": "eql",
        "index": [
          "logs-github.audit-*"
        ]
      },
      {
        "name": "Potential Sudo Privilege Escalation via CVE-2019-14287",
        "description": "This rule monitors for the execution of a suspicious sudo command that is leveraged in CVE-2019-14287 to escalate privileges to root. Sudo does not verify the presence of the designated user ID and proceeds to execute using a user ID that can be chosen arbitrarily. By using the sudo privileges, the command \"sudo -u#-1\" translates to an ID of 0, representing the root user. This exploit may work for sudo versions prior to v1.28.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Defend",
          "Use Case: Vulnerability",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.exploit-db.com/exploits/47502"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "2c9fedbf-6e04-4fb6-bd02-85faa10d0a4b",
        "rule_id": "8af5b42f-8d74-48c8-a8d0-6d14b4197288",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.430Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.430Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\", \"executed\", \"process_started\")\n and process.name == \"sudo\" and process.args == \"-u#-1\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Potential Outgoing RDP Connection by Unusual Process",
        "description": "Adversaries may attempt to connect to a remote system over Windows Remote Desktop Protocol (RDP) to achieve lateral movement. Adversaries may avoid using the Microsoft Terminal Services Client (mstsc.exe) binary to establish an RDP connection to evade detection.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Lateral Movement",
          "Data Source: Elastic Defend",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1021",
                "name": "Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1021/",
                "subtechnique": [
                  {
                    "id": "T1021.001",
                    "name": "Remote Desktop Protocol",
                    "reference": "https://attack.mitre.org/techniques/T1021/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "destination.port",
            "type": "long",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "2e8c19c6-0b94-4f33-a9ee-7c1907a9cad7",
        "rule_id": "8e39f54e-910b-4adb-a87e-494fbba5fb65",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.433Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.433Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "network where host.os.type == \"windows\" and\n  event.action == \"connection_attempted\" and destination.port == 3389 and\n  destination.ip != \"::1\" and destination.ip != \"127.0.0.1\" and\n  not (\n    process.executable : (\n      \"?:\\\\Windows\\\\System32\\\\mstsc.exe\",\n      \"?:\\\\Program Files (x86)\\\\mRemoteNG\\\\mRemoteNG.exe\",\n      \"?:\\\\Program Files (x86)\\\\PRTG Network Monitor\\\\PRTG Probe.exe\",\n      \"?:\\\\Program Files\\\\Azure Advanced Threat Protection Sensor\\\\*\\\\Microsoft.Tri.Sensor.exe\",\n      \"?:\\\\Program Files (x86)\\\\Microsoft\\\\Remote Desktop Connection Manager\\\\RDCMan.exe\",\n      \"?:\\\\Program Files\\\\SentinelOne\\\\Sentinel Agent*\\\\Ranger\\\\SentinelRanger.exe\",\n      \"?:\\\\Program Files\\\\Devolutions\\\\Remote Desktop Manager\\\\RemoteDesktopManager.exe\",\n      \"?:\\\\Program Files (x86)\\\\Devolutions\\\\Remote Desktop Manager\\\\RemoteDesktopManager.exe\"\n    ) and process.code_signature.trusted == true\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.network-*"
        ]
      },
      {
        "name": "Potential ADIDNS Poisoning via Wildcard Record Creation",
        "description": "Active Directory Integrated DNS (ADIDNS) is one of the core components of AD DS, leveraging AD's access control and replication to maintain domain consistency. It stores DNS zones as AD objects, a feature that, while robust, introduces some security issues, such as wildcard records, mainly because of the default permission (Any authenticated users) to create DNS-named records. Attackers can create wildcard records to redirect traffic that doesn't explicitly match records contained in the zone, becoming the Man-in-the-Middle and being able to abuse DNS similarly to LLMNR/NBNS spoofing.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 103,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: Active Directory",
          "Use Case: Active Directory Monitoring",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.netspi.com/blog/technical/network-penetration-testing/exploiting-adidns/",
          "https://www.thehacker.recipes/a-d/movement/mitm-and-coerced-authentications/adidns-spoofing"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1557",
                "name": "Adversary-in-the-Middle",
                "reference": "https://attack.mitre.org/techniques/T1557/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe 'Audit Directory Service Changes' logging policy must be configured for (Success, Failure).\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nPolicies >\nWindows Settings >\nSecurity Settings >\nAdvanced Audit Policies Configuration >\nAudit Policies >\nDS Access >\nAudit Directory Service Changes (Success,Failure)\n```\n\nThe above policy does not cover the target object by default (we still need it to be configured to generate events), so we need to set up an AuditRule using https://github.com/OTRF/Set-AuditRule.\n\n```\nSet-AuditRule -AdObjectPath 'AD:\\CN=MicrosoftDNS,DC=DomainDNSZones,DC=Domain,DC=com' -WellKnownSidType WorldSid -Rights CreateChild -InheritanceFlags Descendents -AttributeGUID e0fa1e8c-9b45-11d0-afdd-00c04fd930c9 -AuditFlags Success\n```\n",
        "related_integrations": [
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.code",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "winlog.event_data.ObjectDN",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "9736b36e-6e43-4e58-9743-003d6e41f183",
        "rule_id": "8f242ffb-b191-4803-90ec-0f19942e17fd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.437Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.437Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where host.os.type == \"windows\" and event.action in (\"Directory Service Changes\", \"directory-service-object-modified\") and\n    event.code == \"5137\" and startsWith(winlog.event_data.ObjectDN, \"DC=*,\")\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-system.*",
          "logs-windows.*"
        ]
      },
      {
        "name": "InstallUtil Activity",
        "description": "InstallUtil is a command-line utility that allows for installation and uninstallation of resources by executing specific installer components specified in .NET binaries. Adversaries may use InstallUtil to proxy the execution of code through a trusted Windows utility.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 104,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Rule Type: BBR",
          "Data Source: Elastic Endgame",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/",
                "subtechnique": [
                  {
                    "id": "T1218.004",
                    "name": "InstallUtil",
                    "reference": "https://attack.mitre.org/techniques/T1218/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "6d0e0501-5632-4fb7-96fa-536c01a4a870",
        "rule_id": "90babaa8-5216-4568-992d-d4a01a105d98",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.440Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.440Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  process.name : \"installutil.exe\" and not user.id : \"S-1-5-18\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-system.security*",
          "winlogbeat-*",
          "logs-windows.*",
          "endgame-*"
        ]
      },
      {
        "name": "Executable Bit Set for Potential Persistence Script",
        "description": "This rule monitors for the addition of an executable bit for scripts that are located in directories which are commonly abused for persistence. An alert of this rule is an indicator that a persistence mechanism is being set up within your environment. Adversaries may create these scripts to execute malicious code at start-up, or at a set interval to gain persistence onto the system.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.intezer.com/blog/malware-analysis/hiddenwasp-malware-targeting-linux-systems/",
          "https://pberba.github.io/security/2022/02/06/linux-threat-hunting-for-persistence-initialization-scripts-and-shell-configuration/#8-boot-or-logon-initialization-scripts-rc-scripts",
          "https://www.cyberciti.biz/faq/how-to-enable-rc-local-shell-script-on-systemd-while-booting-linux-system/",
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1037",
                "name": "Boot or Logon Initialization Scripts",
                "reference": "https://attack.mitre.org/techniques/T1037/",
                "subtechnique": [
                  {
                    "id": "T1037.004",
                    "name": "RC Scripts",
                    "reference": "https://attack.mitre.org/techniques/T1037/004/"
                  }
                ]
              },
              {
                "id": "T1053",
                "name": "Scheduled Task/Job",
                "reference": "https://attack.mitre.org/techniques/T1053/",
                "subtechnique": [
                  {
                    "id": "T1053.003",
                    "name": "Cron",
                    "reference": "https://attack.mitre.org/techniques/T1053/003/"
                  }
                ]
              },
              {
                "id": "T1547",
                "name": "Boot or Logon Autostart Execution",
                "reference": "https://attack.mitre.org/techniques/T1547/",
                "subtechnique": [
                  {
                    "id": "T1547.013",
                    "name": "XDG Autostart Entries",
                    "reference": "https://attack.mitre.org/techniques/T1547/013/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "933c4e43-22a7-4e35-9d34-0f0a7bbddf70",
        "rule_id": "94418745-529f-4259-8d25-a713a6feb6ae",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.443Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.443Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and\nprocess.args : (\n  // Misc.\n  \"/etc/rc.local\", \"/etc/rc.common\", \"/etc/rc.d/rc.local\", \"/etc/init.d/*\", \"/etc/update-motd.d/*\",\n  \"/etc/apt/apt.conf.d/*\", \"/etc/cron*\", \"/etc/init/*\",\n\n  // XDG\n  \"/etc/xdg/autostart/*\", \"/home/*/.config/autostart/*\", \"/root/.config/autostart/*\",\n  \"/home/*/.local/share/autostart/*\", \"/root/.local/share/autostart/*\", \"/home/*/.config/autostart-scripts/*\",\n  \"/root/.config/autostart-scripts/*\", \"/etc/xdg/autostart/*\", \"/usr/share/autostart/*\",\n  \n  // udev\n  \"/lib/udev/*\", \"/etc/udev/rules.d/*\", \"/usr/lib/udev/rules.d/*\", \"/run/udev/rules.d/*\"\n\n) and (\n  (process.name == \"chmod\" and process.args : (\"+x*\", \"1*\", \"3*\", \"5*\", \"7*\")) or\n  (process.name == \"install\" and process.args : \"-m*\" and process.args : (\"7*\", \"5*\", \"3*\", \"1*\"))\n) and not process.parent.executable : \"/var/lib/dpkg/*\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process*",
          "endgame-*"
        ]
      },
      {
        "name": "Potential PowerShell Pass-the-Hash/Relay Script",
        "description": "Detects PowerShell scripts that can execute pass-the-hash (PtH) attacks, intercept and relay NTLM challenges, and carry out other man-in-the-middle (MitM) attacks.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 104,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Resources: Investigation Guide",
          "Data Source: PowerShell Logs"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/Kevin-Robertson/Invoke-TheHash/blob/master/Invoke-WMIExec.ps1",
          "https://github.com/Kevin-Robertson/Invoke-TheHash/blob/master/Invoke-SMBExec.ps1",
          "https://github.com/dafthack/Check-LocalAdminHash/blob/master/Check-LocalAdminHash.ps1",
          "https://github.com/nettitude/PoshC2/blob/master/resources/modules/Invoke-Tater.ps1",
          "https://github.com/Kevin-Robertson/Inveigh/blob/master/Inveigh.ps1"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1557",
                "name": "Adversary-in-the-Middle",
                "reference": "https://attack.mitre.org/techniques/T1557/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.001",
                    "name": "PowerShell",
                    "reference": "https://attack.mitre.org/techniques/T1059/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1550",
                "name": "Use Alternate Authentication Material",
                "reference": "https://attack.mitre.org/techniques/T1550/",
                "subtechnique": [
                  {
                    "id": "T1550.002",
                    "name": "Pass the Hash",
                    "reference": "https://attack.mitre.org/techniques/T1550/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe 'PowerShell Script Block Logging' logging policy must be enabled.\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nAdministrative Templates >\nWindows PowerShell >\nTurn on PowerShell Script Block Logging (Enable)\n```\n\nSteps to implement the logging policy via registry:\n\n```\nreg add \"hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\" /v EnableScriptBlockLogging /t REG_DWORD /d 1\n```\n",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.directory",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "powershell.file.script_block_text",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "723401dd-8068-4af0-9132-beb176a97817",
        "rule_id": "951779c2-82ad-4a6c-82b8-296c1f691449",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.455Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.455Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "winlogbeat-*",
          "logs-windows.powershell*"
        ],
        "query": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    (\"NTLMSSPNegotiate\" and (\"NegotiateSMB\" or \"NegotiateSMB2\")) or\n    \"4E544C4D53535000\" or\n    \"0x4e,0x54,0x4c,0x4d,0x53,0x53,0x50\" or\n    \"0x4e,0x54,0x20,0x4c,0x4d\" or\n    \"0x53,0x4d,0x42,0x20,0x32\" or\n    \"0x81,0xbb,0x7a,0x36,0x44,0x98,0xf1,0x35,0xad,0x32,0x98,0xf0,0x38\"\n  ) and\n  not file.directory : \"C:\\ProgramData\\Microsoft\\Windows Defender Advanced Threat Protection\\Downloads\"\n",
        "language": "kuery"
      },
      {
        "name": "Indirect Command Execution via Forfiles/Pcalua",
        "description": "Identifies indirect command execution via Program Compatibility Assistant (pcalua.exe) or forfiles.exe.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 104,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Rule Type: BBR",
          "Data Source: Elastic Endgame",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1202",
                "name": "Indirect Command Execution",
                "reference": "https://attack.mitre.org/techniques/T1202/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "56fbf330-3449-4a8d-a031-298fb2c1c1b8",
        "rule_id": "98843d35-645e-4e66-9d6a-5049acd96ce1",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.458Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.458Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  process.parent.name : (\"pcalua.exe\", \"forfiles.exe\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-system.security*",
          "winlogbeat-*",
          "logs-windows.*",
          "endgame-*"
        ]
      },
      {
        "name": "AWS IAM AdministratorAccess Policy Attached to User",
        "description": "An adversary with access to a set of compromised credentials may attempt to persist or escalate privileges by attaching additional permissions to compromised user accounts. This rule looks for use of the IAM `AttachUserPolicy` API operation to attach the highly permissive `AdministratorAccess` AWS managed policy to an existing IAM user.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating AWS IAM AdministratorAccess Policy Attached to User\n\nThe AWS IAM `AdministratorAccess` managed policy provides full access to all AWS services and resources.\nWith access to the `iam:AttachUserPolicy` permission, a set of compromised credentials could be used to attach\nthis policy to the current user for privilege escalation or another user as a means of persistence. This rule uses [ES|QL](https://www.elastic.co/guide/en/security/master/rules-ui-create.html#create-esql-rule)\nto look for use of the `AttachUserPolicy` operation along with request_parameters where the policyName is `AdministratorAccess`.\n\n\n#### Possible investigation steps\n\n- Identify the account and its role in the environment.\n- Review IAM permission policies for the user identity.\n- Identify the applications or users that should use this account.\n- Investigate other alerts associated with the account during the past 48 hours.\n- Investigate abnormal values in the `user_agent.original` field by comparing them with the intended and authorized usage and historical data. Suspicious user agent values include non-SDK, AWS CLI, custom user agents, etc.\n- Contact the account owner and confirm whether they are aware of this activity.\n- Considering the source IP address and geolocation of the user who issued the command:\n    - Do they look normal for the calling user?\n    - If the source is an EC2 IP address, is it associated with an EC2 instance in one of your accounts or is the source IP from an EC2 instance that's not under your control?\n    - If it is an authorized EC2 instance, is the activity associated with normal behavior for the instance role or roles? Are there any other alerts or signs of suspicious activity involving this instance?\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking servers, services, and data accessed by the account in the last 24 hours.\n    - Determine what other API calls were made by the user.\n    - Assess whether this behavior is prevalent in the environment by looking for similar occurrences involving other users.\n\n### False positive analysis\n\n- False positives may occur due to the intended usage of the IAM `AdministratorAccess` managed policy. Verify the `aws.cloudtrail.user_identity.arn` should have the `iam:AttachUserPolicy` permission and that the `target.userName` should be given full administrative access.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n    - Rotate user credentials\n    - Remove the `AdministratorAccess` policy from the affected user(s)\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Assess the criticality of affected services and servers.\n    - Work with your IT team to identify and minimize the impact on users.\n    - Identify if the attacker is moving laterally and compromising other accounts, servers, or services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified.\n    - Rotate secrets or delete API keys as needed to revoke the attacker's access to the environment.\n    - Work with your IT teams to minimize the impact on business operations during these actions.\n- Check if unauthorized new users were created, remove unauthorized new accounts, and request password resets for other IAM users.\n- Consider enabling multi-factor authentication for users.\n- Review the permissions assigned to the implicated user to ensure that the least privilege principle is being followed.\n- Implement security best practices [outlined](https://aws.amazon.com/premiumsupport/knowledge-center/security-best-practices/) by AWS.\n- Take the actions needed to return affected systems, data, or services to their normal operational levels.\n- Identify the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "@timestamp",
            "user.name",
            "source.address",
            "aws.cloudtrail.user_identity.arn",
            "user_agent.original",
            "target.userName",
            "event.action",
            "policyName",
            "event.outcome",
            "cloud.region",
            "event.provider",
            "aws.cloudtrail.request_parameters"
          ]
        },
        "version": 4,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS IAM",
          "Use Case: Identity and Access Audit",
          "Tactic: Privilege Escalation",
          "Tactic: Persistence",
          "Resources: Investigation Guide"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "While this can be normal behavior, it should be investigated to ensure validity. Verify whether the user identity should be using the IAM `AttachUserPolicy` API operation to attach the `AdministratorAccess` policy to the target user."
        ],
        "references": [
          "https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachUserPolicy.html",
          "https://docs.aws.amazon.com/aws-managed-policy/latest/reference/AdministratorAccess.html",
          "https://hackingthe.cloud/aws/exploitation/iam_privilege_escalation/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.003",
                    "name": "Additional Cloud Roles",
                    "reference": "https://attack.mitre.org/techniques/T1098/003/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.003",
                    "name": "Additional Cloud Roles",
                    "reference": "https://attack.mitre.org/techniques/T1098/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [],
        "id": "1df6d3a4-0263-43cb-94ae-a10aa701beb9",
        "rule_id": "9aa4be8d-5828-417d-9f54-7cd304571b24",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.462Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.462Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws.cloudtrail-* metadata _id, _version, _index\n| where event.provider == \"iam.amazonaws.com\" and event.action == \"AttachUserPolicy\" and event.outcome == \"success\"\n| dissect aws.cloudtrail.request_parameters \"{%{?policyArn}=%{?arn}:%{?aws}:%{?iam}::%{?aws}:%{?policy}/%{policyName},%{?userName}=%{target.userName}}\"\n| where policyName == \"AdministratorAccess\"\n| keep\n    @timestamp,\n    cloud.region,\n    event.provider,\n    event.action,\n    event.outcome,\n    policyName,\n    target.userName,\n    aws.cloudtrail.request_parameters,\n    aws.cloudtrail.user_identity.arn,\n    related.user,\n    user_agent.original,\n    user.name,\n    source.address\n"
      },
      {
        "name": "High Mean of RDP Session Duration",
        "description": "A machine learning job has detected unusually high mean of RDP session duration. Long RDP sessions can be used to evade detection mechanisms via session persistence, and might be used to perform tasks such as lateral movement, that might require uninterrupted access to a compromised machine.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Lateral Movement Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Lateral Movement"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-12h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/lmd",
          "https://www.elastic.co/blog/detecting-lateral-movement-activity-a-new-kibana-integration",
          "https://www.elastic.co/blog/remote-desktop-protocol-connections-elastic-security"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1210",
                "name": "Exploitation of Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1210/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Lateral Movement Detection integration assets to be installed, as well as file and Windows RDP process events collected by the Elastic Defend integration.  \n\n### Lateral Movement Detection Setup\nThe Lateral Movement Detection integration detects lateral movement activity by identifying abnormalities in file and Windows RDP events. Anomalies are detected using Elastic's Anomaly Detection feature.\n\n#### Prerequisite Requirements:\n- Fleet is required for Lateral Movement Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Windows RDP process events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n#### The following steps should be executed to install assets associated with the Lateral Movement Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Lateral Movement Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "lmd",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [],
        "id": "2f73603d-a2ad-4d5f-beab-92cb73a2d41e",
        "rule_id": "a74c60cb-70ee-4629-a127-608ead14ebf1",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.468Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.468Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 70,
        "machine_learning_job_id": [
          "lmd_high_mean_rdp_session_duration"
        ]
      },
      {
        "name": "Privilege Escalation via CAP_SETUID/SETGID Capabilities",
        "description": "Identifies instances where a process (granted CAP_SETUID and/or CAP_SETGID capabilities) is executed, after which the user's access is elevated to UID/GID 0 (root). In Linux, the CAP_SETUID and CAP_SETGID capabilities allow a process to change its UID and GID, respectively, providing control over user and group identity management. Attackers may leverage a misconfiguration for exploitation in order to escalate their privileges to root.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              },
              {
                "id": "T1548",
                "name": "Abuse Elevation Control Mechanism",
                "reference": "https://attack.mitre.org/techniques/T1548/",
                "subtechnique": [
                  {
                    "id": "T1548.001",
                    "name": "Setuid and Setgid",
                    "reference": "https://attack.mitre.org/techniques/T1548/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.thread.capabilities.effective",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.thread.capabilities.permitted",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "63ca7a45-3815-47f3-8f8d-d3c06214d8ae",
        "rule_id": "9b80cb26-9966-44b5-abbf-764fbdbc3586",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.465Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.465Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, process.entity_id with maxspan=1s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and process.name != null and\n   (process.thread.capabilities.effective : \"CAP_SET?ID\" or process.thread.capabilities.permitted : \"CAP_SET?ID\") and \n   user.id != \"0\" and not (\n     process.parent.executable : (\"/tmp/newroot/*\", \"/opt/carbonblack*\") or\n     process.parent.executable in (\n       \"/opt/SolarWinds/Agent/bin/Plugins/JobEngine/SolarWinds.Agent.JobEngine.Plugin\", \"/usr/bin/vmware-toolbox-cmd\",\n       \"/usr/bin/dbus-daemon\", \"/usr/bin/update-notifier\", \"/usr/share/language-tools/language-options\",\n       \"/opt/SolarWinds/Agent/*\", \"/usr/local/sbin/lynis.sh\"\n     ) or\n     process.executable : (\"/opt/dynatrace/*\", \"/tmp/newroot/*\", \"/opt/SolarWinds/Agent/*\") or\n     process.executable in (\n       \"/bin/fgrep\", \"/usr/bin/sudo\", \"/usr/bin/pkexec\", \"/usr/lib/cockpit/cockpit-session\", \"/usr/sbin/suexec\"\n     ) or\n     process.parent.name in (\"update-notifier\", \"language-options\", \"osqueryd\", \"saposcol\", \"dbus-daemon\", \"osqueryi\", \"sdbrun\") or\n     process.command_line like (\"sudo*BECOME-SUCCESS*\", \"/bin/sh*sapsysinfo.sh*\", \"sudo su\", \"sudo su -\") or\n     process.name == \"sudo\" or\n     process.parent.command_line like \"/usr/bin/python*ansible*\"\n   )]\n  [process where host.os.type == \"linux\" and event.action == \"uid_change\" and event.type == \"change\" and \n   (process.thread.capabilities.effective : \"CAP_SET?ID\" or process.thread.capabilities.permitted : \"CAP_SET?ID\")\n   and user.id == \"0\"]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "High Variance in RDP Session Duration",
        "description": "A machine learning job has detected unusually high variance of RDP session duration. Long RDP sessions can be used to evade detection mechanisms via session persistence, and might be used to perform tasks such as lateral movement, that might require uninterrupted access to a compromised machine.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Lateral Movement Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Lateral Movement"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-12h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/lmd",
          "https://www.elastic.co/blog/detecting-lateral-movement-activity-a-new-kibana-integration",
          "https://www.elastic.co/blog/remote-desktop-protocol-connections-elastic-security"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1210",
                "name": "Exploitation of Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1210/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Lateral Movement Detection integration assets to be installed, as well as file and Windows RDP process events collected by the Elastic Defend integration.  \n\n### Lateral Movement Detection Setup\nThe Lateral Movement Detection integration detects lateral movement activity by identifying abnormalities in file and Windows RDP events. Anomalies are detected using Elastic's Anomaly Detection feature.\n\n#### Prerequisite Requirements:\n- Fleet is required for Lateral Movement Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Windows RDP process events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n#### The following steps should be executed to install assets associated with the Lateral Movement Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Lateral Movement Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "lmd",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [],
        "id": "4a6de40e-1f9c-4230-abeb-4c912d2e972d",
        "rule_id": "a8d35ca0-ad8d-48a9-9f6c-553622dca61a",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.472Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.472Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 70,
        "machine_learning_job_id": [
          "lmd_high_var_rdp_session_duration"
        ]
      },
      {
        "name": "Suspicious APT Package Manager Execution",
        "description": "Detects suspicious process events executed by the APT package manager, potentially indicating persistence through an APT backdoor. In Linux, APT (Advanced Package Tool) is a command-line utility used for handling packages on Debian-based systems, providing functions for installing, updating, upgrading, and removing software along with managing package repositories. Attackers can backdoor APT to gain persistence by injecting malicious code into scripts that APT runs, thereby ensuring continued unauthorized access or control each time APT is used for package management.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Execution",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/"
              },
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/",
                "subtechnique": [
                  {
                    "id": "T1546.016",
                    "name": "Installer Packages",
                    "reference": "https://attack.mitre.org/techniques/T1546/016/"
                  }
                ]
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "457e16e4-e550-4886-ba83-1abce37033c5",
        "rule_id": "ad959eeb-2b7b-4722-ba08-a45f6622f005",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.475Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.475Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id with maxspan=5s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.parent.name == \"apt\" and process.args == \"-c\" and process.name in (\n     \"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\"\n   )\n  ] by process.entity_id\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and process.name : (\n     \"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\", \"python*\", \"php*\",\n     \"perl\", \"ruby\", \"lua*\", \"openssl\", \"nc\", \"netcat\", \"ncat\", \"telnet\", \"awk\"\n   )\n  ] by process.parent.entity_id\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Unusual User Privilege Enumeration via id",
        "description": "This rule monitors for a sequence of 20 \"id\" command executions within 1 second by the same parent process. This behavior is unusual, and may be indicative of the execution of an enumeration script such as LinPEAS or LinEnum. These scripts leverage the \"id\" command to enumerate the privileges of all users present on the system.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1033",
                "name": "System Owner/User Discovery",
                "reference": "https://attack.mitre.org/techniques/T1033/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "2dc6dccc-bb6b-47e9-9779-fbb399f18142",
        "rule_id": "afa135c0-a365-43ab-aa35-fd86df314a47",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.478Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.478Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, process.parent.entity_id with maxspan=1s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and \n   process.name == \"id\" and process.args_count == 2 and \n   not (process.parent.name == \"rpm\" or process.parent.args : \"/var/tmp/rpm-tmp*\")] with runs=20\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Potential Veeam Credential Access Command",
        "description": "Identifies commands that can access and decrypt Veeam credentials stored in MSSQL databases. Attackers can use Veeam Credentials to target backups as part of destructive operations such as Ransomware attacks.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 203,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Tactic: Credential Access",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: System",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: Sysmon",
          "Data Source: SentinelOne",
          "Data Source: Crowdstrike"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://thedfirreport.com/2021/12/13/diavol-ransomware/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1003",
                "name": "OS Credential Dumping",
                "reference": "https://attack.mitre.org/techniques/T1003/"
              },
              {
                "id": "T1555",
                "name": "Credentials from Password Stores",
                "reference": "https://attack.mitre.org/techniques/T1555/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.001",
                    "name": "PowerShell",
                    "reference": "https://attack.mitre.org/techniques/T1059/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "crowdstrike",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pe.original_file_name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "c324e451-64e7-4a2d-aa14-c6ac8007d3f8",
        "rule_id": "b661f86d-1c23-4ce7-a59e-2edbdba28247",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.481Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.481Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n  (\n    (process.name : \"sqlcmd.exe\" or ?process.pe.original_file_name : \"sqlcmd.exe\") or\n    process.args : (\"Invoke-Sqlcmd\", \"Invoke-SqlExecute\", \"Invoke-DbaQuery\", \"Invoke-SqlQuery\")\n  ) and\n  process.args : \"*[VeeamBackup].[dbo].[Credentials]*\"\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-endpoint.events.process-*",
          "logs-windows.forwarded*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-system.security*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-crowdstrike.fdr*"
        ]
      },
      {
        "name": "Unusual Remote File Directory",
        "description": "An anomaly detection job has detected a remote file transfer on an unusual directory indicating a potential lateral movement activity on the host. Many Security solutions monitor well-known directories for suspicious activities, so attackers might use less common directories to bypass monitoring.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Lateral Movement Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Lateral Movement"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-90m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/lmd",
          "https://www.elastic.co/blog/detecting-lateral-movement-activity-a-new-kibana-integration",
          "https://www.elastic.co/blog/remote-desktop-protocol-connections-elastic-security"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1210",
                "name": "Exploitation of Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1210/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Lateral Movement Detection integration assets to be installed, as well as file and Windows RDP process events collected by the Elastic Defend integration.  \n\n### Lateral Movement Detection Setup\nThe Lateral Movement Detection integration detects lateral movement activity by identifying abnormalities in file and Windows RDP events. Anomalies are detected using Elastic's Anomaly Detection feature.\n\n#### Prerequisite Requirements:\n- Fleet is required for Lateral Movement Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- File events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n#### The following steps should be executed to install assets associated with the Lateral Movement Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Lateral Movement Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "lmd",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [],
        "id": "306ff208-25c6-4b77-8785-524c1042bb6e",
        "rule_id": "be4c5aed-90f5-4221-8bd5-7ab3a4334751",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.485Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.485Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 70,
        "machine_learning_job_id": [
          "lmd_rare_file_path_remote_transfer"
        ]
      },
      {
        "name": "Potential Data Exfiltration Activity to an Unusual Region",
        "description": "A machine learning job has detected data exfiltration to a particular geo-location (by region name). Data transfers to geo-locations that are outside the normal traffic patterns of an organization could indicate exfiltration over command and control channels.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Data Exfiltration Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Exfiltration"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-6h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/ded",
          "https://www.elastic.co/blog/detect-data-exfiltration-activity-with-kibanas-new-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": [
              {
                "id": "T1041",
                "name": "Exfiltration Over C2 Channel",
                "reference": "https://attack.mitre.org/techniques/T1041/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Data Exfiltration Detection integration assets to be installed, as well as network and file events collected by integrations such as Elastic Defend and Network Packet Capture (for network events only).  \n\n### Data Exfiltration Detection Setup\nThe Data Exfiltration Detection integration detects data exfiltration activity by identifying abnormalities in network and file events. Anomalies are detected using Elastic's Anomaly Detection feature. \n\n#### Prerequisite Requirements:\n- Fleet is required for Data Exfiltration Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Network events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) or [Network Packet Capture](https://docs.elastic.co/integrations/network_traffic) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To add the Network Packet Capture integration to an Elastic Agent policy, refer to [this](https://www.elastic.co/guide/en/fleet/current/add-integration-to-policy.html) guide.\n\n#### The following steps should be executed to install assets associated with the Data Exfiltration Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Data Exfiltration Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "ded",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "network_traffic",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [],
        "id": "761fe647-a9f6-48f0-900e-837b9bc605ae",
        "rule_id": "bfba5158-1fd6-4937-a205-77d96213b341",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.488Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.488Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 75,
        "machine_learning_job_id": [
          "ded_high_sent_bytes_destination_region_name"
        ]
      },
      {
        "name": "Potential Data Exfiltration Activity to an Unusual IP Address",
        "description": "A machine learning job has detected data exfiltration to a particular geo-location (by IP address). Data transfers to geo-locations that are outside the normal traffic patterns of an organization could indicate exfiltration over command and control channels.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Data Exfiltration Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Exfiltration"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-6h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/ded",
          "https://www.elastic.co/blog/detect-data-exfiltration-activity-with-kibanas-new-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": [
              {
                "id": "T1041",
                "name": "Exfiltration Over C2 Channel",
                "reference": "https://attack.mitre.org/techniques/T1041/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Data Exfiltration Detection integration assets to be installed, as well as network and file events collected by integrations such as Elastic Defend and Network Packet Capture (for network events only).  \n\n### Data Exfiltration Detection Setup\nThe Data Exfiltration Detection integration detects data exfiltration activity by identifying abnormalities in network and file events. Anomalies are detected using Elastic's Anomaly Detection feature. \n\n#### Prerequisite Requirements:\n- Fleet is required for Data Exfiltration Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Network events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) or [Network Packet Capture](https://docs.elastic.co/integrations/network_traffic) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To add the Network Packet Capture integration to an Elastic Agent policy, refer to [this](https://www.elastic.co/guide/en/fleet/current/add-integration-to-policy.html) guide.\n\n#### The following steps should be executed to install assets associated with the Data Exfiltration Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Data Exfiltration Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "ded",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "network_traffic",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [],
        "id": "5bbfe346-e126-4382-9be0-e4266d668e95",
        "rule_id": "cc653d77-ddd2-45b1-9197-c75ad19df66c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.491Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.491Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 75,
        "machine_learning_job_id": [
          "ded_high_sent_bytes_destination_ip"
        ]
      },
      {
        "name": "First Occurrence GitHub Event for a Personal Access Token (PAT)",
        "description": "Detects a first occurrence event for a personal access token (PAT) not seen in the last 14 days.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Execution",
          "Rule Type: BBR",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1648",
                "name": "Serverless Execution",
                "reference": "https://attack.mitre.org/techniques/T1648/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "github.hashed_token",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "github.programmatic_access_type",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "739368fb-e662-483c-b3a6-09e654914eac",
        "rule_id": "ce08b55a-f67d-4804-92b5-617b0fe5a5b5",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.494Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.494Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset:\"github.audit\" and event.category:\"configuration\" and\nevent.action:* and github.hashed_token:* and \ngithub.programmatic_access_type:(\"OAuth access token\" or \"Fine-grained personal access token\")\n",
        "new_terms_fields": [
          "github.hashed_token",
          "event.action"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-github.audit-*"
        ],
        "language": "kuery"
      },
      {
        "name": "WMI WBEMTEST Utility Execution",
        "description": "Adversaries may abuse the WMI diagnostic tool, wbemtest.exe, to enumerate WMI object instances or invoke methods against local or remote endpoints.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 104,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend",
          "Rule Type: BBR",
          "Data Source: Elastic Endgame",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1047",
                "name": "Windows Management Instrumentation",
                "reference": "https://attack.mitre.org/techniques/T1047/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "fa4f708f-bf9f-4c51-b7bb-c9e407e0b732",
        "rule_id": "d3551433-782f-4e22-bbea-c816af2d41c6",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.498Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.498Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and process.name : \"wbemtest.exe\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "winlogbeat-*",
          "logs-windows.*",
          "endgame-*",
          "logs-system.security*"
        ]
      },
      {
        "name": "NTDS Dump via Wbadmin",
        "description": "Identifies the execution of wbadmin to access the NTDS.dit file in a domain controller. Attackers with privileges from groups like Backup Operators can abuse the utility to perform credential access and compromise the domain.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 203,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: System",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: Sysmon",
          "Data Source: SentinelOne",
          "Data Source: Crowdstrike"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://medium.com/r3d-buck3t/windows-privesc-with-sebackupprivilege-65d2cd1eb960"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1003",
                "name": "OS Credential Dumping",
                "reference": "https://attack.mitre.org/techniques/T1003/",
                "subtechnique": [
                  {
                    "id": "T1003.002",
                    "name": "Security Account Manager",
                    "reference": "https://attack.mitre.org/techniques/T1003/002/"
                  },
                  {
                    "id": "T1003.003",
                    "name": "NTDS",
                    "reference": "https://attack.mitre.org/techniques/T1003/003/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1006",
                "name": "Direct Volume Access",
                "reference": "https://attack.mitre.org/techniques/T1006/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "crowdstrike",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pe.original_file_name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "b980ed6d-a99a-49ca-8cc5-d746827fc77d",
        "rule_id": "d93e61db-82d6-4095-99aa-714988118064",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.510Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.510Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n    (process.name : \"wbadmin.exe\" or ?process.pe.original_file_name : \"wbadmin.exe\") and \n     process.args : \"recovery\" and process.command_line : \"*ntds.dit*\"\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-endpoint.events.process-*",
          "logs-windows.forwarded*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-system.security*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-crowdstrike.fdr*"
        ]
      },
      {
        "name": "Network-Level Authentication (NLA) Disabled",
        "description": "Identifies the attempt to disable Network-Level Authentication (NLA) via registry modification. Network Level Authentication (NLA) is a feature on Windows that provides an extra layer of security for Remote Desktop (RDP) connections, as it requires users to authenticate before allowing a full RDP session. Attackers can disable NLA to enable persistence methods that require access to the Windows sign-in screen without authenticating, such as Accessibility Features persistence methods, like Sticky Keys.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 203,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: SentinelOne",
          "Data Source: Sysmon"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.microsoft.com/en-us/security/blog/2023/08/24/flax-typhoon-using-legitimate-software-to-quietly-access-taiwanese-organizations/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1112",
                "name": "Modify Registry",
                "reference": "https://attack.mitre.org/techniques/T1112/"
              },
              {
                "id": "T1562",
                "name": "Impair Defenses",
                "reference": "https://attack.mitre.org/techniques/T1562/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "registry.data.strings",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "registry.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "registry.value",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "ebc52eb6-06b8-4cd8-a449-7b74f3bc789d",
        "rule_id": "db65f5ba-d1ef-4944-b9e8-7e51060c2b42",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.513Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.513Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "registry where host.os.type == \"windows\" and event.action != \"deletion\" and registry.value : \"UserAuthentication\" and\n  registry.path : (\n    \"HKLM\\\\SYSTEM\\\\ControlSet*\\\\Control\\\\Terminal Server\\\\WinStations\\\\RDP-Tcp\\\\UserAuthentication\",\n    \"\\\\REGISTRY\\\\MACHINE\\\\SYSTEM\\\\*ControlSet*\\\\Control\\\\Terminal Server\\\\WinStations\\\\RDP-Tcp\\\\UserAuthentication\",\n    \"MACHINE\\\\SYSTEM\\\\*ControlSet*\\\\Control\\\\Terminal Server\\\\WinStations\\\\RDP-Tcp\\\\UserAuthentication\"\n  ) and registry.data.strings :  (\"0\", \"0x00000000\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.registry-*",
          "endgame-*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-windows.sysmon_operational-*"
        ]
      },
      {
        "name": "Potential privilege escalation via CVE-2022-38028",
        "description": "Identifies a privilege escalation attempt via exploiting CVE-2022-38028 to hijack the print spooler service execution.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 203,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: SentinelOne"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.microsoft.com/en-us/security/blog/2024/04/22/analyzing-forest-blizzards-custom-post-compromise-tool-for-exploiting-cve-2022-38028-to-obtain-credentials/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "07a8b7b9-0edd-4b74-bf73-db249a72ad79",
        "rule_id": "dffbd37c-d4c5-46f8-9181-5afdd9172b4c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.517Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.517Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"windows\" and event.type != \"deletion\" and\n    file.name : \"MPDW-constraints.js\" and\n    file.path : (\n        \"?:\\\\*\\\\Windows\\\\system32\\\\DriVerStoRe\\\\FiLeRePoSiToRy\\\\*\\\\MPDW-constraints.js\",\n        \"?:\\\\*\\\\Windows\\\\WinSxS\\\\amd64_microsoft-windows-printing-printtopdf_*\\\\MPDW-constraints.js\"\n    )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "winlogbeat-*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*"
        ]
      },
      {
        "name": "Potential Data Exfiltration Activity to an Unusual ISO Code",
        "description": "A machine learning job has detected data exfiltration to a particular geo-location (by region name). Data transfers to geo-locations that are outside the normal traffic patterns of an organization could indicate exfiltration over command and control channels.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Data Exfiltration Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Exfiltration"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-6h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/ded",
          "https://www.elastic.co/blog/detect-data-exfiltration-activity-with-kibanas-new-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": [
              {
                "id": "T1041",
                "name": "Exfiltration Over C2 Channel",
                "reference": "https://attack.mitre.org/techniques/T1041/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Data Exfiltration Detection integration assets to be installed, as well as network and file events collected by integrations such as Elastic Defend and Network Packet Capture (for network events only).  \n\n### Data Exfiltration Detection Setup\nThe Data Exfiltration Detection integration detects data exfiltration activity by identifying abnormalities in network and file events. Anomalies are detected using Elastic's Anomaly Detection feature. \n\n#### Prerequisite Requirements:\n- Fleet is required for Data Exfiltration Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Network events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) or [Network Packet Capture](https://docs.elastic.co/integrations/network_traffic) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To add the Network Packet Capture integration to an Elastic Agent policy, refer to [this](https://www.elastic.co/guide/en/fleet/current/add-integration-to-policy.html) guide.\n\n#### The following steps should be executed to install assets associated with the Data Exfiltration Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Data Exfiltration Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "ded",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "network_traffic",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [],
        "id": "ba837871-4091-4dd6-9c8a-4ce920ad32c2",
        "rule_id": "e1db8899-97c1-4851-8993-3a3265353601",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.520Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.520Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 75,
        "machine_learning_job_id": [
          "ded_high_sent_bytes_destination_geo_country_iso_code"
        ]
      },
      {
        "name": "Network Traffic Capture via CAP_NET_RAW",
        "description": "Identifies the ability of a process to be able to create RAW and PACKET socket types for the available network namespaces by a non-root user. A malicious process with this capability may exploit routing between hosts, bypass network access controls, and otherwise tamper with host networking if a firewall is not in place to limit the packet types and contents. The CAP_NET_RAW capability allows the process to bind to any address within the available namespaces, which allows network traffic sniffing by a non root user. The rule identifies previously unknown processes executing with CAP_NET_RAW capabilities through the use of the new terms rule type.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Data Source: Elastic Defend",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1040",
                "name": "Network Sniffing",
                "reference": "https://attack.mitre.org/techniques/T1040/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.thread.capabilities.effective",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.thread.capabilities.permitted",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "b6e1cf49-cc7f-41c7-968c-a8a4f759aa9d",
        "rule_id": "e28b8093-833b-4eda-b877-0873d134cf3c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.523Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.523Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.category:\"process\" and host.os.type:\"linux\" and event.type:\"start\" and event.action:\"exec\" and process.name:* and\n(process.thread.capabilities.effective:\"CAP_NET_RAW\" or process.thread.capabilities.permitted:\"CAP_NET_RAW\") and\nnot user.id:\"0\"\n",
        "new_terms_fields": [
          "process.executable"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-endpoint.events.*"
        ],
        "language": "kuery"
      },
      {
        "name": "Unusual Process For MSSQL Service Accounts",
        "description": "Identifies unusual process executions using MSSQL Service accounts, which can indicate the exploitation/compromise of SQL instances. Attackers may exploit exposed MSSQL instances for initial access or lateral movement.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Lateral Movement",
          "Tactic: Persistence",
          "Data Source: Elastic Defend",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.microsoft.com/en-us/security/blog/2023/08/24/flax-typhoon-using-legitimate-software-to-quietly-access-taiwanese-organizations/",
          "https://learn.microsoft.com/en-us/sql/database-engine/configure-windows/configure-windows-service-accounts-and-permissions?view=sql-server-ver16"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1210",
                "name": "Exploitation of Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1210/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1505",
                "name": "Server Software Component",
                "reference": "https://attack.mitre.org/techniques/T1505/",
                "subtechnique": [
                  {
                    "id": "T1505.001",
                    "name": "SQL Stored Procedures",
                    "reference": "https://attack.mitre.org/techniques/T1505/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.subject_name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.domain",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "69a302ae-e78a-4b34-846e-c6fd172d97f0",
        "rule_id": "e74d645b-fec6-431e-bf93-ca64a538e0de",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.527Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.527Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where event.type == \"start\" and host.os.type == \"windows\" and\n  user.name : (\n    \"SQLSERVERAGENT\", \"SQLAGENT$*\",\n    \"MSSQLSERVER\", \"MSSQL$*\",\n    \"MSSQLServerOLAPService\",\n    \"ReportServer*\", \"MsDtsServer150\",\n    \"MSSQLFDLauncher*\",\n    \"SQLServer2005SQLBrowserUser$*\",\n    \"SQLWriter\", \"winmgmt\"\n  ) and user.domain : \"NT SERVICE\" and\n  not (\n    (\n      process.name : (\n        \"sqlceip.exe\", \"sqlservr.exe\", \"sqlagent.exe\",\n        \"msmdsrv.exe\", \"ReportingServicesService.exe\",\n        \"MsDtsSrvr.exe\", \"sqlbrowser.exe\", \"DTExec.exe\",\n        \"SQLPS.exe\", \"fdhost.exe\", \"fdlauncher.exe\",\n        \"SqlDumper.exe\", \"sqlsqm.exe\", \"DatabaseMail.exe\",\n        \"ISServerExec.exe\", \"Microsoft.ReportingServices.Portal.WebHost.exe\",\n        \"bcp.exe\", \"SQLCMD.exe\", \"DatabaseMail.exe\"\n      ) or\n      process.executable : (\n        \"?:\\\\Windows\\\\System32\\\\wermgr.exe\",\n        \"?:\\\\Windows\\\\System32\\\\conhost.exe\",\n        \"?:\\\\Windows\\\\System32\\\\WerFault.exe\"\n      )\n    ) and\n    (\n      process.code_signature.subject_name : (\"Microsoft Corporation\", \"Microsoft Windows\") and\n      process.code_signature.trusted == true\n    )\n  ) and\n  not (\n    (process.name : \"cmd.exe\" and process.parent.name : \"sqlservr.exe\") or\n    (process.name : \"cmd.exe\" and process.parent.name : \"forfiles.exe\" and process.command_line : \"/c echo *\")\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*"
        ]
      },
      {
        "name": "Spike in Bytes Sent to an External Device via Airdrop",
        "description": "A machine learning job has detected high bytes of data written to an external device via Airdrop. In a typical operational setting, there is usually a predictable pattern or a certain range of data that is written to external devices. An unusually large amount of data being written is anomalous and can signal illicit data copying or transfer activities.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Data Exfiltration Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Exfiltration"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-2h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/ded",
          "https://www.elastic.co/blog/detect-data-exfiltration-activity-with-kibanas-new-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": [
              {
                "id": "T1011",
                "name": "Exfiltration Over Other Network Medium",
                "reference": "https://attack.mitre.org/techniques/T1011/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Data Exfiltration Detection integration assets to be installed, as well as network and file events collected by integrations such as Elastic Defend and Network Packet Capture (for network events only).  \n\n### Data Exfiltration Detection Setup\nThe Data Exfiltration Detection integration detects data exfiltration activity by identifying abnormalities in network and file events. Anomalies are detected using Elastic's Anomaly Detection feature. \n\n#### Prerequisite Requirements:\n- Fleet is required for Data Exfiltration Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- File events collected by the Elastic Defend integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n#### The following steps should be executed to install assets associated with the Data Exfiltration Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Data Exfiltration Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "ded",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [],
        "id": "1393df0b-5abe-45cc-b163-6c21133b7c64",
        "rule_id": "e92c99b6-c547-4bb6-b244-2f27394bc849",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.530Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.530Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 75,
        "machine_learning_job_id": [
          "ded_high_bytes_written_to_external_device_airdrop"
        ]
      },
      {
        "name": "Spike in Remote File Transfers",
        "description": "A machine learning job has detected an abnormal volume of remote files shared on the host indicating potential lateral movement activity. One of the primary goals of attackers after gaining access to a network is to locate and exfiltrate valuable information. Attackers might perform multiple small transfers to match normal egress activity in the network, to evade detection.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Lateral Movement Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Lateral Movement"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-90m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/lmd",
          "https://www.elastic.co/blog/detecting-lateral-movement-activity-a-new-kibana-integration",
          "https://www.elastic.co/blog/remote-desktop-protocol-connections-elastic-security"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1210",
                "name": "Exploitation of Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1210/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Lateral Movement Detection integration assets to be installed, as well as file and Windows RDP process events collected by the Elastic Defend integration.  \n\n### Lateral Movement Detection Setup\nThe Lateral Movement Detection integration detects lateral movement activity by identifying abnormalities in file and Windows RDP events. Anomalies are detected using Elastic's Anomaly Detection feature.\n\n#### Prerequisite Requirements:\n- Fleet is required for Lateral Movement Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- File events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n#### The following steps should be executed to install assets associated with the Lateral Movement Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Lateral Movement Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "lmd",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [],
        "id": "02a41c37-3539-4110-9f9a-ed5dba1b38f4",
        "rule_id": "e9b0902b-c515-413b-b80b-a8dcebc81a66",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.533Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.533Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 70,
        "machine_learning_job_id": [
          "lmd_high_count_remote_file_transfer"
        ]
      },
      {
        "name": "Suspicious APT Package Manager Network Connection",
        "description": "Detects suspicious network events executed by the APT package manager, potentially indicating persistence through an APT backdoor. In Linux, APT (Advanced Package Tool) is a command-line utility used for handling packages on Debian-based systems, providing functions for installing, updating, upgrading, and removing software along with managing package repositories. Attackers can backdoor APT to gain persistence by injecting malicious code into scripts that APT runs, thereby ensuring continued unauthorized access or control each time APT is used for package management.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Command and Control",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/"
              },
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/",
                "subtechnique": [
                  {
                    "id": "T1546.016",
                    "name": "Installer Packages",
                    "reference": "https://attack.mitre.org/techniques/T1546/016/"
                  }
                ]
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": []
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "fd313028-2b3c-46eb-9d1d-af080524ae10",
        "rule_id": "eaef8a35-12e0-4ac0-bc14-81c72b6bd27c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.536Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.536Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id with maxspan=5s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.parent.name == \"apt\" and process.args == \"-c\" and process.name in (\n     \"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\"\n    )\n  ] by process.entity_id\n  [network where host.os.type == \"linux\" and event.action == \"connection_attempted\" and event.type == \"start\" and not (\n     destination.ip == null or destination.ip == \"0.0.0.0\" or cidrmatch(\n     destination.ip, \"10.0.0.0/8\", \"127.0.0.0/8\", \"169.254.0.0/16\", \"172.16.0.0/12\", \"192.0.0.0/24\", \"192.0.0.0/29\",\n     \"192.0.0.8/32\", \"192.0.0.9/32\", \"192.0.0.10/32\", \"192.0.0.170/32\", \"192.0.0.171/32\", \"192.0.2.0/24\",\n     \"192.31.196.0/24\", \"192.52.193.0/24\", \"192.168.0.0/16\", \"192.88.99.0/24\", \"224.0.0.0/4\", \"100.64.0.0/10\",\n     \"192.175.48.0/24\",\"198.18.0.0/15\", \"198.51.100.0/24\", \"203.0.113.0/24\", \"240.0.0.0/4\", \"::1\", \"FE80::/10\",\n     \"FF00::/8\", \"172.31.0.0/16\"\n     )\n   ) and not process.executable == \"/usr/bin/apt-listbugs\"\n  ] by process.parent.entity_id\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Potential Data Exfiltration Activity to an Unusual Destination Port",
        "description": "A machine learning job has detected data exfiltration to a particular destination port. Data transfer patterns that are outside the normal traffic patterns of an organization could indicate exfiltration over command and control channels.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Use Case: Data Exfiltration Detection",
          "Rule Type: ML",
          "Rule Type: Machine Learning",
          "Tactic: Exfiltration"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "15m",
        "from": "now-6h",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/security/current/prebuilt-ml-jobs.html",
          "https://docs.elastic.co/en/integrations/ded",
          "https://www.elastic.co/blog/detect-data-exfiltration-activity-with-kibanas-new-integration"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": [
              {
                "id": "T1041",
                "name": "Exfiltration Over C2 Channel",
                "reference": "https://attack.mitre.org/techniques/T1041/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe rule requires the Data Exfiltration Detection integration assets to be installed, as well as network and file events collected by integrations such as Elastic Defend and Network Packet Capture (for network events only).  \n\n### Data Exfiltration Detection Setup\nThe Data Exfiltration Detection integration detects data exfiltration activity by identifying abnormalities in network and file events. Anomalies are detected using Elastic's Anomaly Detection feature. \n\n#### Prerequisite Requirements:\n- Fleet is required for Data Exfiltration Detection.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n- Network events collected by the [Elastic Defend](https://docs.elastic.co/en/integrations/endpoint) or [Network Packet Capture](https://docs.elastic.co/integrations/network_traffic) integration.\n- To install Elastic Defend, refer to the [documentation](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n- To add the Network Packet Capture integration to an Elastic Agent policy, refer to [this](https://www.elastic.co/guide/en/fleet/current/add-integration-to-policy.html) guide.\n\n#### The following steps should be executed to install assets associated with the Data Exfiltration Detection integration:\n- Go to the Kibana homepage. Under Management, click Integrations.\n- In the query bar, search for Data Exfiltration Detection and select the integration to see more details about it.\n- Follow the instructions under the **Installation** section.\n- For this rule to work, complete the instructions through **Add preconfigured anomaly detection jobs**.\n",
        "related_integrations": [
          {
            "package": "ded",
            "version": "^2.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "network_traffic",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [],
        "id": "5b3bc588-577b-493a-8ae6-6e1eb94bab55",
        "rule_id": "ef8cc01c-fc49-4954-a175-98569c646740",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.540Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.540Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "machine_learning",
        "anomaly_threshold": 75,
        "machine_learning_job_id": [
          "ded_high_sent_bytes_destination_port"
        ]
      },
      {
        "name": "Potential Active Directory Replication Account Backdoor",
        "description": "Identifies the modification of the nTSecurityDescriptor attribute in a domain object with rights related to DCSync to a user/computer account. Attackers can use this backdoor to re-obtain access to hashes of any user/computer.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "",
        "output_index": "",
        "version": 104,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: Active Directory",
          "Use Case: Active Directory Monitoring",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://twitter.com/menasec1/status/1111556090137903104",
          "https://www.specterops.io/assets/resources/an_ace_up_the_sleeve.pdf",
          "https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/security/win_security_account_backdoor_dcsync_rights.yml",
          "https://learn.microsoft.com/en-us/windows/win32/adschema/r-ds-replication-get-changes-all",
          "https://learn.microsoft.com/en-us/windows/win32/adschema/r-ds-replication-get-changes",
          "https://learn.microsoft.com/en-us/windows/win32/adschema/r-ds-replication-get-changes-in-filtered-set"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1003",
                "name": "OS Credential Dumping",
                "reference": "https://attack.mitre.org/techniques/T1003/",
                "subtechnique": [
                  {
                    "id": "T1003.006",
                    "name": "DCSync",
                    "reference": "https://attack.mitre.org/techniques/T1003/006/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "The 'Audit Directory Service Changes' logging policy must be configured for (Success, Failure).\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nPolicies >\nWindows Settings >\nSecurity Settings >\nAdvanced Audit Policies Configuration >\nAudit Policies >\nDS Access >\nAudit Directory Service Changes (Success,Failure)\n```",
        "related_integrations": [
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.code",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "winlog.event_data.AttributeLDAPDisplayName",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "winlog.event_data.AttributeValue",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "9cf530e5-7e40-4088-a0f5-5b2dfcde85a2",
        "rule_id": "f8822053-a5d2-46db-8c96-d460b12c36ac",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.543Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.543Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "winlogbeat-*",
          "logs-system.security*",
          "logs-windows.forwarded*"
        ],
        "query": "event.action:(\"Directory Service Changes\" or \"directory-service-object-modified\") and event.code:\"5136\" and\n  winlog.event_data.AttributeLDAPDisplayName:\"nTSecurityDescriptor\" and\n  winlog.event_data.AttributeValue : (\n    (\n      *1131f6ad-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-* and\n      *1131f6aa-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-* and\n      *89e95b76-444d-4c62-991a-0facbeda640c;;S-1-5-21-*\n    )\n  )\n",
        "language": "kuery"
      },
      {
        "name": "Potential Masquerading as VLC DLL",
        "description": "Identifies instances of VLC-related DLLs which are not signed by the original developer. Attackers may name their payload as legitimate applications to blend into the environment, or embedding its malicious code within legitimate applications to deceive machine learning algorithms by incorporating authentic and benign code.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "Data Source: Elastic Defend",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Tactic: Persistence",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.001",
                    "name": "Invalid Code Signature",
                    "reference": "https://attack.mitre.org/techniques/T1036/001/"
                  },
                  {
                    "id": "T1036.005",
                    "name": "Match Legitimate Name or Location",
                    "reference": "https://attack.mitre.org/techniques/T1036/005/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1554",
                "name": "Compromise Host Software Binary",
                "reference": "https://attack.mitre.org/techniques/T1554/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "dll.code_signature.subject_name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "dll.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "dll.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a503a6bc-8f17-45c2-91ff-a8cacdee1fc9",
        "rule_id": "4494c14f-5ff8-4ed2-8e99-bf816a1642fc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:23.547Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:23.547Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "library where host.os.type == \"windows\" and event.action == \"load\" and\n  dll.name : (\"libvlc.dll\", \"libvlccore.dll\", \"axvlc.dll\") and\n  not (\n    dll.code_signature.subject_name : (\"VideoLAN\", \"716F2E5E-A03A-486B-BC67-9B18474B9D51\")\n    and dll.code_signature.trusted == true\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.library-*"
        ]
      },
      {
        "name": "High Number of Cloned GitHub Repos From PAT",
        "description": "Detects a high number of unique private repo clone events originating from a single personal access token within a short time period.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Execution",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1648",
                "name": "Serverless Execution",
                "reference": "https://attack.mitre.org/techniques/T1648/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "github.programmatic_access_type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "github.repository_public",
            "type": "boolean",
            "ecs": false
          }
        ],
        "id": "b70edad5-f40b-48be-bfcf-d6c7f94c8bae",
        "rule_id": "fb0afac5-bbd6-49b0-b4f8-44e5381e1587",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.394Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.394Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "threshold",
        "query": "event.dataset:\"github.audit\" and event.category:\"configuration\" and event.action:\"git.clone\" and\ngithub.programmatic_access_type:(\"OAuth access token\" or \"Fine-grained personal access token\") and\ngithub.repository_public:false\n",
        "threshold": {
          "field": [
            "github.hashed_token"
          ],
          "value": 1,
          "cardinality": [
            {
              "field": "github.repo",
              "value": 10
            }
          ]
        },
        "index": [
          "logs-github.audit-*"
        ],
        "language": "kuery"
      },
      {
        "name": "First Occurrence of IP Address For GitHub Personal Access Token (PAT)",
        "description": "Detects a new IP address used for a GitHub PAT not previously seen in the last 14 days.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Initial Access",
          "Rule Type: BBR",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1078",
                "name": "Valid Accounts",
                "reference": "https://attack.mitre.org/techniques/T1078/",
                "subtechnique": [
                  {
                    "id": "T1078.004",
                    "name": "Cloud Accounts",
                    "reference": "https://attack.mitre.org/techniques/T1078/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "github.actor_ip",
            "type": "ip",
            "ecs": false
          },
          {
            "name": "github.hashed_token",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "github.programmatic_access_type",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "c0dbd779-4761-4926-b7ec-3064e84a8d74",
        "rule_id": "fc909baa-fb34-4c46-9691-be276ef4234c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.397Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.397Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset:\"github.audit\" and event.category:\"configuration\" and\ngithub.actor_ip:* and github.hashed_token:* and\ngithub.programmatic_access_type:(\"OAuth access token\" or \"Fine-grained personal access token\")\n",
        "new_terms_fields": [
          "github.hashed_token",
          "github.actor_ip"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-github.audit-*"
        ],
        "language": "kuery"
      },
      {
        "name": "GitHub App Deleted",
        "description": "Detects the deletion of a GitHub app either from a repo or an organization.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1648",
                "name": "Serverless Execution",
                "reference": "https://attack.mitre.org/techniques/T1648/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "github.category",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "aeb05468-c5dc-48ff-ab28-0d146ef3c836",
        "rule_id": "fd01b949-81be-46d5-bcf8-284395d5f56d",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.401Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.401Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "configuration where event.dataset == \"github.audit\" and github.category == \"integration_installation\" and event.type == \"deletion\"\n",
        "language": "eql",
        "index": [
          "logs-github.audit-*"
        ]
      },
      {
        "name": "Potential Masquerading as Business App Installer",
        "description": "Identifies executables with names resembling legitimate business applications but lacking signatures from the original developer. Attackers may trick users into downloading malicious executables that masquerade as legitimate applications via malicious ads, forum posts, and tutorials, effectively gaining initial access.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 4,
        "tags": [
          "Domain: Endpoint",
          "Data Source: Elastic Defend",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Tactic: Initial Access",
          "Tactic: Execution"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.rapid7.com/blog/post/2023/08/31/fake-update-utilizes-new-idat-loader-to-execute-stealc-and-lumma-infostealers"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.001",
                    "name": "Invalid Code Signature",
                    "reference": "https://attack.mitre.org/techniques/T1036/001/"
                  },
                  {
                    "id": "T1036.005",
                    "name": "Match Legitimate Name or Location",
                    "reference": "https://attack.mitre.org/techniques/T1036/005/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1189",
                "name": "Drive-by Compromise",
                "reference": "https://attack.mitre.org/techniques/T1189/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1204",
                "name": "User Execution",
                "reference": "https://attack.mitre.org/techniques/T1204/",
                "subtechnique": [
                  {
                    "id": "T1204.002",
                    "name": "Malicious File",
                    "reference": "https://attack.mitre.org/techniques/T1204/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.status",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.subject_name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "5befe565-389b-403a-b66c-6e7a78d9e448",
        "rule_id": "feafdc51-c575-4ed2-89dd-8e20badc2d6c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.404Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.404Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and\n  event.type == \"start\" and process.executable : \"?:\\\\Users\\\\*\\\\Downloads\\\\*\" and\n  not process.code_signature.status : (\"errorCode_endpoint*\", \"errorUntrustedRoot\", \"errorChaining\") and\n  (\n    /* Slack */\n    (process.name : \"*slack*.exe\" and not\n      (process.code_signature.subject_name in (\n        \"Slack Technologies, Inc.\",\n        \"Slack Technologies, LLC\"\n       ) and process.code_signature.trusted == true)\n    ) or\n\n    /* WebEx */\n    (process.name : \"*webex*.exe\" and not\n      (process.code_signature.subject_name in (\"Cisco WebEx LLC\", \"Cisco Systems, Inc.\") and process.code_signature.trusted == true)\n    ) or\n\n    /* Teams */\n    (process.name : \"teams*.exe\" and not\n      (process.code_signature.subject_name == \"Microsoft Corporation\" and process.code_signature.trusted == true)\n    ) or\n\n    /* Discord */\n    (process.name : \"*discord*.exe\" and not\n      (process.code_signature.subject_name == \"Discord Inc.\" and process.code_signature.trusted == true)\n    ) or\n\n    /* WhatsApp */\n    (process.name : \"*whatsapp*.exe\" and not\n      (process.code_signature.subject_name in (\n        \"WhatsApp LLC\",\n        \"WhatsApp, Inc\",\n        \"24803D75-212C-471A-BC57-9EF86AB91435\"\n       ) and process.code_signature.trusted == true)\n    ) or\n\n    /* Zoom */\n    (process.name : (\"*zoom*installer*.exe\", \"*zoom*setup*.exe\", \"zoom.exe\")  and not\n      (process.code_signature.subject_name == \"Zoom Video Communications, Inc.\" and process.code_signature.trusted == true)\n    ) or\n\n    /* Outlook */\n    (process.name : \"*outlook*.exe\" and not\n      (\n        (process.code_signature.subject_name == \"Microsoft Corporation\" and process.code_signature.trusted == true) or\n        (\n          process.name: \"MSOutlookHelp-PST-Viewer.exe\" and process.code_signature.subject_name == \"Aryson Technologies Pvt. Ltd\" and\n          process.code_signature.trusted == true\n        )\n      )\n    ) or\n\n    /* Thunderbird */\n    (process.name : \"*thunderbird*.exe\" and not\n      (process.code_signature.subject_name == \"Mozilla Corporation\" and process.code_signature.trusted == true)\n    ) or\n\n    /* Grammarly */\n    (process.name : \"*grammarly*.exe\" and not\n      (process.code_signature.subject_name == \"Grammarly, Inc.\" and process.code_signature.trusted == true)\n    ) or\n\n    /* Dropbox */\n    (process.name : \"*dropbox*.exe\" and not\n      (process.code_signature.subject_name == \"Dropbox, Inc\" and process.code_signature.trusted == true)\n    ) or\n\n    /* Tableau */\n    (process.name : \"*tableau*.exe\" and not\n      (process.code_signature.subject_name == \"Tableau Software LLC\" and process.code_signature.trusted == true)\n    ) or\n\n    /* Google Drive */\n    (process.name : \"*googledrive*.exe\" and not\n      (process.code_signature.subject_name == \"Google LLC\" and process.code_signature.trusted == true)\n    ) or\n\n    /* MSOffice */\n    (process.name : \"*office*setup*.exe\" and not\n      (process.code_signature.subject_name == \"Microsoft Corporation\" and process.code_signature.trusted == true)\n    ) or\n\n    /* Okta */\n    (process.name : \"*okta*.exe\" and not\n      (process.code_signature.subject_name == \"Okta, Inc.\" and process.code_signature.trusted == true)\n    ) or\n\n    /* OneDrive */\n    (process.name : \"*onedrive*.exe\" and not\n      (process.code_signature.subject_name == \"Microsoft Corporation\" and process.code_signature.trusted == true)\n    ) or\n\n    /* Chrome */\n    (process.name : \"*chrome*.exe\" and not\n      (process.code_signature.subject_name in (\"Google LLC\", \"Google Inc\") and process.code_signature.trusted == true)\n    ) or\n\n    /* Firefox */\n    (process.name : \"*firefox*.exe\" and not\n      (process.code_signature.subject_name == \"Mozilla Corporation\" and process.code_signature.trusted == true)\n    ) or\n\n    /* Edge */\n    (process.name : (\"*microsoftedge*.exe\", \"*msedge*.exe\") and not\n      (process.code_signature.subject_name == \"Microsoft Corporation\" and process.code_signature.trusted == true)\n    ) or\n\n    /* Brave */\n    (process.name : \"*brave*.exe\" and not\n      (process.code_signature.subject_name == \"Brave Software, Inc.\" and process.code_signature.trusted == true)\n    ) or\n\n    /* GoogleCloud Related Tools */\n    (process.name : \"*GoogleCloud*.exe\" and not\n      (process.code_signature.subject_name == \"Google LLC\" and process.code_signature.trusted == true)\n    ) or\n\n    /* Github Related Tools */\n    (process.name : \"*github*.exe\" and not\n      (process.code_signature.subject_name == \"GitHub, Inc.\" and process.code_signature.trusted == true)\n    ) or\n\n    /* Notion */\n    (process.name : \"*notion*.exe\" and not\n      (process.code_signature.subject_name == \"Notion Labs, Inc.\" and process.code_signature.trusted == true)\n    )\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*"
        ]
      },
      {
        "name": "Potential Ransomware Note File Dropped via SMB",
        "description": "Identifies an incoming SMB connection followed by the creation of a file with a name similar to ransomware note files. This may indicate a remote ransomware attack via the SMB protocol.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n## Performance\n\n- This rule may cause medium to high performance impact due to logic scoping all icoming SMB network events.\n\n#### Possible investigation steps\n\n- Investigate the source.ip address connecting to port 445 on this host.\n- Identify the user account that performed the file creation via SMB.\n- If the number of files is too high and source.ip connecting over SMB is unusual isolate the host and block the used credentials.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n\n### False positive analysis\n\n- Remote file creation with similar file naming convention via SMB.\n\n\n### Related rules\n\n- Third-party Backup Files Deleted via Unexpected Process - 11ea6bec-ebde-4d71-a8e9-784948f8e3e9\n- Volume Shadow Copy Deleted or Resized via VssAdmin - b5ea4bfe-a1b2-421f-9d47-22a75a6f2921\n- Volume Shadow Copy Deletion via PowerShell - d99a037b-c8e2-47a5-97b9-170d076827c4\n- Volume Shadow Copy Deletion via WMIC - dc9c1f74-dac3-48e3-b47f-eb79db358f57\n- Suspicious File Renamed via SMB - 78e9b5d5-7c07-40a7-a591-3dbbf464c386\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Consider isolating the involved host to prevent destructive behavior, which is commonly associated with this activity.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- If any other destructive action was identified on the host, it is recommended to prioritize the investigation and look for ransomware preparation and execution activities.\n- If any backups were affected:\n  - Perform data recovery locally or restore the backups from replicated copies (cloud, other servers, etc.).\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Impact",
          "Resources: Investigation Guide",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1485",
                "name": "Data Destruction",
                "reference": "https://attack.mitre.org/techniques/T1485/"
              },
              {
                "id": "T1490",
                "name": "Inhibit System Recovery",
                "reference": "https://attack.mitre.org/techniques/T1490/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1021",
                "name": "Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1021/",
                "subtechnique": [
                  {
                    "id": "T1021.002",
                    "name": "SMB/Windows Admin Shares",
                    "reference": "https://attack.mitre.org/techniques/T1021/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.address",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "destination.port",
            "type": "long",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "network.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pid",
            "type": "long",
            "ecs": true
          },
          {
            "name": "source.address",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "source.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "source.port",
            "type": "long",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "9e820831-c5c3-402a-8c5e-8af93eb5ff4d",
        "rule_id": "02bab13d-fb14-4d7c-b6fe-4a28874d37c5",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.407Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.407Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id with maxspan=1s\n [network where host.os.type == \"windows\" and\n  event.action == \"connection_accepted\" and destination.port == 445 and source.port >= 49152 and process.pid == 4 and\n  source.ip != \"127.0.0.1\" and source.ip != \"::1\" and\n  network.type == \"ipv4\" and not endswith(source.address, destination.address)]\n [file where host.os.type == \"windows\" and event.action == \"creation\" and\n  process.pid == 4 and user.id : (\"S-1-5-21*\", \"S-1-12-*\") and file.extension : (\"hta\", \"txt\", \"readme\", \"htm*\") and\n  file.path : \"C:\\\\Users\\\\*\" and\n   /* ransom file name keywords */\n    file.name : (\"*read*me*\", \"*lock*\", \"*@*\", \"*RECOVER*\", \"*decrypt*\", \"*restore*file*\", \"*FILES_BACK*\", \"*how*to*\")] with runs=3\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Potential Memory Seeking Activity",
        "description": "Monitors for the execution of Unix utilities that may be leveraged as memory address seekers. Attackers may leverage built-in utilities to seek specific memory addresses, allowing for potential future manipulation/exploitation.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Rule Type: BBR",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/arget13/DDexec"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1057",
                "name": "Process Discovery",
                "reference": "https://attack.mitre.org/techniques/T1057/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "b3724084-f0a9-4a16-bd24-61f006c3ef40",
        "rule_id": "035a6f21-4092-471d-9cda-9e379f459b1e",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.410Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.410Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and (\n  (process.name == \"tail\" and process.args in (\"-c\", \"--bytes\")) or\n  (process.name == \"cmp\" and process.args == \"-i\") or\n  (process.name in (\"hexdump\", \"xxd\") and process.args == \"-s\") or\n  (process.name == \"dd\" and process.args : (\"skip*\", \"seek*\"))\n) and not (\n  process.parent.args like (\"/opt/error_monitor/error_monitor.sh\", \"printf*\") or\n  process.parent.name in (\"acme.sh\", \"dracut\", \"leapp\") or\n  process.parent.executable like (\n    \"/bin/cagefs_enter\", \"/opt/nessus_agent/sbin/nessus-service\", \"/usr/libexec/platform-python*\",\n    \"/usr/libexec/vdsm/vdsmd\", \"/usr/local/bin/docker-entrypoint.sh\", \"/usr/lib/module-init-tools/lsinitrd-quick\"\n  ) or\n  process.parent.command_line like \"sh*acme.sh*\" or\n  process.args like \"/var/tmp/dracut*\"\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "Potential Network Scan Executed From Host",
        "description": "This threshold rule monitors for the rapid execution of unix utilities that are capable of conducting network scans. Adversaries may leverage built-in tools such as ping, netcat or socat to execute ping sweeps across the network while attempting to evade detection or due to the lack of network mapping tools available on the compromised host.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1046",
                "name": "Network Service Discovery",
                "reference": "https://attack.mitre.org/techniques/T1046/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows\nthe Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest to select \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "44481741-14ed-4d53-8095-176f65d69d91",
        "rule_id": "03c23d45-d3cb-4ad4-ab5d-b361ffe8724a",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.414Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.414Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "threshold",
        "query": "event.category:process and host.os.type:linux and event.action:(exec or exec_event or executed or process_started) and\nevent.type:start and process.name:(ping or nping or hping or hping2 or hping3 or nc or ncat or netcat or socat)\n",
        "threshold": {
          "field": [
            "host.id",
            "process.parent.entity_id",
            "process.executable"
          ],
          "value": 1,
          "cardinality": [
            {
              "field": "process.args",
              "value": 100
            }
          ]
        },
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ],
        "language": "kuery"
      },
      {
        "name": "Netcat Listener Established via rlwrap",
        "description": "Monitors for the execution of a netcat listener via rlwrap. rlwrap is a 'readline wrapper', a small utility that uses the GNU Readline library to allow the editing of keyboard input for any command. This utility can be used in conjunction with netcat to gain a more stable reverse shell.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Netcat is a dual-use tool that can be used for benign or malicious activity. Netcat is included in some Linux distributions so its presence is not necessarily suspicious. Some normal use of this program, while uncommon, may originate from scripts, automation tools, and frameworks."
        ],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows\nthe Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest to select \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "2d7c3e11-8c25-40f0-b36f-e5ca76b79f38",
        "rule_id": "0f56369f-eb3d-459c-a00b-87c2bf7bdfc5",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.417Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.417Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and \nprocess.name == \"rlwrap\" and process.args in (\"nc\", \"ncat\", \"netcat\", \"nc.openbsd\", \"socat\") and\nprocess.args : \"*l*\" and process.args_count >= 4\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "Execution from a Removable Media with Network Connection",
        "description": "Identifies process execution from a removable media and by an unusual process. Adversaries may move onto systems, possibly those on disconnected or air-gapped networks, by copying malware to removable media and taking advantage of Autorun features when the media is inserted into a system and executes.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Initial Access",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1091",
                "name": "Replication Through Removable Media",
                "reference": "https://attack.mitre.org/techniques/T1091/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.Ext.device.bus_type",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "process.Ext.device.product_id",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "process.code_signature.exists",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.code_signature.status",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "1b469999-e0ef-4fb2-ba2d-2df13bd634c3",
        "rule_id": "1542fa53-955e-4330-8e4d-b2d812adeb5f",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.420Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.420Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by process.entity_id with maxspan=5m\n [process where host.os.type == \"windows\" and event.action == \"start\" and\n  \n  /* Direct Exec from USB */\n  (process.Ext.device.bus_type : \"usb\" or process.Ext.device.product_id : \"USB *\") and\n  (process.code_signature.trusted == false or process.code_signature.exists == false) and \n  \n  not process.code_signature.status : (\"errorExpired\", \"errorCode_endpoint*\")]\n [network where host.os.type == \"windows\" and event.action == \"connection_attempted\"]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-endpoint.events.network-*"
        ]
      },
      {
        "name": "AWS Bedrock Detected Multiple Attempts to use Denied Models by a Single User",
        "description": "Identifies multiple successive failed attempts to use denied model resources within AWS Bedrock. This could indicated attempts to bypass limitations of other approved models, or to force an impact on the environment by incurring exhorbitant costs.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Attempt to use Denied Amazon Bedrock Models.\n\nAmazon Bedrock is AWS’s managed service that enables developers to build and scale generative AI applications using large foundation models (FMs) from top providers.\n\nBedrock offers a variety of pretrained models from Amazon (such as the Titan series), as well as models from providers like Anthropic, Meta, Cohere, and AI21 Labs.\n\n#### Possible investigation steps\n\n- Identify the user account that attempted to use denied models.\n- Investigate other alerts associated with the user account during the past 48 hours.\n- Consider the time of day. If the user is a human (not a program or script), did the activity take place during a normal time of day?\n- Examine the account's attempts to access Amazon Bedrock models in the last 24 hours.\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking Amazon Bedrock model access, prompts generated, and responses to the prompts by the account in the last 24 hours.\n\n### False positive analysis\n\n- Verify the user account that attempted to use denied models, is a legitimate misunderstanding by users or overly strict policies.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Identify if the attacker is moving laterally and compromising other Amazon Bedrock Services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Review the permissions assigned to the implicated user group or role behind these requests to ensure they are authorized and expected to access bedrock and ensure that the least privilege principle is being followed.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "user.id",
            "cloud.account.id",
            "gen_ai.request.model.id",
            "total_denials"
          ]
        },
        "version": 3,
        "tags": [
          "Domain: LLM",
          "Data Source: AWS Bedrock",
          "Data Source: AWS S3",
          "Resources: Investigation Guide",
          "Use Case: Policy Violation",
          "Mitre Atlas: T0015",
          "Mitre Atlas: T0034"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate misunderstanding by users or overly strict policies"
        ],
        "references": [
          "https://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-components.html",
          "https://atlas.mitre.org/techniques/AML.T0015",
          "https://atlas.mitre.org/techniques/AML.T0034",
          "https://www.elastic.co/security-labs/elastic-advances-llm-security"
        ],
        "max_signals": 100,
        "threat": [],
        "setup": "## Setup\n\nThis rule requires that guardrails are configured in AWS Bedrock. For more information, see the AWS Bedrock documentation:\n\nhttps://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-create.html\n",
        "related_integrations": [],
        "required_fields": [],
        "id": "98ade123-8b00-49b0-bcbe-00ebb18ffd0d",
        "rule_id": "17261da3-a6d0-463c-aac8-ea1718afcd20",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.424Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.424Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws_bedrock.invocation-*\n| where gen_ai.response.error_code == \"AccessDeniedException\"\n| keep user.id, gen_ai.request.model.id, cloud.account.id, gen_ai.response.error_code\n| stats total_denials = count(*) by user.id, gen_ai.request.model.id, cloud.account.id\n| where total_denials > 3\n| sort total_denials desc\n"
      },
      {
        "name": "Process Created with a Duplicated Token",
        "description": "Identifies the creation of a process impersonating the token of another user logon session. Adversaries may create a new process with a different token to escalate privileges and bypass access controls.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createprocesswithtokenw"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1134",
                "name": "Access Token Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1134/",
                "subtechnique": [
                  {
                    "id": "T1134.001",
                    "name": "Token Impersonation/Theft",
                    "reference": "https://attack.mitre.org/techniques/T1134/001/"
                  },
                  {
                    "id": "T1134.002",
                    "name": "Create Process with Token",
                    "reference": "https://attack.mitre.org/techniques/T1134/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.Ext.effective_parent.executable",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "process.Ext.effective_parent.name",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "process.Ext.relative_file_creation_time",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "process.Ext.relative_file_name_modify_time",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "process.code_signature.status",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "58f166ac-c575-487b-8c94-f39f5c63ce9e",
        "rule_id": "1b0b4818-5655-409b-9c73-341cac4bb73f",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.427Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.427Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "/* This rule is only compatible with Elastic Endpoint 8.4+ */\n\nprocess where host.os.type == \"windows\" and event.action == \"start\" and\n\n user.id : (\"S-1-5-21-*\", \"S-1-12-1-*\") and\n\n (process.Ext.effective_parent.executable regex~ \"\"\"[C-Z]:\\\\Windows\\\\(System32|SysWOW64)\\\\[a-zA-Z0-9\\-\\_\\.]+\\.exe\"\"\" or\n  process.Ext.effective_parent.executable : \"?:\\\\Windows\\\\explorer.exe\") and\n\n (\n  process.name : (\"powershell.exe\", \"cmd.exe\", \"rundll32.exe\", \"notepad.exe\", \"net.exe\", \"ntdsutil.exe\",\n                  \"tasklist.exe\", \"reg.exe\", \"certutil.exe\", \"bitsadmin.exe\", \"msbuild.exe\", \"esentutl.exe\") or\n\n  ((process.Ext.relative_file_creation_time <= 900 or process.Ext.relative_file_name_modify_time <= 900) and\n   not process.code_signature.status : (\"trusted\", \"errorExpired\", \"errorCode_endpoint*\") and\n   not process.executable : (\"?:\\\\Program Files\\\\*\", \"?:\\\\Program Files (x86)\\\\*\"))\n ) and\n not (process.name : \"rundll32.exe\" and\n      process.command_line : (\"*davclnt.dll,DavSetCookie*\", \"*?:\\\\Program Files*\",\n                              \"*\\\\Windows\\\\System32\\\\winethc.dll*\", \"*\\\\Windows\\\\SYSTEM32\\\\EDGEHTML.dll*\",\n                              \"*shell32.dll,SHCreateLocalServerRunDll*\")) and\n not startswith~(process.Ext.effective_parent.name, process.parent.name) and \n not (process.name : \"powershell.exe\" and process.parent.name : \"wmiprvse.exe\" and process.Ext.effective_parent.executable : \"?:\\\\Windows\\\\System32\\\\wsmprovhost.exe\") and \n not (process.Ext.effective_parent.executable : \"?:\\\\Windows\\\\System32\\\\RuntimeBroker.exe\" and process.parent.executable : \"?:\\\\Windows\\\\System32\\\\sihost.exe\") and \n not (process.Ext.effective_parent.executable : \"?:\\\\Windows\\\\System32\\\\sethc.exe\" and process.parent.executable : \"?:\\\\Windows\\\\System32\\\\svchost.exe\") and \n not (process.Ext.effective_parent.executable : \"?:\\\\Windows\\\\explorer.exe\" and \n      process.parent.executable : (\"?:\\\\Windows\\\\System32\\\\svchost.exe\", \"?:\\\\Windows\\\\System32\\\\msiexec.exe\", \"?:\\\\Windows\\\\twain_32\\\\*.exe\"))\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*"
        ]
      },
      {
        "name": "Executable Masquerading as Kernel Process",
        "description": "Monitors for kernel processes with associated process executable fields that are not empty. Unix kernel processes such as kthreadd and kworker typically do not have process.executable fields associated to them. Attackers may attempt to hide their malicious programs by masquerading as legitimate kernel processes.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://sandflysecurity.com/blog/linux-stealth-rootkit-malware-with-edr-evasion-analyzed/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.004",
                    "name": "Masquerade Task or Service",
                    "reference": "https://attack.mitre.org/techniques/T1036/004/"
                  }
                ]
              },
              {
                "id": "T1564",
                "name": "Hide Artifacts",
                "reference": "https://attack.mitre.org/techniques/T1564/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "e2f44a41-38f2-4dbc-b6e0-9c9d3d6ce1cf",
        "rule_id": "202829f6-0271-4e88-b882-11a655c590d4",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.441Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.441Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and\nprocess.name : (\"kworker*\", \"kthread*\") and process.executable != null\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "Werfault ReflectDebugger Persistence",
        "description": "Identifies the registration of a Werfault Debugger. Attackers may abuse this mechanism to execute malicious payloads every time the utility is executed with the \"-pr\" parameter.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 202,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: SentinelOne",
          "Data Source: Sysmon"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://cocomelonc.github.io/malware/2022/11/02/malware-pers-18.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1112",
                "name": "Modify Registry",
                "reference": "https://attack.mitre.org/techniques/T1112/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "registry.path",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a0aac042-17e5-4272-bf02-b3c112df92f7",
        "rule_id": "205b52c4-9c28-4af4-8979-935f3278d61a",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.445Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.445Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "registry where host.os.type == \"windows\" and event.type == \"change\" and\n  registry.path : (\n    \"HKLM\\\\Software\\\\Microsoft\\\\Windows\\\\Windows Error Reporting\\\\Hangs\\\\ReflectDebugger\",\n    \"\\\\REGISTRY\\\\MACHINE\\\\Software\\\\Microsoft\\\\Windows\\\\Windows Error Reporting\\\\Hangs\\\\ReflectDebugger\",\n    \"MACHINE\\\\Software\\\\Microsoft\\\\Windows\\\\Windows Error Reporting\\\\Hangs\\\\ReflectDebugger\"\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.registry-*",
          "endgame-*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-windows.sysmon_operational-*"
        ]
      },
      {
        "name": "Potential Reverse Shell via Child",
        "description": "This detection rule identifies suspicious network traffic patterns associated with TCP reverse shell activity. This activity consists of a network event that is followed by the creation of a shell process with suspicious command line arguments. An attacker may establish a Linux TCP reverse shell to gain remote access to a target system.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1071",
                "name": "Application Layer Protocol",
                "reference": "https://attack.mitre.org/techniques/T1071/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows\nthe Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click Add integrations.\n- In the query bar, search for Elastic Defend and select the integration to see more details about it.\n- Click Add Elastic Defend.\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either Traditional Endpoints or Cloud Workloads.\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest to select \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in New agent policy name. If other agent policies already exist, you can click the Existing hosts tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click Save and Continue.\n- To complete the integration, select Add Elastic Agent to your hosts and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d0a35827-4426-4627-a20b-024212fa8e1c",
        "rule_id": "2138bb70-5a5e-42fd-be5e-b38edf6a6777",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.448Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.448Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, process.entity_id with maxspan=5s\n  [network where event.type == \"start\" and host.os.type == \"linux\" and\n     event.action in (\"connection_attempted\", \"connection_accepted\") and\n     process.name : (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\", \"socat\") and destination.ip != null and\n     not cidrmatch(destination.ip, \"127.0.0.0/8\", \"169.254.0.0/16\", \"224.0.0.0/4\", \"::1\")]\n  [process where event.type == \"start\" and host.os.type == \"linux\" and event.action == \"exec\" and\n     process.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") and (\n       (process.args : (\"-i\", \"-l\")) or (process.parent.name == \"socat\" and process.parent.args : \"*exec*\")\n   )]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Unknown Execution of Binary with RWX Memory Region",
        "description": "Monitors for the execution of a previously unknown unix binary with read, write and execute memory region permissions. The mprotect() system call is used to change the access protections on a region of memory that has already been allocated. This syscall allows a process to modify the permissions of pages in its virtual address space, enabling or disabling permissions such as read, write, and execute for those pages. RWX permissions on memory is in many cases overly permissive, and should be analyzed thoroughly.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://man7.org/linux/man-pages/man2/mprotect.2.html",
          "https://www.elastic.co/security-labs/linux-detection-engineering-with-auditd"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires the use of the `auditd_manager` integration. `Auditd_manager` is a tool designed to simplify and enhance the management of the audit subsystem in Linux systems. It provides a user-friendly interface and automation capabilities for configuring and monitoring system auditing through the auditd daemon. With `auditd_manager`, administrators can easily define audit rules, track system events, and generate comprehensive audit reports, improving overall security and compliance in the system. The following steps should be executed in order to install and deploy `auditd_manager` on a Linux system.\n```\nKibana -->\nManagement -->\nIntegrations -->\nAuditd Manager -->\nAdd Auditd Manager\n```\n`Auditd_manager` subscribes to the kernel and receives events as they occur without any additional configuration. However, if more advanced configuration is required to detect specific behavior, audit rules can be added to the integration in either the \"audit rules\" configuration box or the \"auditd rule files\" box by specifying a file to read the audit rules from.\nFor this detection rule to trigger, the following additional audit rules are required to be added to the integration:\n```\n-a always,exit -F arch=b64 -S mprotect\n```\nAdd the newly installed `auditd manager` to an agent policy, and deploy the agent on a Linux system from which auditd log files are desirable.\n",
        "related_integrations": [
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "auditd.data.a2",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "auditd.data.syscall",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "28aecef7-8748-4243-8021-2a35bd20c530",
        "rule_id": "23bcd283-2bc0-4db2-81d4-273fc051e5c0",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.451Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.451Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.category:process and host.os.type:linux and auditd.data.syscall:mprotect and auditd.data.a2:7 and not (\n  process.executable:(\n    \"/usr/share/kibana/node/bin/node\" or \"/usr/share/elasticsearch/jdk/bin/java\" or \"/usr/sbin/apache2\"\n  ) or\n  process.name:httpd\n)\n",
        "new_terms_fields": [
          "process.executable"
        ],
        "history_window_start": "now-7d",
        "index": [
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ],
        "language": "kuery"
      },
      {
        "name": "Potential Relay Attack against a Domain Controller",
        "description": "Identifies potential relay attacks against a domain controller (DC) by identifying authentication events using the domain controller computer account coming from other hosts to the DC that owns the account. Attackers may relay the DC hash after capturing it using forced authentication.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 102,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: Elastic Defend",
          "Data Source: Active Directory",
          "Use Case: Active Directory Monitoring",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/p0dalirius/windows-coerced-authentication-methods",
          "https://www.thehacker.recipes/a-d/movement/mitm-and-coerced-authentications",
          "https://attack.mitre.org/techniques/T1187/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1187",
                "name": "Forced Authentication",
                "reference": "https://attack.mitre.org/techniques/T1187/"
              },
              {
                "id": "T1557",
                "name": "Adversary-in-the-Middle",
                "reference": "https://attack.mitre.org/techniques/T1557/",
                "subtechnique": [
                  {
                    "id": "T1557.001",
                    "name": "LLMNR/NBT-NS Poisoning and SMB Relay",
                    "reference": "https://attack.mitre.org/techniques/T1557/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.code",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "host.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "source.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "user.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "winlog.event_data.AuthenticationPackageName",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "winlog.logon.type",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "bef45946-eb26-41d4-bb3b-30d54d5359cb",
        "rule_id": "263481c8-1e9b-492e-912d-d1760707f810",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.455Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.455Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "authentication where host.os.type == \"windows\" and event.code in (\"4624\", \"4625\") and endswith~(user.name, \"$\") and\n    winlog.event_data.AuthenticationPackageName : \"NTLM\" and winlog.logon.type : \"network\" and\n\n    /* Filter for a machine account that matches the hostname */\n    startswith~(host.name, substring(user.name, 0, -1)) and\n    \n    /* Verify if the Source IP belongs to the host */\n    not endswith(string(source.ip), string(host.ip)) and\n    source.ip != null and source.ip != \"::1\" and source.ip != \"127.0.0.1\"\n",
        "language": "eql",
        "index": [
          "logs-system.security-*",
          "logs-windows.forwarded*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "Potential SSH-IT SSH Worm Downloaded",
        "description": "Identifies processes that are capable of downloading files with command line arguments containing URLs to SSH-IT's autonomous SSH worm. This worm intercepts outgoing SSH connections every time a user uses ssh.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Lateral Movement",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.thc.org/ssh-it/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1021",
                "name": "Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1021/",
                "subtechnique": [
                  {
                    "id": "T1021.004",
                    "name": "SSH",
                    "reference": "https://attack.mitre.org/techniques/T1021/004/"
                  }
                ]
              },
              {
                "id": "T1563",
                "name": "Remote Service Session Hijacking",
                "reference": "https://attack.mitre.org/techniques/T1563/",
                "subtechnique": [
                  {
                    "id": "T1563.001",
                    "name": "SSH Hijacking",
                    "reference": "https://attack.mitre.org/techniques/T1563/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows\nthe Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest to select \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "46ff67cc-d0c2-4a9e-8f7d-4ecedac65957",
        "rule_id": "2ddc468e-b39b-4f5b-9825-f3dcb0e998ea",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.458Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.458Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\", \"executed\", \"process_started\")\n and process.name in (\"curl\", \"wget\") and process.args : (\n  \"https://thc.org/ssh-it/x\", \"http://nossl.segfault.net/ssh-it-deploy.sh\", \"https://gsocket.io/x\",\n  \"https://thc.org/ssh-it/bs\", \"http://nossl.segfault.net/bs\"\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Network Connection via Sudo Binary",
        "description": "Detects network connections initiated by the \"sudo\" binary. This behavior is uncommon and may occur in instances where reverse shell shellcode is injected into a process run with elevated permissions via \"sudo\". Attackers may attempt to inject shellcode into processes running as root, to escalate privileges.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1055",
                "name": "Process Injection",
                "reference": "https://attack.mitre.org/techniques/T1055/",
                "subtechnique": [
                  {
                    "id": "T1055.008",
                    "name": "Ptrace System Calls",
                    "reference": "https://attack.mitre.org/techniques/T1055/008/"
                  }
                ]
              },
              {
                "id": "T1548",
                "name": "Abuse Elevation Control Mechanism",
                "reference": "https://attack.mitre.org/techniques/T1548/",
                "subtechnique": [
                  {
                    "id": "T1548.003",
                    "name": "Sudo and Sudo Caching",
                    "reference": "https://attack.mitre.org/techniques/T1548/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "46da457d-063c-422c-9c48-5576b477563f",
        "rule_id": "30e1e9f2-eb9c-439f-aff6-1e3068e99384",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.461Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.461Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "network where host.os.type == \"linux\" and event.type == \"start\" and\nevent.action in (\"connection_attempted\", \"ipv4_connection_attempt_event\") and process.name == \"sudo\" and not (\n  destination.ip == null or destination.ip == \"0.0.0.0\" or cidrmatch(\n    destination.ip, \"10.0.0.0/8\", \"127.0.0.0/8\", \"169.254.0.0/16\", \"172.16.0.0/12\", \"192.0.0.0/24\", \"192.0.0.0/29\",\n    \"192.0.0.8/32\", \"192.0.0.9/32\", \"192.0.0.10/32\", \"192.0.0.170/32\", \"192.0.0.171/32\", \"192.0.2.0/24\",\n    \"192.31.196.0/24\", \"192.52.193.0/24\", \"192.168.0.0/16\", \"192.88.99.0/24\", \"224.0.0.0/4\", \"100.64.0.0/10\",\n    \"192.175.48.0/24\",\"198.18.0.0/15\", \"198.51.100.0/24\", \"203.0.113.0/24\", \"240.0.0.0/4\", \"::1\", \"FE80::/10\",\n    \"FF00::/8\", \"172.31.0.0/16\"\n  )\n) \n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "AWS STS GetCallerIdentity API Called for the First Time",
        "description": "An adversary with access to a set of compromised credentials may attempt to verify that the credentials are valid and determine what account they are using. This rule looks for the first time an identity has called the STS `GetCallerIdentity` API operation in the last 15 days, which may be an indicator of compromised credentials. A legitimate user would not need to call this operation as they should know the account they are using.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating AWS GetCallerIdentity API Called for the First Time\n\nAWS Security Token Service (AWS STS) is a service that enables you to request temporary, limited-privilege credentials for users.\nThe `GetCallerIdentity` function returns details about the IAM user or role owning the credentials used to call the operation.\nNo permissions are required to run this operation and the same information is returned even when access is denied.\nThis rule looks for use of the `GetCallerIdentity` operation. This is a [New Terms](https://www.elastic.co/guide/en/security/master/rules-ui-create.html#create-new-terms-rule) rule indicating this is the first time a specific user identity has called this operation within the last 15 days.\n\n#### Possible investigation steps\n\n- Identify the account and its role in the environment, a role belonging to a service like Lambda or an EC2 instance would be highly suspicious.\n- Identify the applications or users that should use this account.\n- Investigate other alerts associated with the account during the past 48 hours.\n- Investigate abnormal values in the `user_agent.original` field by comparing them with the intended and authorized usage and historical data. Suspicious user agent values include non-SDK, AWS CLI, custom user agents, etc.\n- Assess whether this behavior is prevalent in the environment by looking for similar occurrences involving other users.\n- Contact the account owner and confirm whether they are aware of this activity.\n- Considering the source IP address and geolocation of the user who issued the command:\n    - Do they look normal for the calling user?\n    - If the source is an EC2 IP address, is it associated with an EC2 instance in one of your accounts or is the source IP from an EC2 instance that's not under your control?\n    - If it is an authorized EC2 instance, is the activity associated with normal behavior for the instance role or roles? Are there any other alerts or signs of suspicious activity involving this instance?\n- Review IAM permission policies for the user identity.\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking servers, services, and data accessed by the account in the last 24 hours.\n\n### False positive analysis\n\n- False positives may occur due to the intended usage of the service. Tuning is needed in order to have higher confidence. Consider adding exceptions — preferably with a combination of user agent and IP address conditions.\n- Automation workflows that rely on the results from this API request may also generate false-positives. We recommend adding exceptions related to the `user.name` or `aws.cloudtrail.user_identity.arn` values to ignore these.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Assess the criticality of affected services and servers.\n    - Work with your IT team to identify and minimize the impact on users.\n    - Identify if the attacker is moving laterally and compromising other accounts, servers, or services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Rotate secrets or delete API keys as needed to revoke the attacker's access to the environment. Work with your IT teams to minimize the impact on business operations during these actions.\n- Check if unauthorized new users were created, remove unauthorized new accounts, and request password resets for other IAM users.\n- Consider enabling multi-factor authentication for users.\n- Review the permissions assigned to the implicated user to ensure that the least privilege principle is being followed.\n- Implement security best practices [outlined](https://aws.amazon.com/premiumsupport/knowledge-center/security-best-practices/) by AWS.\n- Take the actions needed to return affected systems, data, or services to their normal operational levels.\n- Identify the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "@timestamp",
            "user.name",
            "source.address",
            "aws.cloudtrail.user_identity.type",
            "aws.cloudtrail.user_identity.arn",
            "user_agent.original",
            "event.action",
            "event.outcome",
            "cloud.region",
            "aws.cloudtrail.request_parameters"
          ]
        },
        "version": 3,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS STS",
          "Use Case: Identity and Access Audit",
          "Tactic: Discovery",
          "Resources: Investigation Guide"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Verify whether the user identity should be using the STS `GetCallerIdentity` API operation. If known behavior is causing false positives, it can be exempted from the rule."
        ],
        "references": [
          "https://docs.aws.amazon.com/STS/latest/APIReference/API_GetCallerIdentity.html",
          "https://www.secureworks.com/research/detecting-the-use-of-stolen-aws-lambda-credentials",
          "https://detectioninthe.cloud/ttps/discovery/get_caller_identity/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1087",
                "name": "Account Discovery",
                "reference": "https://attack.mitre.org/techniques/T1087/",
                "subtechnique": [
                  {
                    "id": "T1087.004",
                    "name": "Cloud Account",
                    "reference": "https://attack.mitre.org/techniques/T1087/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.user_identity.type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "95699331-0e5b-4325-85f6-be028128873b",
        "rule_id": "30fbf4db-c502-4e68-a239-2e99af0f70da",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.464Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.464Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset: \"aws.cloudtrail\"\n    and event.provider: \"sts.amazonaws.com\"\n    and event.action: \"GetCallerIdentity\"\n    and event.outcome: \"success\"\n    and not aws.cloudtrail.user_identity.type: \"AssumedRole\"\n",
        "new_terms_fields": [
          "aws.cloudtrail.user_identity.arn"
        ],
        "history_window_start": "now-10d",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "language": "kuery"
      },
      {
        "name": "Network Connection from Binary with RWX Memory Region",
        "description": "Monitors for the execution of a unix binary with read, write and execute memory region permissions, followed by a network connection. The mprotect() system call is used to change the access protections on a region of memory that has already been allocated. This syscall allows a process to modify the permissions of pages in its virtual address space, enabling or disabling permissions such as read, write, and execute for those pages. RWX permissions on memory is in many cases overly permissive, and should (especially in conjunction with an outbound network connection) be analyzed thoroughly.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://man7.org/linux/man-pages/man2/mprotect.2.html",
          "https://www.elastic.co/security-labs/linux-detection-engineering-with-auditd"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1071",
                "name": "Application Layer Protocol",
                "reference": "https://attack.mitre.org/techniques/T1071/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires the use of the `auditd_manager` integration. `Auditd_manager` is a tool designed to simplify and enhance the management of the audit subsystem in Linux systems. It provides a user-friendly interface and automation capabilities for configuring and monitoring system auditing through the auditd daemon. With `auditd_manager`, administrators can easily define audit rules, track system events, and generate comprehensive audit reports, improving overall security and compliance in the system. The following steps should be executed in order to install and deploy `auditd_manager` on a Linux system.\n```\nKibana -->\nManagement -->\nIntegrations -->\nAuditd Manager -->\nAdd Auditd Manager\n```\n`Auditd_manager` subscribes to the kernel and receives events as they occur without any additional configuration. However, if more advanced configuration is required to detect specific behavior, audit rules can be added to the integration in either the \"audit rules\" configuration box or the \"auditd rule files\" box by specifying a file to read the audit rules from.\nFor this detection rule to trigger, the following additional audit rules are required to be added to the integration:\n```\n-a always,exit -F arch=b64 -S mprotect\n```\nAdd the newly installed `auditd manager` to an agent policy, and deploy the agent on a Linux system from which auditd log files are desirable.\n",
        "related_integrations": [
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          },
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "auditd.data.a2",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "auditd.data.syscall",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pid",
            "type": "long",
            "ecs": true
          }
        ],
        "id": "8e03c886-81ff-4450-8bc6-48dbf691b85b",
        "rule_id": "32300431-c2d5-432d-8ec8-0e03f9924756",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.467Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.467Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sample by host.id, process.pid, process.name\n  /* auditd.data.a2 == \"7\" translates to RWX memory region protection (PROT_READ | PROT_WRITE | PROT_EXEC) */\n  [process where host.os.type == \"linux\" and auditd.data.syscall == \"mprotect\" and auditd.data.a2 == \"7\" and\n   not process.name == \"httpd\"]\n  [network where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"connection_attempted\" and\n   not cidrmatch(destination.ip, \"127.0.0.0/8\", \"169.254.0.0/16\", \"224.0.0.0/4\", \"::1\")]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Downloaded Shortcut Files",
        "description": "Identifies .lnk shortcut file downloaded from outside the local network. These shortcut files are commonly used in phishing campaigns.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1204",
                "name": "User Execution",
                "reference": "https://attack.mitre.org/techniques/T1204/",
                "subtechnique": [
                  {
                    "id": "T1204.002",
                    "name": "Malicious File",
                    "reference": "https://attack.mitre.org/techniques/T1204/002/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1566",
                "name": "Phishing",
                "reference": "https://attack.mitre.org/techniques/T1566/",
                "subtechnique": [
                  {
                    "id": "T1566.001",
                    "name": "Spearphishing Attachment",
                    "reference": "https://attack.mitre.org/techniques/T1566/001/"
                  },
                  {
                    "id": "T1566.002",
                    "name": "Spearphishing Link",
                    "reference": "https://attack.mitre.org/techniques/T1566/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.windows.zone_identifier",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "faf88fc8-d5b7-45aa-addb-00c03be1f89d",
        "rule_id": "39157d52-4035-44a8-9d1a-6f8c5f580a07",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.470Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.470Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"windows\" and event.type == \"creation\" and file.extension == \"lnk\" and file.Ext.windows.zone_identifier > 1\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file-*"
        ]
      },
      {
        "name": "Systemd Generator Created",
        "description": "This rule detects the creation of a systemd generator file. Generators are small executables executed by systemd at bootup and during configuration reloads. Their main role is to convert non-native configuration and execution parameters into dynamically generated unit files, symlinks, or drop-ins, extending the unit file hierarchy for the service manager. Systemd generators can be used to execute arbitrary code at boot time, which can be leveraged by attackers to maintain persistence on a Linux system.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://pberba.github.io/security/2022/02/07/linux-threat-hunting-for-persistence-systemd-generators/",
          "https://www.elastic.co/security-labs/primer-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/",
                "subtechnique": [
                  {
                    "id": "T1543.002",
                    "name": "Systemd Service",
                    "reference": "https://attack.mitre.org/techniques/T1543/002/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/",
                "subtechnique": [
                  {
                    "id": "T1543.002",
                    "name": "Systemd Service",
                    "reference": "https://attack.mitre.org/techniques/T1543/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.original.extension",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "9741c8e4-f0bf-4b55-827b-e07f648f06ba",
        "rule_id": "39c06367-b700-4380-848a-cab06e7afede",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.474Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.474Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.action in (\"rename\", \"creation\") and file.path : (\n\"/run/systemd/system-generators/*\", \"/etc/systemd/system-generators/*\",\n\"/usr/local/lib/systemd/system-generators/*\", \"/lib/systemd/system-generators/*\",\n\"/usr/lib/systemd/system-generators/*\", \"/etc/systemd/user-generators/*\",\n\"/usr/local/lib/systemd/user-generators/*\", \"/usr/lib/systemd/user-generators/*\",\n\"/lib/systemd/user-generators/*\"\n) and not (\n  process.executable in (\n    \"/bin/dpkg\", \"/usr/bin/dpkg\", \"/bin/dockerd\", \"/usr/bin/dockerd\", \"/usr/sbin/dockerd\", \"/bin/microdnf\",\n    \"/usr/bin/microdnf\", \"/bin/rpm\", \"/usr/bin/rpm\", \"/bin/snapd\", \"/usr/bin/snapd\", \"/bin/yum\", \"/usr/bin/yum\",\n    \"/bin/dnf\", \"/usr/bin/dnf\", \"/bin/podman\", \"/usr/bin/podman\", \"/bin/dnf-automatic\", \"/usr/bin/dnf-automatic\",\n    \"/bin/pacman\", \"/usr/bin/pacman\", \"/usr/bin/dpkg-divert\", \"/bin/dpkg-divert\", \"/sbin/apk\", \"/usr/sbin/apk\",\n    \"/usr/local/sbin/apk\", \"/usr/bin/apt\", \"/usr/sbin/pacman\", \"/bin/podman\", \"/usr/bin/podman\", \"/usr/bin/puppet\",\n    \"/bin/puppet\", \"/opt/puppetlabs/puppet/bin/puppet\", \"/usr/bin/chef-client\", \"/bin/chef-client\", \"/usr/sbin/sshd\",\n    \"/bin/autossl_check\", \"/usr/bin/autossl_check\", \"/proc/self/exe\", \"/dev/fd/*\",  \"/usr/bin/pamac-daemon\",\n    \"/bin/pamac-daemon\", \"/usr/lib/snapd/snapd\", \"/usr/local/bin/dockerd\", \"/usr/libexec/platform-python\"\n  ) or\n  file.extension in (\"swp\", \"swpx\", \"swx\", \"dpkg-remove\") or\n  file.Ext.original.extension == \"dpkg-new\" or\n  process.executable == null\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*"
        ]
      },
      {
        "name": "Rapid7 Threat Command CVEs Correlation",
        "description": "This rule is triggered when CVEs collected from the Rapid7 Threat Command Integration have a match against vulnerabilities that were found in the customer environment.",
        "risk_score": 99,
        "severity": "critical",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating Rapid7 Threat Command CVEs Correlation\n\nRapid7 Threat Command CVEs Correlation rule allows matching CVEs from user indices within the vulnerabilities collected from Rapid7 Threat Command integrations.\n\nThe matches will be based on the latest values of CVEs from the last 180 days. So it's essential to validate the data and review the results by investigating the associated activity to determine if it requires further investigation.\n\nIf a vulnerability matches a local observation, the following enriched fields will be generated to identify the vulnerability, field, and type matched.\n\n- `threat.indicator.matched.atomic` - this identifies the atomic vulnerability that matched the local observation\n- `threat.indicator.matched.field` - this identifies the vulnerability field that matched the local observation\n- `threat.indicator.matched.type` - this identifies the vulnerability type that matched the local observation\n\nAdditional investigation can be done by reviewing the source of the activity and considering the history of the vulnerability that was matched. This can help understand if the activity is related to legitimate behavior.\n\n- Investigation can be validated and reviewed based on the data that was matched and by viewing the source of that activity.\n- Consider the history of the vulnerability that was matched. Has it happened before? Is it happening on multiple machines? These kinds of questions can help understand if the activity is related to legitimate behavior.\n- Consider the user and their role within the company: is this something related to their job or work function?\n",
        "output_index": "",
        "version": 103,
        "tags": [
          "OS: Windows",
          "Data Source: Elastic Endgame",
          "Data Source: Windows",
          "Data Source: Network",
          "Data Source: Rapid7 Threat Command",
          "Rule Type: Threat Match",
          "Resources: Investigation Guide",
          "Use Case: Vulnerability",
          "Use Case: Asset Visibility",
          "Use Case: Continuous Monitoring"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "30m",
        "from": "now-35m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-threatintel.html",
          "https://docs.elastic.co/integrations/ti_rapid7_threat_command"
        ],
        "max_signals": 10000,
        "threat": [],
        "setup": "\n## Setup\n\nThis rule needs threat intelligence indicators to work.\nThreat intelligence indicators can be collected using an [Elastic Agent integration](https://www.elastic.co/guide/en/security/current/es-threat-intel-integrations.html#agent-ti-integration),\nthe [Threat Intel module](https://www.elastic.co/guide/en/security/current/es-threat-intel-integrations.html#ti-mod-integration),\nor a [custom integration](https://www.elastic.co/guide/en/security/current/es-threat-intel-integrations.html#custom-ti-integration).\n\nMore information can be found [here](https://www.elastic.co/guide/en/security/current/es-threat-intel-integrations.html).\n\n## Max Signals\n\nThis rule is configured to generate more **Max alerts per run** than the default 1000 alerts per run set for all rules. This is to ensure that it captures as many alerts as possible.\n\n**IMPORTANT:** The rule's **Max alerts per run** setting can be superseded by the `xpack.alerting.rules.run.alerts.max` Kibana config setting, which determines the maximum alerts generated by _any_ rule in the Kibana alerting framework. For example, if `xpack.alerting.rules.run.alerts.max` is set to 1000, this rule will still generate no more than 1000 alerts even if its own **Max alerts per run** is set higher.\n\nTo make sure this rule can generate as many alerts as it's configured in its own **Max alerts per run** setting, increase the `xpack.alerting.rules.run.alerts.max` system setting accordingly.\n\n**NOTE:** Changing `xpack.alerting.rules.run.alerts.max` is not possible in Serverless projects.\n",
        "related_integrations": [
          {
            "package": "ti_rapid7_threat_command",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "vulnerability.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "4607ed06-d10f-4bb4-bdf3-1494b4d1815f",
        "rule_id": "3a657da0-1df2-11ef-a327-f661ea17fbcc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.477Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.477Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "threat_match",
        "query": "vulnerability.id : *\n",
        "threat_query": "@timestamp >= \"now-30d/d\" and vulnerability.id : * and event.module: ti_rapid7_threat_command",
        "threat_mapping": [
          {
            "entries": [
              {
                "field": "vulnerability.id",
                "type": "mapping",
                "value": "vulnerability.id"
              }
            ]
          }
        ],
        "threat_index": [
          "logs-ti_rapid7_threat_command_latest.vulnerability"
        ],
        "index": [
          "auditbeat-*",
          "endgame-*",
          "filebeat-*",
          "logs-*",
          "packetbeat-*",
          "winlogbeat-*"
        ],
        "filters": [
          {
            "$state": {
              "store": "appState"
            },
            "meta": {
              "disabled": false,
              "key": "rapid7.tc.vulnerability.id",
              "negate": true,
              "type": "exists"
            },
            "query": {
              "exists": {
                "field": "rapid7.tc.vulnerability.id"
              }
            }
          }
        ],
        "threat_indicator_path": "rapid7.tc.vulnerability",
        "threat_language": "kuery",
        "language": "kuery"
      },
      {
        "name": "Potential Remote File Execution via MSIEXEC",
        "description": "Identifies the execution of the built-in Windows Installer, msiexec.exe, to install a remote package. Adversaries may abuse msiexec.exe to launch local or network accessible MSI files.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Initial Access",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1566",
                "name": "Phishing",
                "reference": "https://attack.mitre.org/techniques/T1566/",
                "subtechnique": [
                  {
                    "id": "T1566.002",
                    "name": "Spearphishing Link",
                    "reference": "https://attack.mitre.org/techniques/T1566/002/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/",
                "subtechnique": [
                  {
                    "id": "T1218.007",
                    "name": "Msiexec",
                    "reference": "https://attack.mitre.org/techniques/T1218/007/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.Ext.token.integrity_level_name",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.subject_name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "ee9025a6-6f0d-41aa-a402-601b7e22a397",
        "rule_id": "3e441bdb-596c-44fd-8628-2cfdf4516ada",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.480Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.480Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence with maxspan=1m\n [process where host.os.type == \"windows\" and event.action == \"start\" and\n    process.name : \"msiexec.exe\" and process.args : \"/V\"] by process.entity_id\n [network where host.os.type == \"windows\" and process.name : \"msiexec.exe\" and\n    event.action == \"connection_attempted\"] by process.entity_id\n [process where host.os.type == \"windows\" and event.action == \"start\" and\n  process.parent.name : \"msiexec.exe\" and user.id : (\"S-1-5-21-*\", \"S-1-5-12-1-*\") and\n  not process.executable : (\"?:\\\\Windows\\\\SysWOW64\\\\msiexec.exe\",\n                            \"?:\\\\Windows\\\\System32\\\\msiexec.exe\",\n                            \"?:\\\\Windows\\\\System32\\\\srtasks.exe\",\n                            \"?:\\\\Windows\\\\SysWOW64\\\\srtasks.exe\",\n                            \"?:\\\\Windows\\\\System32\\\\taskkill.exe\",\n                            \"?:\\\\Windows\\\\Installer\\\\MSI*.tmp\",\n                            \"?:\\\\Program Files\\\\*.exe\",\n                            \"?:\\\\Program Files (x86)\\\\*.exe\",\n                            \"?:\\\\Windows\\\\System32\\\\ie4uinit.exe\",\n                            \"?:\\\\Windows\\\\SysWOW64\\\\ie4uinit.exe\",\n                            \"?:\\\\Windows\\\\System32\\\\sc.exe\",\n                            \"?:\\\\Windows\\\\system32\\\\Wbem\\\\mofcomp.exe\",\n                            \"?:\\\\Windows\\\\twain_32\\\\fjscan32\\\\SOP\\\\crtdmprc.exe\",\n                            \"?:\\\\Windows\\\\SysWOW64\\\\taskkill.exe\",\n                            \"?:\\\\Windows\\\\SysWOW64\\\\schtasks.exe\",\n                            \"?:\\\\Windows\\\\system32\\\\schtasks.exe\",\n                            \"?:\\\\Windows\\\\System32\\\\sdbinst.exe\") and\n  not (process.code_signature.subject_name == \"Citrix Systems, Inc.\" and process.code_signature.trusted == true) and\n  not (process.name : (\"regsvr32.exe\", \"powershell.exe\", \"rundll32.exe\", \"wscript.exe\") and\n       process.Ext.token.integrity_level_name == \"high\" and\n       process.args : (\"?:\\\\Program Files\\\\*\", \"?:\\\\Program Files (x86)\\\\*\")) and\n  not (process.executable : (\"?:\\\\Program Files\\\\*.exe\", \"?:\\\\Program Files (x86)\\\\*.exe\") and process.code_signature.trusted == true) and\n  not (process.name : \"rundll32.exe\" and process.args : \"printui.dll,PrintUIEntry\")\n  ] by process.parent.entity_id\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-endpoint.events.network-*"
        ]
      },
      {
        "name": "DNF Package Manager Plugin File Creation",
        "description": "Detects file creation events in the plugin directories for the Yum package manager. In Linux, DNF (Dandified YUM) is a command-line utility used for handling packages on Fedora-based systems, providing functions for installing, updating, upgrading, and removing software along with managing package repositories. Attackers can backdoor DNF to gain persistence by injecting malicious code into plugins that DNF runs, thereby ensuring continued unauthorized access or control each time DNF is used for package management.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://pwnshift.github.io/2020/10/01/persistence.html",
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/"
              },
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/",
                "subtechnique": [
                  {
                    "id": "T1546.016",
                    "name": "Installer Packages",
                    "reference": "https://attack.mitre.org/techniques/T1546/016/"
                  }
                ]
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\n\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\n\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "08e03adb-ac71-4924-a198-c1a46aed8476",
        "rule_id": "3fe4e20c-a600-4a86-9d98-3ecb1ef23550",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.484Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.484Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.action in (\"rename\", \"creation\") and\nfile.path : (\"/usr/lib/python*/site-packages/dnf-plugins/*\", \"/etc/dnf/plugins/*\") and not (\n  process.executable in (\n    \"/bin/dockerd\", \"/usr/bin/dockerd\", \"/usr/sbin/dockerd\", \"/bin/microdnf\", \"/usr/bin/microdnf\", \"/bin/rpm\",\n    \"/usr/bin/rpm\", \"/bin/snapd\", \"/usr/bin/snapd\", \"/bin/yum\", \"/usr/bin/yum\", \"/bin/dnf\", \"/usr/bin/dnf\",\n    \"/bin/podman\", \"/usr/bin/podman\", \"/bin/dnf-automatic\", \"/usr/bin/dnf-automatic\", \"/sbin/apk\", \"/usr/sbin/apk\",\n    \"/usr/local/sbin/apk\", \"/bin/podman\", \"/usr/bin/podman\", \"/usr/bin/puppet\", \"/bin/puppet\",\n    \"/opt/puppetlabs/puppet/bin/puppet\", \"/usr/bin/chef-client\", \"/bin/chef-client\", \"/bin/autossl_check\",\n    \"/usr/bin/autossl_check\", \"/proc/self/exe\", \"/dev/fd/*\", \"/usr/lib/snapd/snapd\", \"/usr/local/bin/dockerd\",\n    \"/usr/libexec/netplan/generate\"\n  ) or\n  file.extension in (\"swp\", \"swpx\", \"swx\") or\n  process.executable : (\n    \"/nix/store/*\", \"/var/lib/dpkg/*\", \"/tmp/vmis.*\", \"/snap/*\", \"/dev/fd/*\", \"/usr/lib/*\", \"/usr/libexec/*\",\n    \"/etc/kernel/*\"\n  ) or\n  process.executable == null or\n  (process.name == \"sed\" and file.name : \"sed*\") or\n  (process.name == \"perl\" and file.name : \"e2scrub_all.tmp*\") \n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*"
        ]
      },
      {
        "name": "Unix Socket Connection",
        "description": "This rule monitors for inter-process communication via Unix sockets. Adversaries may attempt to communicate with local Unix sockets to enumerate application details, find vulnerabilities/configuration mistakes and potentially escalate privileges or set up malicious communication channels via Unix sockets for inter-process communication to attempt to evade detection.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1559",
                "name": "Inter-Process Communication",
                "reference": "https://attack.mitre.org/techniques/T1559/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "3f7a6e21-8313-491b-9899-6c9b9ab7f3dd",
        "rule_id": "41284ba3-ed1a-4598-bfba-a97f75d9aba2",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.496Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.496Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\", \"executed\", \"process_started\")\n and (\n  (process.name in (\"nc\", \"ncat\", \"netcat\", \"nc.openbsd\") and \n   process.args == \"-U\" and process.args : (\"/usr/local/*\", \"/run/*\", \"/var/run/*\")) or\n  (process.name == \"socat\" and \n   process.args == \"-\" and process.args : (\"UNIX-CLIENT:/usr/local/*\", \"UNIX-CLIENT:/run/*\", \"UNIX-CLIENT:/var/run/*\"))\n) and\nnot process.args == \"/var/run/libvirt/libvirt-sock\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Remote XSL Script Execution via COM",
        "description": "Identifies the execution of a hosted XSL script using the Microsoft.XMLDOM COM interface via Microsoft Office processes. This behavior may indicate adversarial activity to execute malicious JScript or VBScript on the system.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Initial Access",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1566",
                "name": "Phishing",
                "reference": "https://attack.mitre.org/techniques/T1566/",
                "subtechnique": [
                  {
                    "id": "T1566.002",
                    "name": "Spearphishing Link",
                    "reference": "https://attack.mitre.org/techniques/T1566/002/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1220",
                "name": "XSL Script Processing",
                "reference": "https://attack.mitre.org/techniques/T1220/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "dll.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "7df40c2c-f3a6-4e66-9229-da25b8b4c894",
        "rule_id": "48f657ee-de4f-477c-aa99-ed88ee7af97a",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.499Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.499Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence with maxspan=1m\n [library where host.os.type == \"windows\" and dll.name : \"msxml3.dll\" and\n  process.name : (\"winword.exe\", \"excel.exe\", \"powerpnt.exe\", \"mspub.exe\")] by process.entity_id\n [process where host.os.type == \"windows\" and event.action == \"start\" and\n  process.parent.name : (\"winword.exe\", \"excel.exe\", \"powerpnt.exe\", \"mspub.exe\") and \n  not process.executable :\n        (\"?:\\\\Windows\\\\System32\\\\WerFault.exe\",\n         \"?:\\\\Windows\\\\SysWoW64\\\\WerFault.exe\",\n         \"?:\\\\windows\\\\splwow64.exe\",\n         \"?:\\\\Windows\\\\System32\\\\conhost.exe\",\n         \"?:\\\\Program Files\\\\*.exe\",\n         \"?:\\\\Program Files (x86)\\\\*exe\")] by process.parent.entity_id\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-endpoint.events.library-*"
        ]
      },
      {
        "name": "Hidden Files and Directories via Hidden Flag",
        "description": "Identify activity related where adversaries can add the 'hidden' flag to files to hide them from the user in an attempt to evade detection.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "OS: macOS",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1564",
                "name": "Hide Artifacts",
                "reference": "https://attack.mitre.org/techniques/T1564/",
                "subtechnique": [
                  {
                    "id": "T1564.001",
                    "name": "Hidden Files and Directories",
                    "reference": "https://attack.mitre.org/techniques/T1564/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "4ba11878-b580-4ff1-aa31-14d35b279386",
        "rule_id": "5124e65f-df97-4471-8dcb-8e3953b3ea97",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.502Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.502Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.type == \"creation\" and process.name == \"chflags\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "PowerShell Script with Veeam Credential Access Capabilities",
        "description": "Identifies PowerShell scripts that can access and decrypt Veeam credentials stored in MSSQL databases. Attackers can use Veeam Credentials to target backups as part of destructive operations such as Ransomware attacks.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 103,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: PowerShell Logs"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://forums.veeam.com/veeam-backup-replication-f2/recover-esxi-password-in-veeam-t34630.html",
          "https://www.crowdstrike.com/blog/anatomy-of-alpha-spider-ransomware/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1003",
                "name": "OS Credential Dumping",
                "reference": "https://attack.mitre.org/techniques/T1003/"
              },
              {
                "id": "T1555",
                "name": "Credentials from Password Stores",
                "reference": "https://attack.mitre.org/techniques/T1555/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.001",
                    "name": "PowerShell",
                    "reference": "https://attack.mitre.org/techniques/T1059/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe 'PowerShell Script Block Logging' logging policy must be enabled.\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nAdministrative Templates >\nWindows PowerShell >\nTurn on PowerShell Script Block Logging (Enable)\n```\n\nSteps to implement the logging policy via registry:\n\n```\nreg add \"hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\" /v EnableScriptBlockLogging /t REG_DWORD /d 1\n```\n",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "powershell.file.script_block_text",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "ecc07c64-90fa-47ac-b83e-40fd23ef6615",
        "rule_id": "5c602cba-ae00-4488-845d-24de2b6d8055",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.506Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.506Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "winlogbeat-*",
          "logs-windows.powershell*"
        ],
        "query": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    (\n      \"[dbo].[Credentials]\" and\n      (\"Veeam\" or \"VeeamBackup\")\n    ) or\n    \"ProtectedStorage]::GetLocalString\"\n  )\n",
        "language": "kuery"
      },
      {
        "name": "Network Connection Initiated by SSHD Child Process",
        "description": "This rule identifies an egress internet connection initiated by an SSH Daemon child process. This behavior is indicative of the alteration of a shell configuration file or other mechanism that launches a process when a new SSH login occurs. Attackers can also backdoor the SSH daemon to allow for persistence, call out to a C2 or to steal credentials.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://hadess.io/the-art-of-linux-persistence/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/",
                "subtechnique": [
                  {
                    "id": "T1546.004",
                    "name": "Unix Shell Configuration Modification",
                    "reference": "https://attack.mitre.org/techniques/T1546/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1021",
                "name": "Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1021/",
                "subtechnique": [
                  {
                    "id": "T1021.004",
                    "name": "SSH",
                    "reference": "https://attack.mitre.org/techniques/T1021/004/"
                  }
                ]
              },
              {
                "id": "T1563",
                "name": "Remote Service Session Hijacking",
                "reference": "https://attack.mitre.org/techniques/T1563/",
                "subtechnique": [
                  {
                    "id": "T1563.001",
                    "name": "SSH Hijacking",
                    "reference": "https://attack.mitre.org/techniques/T1563/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": []
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "c2bf68f2-cfb7-4d77-b965-23a2c935598a",
        "rule_id": "63431796-f813-43af-820b-492ee2efec8e",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.509Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.509Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id with maxspan=1s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.parent.executable == \"/usr/sbin/sshd\"] by process.entity_id\n  [network where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"connection_attempted\" and not (\n     destination.ip == null or destination.ip == \"0.0.0.0\" or cidrmatch(\n     destination.ip, \"10.0.0.0/8\", \"127.0.0.0/8\", \"169.254.0.0/16\", \"172.16.0.0/12\", \"192.0.0.0/24\", \"192.0.0.0/29\",\n     \"192.0.0.8/32\", \"192.0.0.9/32\", \"192.0.0.10/32\", \"192.0.0.170/32\", \"192.0.0.171/32\", \"192.0.2.0/24\",\n     \"192.31.196.0/24\", \"192.52.193.0/24\", \"192.168.0.0/16\", \"192.88.99.0/24\", \"224.0.0.0/4\", \"100.64.0.0/10\",\n     \"192.175.48.0/24\",\"198.18.0.0/15\", \"198.51.100.0/24\", \"203.0.113.0/24\", \"240.0.0.0/4\", \"::1\", \"FE80::/10\",\n     \"FF00::/8\", \"172.31.0.0/16\"\n     )\n    ) and not (\n      process.executable in (\"/bin/yum\", \"/usr/bin/yum\") or\n      process.name in (\"login_duo\", \"ssh\", \"sshd\", \"sshd-session\")\n    )\n  ] by process.parent.entity_id\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Linux Process Hooking via GDB",
        "description": "This rule monitors for potential memory dumping through gdb. Attackers may leverage memory dumping techniques to attempt secret extraction from privileged processes. Tools that display this behavior include \"truffleproc\" and \"bash-memory-dump\". This behavior should not happen by default, and should be investigated thoroughly.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/controlplaneio/truffleproc",
          "https://github.com/hajzer/bash-memory-dump"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1003",
                "name": "OS Credential Dumping",
                "reference": "https://attack.mitre.org/techniques/T1003/",
                "subtechnique": [
                  {
                    "id": "T1003.007",
                    "name": "Proc Filesystem",
                    "reference": "https://attack.mitre.org/techniques/T1003/007/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d88ca307-9b4c-4943-914f-32ff7479cc02",
        "rule_id": "66c058f3-99f4-4d18-952b-43348f2577a0",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.512Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.512Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\", \"executed\", \"process_started\")\n and process.name == \"gdb\" and process.args in (\"--pid\", \"-p\") and \n/* Covered by d4ff2f53-c802-4d2e-9fb9-9ecc08356c3f */\nprocess.args != \"1\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Suspicious Access to LDAP Attributes",
        "description": "Identify read access to a high number of Active Directory object attributes. The knowledge of objects properties can help adversaries find vulnerabilities, elevate privileges or collect sensitive information.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 102,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Data Source: System",
          "Data Source: Active Directory",
          "Data Source: Windows"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1069",
                "name": "Permission Groups Discovery",
                "reference": "https://attack.mitre.org/techniques/T1069/"
              }
            ]
          }
        ],
        "setup": "The 'Audit Directory Service Changes' logging policy must be configured for (Success, Failure).\nSteps to implement the logging policy with Advanced Audit Configuration:\n\nComputer Configuration >\nPolicies >\nWindows Settings >\nSecurity Settings >\nAdvanced Audit Policies Configuration >\nAudit Policies >\nDS Access >\nAudit Directory Service Changes (Success,Failure)\n",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.code",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "winlog.event_data.AccessMaskDescription",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "winlog.event_data.Properties",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "winlog.event_data.SubjectUserSid",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "93061585-47ae-4e9f-92a5-30614d44931b",
        "rule_id": "68ad737b-f90a-4fe5-bda6-a68fa460044e",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.515Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.515Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where event.action in (\"Directory Service Access\", \"object-operation-performed\") and\n event.code == \"4662\" and not winlog.event_data.SubjectUserSid : \"S-1-5-18\" and\n winlog.event_data.AccessMaskDescription == \"Read Property\" and length(winlog.event_data.Properties) >= 2000\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-system.security*",
          "logs-windows.forwarded*"
        ]
      },
      {
        "name": "Active Directory Group Modification by SYSTEM",
        "description": "Identifies a user being added to an active directory group by the SYSTEM (S-1-5-18) user. This behavior can indicate that the attacker has achieved SYSTEM privileges in a domain controller, which attackers can obtain by exploiting vulnerabilities or abusing default group privileges (e.g., Server Operators), and is attempting to pivot to a domain account.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 102,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Use Case: Active Directory Monitoring",
          "Data Source: Active Directory",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.code",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "group.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "winlog.api",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "winlog.event_data.SubjectUserSid",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "af179271-550e-481e-a169-922b329088f0",
        "rule_id": "6f024bde-7085-489b-8250-5957efdf1caf",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.518Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.518Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "iam where winlog.api == \"wineventlog\" and event.code == \"4728\" and\nwinlog.event_data.SubjectUserSid : \"S-1-5-18\" and\n\n/* DOMAIN_USERS and local groups */\nnot group.id : \"S-1-5-21-*-513\"\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-system.security*",
          "logs-windows.forwarded*"
        ]
      },
      {
        "name": "Suspicious Execution via MSIEXEC",
        "description": "Identifies suspicious execution of the built-in Windows Installer, msiexec.exe, to install a package from usual paths or parent process. Adversaries may abuse msiexec.exe to launch malicious local MSI files.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 103,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Rule Type: BBR",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://lolbas-project.github.io/lolbas/Binaries/Msiexec/",
          "https://www.guardicore.com/labs/purple-fox-rootkit-now-propagates-as-a-worm/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/",
                "subtechnique": [
                  {
                    "id": "T1218.007",
                    "name": "Msiexec",
                    "reference": "https://attack.mitre.org/techniques/T1218/007/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.parent.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.working_directory",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "6208d272-2e12-48bf-ad00-cb71a7946022",
        "rule_id": "708c9d92-22a3-4fe0-b6b9-1f861c55502d",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.522Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.522Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.action == \"start\" and\n  process.name : \"msiexec.exe\" and user.id : (\"S-1-5-21*\", \"S-1-12-*\") and process.parent.executable != null and\n  (\n    (process.args : \"/i\" and process.args : (\"/q\", \"/quiet\") and process.args_count == 4 and\n     process.args : (\"?:\\\\Users\\\\*\", \"?:\\\\ProgramData\\\\*\") and\n     not process.parent.executable : (\"?:\\\\Program Files (x86)\\\\*.exe\",\n                                      \"?:\\\\Program Files\\\\*.exe\",\n                                      \"?:\\\\Windows\\\\explorer.exe\",\n                                      \"?:\\\\Users\\\\*\\\\Desktop\\\\*\",\n                                      \"?:\\\\Users\\\\*\\\\Downloads\\\\*\",\n                                      \"?:\\\\programdata\\\\*\")) or\n\n    (process.args_count == 1 and not process.parent.executable : (\"?:\\\\Windows\\\\explorer.exe\", \"?:\\\\Windows\\\\SysWOW64\\\\explorer.exe\")) or\n\n    (process.args : \"/i\" and process.args : (\"/q\", \"/quiet\") and process.args_count == 4 and\n     (process.parent.args : \"Schedule\" or process.parent.name : \"wmiprvse.exe\" or\n     process.parent.executable : \"?:\\\\Users\\\\*\\\\AppData\\\\*\" or\n     (process.parent.name : (\"powershell.exe\", \"cmd.exe\") and length(process.parent.command_line) >= 200))) or\n\n    (process.args : \"/i\" and process.args : (\"/q\", \"/quiet\") and process.args_count == 4 and\n     ?process.working_directory : \"?:\\\\\" and process.parent.name : (\"cmd.exe\", \"powershell.exe\"))\n  ) and\n\n  /* noisy pattern */\n  not (process.parent.executable : \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\*\" and ?process.parent.args_count >= 2 and\n       process.args : \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\*\\\\*.msi\") and\n\n  not process.args : (\"?:\\\\Program Files (x86)\\\\*\", \"?:\\\\Program Files\\\\*\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "winlogbeat-*",
          "logs-windows.*",
          "endgame-*"
        ]
      },
      {
        "name": "Suspicious Passwd File Event Action",
        "description": "Monitors for the generation of a passwd password entry via openssl, followed by a file write activity on the \"/etc/passwd\" file. The \"/etc/passwd\" file in Linux stores user account information, including usernames, user IDs, group IDs, home directories, and default shell paths. Attackers may exploit a misconfiguration in the \"/etc/passwd\" file permissions or other privileges to add a new entry to the \"/etc/passwd\" file with root permissions, and leverage this new user account to login as root.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Data Source: Auditd Manager",
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend and Auditd Manager.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows\nthe Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest to select \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n### Auditd Manager Integration Setup\nThe Auditd Manager Integration receives audit events from the Linux Audit Framework which is a part of the Linux kernel.\nAuditd Manager provides a user-friendly interface and automation capabilities for configuring and monitoring system auditing through the auditd daemon. With `auditd_manager`, administrators can easily define audit rules, track system events, and generate comprehensive audit reports, improving overall security and compliance in the system.\n\n#### The following steps should be executed in order to add the Elastic Agent System integration \"auditd_manager\" on a Linux System:\n- Go to the Kibana home page and click “Add integrations”.\n- In the query bar, search for “Auditd Manager” and select the integration to see more details about it.\n- Click “Add Auditd Manager”.\n- Configure the integration name and optionally add a description.\n- Review optional and advanced settings accordingly.\n- Add the newly installed “auditd manager” to an existing or a new agent policy, and deploy the agent on a Linux system from which auditd log files are desirable.\n- Click “Save and Continue”.\n- For more details on the integration refer to the [helper guide](https://docs.elastic.co/integrations/auditd_manager).\n\n#### Rule Specific Setup Note\nAuditd Manager subscribes to the kernel and receives events as they occur without any additional configuration.\nHowever, if more advanced configuration is required to detect specific behavior, audit rules can be added to the integration in either the \"audit rules\" configuration box or the \"auditd rule files\" box by specifying a file to read the audit rules from.\n- For this detection rule the following additional audit rules are required to be added to the integration:\n  -- \"-w /etc/passwd -p wa -k etcpasswd\"\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "auditd.data.a2",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.pid",
            "type": "long",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "5ca4862b-1525-4e65-a224-f01d91c98404",
        "rule_id": "71d6a53d-abbd-40df-afee-c21fff6aafb0",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.525Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.525Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, process.parent.pid with maxspan=1m\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.name == \"openssl\" and process.args == \"passwd\" and user.id != \"0\"]\n  [file where host.os.type == \"linux\" and file.path == \"/etc/passwd\" and process.parent.pid != 1 and\n   not auditd.data.a2 == \"80000\" and event.outcome == \"success\" and user.id != \"0\"]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Service Disabled via Registry Modification",
        "description": "Identifies attempts to modify services start settings using processes other than services.exe. Attackers may attempt to modify security and monitoring services to avoid detection or delay response.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1112",
                "name": "Modify Registry",
                "reference": "https://attack.mitre.org/techniques/T1112/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1489",
                "name": "Service Stop",
                "reference": "https://attack.mitre.org/techniques/T1489/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "registry.data.strings",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "registry.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "31a5dd64-e74c-4d32-85a6-fdef3b142cff",
        "rule_id": "75dcb176-a575-4e33-a020-4a52aaa1b593",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.528Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.528Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "registry where host.os.type == \"windows\" and event.type == \"change\" and\n  registry.path : (\n    \"HKLM\\\\SYSTEM\\\\*ControlSet*\\\\Services\\\\*\\\\Start\",\n    \"\\\\REGISTRY\\\\MACHINE\\\\SYSTEM\\\\*ControlSet*\\\\Services\\\\*\\\\Start\"\n  ) and registry.data.strings : (\"3\", \"4\") and\n  not \n    (\n      process.name : \"services.exe\" and user.id : \"S-1-5-18\"\n    )\n  and not registry.path : \"HKLM\\\\SYSTEM\\\\ControlSet001\\\\Services\\\\MrxSmb10\\\\Start\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.registry-*",
          "endgame-*"
        ]
      },
      {
        "name": "Suspicious File Renamed via SMB",
        "description": "Identifies an incoming SMB connection followed by a suspicious file rename operation. This may indicate a remote ransomware attack via the SMB protocol.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n## Performance\n\n- This rule may cause medium to high performance impact due to logic scoping all icoming SMB network events.\n\n#### Possible investigation steps\n\n- Investigate the source.ip address connecting to port 445 on this host.\n- Identify the user account that performed the file creation via SMB.\n- If the number of files is too high and source.ip connecting over SMB is unusual isolate the host and block the used credentials.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n\n### False positive analysis\n\n- Remote file rename over SMB.\n\n### Related rules\n\n- Third-party Backup Files Deleted via Unexpected Process - 11ea6bec-ebde-4d71-a8e9-784948f8e3e9\n- Volume Shadow Copy Deleted or Resized via VssAdmin - b5ea4bfe-a1b2-421f-9d47-22a75a6f2921\n- Volume Shadow Copy Deletion via PowerShell - d99a037b-c8e2-47a5-97b9-170d076827c4\n- Volume Shadow Copy Deletion via WMIC - dc9c1f74-dac3-48e3-b47f-eb79db358f57\n- Potential Ransomware Note File Dropped via SMB - 02bab13d-fb14-4d7c-b6fe-4a28874d37c5\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Consider isolating the involved host to prevent destructive behavior, which is commonly associated with this activity.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- If any other destructive action was identified on the host, it is recommended to prioritize the investigation and look for ransomware preparation and execution activities.\n- If any backups were affected:\n  - Perform data recovery locally or restore the backups from replicated copies (cloud, other servers, etc.).\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Impact",
          "Resources: Investigation Guide",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://news.sophos.com/en-us/2023/12/21/akira-again-the-ransomware-that-keeps-on-taking/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1485",
                "name": "Data Destruction",
                "reference": "https://attack.mitre.org/techniques/T1485/"
              },
              {
                "id": "T1490",
                "name": "Inhibit System Recovery",
                "reference": "https://attack.mitre.org/techniques/T1490/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1021",
                "name": "Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1021/",
                "subtechnique": [
                  {
                    "id": "T1021.002",
                    "name": "SMB/Windows Admin Shares",
                    "reference": "https://attack.mitre.org/techniques/T1021/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.address",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "destination.port",
            "type": "long",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.entropy",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.Ext.original.name",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "network.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pid",
            "type": "long",
            "ecs": true
          },
          {
            "name": "source.address",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "source.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "source.port",
            "type": "long",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "cafda3e9-4cfb-41ed-9c4c-14f1233b7dc7",
        "rule_id": "78e9b5d5-7c07-40a7-a591-3dbbf464c386",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.531Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.531Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id with maxspan=1s\n [network where host.os.type == \"windows\" and\n  event.action == \"connection_accepted\" and destination.port == 445 and source.port >= 49152 and process.pid == 4 and\n  source.ip != \"127.0.0.1\" and source.ip != \"::1\" and\n  network.type == \"ipv4\" and not endswith(source.address, destination.address)]\n [file where host.os.type == \"windows\" and\n  event.action == \"rename\" and process.pid == 4 and user.id : (\"S-1-5-21*\", \"S-1-12-*\") and\n  file.extension != null and file.Ext.entropy >= 6 and file.path : \"C:\\\\Users\\\\*\" and\n  file.Ext.original.name : (\"*.jpg\", \"*.bmp\", \"*.png\", \"*.pdf\", \"*.doc\", \"*.docx\", \"*.xls\", \"*.xlsx\", \"*.ppt\", \"*.pptx\", \"*.lnk\") and\n  not file.extension : (\"jpg\", \"bmp\", \"png\", \"pdf\", \"doc\", \"docx\", \"xls\", \"xlsx\", \"ppt\", \"pptx\", \"*.lnk\")] with runs=3\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "SSH Key Generated via ssh-keygen",
        "description": "This rule identifies the creation of SSH keys using the ssh-keygen tool, which is the standard utility for generating SSH keys. Users often create SSH keys for authentication with remote services. However, threat actors can exploit this tool to move laterally across a network or maintain persistence by generating unauthorized SSH keys, granting them SSH access to systems.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Lateral Movement",
          "Tactic: Persistence",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/primer-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.004",
                    "name": "SSH Authorized Keys",
                    "reference": "https://attack.mitre.org/techniques/T1098/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1021",
                "name": "Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1021/",
                "subtechnique": [
                  {
                    "id": "T1021.004",
                    "name": "SSH",
                    "reference": "https://attack.mitre.org/techniques/T1021/004/"
                  }
                ]
              },
              {
                "id": "T1563",
                "name": "Remote Service Session Hijacking",
                "reference": "https://attack.mitre.org/techniques/T1563/",
                "subtechnique": [
                  {
                    "id": "T1563.001",
                    "name": "SSH Hijacking",
                    "reference": "https://attack.mitre.org/techniques/T1563/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "1ec72e2b-a37d-441a-bd5a-681baf784aff",
        "rule_id": "7df3cb8b-5c0c-4228-b772-bb6cd619053c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.534Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.534Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.action in (\"creation\", \"file_create_event\") and\nprocess.executable == \"/usr/bin/ssh-keygen\" and file.path : (\"/home/*/.ssh/*\", \"/root/.ssh/*\", \"/etc/ssh/*\") and\nnot file.name : \"known_hosts.*\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*",
          "endgame-*"
        ]
      },
      {
        "name": "Discovery of Internet Capabilities via Built-in Tools",
        "description": "Identifies the use of built-in tools attackers can use to check for Internet connectivity on compromised systems. These results may be used to determine communication capabilities with C2 servers, or to identify routes, redirectors, and proxy servers.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 102,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Rule Type: BBR",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1016",
                "name": "System Network Configuration Discovery",
                "reference": "https://attack.mitre.org/techniques/T1016/",
                "subtechnique": [
                  {
                    "id": "T1016.001",
                    "name": "Internet Connection Discovery",
                    "reference": "https://attack.mitre.org/techniques/T1016/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name.caseless",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "d9b9f954-9f2d-47cb-804f-ea752fd32a50",
        "rule_id": "7f89afef-9fc5-4e7b-bf16-75ffdf27f8db",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.546Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.546Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "host.os.type:windows and event.category:process and event.type:start and \nprocess.name.caseless:(\"ping.exe\" or \"tracert.exe\" or \"pathping.exe\") and\nnot process.args:(\"127.0.0.1\" or \"0.0.0.0\" or \"localhost\" or \"::1\")\n",
        "new_terms_fields": [
          "host.id",
          "user.id",
          "process.command_line"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-endpoint.events.*"
        ],
        "language": "kuery"
      },
      {
        "name": "Potential AWS S3 Bucket Ransomware Note Uploaded",
        "description": "Identifies potential ransomware note being uploaded to an AWS S3 bucket. This rule detects the `PutObject` S3 API call with a common ransomware note file extension such as `.ransom`, or `.lock`. Adversaries with access to a misconfigured S3 bucket may retrieve, delete, and replace objects with ransom notes to extort victims.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "\n## Triage and Analysis\n\n### Investigating Potential AWS S3 Bucket Ransomware Note Uploaded\n\nThis rule detects the `PutObject` S3 API call with a common ransomware note file extension such as `.ransom`, or `.lock`. Adversaries with access to a misconfigured S3 bucket may retrieve, delete, and replace objects with ransom notes to extort victims.\n\n#### Possible Investigation Steps:\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who performed the action. Verify if this actor typically performs such actions and if they have the necessary permissions.\n- **Review the Request Details**: Examine the `aws.cloudtrail.request_parameters` to understand the specific details of the `PutObject` action. Look for any unusual parameters that could suggest unauthorized or malicious modifications.\n- **Analyze the Source of the Request**: Investigate the `source.ip` and `source.geo` fields to determine the geographical origin of the request. An external or unexpected location might indicate compromised credentials or unauthorized access.\n- **Contextualize with Timestamp**: Use the `@timestamp` field to check when the ransom note was uploaded. Changes during non-business hours or outside regular maintenance windows might require further scrutiny.\n- **Inspect the Ransom Note**: Review the `aws.cloudtrail.request_parameters` for the `PutObject` action to identify the characteristics of the uploaded ransom note. Look for common ransomware file extensions such as `.txt`, `.note`, `.ransom`, or `.html`.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this action to see if the same actor or IP address engaged in other potentially suspicious activities.\n- **Check for Object Deletion or Access**: Look for `DeleteObject`, `DeleteObjects`, or `GetObject` API calls to the same S3 bucket that may indicate the adversary accessing and destroying objects before placing the ransom note.\n\n### False Positive Analysis:\n\n- **Legitimate Administrative Actions**: Confirm if the `PutObject` action aligns with scheduled updates, maintenance activities, or legitimate administrative tasks documented in change management systems.\n- **Consistency Check**: Compare the action against historical data of similar activities performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.\n- **Verify through Outcomes**: Check the `aws.cloudtrail.response_elements` and the `event.outcome` to confirm if the upload was successful and intended according to policy.\n\n### Response and Remediation:\n\n- **Immediate Review and Reversal if Necessary**: If the activity was unauthorized, remove the uploaded ransom notes from the S3 bucket and review the bucket's access logs for any suspicious activity.\n- **Enhance Monitoring and Alerts**: Adjust monitoring systems to alert on similar `PutObject` actions, especially those involving sensitive data or unusual file extensions.\n- **Educate and Train**: Provide additional training to users with administrative rights on the importance of security best practices concerning S3 bucket management and the risks of ransomware.\n- **Audit S3 Bucket Policies and Permissions**: Conduct a comprehensive audit of all S3 bucket policies and associated permissions to ensure they adhere to the principle of least privilege.\n- **Incident Response**: If there's an indication of malicious intent or a security breach, initiate the incident response protocol to mitigate any damage and prevent future occurrences.\n\n### Additional Information:\n\nFor further guidance on managing S3 bucket security and protecting against ransomware, refer to the [AWS S3 documentation](https://docs.aws.amazon.com/AmazonS3/latest/userguide/Welcome.html) and AWS best practices for security. Additionally, consult the following resources for specific details on S3 ransomware protection:\n- [ERMETIC REPORT - AWS S3 Ransomware Exposure in the Wild](https://s3.amazonaws.com/bizzabo.file.upload/PtZzA0eFQwV2RA5ysNeo_ERMETIC%20REPORT%20-%20AWS%20S3%20Ransomware%20Exposure%20in%20the%20Wild.pdf)\n- [AWS S3 Ransomware Batch Deletion](https://stratus-red-team.cloud/attack-techniques/AWS/aws.impact.s3-ransomware-batch-deletion/)\n- [S3 Ransomware Part 1: Attack Vector](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)\n",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS S3",
          "Use Case: Threat Detection",
          "Tactic: Impact"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Administrators may legitimately access, delete, and replace objects in S3 buckets. Ensure that the sequence of events is not part of a legitimate operation before taking action."
        ],
        "references": [
          "https://s3.amazonaws.com/bizzabo.file.upload/PtZzA0eFQwV2RA5ysNeo_ERMETIC%20REPORT%20-%20AWS%20S3%20Ransomware%20Exposure%20in%20the%20Wild.pdf",
          "https://stratus-red-team.cloud/attack-techniques/AWS/aws.impact.s3-ransomware-batch-deletion/",
          "https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1485",
                "name": "Data Destruction",
                "reference": "https://attack.mitre.org/techniques/T1485/"
              }
            ]
          }
        ],
        "setup": "AWS S3 data types need to be enabled in the CloudTrail trail configuration.",
        "related_integrations": [],
        "required_fields": [],
        "id": "680a6508-60c7-4228-a508-e35ae5fc059f",
        "rule_id": "7fda9bb2-fd28-11ee-85f9-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.550Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.550Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws.cloudtrail-*\n\n// any successful uploads via S3 API requests\n| where event.dataset == \"aws.cloudtrail\"\n    and event.provider == \"s3.amazonaws.com\"\n    and event.action == \"PutObject\"\n    and event.outcome == \"success\"\n\n// abstract object name from API request parameters\n| dissect aws.cloudtrail.request_parameters \"%{?ignore_values}key=%{object_name}}\"\n\n// regex on common ransomware note extensions\n| where object_name rlike \"(.*)(ransom|lock|crypt|enc|readme|how_to_decrypt|decrypt_instructions|recovery|datarescue)(.*)\"\n    and not object_name rlike \"(.*)(AWSLogs|CloudTrail|access-logs)(.*)\"\n\n// keep relevant fields\n| keep tls.client.server_name, aws.cloudtrail.user_identity.arn, object_name\n\n// aggregate by S3 bucket, resource and object name\n| stats note_upload_count = count(*) by tls.client.server_name, aws.cloudtrail.user_identity.arn, object_name\n\n// filter for single occurrence to eliminate common upload operations\n| where note_upload_count == 1\n"
      },
      {
        "name": "Potential PowerShell Obfuscated Script",
        "description": "Identifies scripts that contain patterns and known methods that obfuscate PowerShell code. Attackers can use obfuscation techniques to bypass PowerShell security protections such as Antimalware Scan Interface (AMSI).",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 103,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: PowerShell Logs"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/danielbohannon/Invoke-Obfuscation"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1027",
                "name": "Obfuscated Files or Information",
                "reference": "https://attack.mitre.org/techniques/T1027/"
              },
              {
                "id": "T1140",
                "name": "Deobfuscate/Decode Files or Information",
                "reference": "https://attack.mitre.org/techniques/T1140/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.001",
                    "name": "PowerShell",
                    "reference": "https://attack.mitre.org/techniques/T1059/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe 'PowerShell Script Block Logging' logging policy must be enabled.\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nAdministrative Templates >\nWindows PowerShell >\nTurn on PowerShell Script Block Logging (Enable)\n```\n\nSteps to implement the logging policy via registry:\n\n```\nreg add \"hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\" /v EnableScriptBlockLogging /t REG_DWORD /d 1\n```\n",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "powershell.file.script_block_text",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "e30166ef-10a2-4f2e-9d67-7657a248969f",
        "rule_id": "8025db49-c57c-4fc0-bd86-7ccd6d10a35a",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.553Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.553Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "winlogbeat-*",
          "logs-windows.powershell*"
        ],
        "query": "event.category:process and host.os.type:windows and\n  powershell.file.script_block_text : (\n    \"[string]::join\" or\n    \"-Join\" or\n    \"[convert]::toint16\" or\n    \"[char][int]$_\" or\n    (\"ConvertTo-SecureString\" and \"PtrToStringAuto\") or\n    \".GetNetworkCredential().password\" or\n    \"-BXor\" or\n    (\"replace\" and \"char\") or\n    \"[array]::reverse\"\n  ) and\n  powershell.file.script_block_text : (\n    (\"$pSHoMe[\" and \"+$pSHoMe[\") or\n    (\"$ShellId[\" and \"+$ShellId[\") or\n    (\"$env:ComSpec[4\" and \"25]-Join\") or\n    ((\"Set-Variable\" or \"SV\" or \"Set-Item\") and \"OFS\") or\n    (\"*MDR*\" and \"Name[3,11,2]\") or\n    (\"$VerbosePreference\" and \"[1,3]+'X'-Join''\") or\n    (\"rahc\" or \"ekovin\" or \"gnirts\" or \"ecnereferpesobrev\" or \"ecalper\" or \"cepsmoc\" or \"dillehs\")\n  )\n",
        "language": "kuery"
      },
      {
        "name": "Potential Upgrade of Non-interactive Shell",
        "description": "Identifies when a non-interactive terminal (tty) is being upgraded to a fully interactive shell. Attackers may upgrade a simple reverse shell to a fully interactive tty after obtaining initial access to a host, in order to obtain a more stable connection.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "e237f85f-aeab-406d-8b30-eba8ab1c3fef",
        "rule_id": "84d1f8db-207f-45ab-a578-921d91c23eb2",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.557Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.557Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and (\n  (process.name == \"stty\" and process.args == \"raw\" and process.args == \"-echo\" and process.args_count >= 3) or\n  (process.name == \"script\" and process.args in (\"-qc\", \"-c\") and process.args == \"/dev/null\" and \n   process.args_count == 4)\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "File with Suspicious Extension Downloaded",
        "description": "Identifies unusual files downloaded from outside the local network that have the potential to be abused for code execution.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://x.com/Laughing_Mantis/status/1518766501385318406",
          "https://wikileaks.org/ciav7p1/cms/page_13763375.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1566",
                "name": "Phishing",
                "reference": "https://attack.mitre.org/techniques/T1566/",
                "subtechnique": [
                  {
                    "id": "T1566.001",
                    "name": "Spearphishing Attachment",
                    "reference": "https://attack.mitre.org/techniques/T1566/001/"
                  },
                  {
                    "id": "T1566.002",
                    "name": "Spearphishing Link",
                    "reference": "https://attack.mitre.org/techniques/T1566/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.windows.zone_identifier",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "24560f35-d288-4868-98d0-734b8c179161",
        "rule_id": "8d366588-cbd6-43ba-95b4-0971c3f906e5",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.560Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.560Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"windows\" and event.type == \"creation\" and\n  file.extension : (\n    \"appinstaller\", \"application\", \"appx\", \"appxbundle\", \"cpl\", \"diagcab\", \"diagpkg\", \"diagcfg\", \"manifest\",\n    \"msix\", \"pif\", \"search-ms\", \"searchConnector-ms\", \"settingcontent-ms\", \"symlink\", \"theme\", \"themepack\" \n  ) and file.Ext.windows.zone_identifier > 1 and\n  not\n  (\n    (\n      file.extension : \"msix\" and \n      file.path : (\n        \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\WinGet\\\\Microsoft.Winget.Source*\",\n        \"?:\\\\Windows\\\\system32\\\\config\\\\systemprofile\\\\AppData\\\\Local\\\\Microsoft\\\\WinGet\\\\State\\\\defaultState\\\\Microsoft.PreIndexed.Package\\\\Microsoft.Winget.Source*\"\n      )\n    ) or\n    (\n      process.name : \"Teams.exe\" and process.code_signature.trusted == true and\n      file.extension : \"msix\" and \n      file.path : \"?:\\\\Users\\\\*\\\\AppData\\\\Roaming\\\\Microsoft\\\\Teams\\\\tmp\\\\*\"\n    )\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file-*"
        ]
      },
      {
        "name": "Creation of Kernel Module",
        "description": "Identifies activity related to loading kernel modules on Linux via creation of new ko files in the LKM directory.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Rule Type: BBR",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1547",
                "name": "Boot or Logon Autostart Execution",
                "reference": "https://attack.mitre.org/techniques/T1547/",
                "subtechnique": [
                  {
                    "id": "T1547.006",
                    "name": "Kernel Modules and Extensions",
                    "reference": "https://attack.mitre.org/techniques/T1547/006/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "591c2ce4-e213-4ea3-a546-7c0c6a17fe0c",
        "rule_id": "947827c6-9ed6-4dec-903e-c856c86e72f3",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.563Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.563Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.type in (\"change\", \"creation\") and file.path : \"/lib/modules/*\" and\nfile.extension == \"ko\" and not process.name : (\n  \"dpkg\", \"systemd\", \"falcon-sensor*\", \"dnf\", \"yum\", \"rpm\", \"cp\"\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "Unsigned BITS Service Client Process",
        "description": "Identifies an unsigned Windows Background Intelligent Transfer Service (BITS) client process. Attackers may abuse BITS functionality to download or upload data using the BITS service.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Rule Type: BBR",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://web.archive.org/web/20230531215706/https://blog.menasec.net/2021/05/hunting-for-suspicious-usage-of.html",
          "https://www.elastic.co/blog/hunting-for-persistence-using-elastic-security-part-2"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.001",
                    "name": "Invalid Code Signature",
                    "reference": "https://attack.mitre.org/techniques/T1036/001/"
                  }
                ]
              },
              {
                "id": "T1197",
                "name": "BITS Jobs",
                "reference": "https://attack.mitre.org/techniques/T1197/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "dll.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.status",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "724ca22d-b4ce-4926-b732-49aadf2608f6",
        "rule_id": "9a3884d0-282d-45ea-86ce-b9c81100f026",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.566Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.566Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "library where dll.name : \"Bitsproxy.dll\" and process.executable != null and\nnot process.code_signature.trusted == true and\nnot process.code_signature.status : (\"errorExpired\", \"errorCode_endpoint*\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.library-*"
        ]
      },
      {
        "name": "Potential Privilege Escalation via Python cap_setuid",
        "description": "This detection rule monitors for the execution of a system command with setuid or setgid capabilities via Python, followed by a uid or gid change to the root user. This sequence of events may indicate successful privilege escalation. Setuid (Set User ID) and setgid (Set Group ID) are Unix-like OS features that enable processes to run with elevated privileges, based on the file owner or group. Threat actors can exploit these attributes to escalate privileges to the privileges that are set on the binary that is being executed.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              },
              {
                "id": "T1548",
                "name": "Abuse Elevation Control Mechanism",
                "reference": "https://attack.mitre.org/techniques/T1548/",
                "subtechnique": [
                  {
                    "id": "T1548.001",
                    "name": "Setuid and Setgid",
                    "reference": "https://attack.mitre.org/techniques/T1548/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows\nthe Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest to select \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "group.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "1ccd47d9-4f2d-40a7-a312-00f0bac96f3f",
        "rule_id": "a0ddb77b-0318-41f0-91e4-8c1b5528834f",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.570Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.570Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, process.entity_id with maxspan=1s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and \n   process.args : \"import os;os.set?id(0);os.system(*)\" and process.args : \"*python*\" and user.id != \"0\"]\n  [process where host.os.type == \"linux\" and event.action in (\"uid_change\", \"gid_change\") and event.type == \"change\" and \n   (user.id == \"0\" or group.id == \"0\")]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Git Hook Created or Modified",
        "description": "This rule detects the creation or modification of a Git hook file on a Linux system. Git hooks are scripts that Git executes before or after events such as commit, push, and receive. They are used to automate tasks, enforce policies, and customize Git's behavior. Attackers can abuse Git hooks to maintain persistence on a system by executing malicious code whenever a specific Git event occurs.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Execution",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://git-scm.com/docs/githooks/2.26.0",
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/"
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d25f23de-29ea-4d8a-b073-853f8d4ba43b",
        "rule_id": "ac531fcc-1d3b-476d-bbb5-1357728c9a37",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.573Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.573Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.type == \"creation\" and file.path : \"*.git/hooks/*\" and\nfile.extension == null and process.executable != null and not (\n  process.executable in (\n    \"/bin/dpkg\", \"/usr/bin/dpkg\", \"/bin/dockerd\", \"/usr/bin/dockerd\", \"/usr/sbin/dockerd\", \"/bin/microdnf\",\n    \"/usr/bin/microdnf\", \"/bin/rpm\", \"/usr/bin/rpm\", \"/bin/snapd\", \"/usr/bin/snapd\", \"/bin/yum\", \"/usr/bin/yum\",\n    \"/bin/dnf\", \"/usr/bin/dnf\", \"/bin/podman\", \"/usr/bin/podman\", \"/bin/dnf-automatic\", \"/usr/bin/dnf-automatic\",\n    \"/bin/pacman\", \"/usr/bin/pacman\", \"/usr/bin/dpkg-divert\", \"/bin/dpkg-divert\", \"/sbin/apk\", \"/usr/sbin/apk\",\n    \"/usr/local/sbin/apk\", \"/usr/bin/apt\", \"/usr/sbin/pacman\", \"/bin/podman\", \"/usr/bin/podman\", \"/usr/bin/puppet\",\n    \"/bin/puppet\", \"/opt/puppetlabs/puppet/bin/puppet\", \"/usr/bin/chef-client\", \"/bin/chef-client\",\n    \"/bin/autossl_check\", \"/usr/bin/autossl_check\", \"/proc/self/exe\", \"/usr/bin/pamac-daemon\", \"/bin/pamac-daemon\",\n    \"/usr/local/bin/dockerd\", \"/sbin/dockerd\"\n  ) or\n  process.executable : (\"/nix/store/*\", \"/var/lib/dpkg/*\", \"/snap/*\", \"/dev/fd/*\") or\n  process.name in (\"git\", \"dirname\", \"tar\", \"gitea\", \"git-lfs\") or\n  (process.name == \"sed\" and file.name : \"sed*\") or\n  (process.name == \"perl\" and file.name : \"e2scrub_all.tmp*\") \n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*"
        ]
      },
      {
        "name": "Netsh Helper DLL",
        "description": "Identifies the addition of a Netsh Helper DLL, netsh.exe supports the addition of these DLLs to extend its functionality. Attackers may abuse this mechanism to execute malicious payloads every time the utility is executed, which can be done by administrators or a scheduled task.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 202,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: SentinelOne",
          "Data Source: Sysmon"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/",
                "subtechnique": [
                  {
                    "id": "T1546.007",
                    "name": "Netsh Helper DLL",
                    "reference": "https://attack.mitre.org/techniques/T1546/007/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1112",
                "name": "Modify Registry",
                "reference": "https://attack.mitre.org/techniques/T1112/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "registry.path",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "5de369a7-6a06-4aad-af7e-d418ec2fd4e7",
        "rule_id": "b0638186-4f12-48ac-83d2-47e686d08e82",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.576Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.576Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "registry where host.os.type == \"windows\" and event.type == \"change\" and\n  registry.path : (\n    \"HKLM\\\\Software\\\\Microsoft\\\\netsh\\\\*\",\n    \"\\\\REGISTRY\\\\MACHINE\\\\Software\\\\Microsoft\\\\netsh\\\\*\",\n    \"MACHINE\\\\Software\\\\Microsoft\\\\netsh\\\\*\"\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.registry-*",
          "endgame-*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-windows.sysmon_operational-*"
        ]
      },
      {
        "name": "Potential Abuse of Resources by High Token Count and Large Response Sizes",
        "description": "Detects potential resource exhaustion or data breach attempts by monitoring for users who consistently generate high input token counts, submit numerous requests, and receive large responses. This behavior could indicate an attempt to overload the system or extract an unusually large amount of data, possibly revealing sensitive information or causing service disruptions.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Amazon Bedrock Models High Token Count and Large Response Sizes.\n\nAmazon Bedrock is AWS’s managed service that enables developers to build and scale generative AI applications using large foundation models (FMs) from top providers.\n\nBedrock offers a variety of pretrained models from Amazon (such as the Titan series), as well as models from providers like Anthropic, Meta, Cohere, and AI21 Labs.\n\n#### Possible investigation steps\n\n- Identify the user account that used high prompt token counts and whether it should perform this kind of action.\n- Investigate large response sizes and the number of requests made by the user account.\n- Investigate other alerts associated with the user account during the past 48 hours.\n- Consider the time of day. If the user is a human (not a program or script), did the activity take place during a normal time of day?\n- Examine the account's prompts and responses in the last 24 hours.\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking Amazon Bedrock model access, prompts generated, and responses to the prompts by the account in the last 24 hours.\n\n### False positive analysis\n\n- Verify the user account that used high prompt and large response sizes, has a business justification for the heavy usage of the system.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Identify if the attacker is moving laterally and compromising other Amazon Bedrock Services.\n    - Identify any regulatory or legal ramifications related to this activity.\n    - Identify potential resource exhaustion and impact on billing.\n- Review the permissions assigned to the implicated user group or role behind these requests to ensure they are authorized and expected to access bedrock and ensure that the least privilege principle is being followed.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: LLM",
          "Data Source: AWS Bedrock",
          "Data Source: Amazon Web Services",
          "Data Source: AWS S3",
          "Use Case: Potential Overload",
          "Use Case: Resource Exhaustion",
          "Mitre Atlas: LLM04"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Authorized heavy usage of the system that is business justified and monitored."
        ],
        "references": [
          "https://atlas.mitre.org/techniques/AML.T0051",
          "https://owasp.org/www-project-top-10-for-large-language-model-applications/",
          "https://www.elastic.co/security-labs/elastic-advances-llm-security"
        ],
        "max_signals": 100,
        "threat": [],
        "setup": "## Setup\n\nThis rule requires that guardrails are configured in AWS Bedrock. For more information, see the AWS Bedrock documentation:\n\nhttps://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-create.html\n",
        "related_integrations": [],
        "required_fields": [],
        "id": "0dedea43-b564-417c-a571-f6555161cd5b",
        "rule_id": "b1773d05-f349-45fb-9850-287b8f92f02d",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.580Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.580Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws_bedrock.invocation-*\n| keep user.id, gen_ai.usage.prompt_tokens, gen_ai.usage.completion_tokens\n| stats max_tokens = max(gen_ai.usage.prompt_tokens),\n         total_requests = count(*),\n         avg_response_size = avg(gen_ai.usage.completion_tokens)\n  by user.id\n// tokens count depends on specific LLM, as is related to how embeddings are generated.\n| where max_tokens > 5000 and total_requests > 10 and avg_response_size > 500\n| eval risk_factor = (max_tokens / 1000) * total_requests * (avg_response_size / 500)\n| where risk_factor > 10\n| sort risk_factor desc\n"
      },
      {
        "name": "First Occurrence of Personal Access Token (PAT) Use For a GitHub User",
        "description": "A new PAT was used for a GitHub user not previously seen in the last 14 days.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 204,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Persistence",
          "Rule Type: BBR",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.001",
                    "name": "Additional Cloud Credentials",
                    "reference": "https://attack.mitre.org/techniques/T1098/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "github",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "github.hashed_token",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "github.programmatic_access_type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "user.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "af87889f-3365-4843-b6dc-c5e8c27c85df",
        "rule_id": "f94e898e-94f1-4545-8923-03e4b2866211",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:24.583Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:24.583Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset:\"github.audit\" and event.category:\"configuration\" and\ngithub.hashed_token:* and user.name:* and\ngithub.programmatic_access_type:(\"OAuth access token\" or \"Fine-grained personal access token\")\n",
        "new_terms_fields": [
          "user.name",
          "github.hashed_token"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-github.audit-*"
        ],
        "language": "kuery"
      },
      {
        "name": "Unsigned DLL Loaded by a Trusted Process",
        "description": "Identifies digitally signed (trusted) processes loading unsigned DLLs. Attackers may plant their payloads into the application folder and invoke the legitimate application to execute the payload, masking actions they perform under a legitimate, trusted, and potentially elevated system or software process.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 102,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Rule Type: BBR",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/",
                "subtechnique": [
                  {
                    "id": "T1574.001",
                    "name": "DLL Search Order Hijacking",
                    "reference": "https://attack.mitre.org/techniques/T1574/001/"
                  },
                  {
                    "id": "T1574.002",
                    "name": "DLL Side-Loading",
                    "reference": "https://attack.mitre.org/techniques/T1574/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "dll.Ext.device.product_id",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "dll.Ext.relative_file_creation_time",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "dll.Ext.relative_file_name_modify_time",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "dll.code_signature.status",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "dll.hash.sha256",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "dll.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "dll.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.status",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "f5c2d857-49b6-4f4f-8731-a52b5fc68552",
        "rule_id": "c20cd758-07b1-46a1-b03f-fa66158258b8",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.452Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.452Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "library where host.os.type == \"windows\" and\n   (dll.Ext.relative_file_creation_time <= 500 or\n    dll.Ext.relative_file_name_modify_time <= 500 or\n    dll.Ext.device.product_id : (\"Virtual DVD-ROM\", \"Virtual Disk\")) and dll.hash.sha256 != null and\n    process.code_signature.status :\"trusted\" and not dll.code_signature.status : (\"trusted\", \"errorExpired\", \"errorCode_endpoint*\") and\n    /* DLL loaded from the process.executable current directory */\n    endswith~(substring(dll.path, 0, length(dll.path) - (length(dll.name) + 1)), substring(process.executable, 0, length(process.executable) - (length(process.name) + 1)))\n    and not user.id : \"S-1-5-18\" and\n    not dll.hash.sha256 : (\n        \"19588e6a318894abe8094374bee233e666f319de909c69f12a6047b14473e299\",\n        \"6e8bee250c8cc1b65150522f33794759f5c65f58fff17c5cbf6422ad68b421d2\",\n        \"55de11531dc0e566cb91f26e48d1301a161a4b8b24abed42304d711412368760\",\n        \"56a5148d00c2d9e58415be2d64eca922a58063fe26d9af1c87084aa383c9058e\",\n        \"83ee0ff920144edb2c2f4ea10130f55443493290886985a63233fa2431e450f9\",\n        \"0d0d8f2eaff6b5f75e63d9721d5a0480b30e70792fe0d3a24d76fd3e61b05982\",\n        \"8b6ce3a640e2d6f36b0001be2a1abb765ae51e62c314a15911e75138cbb544bb\",\n        \"ea02a19dd824cb7d611b8821d1b9e6a076714a195d027d1ff918128a64ac5220\",\n        \"02a6d001e6dd944738e09b720e49dcb1272cb782b870e5ae319d4600bc192225\",\n        \"e7714a1d6ac3f4c4ae22564b9ca301e486f5f42691859c0a687246c47b5cf5c9\",\n        \"17f0f709fb7f6190c03b19b6198fd863b6f0d79f46ccfebac6064be747a4cb3e\",\n        \"cb7ab3788d10940df874acd97b1821bbb5ee4a91f3eec11982bb5bf7a3c96443\",\n        \"c944ee510721a1d30d42227cc3061dfdcbc144c952381afcfe4f6e82c5435ffc\",\n        \"967189adfbc889fde89aafc867f7a1f02731f8592cf6fd5a4ace1929213e2e13\",\n        \"4a824526749790603eb66777f79787128dd282162a3904a4c1135de43b14d029\",\n        \"620a7e658af05cc848091b8a639854b9b15700a9061b4a3d078523653133a4af\",\n        \"cb220267fb0116b298bab6a09a764420d630c52026f7d750f8ffca4818389327\",\n        \"0da1f856d92d6b95f10ed8c3f629cd15468c906de9352fb4ae629139d1412eed\",\n        \"e1646c7778c24407a17881908037a49ecfcb5a980d155212d544302653a3ef62\",\n        \"e102c9c5b22ceb60dc516ab4124bea8ec8e808b08eec48ea7ac674d13fca82ef\",\n        \"c7544e1f9927afdf6e8cd7063020b572e60fe8f00af39227eb831d331df38225\",\n        \"3668c6749db59a6cbc5293d0a4f904f76d6fb5048704449dd53894916f408a57\",\n        \"7705851ba047a8154402aca92621b60be0e0e9d9b52b19bf8be540305bd53dba\",\n        \"b5acf358ff97127eac9ef4c664a980b937376b5295ef23d77ee338225de10d60\",\n        \"394d2d862f2ddce71f28d9b933b21a7d6c621c80ef28652574f758f77f01f716\",\n        \"e958d03db79e9f1d2770c70a5bc24904aa3e2d27a8d5637684cf8166b38908f2\",\n        \"284701380f33a30b25e8eb9822e7f47179238e91d08bd3fb5a117145de7e0d8d\",\n        \"497471497886f18ca16f7facab7d76dc9bfadd69deb9c6e4ea9bdc0869a15628\",\n        \"739bedcfc8eb860927eb2057474be5b39518aaaa6703f9f85307a432fa1f236e\",\n        \"8f4c72e3c7de1ab5d894ec7813f65c5298ecafc183f31924b44a427433ffca42\",\n        \"1ac4753056179b358132c55ca3086d550849ae30259ba94f334826c2fbf6c57e\",\n        \"53e8fecd7d4b1b74064eba9bfa6a361d52929f440954931b4ba65615148bf0ea\",\n        \"e9088afd8871dbad5eda47a9d8abf3b08dd2e17c423ba8a05f9b6ad6751f9b7c\",\n        \"ab27eb05130db2f92499234b69ff97ee6429c7824efcb7324ae3e404e2b405bf\",\n        \"553451008520a5f0110d84192cba40208fb001c27454f946e85e6fb2e6553292\"\n    )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.library-*"
        ]
      },
      {
        "name": "Kernel Driver Load by non-root User",
        "description": "Detects the loading of a Linux kernel module by a non-root user through system calls. Threat actors may leverage Linux kernel modules to load a rootkit on a system providing them with complete control and the ability to hide from security products. As other rules monitor for the addition of Linux kernel modules through system utilities or .ko files, this rule covers the gap that evasive rootkits leverage by monitoring for kernel module additions on the lowest level through auditd_manager.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Data Source: Auditd Manager",
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1547",
                "name": "Boot or Logon Autostart Execution",
                "reference": "https://attack.mitre.org/techniques/T1547/",
                "subtechnique": [
                  {
                    "id": "T1547.006",
                    "name": "Kernel Modules and Extensions",
                    "reference": "https://attack.mitre.org/techniques/T1547/006/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1014",
                "name": "Rootkit",
                "reference": "https://attack.mitre.org/techniques/T1014/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Auditd Manager.\n\n### Auditd Manager Integration Setup\nThe Auditd Manager Integration receives audit events from the Linux Audit Framework which is a part of the Linux kernel.\nAuditd Manager provides a user-friendly interface and automation capabilities for configuring and monitoring system auditing through the auditd daemon. With `auditd_manager`, administrators can easily define audit rules, track system events, and generate comprehensive audit reports, improving overall security and compliance in the system.\n\n#### The following steps should be executed in order to add the Elastic Agent System integration \"auditd_manager\" on a Linux System:\n- Go to the Kibana home page and click “Add integrations”.\n- In the query bar, search for “Auditd Manager” and select the integration to see more details about it.\n- Click “Add Auditd Manager”.\n- Configure the integration name and optionally add a description.\n- Review optional and advanced settings accordingly.\n- Add the newly installed “auditd manager” to an existing or a new agent policy, and deploy the agent on a Linux system from which auditd log files are desirable.\n- Click “Save and Continue”.\n- For more details on the integration refer to the [helper guide](https://docs.elastic.co/integrations/auditd_manager).\n\n#### Rule Specific Setup Note\nAuditd Manager subscribes to the kernel and receives events as they occur without any additional configuration.\nHowever, if more advanced configuration is required to detect specific behavior, audit rules can be added to the integration in either the \"audit rules\" configuration box or the \"auditd rule files\" box by specifying a file to read the audit rules from.\n- For this detection rule the following additional audit rules are required to be added to the integration:\n  -- \"-a always,exit -F arch=b64 -S finit_module -S init_module -S delete_module -F auid!=-1 -k modules\"\n  -- \"-a always,exit -F arch=b32 -S finit_module -S init_module -S delete_module -F auid!=-1 -k modules\"\n",
        "related_integrations": [
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "auditd.data.syscall",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "bf88abe0-9b74-4d67-b3f0-d5e0cb1e55e5",
        "rule_id": "ba81c182-4287-489d-af4d-8ae834b06040",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.437Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.437Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "driver where host.os.type == \"linux\" and event.action == \"loaded-kernel-module\" and\nauditd.data.syscall in (\"init_module\", \"finit_module\") and user.id != \"0\"\n",
        "language": "eql",
        "index": [
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Potential Buffer Overflow Attack Detected",
        "description": "Detects potential buffer overflow attacks by querying the \"Segfault Detected\" pre-built rule signal index, through a threshold rule, with a minimum number of 100 segfault alerts in a short timespan. A large amount of segfaults in a short time interval could indicate application exploitation attempts.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Tactic: Initial Access",
          "Use Case: Vulnerability",
          "Rule Type: Higher-Order Rule"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1190",
                "name": "Exploit Public-Facing Application",
                "reference": "https://attack.mitre.org/techniques/T1190/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule leverages alert data from other prebuilt detection rules to function correctly. \n\n### Dependent Elastic Detection Rule Enablement\nAs a higher-order rule (based on other detections), this rule also requires the following prerequisite Elastic detection rule to be installed and enabled:\n- Segfault Detected (5c81fc9d-1eae-437f-ba07-268472967013)\n",
        "related_integrations": [],
        "required_fields": [
          {
            "name": "event.kind",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "kibana.alert.rule.rule_id",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "c89a6017-f7b5-43eb-a743-ff17560bd255",
        "rule_id": "b7c05aaf-78c2-4558-b069-87fa25973489",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.433Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.433Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "threshold",
        "query": "kibana.alert.rule.rule_id:\"5c81fc9d-1eae-437f-ba07-268472967013\" and host.os.type:linux and event.kind:signal\n",
        "threshold": {
          "field": [
            "event.kind",
            "host.id"
          ],
          "value": 100
        },
        "index": [
          ".alerts-security.*"
        ],
        "language": "kuery"
      },
      {
        "name": "Potential Privilege Escalation via Service ImagePath Modification",
        "description": "Identifies registry modifications to default services that could enable privilege escalation to SYSTEM. Attackers with privileges from groups like Server Operators may change the ImagePath of services to executables under their control or to execute commands.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 102,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://cube0x0.github.io/Pocing-Beyond-DA/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/",
                "subtechnique": [
                  {
                    "id": "T1543.003",
                    "name": "Windows Service",
                    "reference": "https://attack.mitre.org/techniques/T1543/003/"
                  }
                ]
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/",
                "subtechnique": [
                  {
                    "id": "T1574.011",
                    "name": "Services Registry Permissions Weakness",
                    "reference": "https://attack.mitre.org/techniques/T1574/011/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1569",
                "name": "System Services",
                "reference": "https://attack.mitre.org/techniques/T1569/",
                "subtechnique": [
                  {
                    "id": "T1569.002",
                    "name": "Service Execution",
                    "reference": "https://attack.mitre.org/techniques/T1569/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "registry.data.strings",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "registry.key",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "registry.value",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "f34c4771-ae27-43ea-a12f-0aaa2ba2e04c",
        "rule_id": "b66b7e2b-d50a-49b9-a6fc-3a383baedc6b",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.430Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.430Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "registry where host.os.type == \"windows\" and event.type == \"change\" and process.executable != null and \n  event.action == \"modification\" and registry.value == \"ImagePath\" and\n  registry.key : (\n    \"*\\\\ADWS\", \"*\\\\AppHostSvc\", \"*\\\\AppReadiness\", \"*\\\\AudioEndpointBuilder\", \"*\\\\AxInstSV\", \"*\\\\camsvc\", \"*\\\\CertSvc\",\n    \"*\\\\COMSysApp\", \"*\\\\CscService\", \"*\\\\defragsvc\", \"*\\\\DeviceAssociationService\", \"*\\\\DeviceInstall\", \"*\\\\DevQueryBroker\",\n    \"*\\\\Dfs\", \"*\\\\DFSR\", \"*\\\\diagnosticshub.standardcollector.service\", \"*\\\\DiagTrack\", \"*\\\\DmEnrollmentSvc\", \"*\\\\DNS\",\n    \"*\\\\dot3svc\", \"*\\\\Eaphost\", \"*\\\\GraphicsPerfSvc\", \"*\\\\hidserv\", \"*\\\\HvHost\", \"*\\\\IISADMIN\", \"*\\\\IKEEXT\",\n    \"*\\\\InstallService\", \"*\\\\iphlpsvc\", \"*\\\\IsmServ\", \"*\\\\LanmanServer\", \"*\\\\MSiSCSI\", \"*\\\\NcbService\", \"*\\\\Netlogon\",\n    \"*\\\\Netman\", \"*\\\\NtFrs\", \"*\\\\PlugPlay\", \"*\\\\Power\", \"*\\\\PrintNotify\", \"*\\\\ProfSvc\", \"*\\\\PushToInstall\", \"*\\\\RSoPProv\",\n    \"*\\\\sacsvr\", \"*\\\\SENS\", \"*\\\\SensorDataService\", \"*\\\\SgrmBroker\", \"*\\\\ShellHWDetection\", \"*\\\\shpamsvc\", \"*\\\\StorSvc\",\n    \"*\\\\svsvc\", \"*\\\\swprv\", \"*\\\\SysMain\", \"*\\\\Themes\", \"*\\\\TieringEngineService\", \"*\\\\TokenBroker\", \"*\\\\TrkWks\",\n    \"*\\\\UALSVC\", \"*\\\\UserManager\", \"*\\\\vm3dservice\", \"*\\\\vmicguestinterface\", \"*\\\\vmicheartbeat\", \"*\\\\vmickvpexchange\",\n    \"*\\\\vmicrdv\", \"*\\\\vmicshutdown\", \"*\\\\vmicvmsession\", \"*\\\\vmicvss\", \"*\\\\vmvss\", \"*\\\\VSS\", \"*\\\\w3logsvc\", \"*\\\\W3SVC\",\n    \"*\\\\WalletService\", \"*\\\\WAS\", \"*\\\\wercplsupport\", \"*\\\\WerSvc\", \"*\\\\Winmgmt\", \"*\\\\wisvc\", \"*\\\\wmiApSrv\",\n    \"*\\\\WPDBusEnum\", \"*\\\\WSearch\"\n  ) and\n  not (\n    registry.data.strings : (\n        \"?:\\\\Windows\\\\system32\\\\*.exe\",\n        \"%systemroot%\\\\system32\\\\*.exe\",\n        \"%windir%\\\\system32\\\\*.exe\",\n        \"%SystemRoot%\\\\system32\\\\svchost.exe -k *\",\n        \"%windir%\\\\system32\\\\svchost.exe -k *\"\n    ) and\n        not registry.data.strings : (\n            \"*\\\\cmd.exe\",\n            \"*\\\\cscript.exe\",\n            \"*\\\\ieexec.exe\",\n            \"*\\\\iexpress.exe\",\n            \"*\\\\installutil.exe\",\n            \"*\\\\Microsoft.Workflow.Compiler.exe\",\n            \"*\\\\msbuild.exe\",\n            \"*\\\\mshta.exe\",\n            \"*\\\\msiexec.exe\",\n            \"*\\\\msxsl.exe\",\n            \"*\\\\net.exe\",\n            \"*\\\\powershell.exe\",\n            \"*\\\\pwsh.exe\",\n            \"*\\\\reg.exe\",\n            \"*\\\\RegAsm.exe\",\n            \"*\\\\RegSvcs.exe\",\n            \"*\\\\regsvr32.exe\",\n            \"*\\\\rundll32.exe\",\n            \"*\\\\vssadmin.exe\",\n            \"*\\\\wbadmin.exe\",\n            \"*\\\\wmic.exe\",\n            \"*\\\\wscript.exe\"\n        )\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.registry-*",
          "logs-windows.sysmon_operational-*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "Systemd Service Started by Unusual Parent Process",
        "description": "Systemctl is a process used in Linux systems to manage systemd processes through service configuration files. Malicious actors can leverage systemd services to achieve persistence by creating or modifying service files to execute malicious commands or payloads during system startup. This allows them to maintain unauthorized access, execute additional malicious activities, or evade detection.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Systemd Service Started by Unusual Parent Process\n\nSystemd service files are configuration files in Linux systems used to define and manage systemd services.\n\nMalicious actors can leverage systemd service files to achieve persistence by creating or modifying service files to execute malicious commands or payloads during system startup. This allows them to maintain unauthorized access, execute additional malicious activities, or evade detection.\n\nThis rule monitors the execution of the systemctl binary to start, enable or reenable a systemd service, potentially indicating the creation of a persistence mechanism.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/master/invest-guide-run-osquery.html) introduced in Elastic Stack version 8.5.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n> This investigation guide uses [placeholder fields](https://www.elastic.co/guide/en/security/current/osquery-placeholder-fields.html) to dynamically pass alert data into Osquery queries. Placeholder fields were introduced in Elastic Stack version 8.7.0. If you're using Elastic Stack version 8.6.0 or earlier, you'll need to manually adjust this investigation guide's queries to ensure they properly run.\n\n#### Possible Investigation Steps\n\n- Investigate the currently enabled systemd services through the following command `sudo systemctl list-unit-files`.\n- Investigate whether any other files in any of the available systemd directories have been altered through OSQuery.\n  - !{osquery{\"label\":\"Osquery - Retrieve File Listing Information\",\"query\":\"SELECT * FROM file WHERE ( path LIKE '/etc/systemd/system/%' OR path LIKE '/usr/local/lib/systemd/system/%' OR path LIKE\\n'/lib/systemd/system/%' OR path LIKE '/usr/lib/systemd/system/%' OR path LIKE '/home/user/.config/systemd/user/%' )\\n\"}}\n  - !{osquery{\"label\":\"Osquery - Retrieve Additional File Listing Information\",\"query\":\"SELECT f.path, u.username AS file_owner, g.groupname AS group_owner, datetime(f.atime, 'unixepoch') AS\\nfile_last_access_time, datetime(f.mtime, 'unixepoch') AS file_last_modified_time, datetime(f.ctime, 'unixepoch') AS\\nfile_last_status_change_time, datetime(f.btime, 'unixepoch') AS file_created_time, f.size AS size_bytes FROM file f LEFT\\nJOIN users u ON f.uid = u.uid LEFT JOIN groups g ON f.gid = g.gid WHERE ( path LIKE '/etc/systemd/system/%' OR path LIKE\\n'/usr/local/lib/systemd/system/%' OR path LIKE '/lib/systemd/system/%' OR path LIKE '/usr/lib/systemd/system/%' OR path\\nLIKE '/home/{{user.name}}/.config/systemd/user/%' )\\n\"}}\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence and whether they are located in expected locations.\n  - !{osquery{\"label\":\"Osquery - Retrieve Running Processes by User\",\"query\":\"SELECT pid, username, name FROM processes p JOIN users u ON u.uid = p.uid ORDER BY username\"}}\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Validate the activity is not related to planned patches, updates, network administrator activity, or legitimate software installations.\n- Investigate whether the altered scripts call other malicious scripts elsewhere on the file system. \n  - If scripts or executables were dropped, retrieve the files and determine if they are malicious:\n    - Use a private sandboxed malware analysis system to perform analysis.\n      - Observe and collect information about the following activities:\n        - Attempts to contact external domains and addresses.\n          - Check if the domain is newly registered or unexpected.\n          - Check the reputation of the domain or IP address.\n        - File access, modification, and creation activities.\n        - Cron jobs, services and other persistence mechanisms.\n            - !{osquery{\"label\":\"Osquery - Retrieve Crontab Information\",\"query\":\"SELECT * FROM crontab\"}}\n- Investigate abnormal behaviors by the subject process/user such as network connections, file modifications, and any other spawned child processes.\n  - Investigate listening ports and open sockets to look for potential command and control traffic or data exfiltration.\n    - !{osquery{\"label\":\"Osquery - Retrieve Listening Ports\",\"query\":\"SELECT pid, address, port, socket, protocol, path FROM listening_ports\"}}\n    - !{osquery{\"label\":\"Osquery - Retrieve Open Sockets\",\"query\":\"SELECT pid, family, remote_address, remote_port, socket, state FROM process_open_sockets\"}}\n  - Identify the user account that performed the action, analyze it, and check whether it should perform this kind of action.\n    - !{osquery{\"label\":\"Osquery - Retrieve Information for a Specific User\",\"query\":\"SELECT * FROM users WHERE username = {{user.name}}\"}}\n- Investigate whether the user is currently logged in and active.\n    - !{osquery{\"label\":\"Osquery - Investigate the Account Authentication Status\",\"query\":\"SELECT * FROM logged_in_users WHERE user = {{user.name}}\"}}\n\n### False Positive Analysis\n\n- If this activity is related to new benign software installation activity, consider adding exceptions — preferably with a combination of user and command line conditions.\n- If this activity is related to a system administrator who uses systemd services for administrative purposes, consider adding exceptions for this specific administrator user account. \n- Try to understand the context of the execution by thinking about the user, machine, or business purpose. A small number of endpoints, such as servers with unique software, might appear unusual but satisfy a specific business need.\n\n### Related Rules\n\n- New Systemd Service Created by Previously Unknown Process - 17b0a495-4d9f-414c-8ad0-92f018b8e001\n- Potential Persistence Through Run Control Detected - 0f4d35e4-925e-4959-ab24-911be207ee6f\n- Potential Persistence Through init.d Detected - 474fd20e-14cc-49c5-8160-d9ab4ba16c8b\n- New Systemd Timer Created - 7fb500fa-8e24-4bd1-9480-2a819352602c\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Delete the service/timer or restore its original configuration.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Leverage the incident response data and logging to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/springtail-kimsuky-backdoor-espionage",
          "https://pberba.github.io/security/2022/01/30/linux-threat-hunting-for-persistence-systemd-timers-cron/",
          "https://www.elastic.co/security-labs/primer-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/",
                "subtechnique": [
                  {
                    "id": "T1543.002",
                    "name": "Systemd Service",
                    "reference": "https://attack.mitre.org/techniques/T1543/002/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/",
                "subtechnique": [
                  {
                    "id": "T1543.002",
                    "name": "Systemd Service",
                    "reference": "https://attack.mitre.org/techniques/T1543/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.entry_leader.entry_meta.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.pid",
            "type": "long",
            "ecs": true
          }
        ],
        "id": "76a81b09-a50a-4080-967c-d440cc4ac591",
        "rule_id": "b605f262-f7dc-41b5-9ebc-06bafe7a83b6",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.426Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.426Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "host.os.type:linux and event.category:process and event.type:start and event.action:exec and\nprocess.executable:/usr/bin/systemctl and process.args:(enable or reenable or start) and \nprocess.entry_leader.entry_meta.type:* and\nnot (\n  process.entry_leader.entry_meta.type:(container or init or unknown) or\n  process.parent.pid:1 or\n  process.parent.executable:(\n    /bin/adduser or /bin/dnf or /bin/dnf-automatic or /bin/dockerd or /bin/dpkg or /bin/microdnf or /bin/pacman or\n    /bin/podman or /bin/rpm or /bin/snapd or /bin/sudo or /bin/useradd or /bin/yum or /usr/bin/dnf or\n    /usr/bin/dnf-automatic or /usr/bin/dockerd or /usr/bin/dpkg or /usr/bin/microdnf or /usr/bin/pacman or\n    /usr/bin/podman or /usr/bin/rpm or /usr/bin/snapd or /usr/bin/sudo or /usr/bin/yum or /usr/sbin/adduser or\n    /usr/sbin/invoke-rc.d or /usr/sbin/useradd or /var/lib/dpkg/*\n  ) or\n  process.args_count >= 5\n)\n",
        "new_terms_fields": [
          "process.parent.executable"
        ],
        "history_window_start": "now-7d",
        "index": [
          "logs-endpoint.events.*"
        ],
        "language": "kuery"
      },
      {
        "name": "Active Directory Forced Authentication from Linux Host - SMB Named Pipes",
        "description": "Identifies a potential forced authentication using related SMB named pipes. Attackers may attempt to force targets to authenticate to a host controlled by them to capture hashes or enable relay attacks.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: Elastic Defend",
          "Data Source: Active Directory",
          "Use Case: Active Directory Monitoring",
          "Data Source: System"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/p0dalirius/windows-coerced-authentication-methods",
          "https://www.thehacker.recipes/a-d/movement/mitm-and-coerced-authentications",
          "https://attack.mitre.org/techniques/T1187/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1187",
                "name": "Forced Authentication",
                "reference": "https://attack.mitre.org/techniques/T1187/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule uses Elastic Endpoint network events from Linux hosts and system integration events from Domain controllers\nfor correlation. Both data sources should be collected from the hosts for this detection to work.\n\nThe 'Audit Detailed File Share' audit policy must be configured (Success Failure).\nSteps to implement the logging policy with Advanced Audit Configuration:\n```\nComputer Configuration >\nPolicies >\nWindows Settings >\nSecurity Settings >\nAdvanced Audit Policies Configuration >\nAudit Policies >\nObject Access >\nAudit Detailed File Share (Success,Failure)\n```\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "data_stream.namespace",
            "type": "constant_keyword",
            "ecs": false
          },
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "destination.port",
            "type": "long",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.code",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "source.ip",
            "type": "ip",
            "ecs": true
          }
        ],
        "id": "2eb42195-2139-45dd-a4f3-813aea3aae2c",
        "rule_id": "c24e9a43-f67e-431d-991b-09cdb83b3c0c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.472Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.472Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence with maxspan=15s\n[network where host.os.type == \"linux\" and event.action == \"connection_attempted\" and destination.port == 445 and not startswith~(string(destination.ip), string(host.ip))] by host.ip, data_stream.namespace\n[file where host.os.type == \"windows\" and event.code == \"5145\" and file.name : (\"Spoolss\", \"netdfs\", \"lsarpc\", \"lsass\", \"netlogon\", \"samr\", \"efsrpc\", \"FssagentRpc\")] by source.ip, data_stream.namespace\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.network-*",
          "logs-system.security-*",
          "winlogbeat-*"
        ]
      },
      {
        "name": "Downloaded URL Files",
        "description": "Identifies .url shortcut files downloaded from outside the local network. These shortcut files are commonly used in phishing campaigns.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1204",
                "name": "User Execution",
                "reference": "https://attack.mitre.org/techniques/T1204/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1566",
                "name": "Phishing",
                "reference": "https://attack.mitre.org/techniques/T1566/",
                "subtechnique": [
                  {
                    "id": "T1566.001",
                    "name": "Spearphishing Attachment",
                    "reference": "https://attack.mitre.org/techniques/T1566/001/"
                  },
                  {
                    "id": "T1566.002",
                    "name": "Spearphishing Link",
                    "reference": "https://attack.mitre.org/techniques/T1566/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.windows.zone_identifier",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "2d4f9b54-0cbf-4900-80e1-3988d82e7dce",
        "rule_id": "cd82e3d6-1346-4afd-8f22-38388bbf34cb",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.476Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.476Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"windows\" and event.type == \"creation\" and file.extension == \"url\"\n   and file.Ext.windows.zone_identifier > 1 and not process.name : \"explorer.exe\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file-*"
        ]
      },
      {
        "name": "Privilege Escalation via CAP_CHOWN/CAP_FOWNER Capabilities",
        "description": "Identifies instances where a processes (granted CAP_CHOWN and/or CAP_FOWNER capabilities) is executed, after which the ownership of a suspicious file or binary is changed. In Linux, the CAP_CHOWN capability allows a process to change the owner of a file, while CAP_FOWNER permits it to bypass permission checks on operations that require file ownership (like reading, writing, and executing). Attackers may abuse these capabilities to obtain unauthorized access to files.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Data Source: Auditd Manager",
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Auditd Manager.\n\n### Auditd Manager Integration Setup\nThe Auditd Manager Integration receives audit events from the Linux Audit Framework which is a part of the Linux kernel.\nAuditd Manager provides a user-friendly interface and automation capabilities for configuring and monitoring system auditing through the auditd daemon. With `auditd_manager`, administrators can easily define audit rules, track system events, and generate comprehensive audit reports, improving overall security and compliance in the system.\n\n#### The following steps should be executed in order to add the Elastic Agent System integration \"auditd_manager\" on a Linux System:\n- Go to the Kibana home page and click “Add integrations”.\n- In the query bar, search for “Auditd Manager” and select the integration to see more details about it.\n- Click “Add Auditd Manager”.\n- Configure the integration name and optionally add a description.\n- Review optional and advanced settings accordingly.\n- Add the newly installed “auditd manager” to an existing or a new agent policy, and deploy the agent on a Linux system from which auditd log files are desirable.\n- Click “Save and Continue”.\n- For more details on the integration refer to the [helper guide](https://docs.elastic.co/integrations/auditd_manager).\n\n#### Rule Specific Setup Note\nAuditd Manager subscribes to the kernel and receives events as they occur without any additional configuration.\nHowever, if more advanced configuration is required to detect specific behavior, audit rules can be added to the integration in either the \"audit rules\" configuration box or the \"auditd rule files\" box by specifying a file to read the audit rules from.\n- For this detection rule the following additional audit rules are required to be added to the integration:\n  -- \"-w /etc/ -p rwxa -k audit_recursive_etc\"\n  -- \"-w /root/ -p rwxa -k audit_root\"\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pid",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.thread.capabilities.effective",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "41c13a10-4cef-4fb7-a157-7cb27325089b",
        "rule_id": "d55abdfb-5384-402b-add4-6c401501b0c3",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.479Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.479Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, process.pid with maxspan=1s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.name != null and process.thread.capabilities.effective : (\"CAP_CHOWN\", \"CAP_FOWNER\") and\n   process.command_line : (\"*sudoers*\", \"*passwd*\", \"*shadow*\", \"*/root/*\") and user.id != \"0\"]\n  [file where host.os.type == \"linux\" and event.action == \"changed-file-ownership-of\" and event.type == \"change\" and\n   event.outcome == \"success\" and file.path in (\n     \"/etc/passwd\",\n     \"/etc/shadow\",\n     \"/etc/sudoers\",\n     \"/root/.ssh/*\"\n   ) and user.id != \"0\"\n  ]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Suspicious Memory grep Activity",
        "description": "Monitors for grep activity related to memory mapping. The /proc/*/maps file in Linux provides a memory map for a specific process, detailing the memory segments, permissions, and what files are mapped to these segments. Attackers may read a process's memory map to identify memory addresses for code injection or process hijacking.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/arget13/DDexec"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1057",
                "name": "Process Discovery",
                "reference": "https://attack.mitre.org/techniques/T1057/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "58e92aeb-2c95-4493-b7ed-e2e6dca1c278",
        "rule_id": "d74d6506-427a-4790-b170-0c2a6ddac799",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.493Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.493Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and\nprocess.name in (\"grep\", \"egrep\", \"fgrep\", \"rgrep\") and process.args in (\"[stack]\", \"[vdso]\", \"[heap]\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "AWS IAM AdministratorAccess Policy Attached to Role",
        "description": "An adversary with access to a set of compromised credentials may attempt to persist or escalate privileges by attaching additional permissions to compromised IAM roles. This rule looks for use of the IAM `AttachRolePolicy` API operation to attach the highly permissive `AdministratorAccess` AWS managed policy to an existing IAM role.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating AWS IAM AdministratorAccess Policy Attached to Role\n\nThe AWS IAM `AdministratorAccess` managed policy provides full access to all AWS services and resources.\nWith access to the `iam:AttachRolePolicy` permission, a set of compromised credentials could be used to attach\nthis policy to a compromised role for privilege escalation or as a means of persistence. This rule uses [ES|QL](https://www.elastic.co/guide/en/security/master/rules-ui-create.html#create-esql-rule)\nto look for use of the `AttachRolePolicy` operation along with request_parameters where the policyName is `AdministratorAccess`.\n\n\n#### Possible investigation steps\n\n- Identify the account and its role in the environment.\n- Review IAM permission policies for the user identity.\n- Identify the applications or users that should use this account.\n- Investigate other alerts associated with the account during the past 48 hours.\n- Investigate abnormal values in the `user_agent.original` field by comparing them with the intended and authorized usage and historical data. Suspicious user agent values include non-SDK, AWS CLI, custom user agents, etc.\n- Contact the account owner and confirm whether they are aware of this activity.\n- Considering the source IP address and geolocation of the user who issued the command:\n    - Do they look normal for the calling user?\n    - If the source is an EC2 IP address, is it associated with an EC2 instance in one of your accounts or is the source IP from an EC2 instance that's not under your control?\n    - If it is an authorized EC2 instance, is the activity associated with normal behavior for the instance role or roles? Are there any other alerts or signs of suspicious activity involving this instance?\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking servers, services, and data accessed by the account in the last 24 hours.\n    - Determine what other API calls were made by the user.\n    - Assess whether this behavior is prevalent in the environment by looking for similar occurrences involving other users.\n\n### False positive analysis\n\n- False positives may occur due to the intended usage of the IAM `AdministratorAccess` managed policy. Verify the `aws.cloudtrail.user_identity.arn` should have the `iam:AttachRolePolicy` permission and that the `role.name` should be given full administrative access.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n    - Rotate user credentials\n    - Remove the `AdministratorAccess` policy from the affected role(s)\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Assess the criticality of affected services and servers.\n    - Work with your IT team to identify and minimize the impact on users.\n    - Identify if the attacker is moving laterally and compromising other accounts, servers, or services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified.\n    - Rotate secrets or delete API keys as needed to revoke the attacker's access to the environment.\n    - Work with your IT teams to minimize the impact on business operations during these actions.\n- Check if unauthorized new users were created, remove unauthorized new accounts, and request password resets for other IAM users.\n- Consider enabling multi-factor authentication for users.\n- Review the permissions assigned to the implicated user to ensure that the least privilege principle is being followed.\n- Implement security best practices [outlined](https://aws.amazon.com/premiumsupport/knowledge-center/security-best-practices/) by AWS.\n- Take the actions needed to return affected systems, data, or services to their normal operational levels.\n- Identify the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS IAM",
          "Use Case: Identity and Access Audit",
          "Tactic: Privilege Escalation",
          "Tactic: Persistence",
          "Resources: Investigation Guide"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "While this can be normal behavior, it should be investigated to ensure validity. Verify whether the user identity should be using the IAM `AttachRolePolicy` API operation to attach the `AdministratorAccess` policy to the target role."
        ],
        "references": [
          "https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html",
          "https://docs.aws.amazon.com/aws-managed-policy/latest/reference/AdministratorAccess.html",
          "https://hackingthe.cloud/aws/exploitation/iam_privilege_escalation/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.003",
                    "name": "Additional Cloud Roles",
                    "reference": "https://attack.mitre.org/techniques/T1098/003/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.003",
                    "name": "Additional Cloud Roles",
                    "reference": "https://attack.mitre.org/techniques/T1098/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [],
        "id": "07fa3d51-240f-430a-8a0a-9229bd840976",
        "rule_id": "dde13d58-bc39-4aa0-87fd-b4bdbf4591da",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.499Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.499Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws.cloudtrail-* metadata _id, _version, _index\n| where event.provider == \"iam.amazonaws.com\" and event.action == \"AttachRolePolicy\" and event.outcome == \"success\"\n| dissect aws.cloudtrail.request_parameters \"{%{?policyArn}=%{?arn}:%{?aws}:%{?iam}::%{?aws}:%{?policy}/%{policyName},%{?roleName}=%{role.name}}\"\n| where policyName == \"AdministratorAccess\"\n| keep @timestamp, event.provider, event.action, event.outcome, policyName, role.name\n"
      },
      {
        "name": "Network Connections Initiated Through XDG Autostart Entry",
        "description": "Detects network connections initiated through Cross-Desktop Group (XDG) autostart entries for GNOME and XFCE-based Linux distributions. XDG Autostart entries can be used to execute arbitrary commands or scripts when a user logs in. This rule helps to identify potential malicious activity where an attacker may have modified XDG autostart scripts to establish persistence on the system.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://specifications.freedesktop.org/autostart-spec/autostart-spec-latest.html",
          "https://hadess.io/the-art-of-linux-persistence/",
          "https://www.elastic.co/security-labs/primer-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1547",
                "name": "Boot or Logon Autostart Execution",
                "reference": "https://attack.mitre.org/techniques/T1547/",
                "subtechnique": [
                  {
                    "id": "T1547.013",
                    "name": "XDG Autostart Entries",
                    "reference": "https://attack.mitre.org/techniques/T1547/013/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from one of the following integrations:\n- Elastic Defend\n- Auditbeat\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\n### Auditbeat Setup\nAuditbeat is a lightweight shipper that you can install on your servers to audit the activities of users and processes on your systems. For example, you can use Auditbeat to collect and centralize audit events from the Linux Audit Framework. You can also use Auditbeat to detect changes to critical files, like binaries and configuration files, and identify potential security policy violations.\n\n#### The following steps should be executed in order to add the Auditbeat on a Linux System:\n- Elastic provides repositories available for APT and YUM-based distributions. Note that we provide binary packages, but no source packages.\n- To install the APT and YUM repositories follow the setup instructions in this [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setup-repositories.html).\n- To run Auditbeat on Docker follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-docker.html).\n- To run Auditbeat on Kubernetes follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/running-on-kubernetes.html).\n- For complete “Setup and Run Auditbeat” information refer to the [helper guide](https://www.elastic.co/guide/en/beats/auditbeat/current/setting-up-and-running.html).\n\n#### Custom Ingest Pipeline\nFor versions <8.2, you need to add a custom ingest pipeline to populate `event.ingested` with @timestamp for non-elastic-agent indexes, like auditbeats/filebeat/winlogbeat etc. For more details to add a custom ingest pipeline refer to the [guide](https://www.elastic.co/guide/en/fleet/current/data-streams-pipeline-tutorial.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d22388ef-68c9-474a-a367-d2b674bdd792",
        "rule_id": "dd52d45a-4602-4195-9018-ebe0f219c273",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.496Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.496Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, process.entity_id with maxspan=1s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and (\n     (process.parent.executable == \"/usr/bin/xfce4-session\") or\n     (process.executable == \"/bin/sh\" and process.args == \"-e\" and process.args == \"-u\" and\n      process.args == \"-c\" and process.args : \"export GIO_LAUNCHED_DESKTOP_FILE_PID=$$;*\")\n   )\n  ]\n  [network where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"connection_attempted\" and not (\n     destination.ip == null or destination.ip == \"0.0.0.0\" or cidrmatch(\n       destination.ip, \"10.0.0.0/8\", \"127.0.0.0/8\", \"169.254.0.0/16\", \"172.16.0.0/12\", \"192.0.0.0/24\", \"192.0.0.0/29\",\n       \"192.0.0.8/32\", \"192.0.0.9/32\", \"192.0.0.10/32\", \"192.0.0.170/32\", \"192.0.0.171/32\", \"192.0.2.0/24\",\n       \"192.31.196.0/24\", \"192.52.193.0/24\", \"192.168.0.0/16\", \"192.88.99.0/24\", \"224.0.0.0/4\", \"100.64.0.0/10\",\n       \"192.175.48.0/24\",\"198.18.0.0/15\", \"198.51.100.0/24\", \"203.0.113.0/24\", \"240.0.0.0/4\", \"::1\", \"FE80::/10\",\n       \"FF00::/8\", \"172.31.0.0/16\"\n       ) or\n       process.executable in (\n        \"/usr/lib64/firefox/firefox\", \"/usr/lib/firefox/firefox\", \"/opt/forticlient/fortitraylauncher\"\n       )\n     )\n  ]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "AWS IAM AdministratorAccess Policy Attached to Group",
        "description": "An adversary with access to a set of compromised credentials may attempt to persist or escalate privileges by attaching additional permissions to user groups the compromised user account belongs to. This rule looks for use of the IAM `AttachGroupPolicy` API operation to attach the highly permissive `AdministratorAccess` AWS managed policy to an existing IAM user group.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating AWS IAM AdministratorAccess Policy Attached to Group\n\nThe AWS IAM `AdministratorAccess` managed policy provides full access to all AWS services and resources.\nWith access to the `iam:AttachGroupPolicy` permission, a set of compromised credentials could be used to attach\nthis policy to the current user's groups for privilege escalation or as a means of persistence. This rule uses [ES|QL](https://www.elastic.co/guide/en/security/master/rules-ui-create.html#create-esql-rule)\nto look for use of the `AttachGroupPolicy` operation along with request_parameters where the policyName is `AdministratorAccess`.\n\n\n#### Possible investigation steps\n\n- Identify the account and its role in the environment.\n- Review IAM permission policies for the user identity.\n- Identify the applications or users that should use this account.\n- Investigate other alerts associated with the account during the past 48 hours.\n- Investigate abnormal values in the `user_agent.original` field by comparing them with the intended and authorized usage and historical data. Suspicious user agent values include non-SDK, AWS CLI, custom user agents, etc.\n- Contact the account owner and confirm whether they are aware of this activity.\n- Considering the source IP address and geolocation of the user who issued the command:\n    - Do they look normal for the calling user?\n    - If the source is an EC2 IP address, is it associated with an EC2 instance in one of your accounts or is the source IP from an EC2 instance that's not under your control?\n    - If it is an authorized EC2 instance, is the activity associated with normal behavior for the instance role or roles? Are there any other alerts or signs of suspicious activity involving this instance?\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking servers, services, and data accessed by the account in the last 24 hours.\n    - Determine what other API calls were made by the user.\n    - Assess whether this behavior is prevalent in the environment by looking for similar occurrences involving other users.\n\n### False positive analysis\n\n- False positives may occur due to the intended usage of the IAM `AdministratorAccess` managed policy. Verify the `aws.cloudtrail.user_identity.arn` should have the `iam:AttachUserPolicy` permission and that the `target.userName` should be given full administrative access.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n    - Rotate user credentials\n    - Remove the `AdministratorAccess` policy from the affected group(s)\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Assess the criticality of affected services and servers.\n    - Work with your IT team to identify and minimize the impact on users.\n    - Identify if the attacker is moving laterally and compromising other accounts, servers, or services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified.\n    - Rotate secrets or delete API keys as needed to revoke the attacker's access to the environment.\n    - Work with your IT teams to minimize the impact on business operations during these actions.\n- Check if unauthorized new users were created, remove unauthorized new accounts, and request password resets for other IAM users.\n- Consider enabling multi-factor authentication for users.\n- Review the permissions assigned to the implicated user to ensure that the least privilege principle is being followed.\n- Implement security best practices [outlined](https://aws.amazon.com/premiumsupport/knowledge-center/security-best-practices/) by AWS.\n- Take the actions needed to return affected systems, data, or services to their normal operational levels.\n- Identify the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS IAM",
          "Use Case: Identity and Access Audit",
          "Tactic: Privilege Escalation",
          "Tactic: Persistence",
          "Resources: Investigation Guide"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "While this can be normal behavior, it should be investigated to ensure validity. Verify whether the user identity should be using the IAM `AttachGroupPolicy` API operation to attach the `AdministratorAccess` policy to the user group."
        ],
        "references": [
          "https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachGroupPolicy.html",
          "https://docs.aws.amazon.com/aws-managed-policy/latest/reference/AdministratorAccess.html",
          "https://hackingthe.cloud/aws/exploitation/iam_privilege_escalation/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.003",
                    "name": "Additional Cloud Roles",
                    "reference": "https://attack.mitre.org/techniques/T1098/003/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.003",
                    "name": "Additional Cloud Roles",
                    "reference": "https://attack.mitre.org/techniques/T1098/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [],
        "id": "6698588e-7c3c-47ca-9b60-c079c41c70ad",
        "rule_id": "df919b5e-a0f6-4fd8-8598-e3ce79299e3b",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.503Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.503Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws.cloudtrail-* metadata _id, _version, _index\n| where event.provider == \"iam.amazonaws.com\" and event.action == \"AttachGroupPolicy\" and event.outcome == \"success\"\n| dissect aws.cloudtrail.request_parameters \"{%{?policyArn}=%{?arn}:%{?aws}:%{?iam}::%{?aws}:%{?policy}/%{policyName},%{?groupName}=%{group.name}}\"\n| where policyName == \"AdministratorAccess\"\n| keep @timestamp, event.provider, event.action, event.outcome, policyName, group.name\n"
      },
      {
        "name": "Delayed Execution via Ping",
        "description": "Identifies the execution of commonly abused Windows utilities via a delayed Ping execution. This behavior is often observed during malware installation and is consistent with an attacker attempting to evade detection.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.001",
                    "name": "PowerShell",
                    "reference": "https://attack.mitre.org/techniques/T1059/001/"
                  },
                  {
                    "id": "T1059.005",
                    "name": "Visual Basic",
                    "reference": "https://attack.mitre.org/techniques/T1059/005/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1216",
                "name": "System Script Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1216/"
              },
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/",
                "subtechnique": [
                  {
                    "id": "T1218.003",
                    "name": "CMSTP",
                    "reference": "https://attack.mitre.org/techniques/T1218/003/"
                  },
                  {
                    "id": "T1218.004",
                    "name": "InstallUtil",
                    "reference": "https://attack.mitre.org/techniques/T1218/004/"
                  },
                  {
                    "id": "T1218.005",
                    "name": "Mshta",
                    "reference": "https://attack.mitre.org/techniques/T1218/005/"
                  },
                  {
                    "id": "T1218.009",
                    "name": "Regsvcs/Regasm",
                    "reference": "https://attack.mitre.org/techniques/T1218/009/"
                  },
                  {
                    "id": "T1218.010",
                    "name": "Regsvr32",
                    "reference": "https://attack.mitre.org/techniques/T1218/010/"
                  },
                  {
                    "id": "T1218.011",
                    "name": "Rundll32",
                    "reference": "https://attack.mitre.org/techniques/T1218/011/"
                  }
                ]
              },
              {
                "id": "T1220",
                "name": "XSL Script Processing",
                "reference": "https://attack.mitre.org/techniques/T1220/"
              },
              {
                "id": "T1497",
                "name": "Virtualization/Sandbox Evasion",
                "reference": "https://attack.mitre.org/techniques/T1497/",
                "subtechnique": [
                  {
                    "id": "T1497.003",
                    "name": "Time Based Evasion",
                    "reference": "https://attack.mitre.org/techniques/T1497/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pe.original_file_name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.working_directory",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "8b31aae6-4916-48dc-9261-1d68bf6bb10b",
        "rule_id": "e00b8d49-632f-4dc6-94a5-76153a481915",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.506Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.506Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by process.parent.entity_id with maxspan=1m\n  [process where host.os.type == \"windows\" and event.action == \"start\" and process.name : \"ping.exe\" and\n   process.args : \"-n\" and process.parent.name : \"cmd.exe\" and not user.id : \"S-1-5-18\"]\n  [process where host.os.type == \"windows\" and event.action == \"start\" and\n   process.parent.name : \"cmd.exe\" and\n   (\n        process.name : (\n            \"rundll32.exe\", \"powershell.exe\",\n            \"mshta.exe\", \"msbuild.exe\",\n            \"certutil.exe\", \"regsvr32.exe\",\n            \"powershell.exe\", \"cscript.exe\",\n            \"wscript.exe\", \"wmic.exe\",\n            \"installutil.exe\", \"msxsl.exe\",\n            \"Microsoft.Workflow.Compiler.exe\",\n            \"ieexec.exe\", \"iexpress.exe\",\n            \"RegAsm.exe\", \"installutil.exe\",\n            \"RegSvcs.exe\", \"RegAsm.exe\"\n        ) or\n        (process.executable : \"?:\\\\Users\\\\*\\\\AppData\\\\*.exe\" and not process.code_signature.trusted == true)\n    ) and\n\n    not process.args : (\"?:\\\\Program Files\\\\*\", \"?:\\\\Program Files (x86)\\\\*\") and\n    not (process.name : (\"openssl.exe\", \"httpcfg.exe\", \"certutil.exe\") and process.parent.command_line : \"*ScreenConnectConfigurator.cmd*\") and\n    not (process.pe.original_file_name : \"DPInst.exe\" and process.command_line : \"driver\\\\DPInst_x64  /f \") and\n    not (process.name : \"powershell.exe\" and process.args : \"Write-Host ======*\") and\n    not (process.name : \"wscript.exe\" and process.args : \"launchquiet_args.vbs\" and process.parent.args : \"?:\\\\Windows\\\\TempInst\\\\7z*\") and\n    not (process.name : \"regsvr32.exe\" and process.args : (\"?:\\\\windows\\\\syswow64\\\\msxml?.dll\", \"msxml?.dll\", \"?:\\\\Windows\\\\SysWOW64\\\\mschrt20.ocx\")) and \n    not (process.name : \"wscript.exe\" and\n         process.working_directory :\n                    (\"?:\\\\Windows\\\\TempInst\\\\*\",\n                     \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\BackupBootstrapper\\\\Logs\\\\\",\n                     \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\QBTools\\\\\"))\n    ]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*"
        ]
      },
      {
        "name": "Potential Credential Access via Memory Dump File Creation",
        "description": "Identifies the creation or modification of a medium size memory dump file which can indicate an attempt to access credentials from a process memory.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: Elastic Defend",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1003",
                "name": "OS Credential Dumping",
                "reference": "https://attack.mitre.org/techniques/T1003/",
                "subtechnique": [
                  {
                    "id": "T1003.001",
                    "name": "LSASS Memory",
                    "reference": "https://attack.mitre.org/techniques/T1003/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.header_bytes",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.size",
            "type": "long",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d750bd81-673b-4738-b206-e021d66f7c15",
        "rule_id": "e707a7be-cc52-41ac-8ab3-d34b38c20005",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.509Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.509Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"windows\" and event.type == \"creation\" and\n\n  /* MDMP header */\n  file.Ext.header_bytes : \"4d444d50*\" and file.size >= 30000 and\n  not\n\n  (\n    (\n      process.name : \"System\" or\n      process.executable : (\n        \"?:\\\\Windows\\\\System32\\\\WerFault.exe\",\n        \"?:\\\\Windows\\\\SysWOW64\\\\WerFault.exe\",\n        \"?:\\\\Windows\\\\System32\\\\Wermgr.exe\",\n        \"?:\\\\Windows\\\\SysWOW64\\\\Wermgr.exe\",\n        \"?:\\\\Windows\\\\System32\\\\WerFaultSecure.exe\",\n        \"?:\\\\Windows\\\\SysWOW64\\\\WerFaultSecure.exe\",\n        \"?:\\\\Windows\\\\System32\\\\WUDFHost.exe\",\n        \"C:\\\\Windows\\\\System32\\\\rdrleakdiag.exe\",\n        \"?:\\\\Windows\\\\System32\\\\Taskmgr.exe\",\n        \"?:\\\\Windows\\\\SysWOW64\\\\Taskmgr.exe\",\n        \"?:\\\\Program Files\\\\*.exe\",\n        \"?:\\\\Program Files (x86)\\\\*.exe\",\n        \"?:\\\\Windows\\\\SystemApps\\\\*.exe\",\n        \"?:\\\\Users\\\\*\\\\AppData\\\\Roaming\\\\Zoom\\\\bin\\\\zCrashReport64.exe\",\n        \"?:\\\\Windows\\\\CCM\\\\ccmdump.exe\"\n      ) and process.code_signature.trusted == true\n    ) or\n    (\n      file.path : (\n        \"?:\\\\ProgramData\\\\Microsoft\\\\Windows\\\\WER\\\\*\",\n        \"?:\\\\ProgramData\\\\Microsoft\\\\WDF\\\\*\",\n        \"?:\\\\ProgramData\\\\Alteryx\\\\ErrorLogs\\\\*\",\n        \"?:\\\\ProgramData\\\\Goodix\\\\*\",\n        \"?:\\\\Windows\\\\system32\\\\config\\\\systemprofile\\\\AppData\\\\Local\\\\CrashDumps\\\\*\",\n        \"?:\\\\Users\\\\*\\\\AppData\\\\Roaming\\\\Zoom\\\\logs\\\\zoomcrash*\",\n        \"?:\\\\Users\\\\*\\\\AppData\\\\*\\\\Crashpad\\\\*\",\n        \"?:\\\\Users\\\\*\\\\AppData\\\\*\\\\crashpaddb\\\\*\",\n        \"?:\\\\Users\\\\*\\\\AppData\\\\*\\\\HungReports\\\\*\",\n        \"?:\\\\Users\\\\*\\\\AppData\\\\*\\\\CrashDumps\\\\*\",\n        \"?:\\\\Users\\\\*\\\\AppData\\\\*\\\\NativeCrashReporting\\\\*\"\n      ) and (process.code_signature.trusted == true or process.executable == null)\n    )\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file-*"
        ]
      },
      {
        "name": "Suspicious Network Connection via systemd",
        "description": "Detects suspicious network events executed by systemd, potentially indicating persistence through a systemd backdoor. Systemd is a system and service manager for Linux operating systems, used to initialize and manage system processes. Attackers can backdoor systemd for persistence by creating or modifying systemd unit files to execute malicious scripts or commands, or by replacing legitimate systemd binaries with compromised ones, ensuring that their malicious code is automatically executed at system startup or during certain system events.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Command and Control",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/",
                "subtechnique": [
                  {
                    "id": "T1543.002",
                    "name": "Systemd Service",
                    "reference": "https://attack.mitre.org/techniques/T1543/002/"
                  }
                ]
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": []
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "ab5cbdbe-77f2-4c03-9c6e-d8ce1af4934b",
        "rule_id": "f3818c85-2207-4b51-8a28-d70fb156ee87",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.512Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.512Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id with maxspan=5s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.parent.name == \"systemd\" and process.name in (\n     \"python*\", \"php*\", \"perl\", \"ruby\", \"lua*\", \"openssl\", \"nc\", \"netcat\", \"ncat\", \"telnet\", \"awk\"\n   )\n  ] by process.entity_id\n  [network where host.os.type == \"linux\" and event.action == \"connection_attempted\" and event.type == \"start\" and\n   not process.executable == \"/tmp/newroot/bin/curl\"] by process.parent.entity_id\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "AWS Bedrock Guardrails Detected Multiple Policy Violations Within a Single Blocked Request",
        "description": "Identifies multiple violations of AWS Bedrock guardrails within a single request, resulting in a block action, increasing the likelihood of malicious intent. Multiple violations implies that a user may be intentionally attempting to cirvumvent security controls, access sensitive information, or possibly exploit a vulnerability in the system.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Amazon Bedrock Guardrail Multiple Policy Violations Within a Single Blocked Request.\n\nAmazon Bedrock Guardrail is a set of features within Amazon Bedrock designed to help businesses apply robust safety and privacy controls to their generative AI applications.\n\nIt enables users to set guidelines and filters that manage content quality, relevancy, and adherence to responsible AI practices.\n\nThrough Guardrail, organizations can define \"denied topics\" to prevent the model from generating content on specific, undesired subjects,\nand they can establish thresholds for harmful content categories, including hate speech, violence, or offensive language.\n\n#### Possible investigation steps\n\n- Identify the user account and the user request that caused multiple policy violations and whether it should perform this kind of action.\n- Investigate the user activity that might indicate a potential brute force attack.\n- Investigate other alerts associated with the user account during the past 48 hours.\n- Consider the time of day. If the user is a human (not a program or script), did the activity take place during a normal time of day?\n- Examine the account's prompts and responses in the last 24 hours.\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking Amazon Bedrock model access, prompts generated, and responses to the prompts by the account in the last 24 hours.\n\n### False positive analysis\n\n- Verify the user account that caused multiple policy violations, is not testing any new model deployments or updated compliance policies in Amazon Bedrock guardrails.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Identify if the attacker is moving laterally and compromising other Amazon Bedrock Services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Review the permissions assigned to the implicated user group or role behind these requests to ensure they are authorized and expected to access bedrock and ensure that the least privilege principle is being followed.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: LLM",
          "Data Source: AWS Bedrock",
          "Data Source: AWS S3",
          "Resources: Investigation Guide",
          "Use Case: Policy Violation",
          "Mitre Atlas: T0051",
          "Mitre Atlas: T0054"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate misunderstanding by users or overly strict policies"
        ],
        "references": [
          "https://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-components.html",
          "https://atlas.mitre.org/techniques/AML.T0051",
          "https://atlas.mitre.org/techniques/AML.T0054",
          "https://www.elastic.co/security-labs/elastic-advances-llm-security"
        ],
        "max_signals": 100,
        "threat": [],
        "setup": "## Setup\n\nThis rule requires that guardrails are configured in AWS Bedrock. For more information, see the AWS Bedrock documentation:\n\nhttps://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-create.html\n",
        "related_integrations": [],
        "required_fields": [],
        "id": "bde29029-b2e8-4e97-b7f5-8fd8872a6815",
        "rule_id": "f4c2515a-18bb-47ce-a768-1dc4e7b0fe6c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.516Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.516Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws_bedrock.invocation-*\n| where gen_ai.policy.action == \"BLOCKED\"\n| eval policy_violations = mv_count(gen_ai.policy.name)\n| where policy_violations > 1\n| keep gen_ai.policy.action, policy_violations, user.id, gen_ai.request.model.id, cloud.account.id, user.id\n| stats total_unique_request_violations = count(*) by policy_violations, user.id, gen_ai.request.model.id, cloud.account.id\n| sort total_unique_request_violations desc\n"
      },
      {
        "name": "Potential Privilege Escalation via Linux DAC permissions",
        "description": "Identifies potential privilege escalation exploitation of DAC (Discretionary access control) file permissions. The rule identifies exploitation of DAC checks on sensitive file paths via suspicious processes whose capabilities include CAP_DAC_OVERRIDE (where a process can bypass all read write and execution checks) or CAP_DAC_READ_SEARCH (where a process can read any file or perform any executable permission on the directories).",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.thread.capabilities.effective",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.thread.capabilities.permitted",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "4f9bd5c5-61b1-4fac-95a3-c10bb4a22066",
        "rule_id": "f7c70f2e-4616-439c-85ac-5b98415042fe",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.519Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.519Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.category:process and host.os.type:linux and event.type:start and event.action:exec and\n(process.thread.capabilities.permitted:CAP_DAC_* or process.thread.capabilities.effective: CAP_DAC_*) and\nprocess.command_line:(*sudoers* or *passwd* or *shadow* or */root/*) and not (\n  user.id : \"0\" or\n  process.name : (\n    \"tar\" or \"getent\" or \"su\" or \"stat\" or \"dirname\" or \"chown\" or \"sudo\" or \"dpkg-split\" or \"dpkg-deb\" or \"dpkg\" or\n    \"podman\" or \"awk\" or \"passwd\" or \"dpkg-maintscript-helper\" or \"mutt_dotlock\" or \"nscd\" or \"logger\" or \"gpasswd\"\n  ) or\n  process.executable : /usr/lib/*/lxc/rootfs/* or\n  process.parent.name : (\n    \"dpkg\" or \"java\" or *postinst or \"dpkg-preconfigure\" or \"gnome-shell\"\n  )\n)\n",
        "new_terms_fields": [
          "process.executable"
        ],
        "history_window_start": "now-10d",
        "index": [
          "logs-endpoint.events.*"
        ],
        "language": "kuery"
      },
      {
        "name": "Browser Extension Install",
        "description": "Identifies the install of browser extensions. Malicious browser extensions can be installed via app store downloads masquerading as legitimate extensions, social engineering, or by an adversary that has already compromised a system.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 202,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: SentinelOne",
          "Data Source: Sysmon",
          "Data Source: Microsoft Defender for Endpoint"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1176",
                "name": "Browser Extensions",
                "reference": "https://attack.mitre.org/techniques/T1176/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "b3a05eb8-553d-4ed6-952c-2c8d686709e4",
        "rule_id": "f97504ac-1053-498f-aeaa-c6d01e76b379",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.522Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.522Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"windows\" and event.type : \"creation\" and \n(\n  /* Firefox-Based Browsers */\n  (\n    file.name : \"*.xpi\" and\n    file.path : \"?:\\\\Users\\\\*\\\\AppData\\\\Roaming\\\\*\\\\Profiles\\\\*\\\\Extensions\\\\*.xpi\" and\n    not \n    (\n      process.name : \"firefox.exe\" and\n      file.name : (\"langpack-*@firefox.mozilla.org.xpi\", \"*@dictionaries.addons.mozilla.org.xpi\")\n    )\n  ) or\n  /* Chromium-Based Browsers */\n  (\n    file.name : \"*.crx\" and\n    file.path : \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\*\\\\*\\\\User Data\\\\Webstore Downloads\\\\*\"\n  )\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file-*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-windows.sysmon_operational-*",
          "winlogbeat-*",
          "endgame-*"
        ]
      },
      {
        "name": "User or Group Creation/Modification",
        "description": "This rule leverages the `auditd_manager` integration to detect user or group creation or modification events on Linux systems. Threat actors may attempt to create or modify users or groups to establish persistence on the system.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/primer-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1136",
                "name": "Create Account",
                "reference": "https://attack.mitre.org/techniques/T1136/",
                "subtechnique": [
                  {
                    "id": "T1136.001",
                    "name": "Local Account",
                    "reference": "https://attack.mitre.org/techniques/T1136/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Auditd Manager.\n\n### Auditd Manager Integration Setup\nThe Auditd Manager Integration receives audit events from the Linux Audit Framework which is a part of the Linux kernel.\nAuditd Manager provides a user-friendly interface and automation capabilities for configuring and monitoring system auditing through the auditd daemon. With `auditd_manager`, administrators can easily define audit rules, track system events, and generate comprehensive audit reports, improving overall security and compliance in the system.\n\n#### The following steps should be executed in order to add the Elastic Agent System integration \"auditd_manager\" on a Linux System:\n- Go to the Kibana home page and click “Add integrations”.\n- In the query bar, search for “Auditd Manager” and select the integration to see more details about it.\n- Click “Add Auditd Manager”.\n- Configure the integration name and optionally add a description.\n- Review optional and advanced settings accordingly.\n- Add the newly installed “auditd manager” to an existing or a new agent policy, and deploy the agent on a Linux system from which auditd log files are desirable.\n- Click “Save and Continue”.\n- For more details on the integration refer to the [helper guide](https://docs.elastic.co/integrations/auditd_manager).\n\n#### Rule Specific Setup Note\nAuditd Manager subscribes to the kernel and receives events as they occur without any additional configuration.\nHowever, if more advanced configuration is required to detect specific behavior, audit rules can be added to the integration in either the \"audit rules\" configuration box or the \"auditd rule files\" box by specifying a file to read the audit rules from.\nFor this detection rule to trigger, the following additional audit rules are required to be added to the integration:\n```\n-w /usr/sbin/groupadd -p x -k group_modification\n-w /sbin/groupadd -p x -k group_modification\n-w /usr/sbin/groupmod -p x -k group_modification\n-w /sbin/groupmod -p x -k group_modification\n-w /usr/sbin/addgroup -p x -k group_modification\n-w /sbin/addgroup -p x -k group_modification\n-w /usr/sbin/usermod -p x -k user_modification\n-w /sbin/usermod -p x -k user_modification\n-w /usr/sbin/userdel -p x -k user_modification\n-w /sbin/userdel -p x -k user_modification\n-w /usr/sbin/useradd -p x -k user_modification\n-w /sbin/useradd -p x -k user_modification\n-w /usr/sbin/adduser -p x -k user_modification\n-w /sbin/adduser -p x -k user_modification\n```\n",
        "related_integrations": [
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "auditd.result",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "3edec09f-6a84-4a27-8c04-bea7f6b694e1",
        "rule_id": "fcf733d5-7801-4eb0-92ac-8ffacf3658f2",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.526Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.526Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "iam where host.os.type == \"linux\" and event.type in (\"creation\", \"change\") and auditd.result == \"success\" and \nevent.action in (\"changed-password\", \"added-user-account\", \"added-group-account-to\")\n",
        "language": "eql",
        "index": [
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Suspicious Dynamic Linker Discovery via od",
        "description": "Monitors for dynamic linker discovery via the od utility. od (octal dump) is a command-line utility in Unix operating systems used for displaying data in various formats, including octal, hexadecimal, decimal, and ASCII, primarily used for examining and debugging binary files or data streams. Attackers can leverage od to analyze the dynamic linker by identifying injection points and craft exploits based on the observed behaviors and structures within these files.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/arget13/DDexec"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1057",
                "name": "Process Discovery",
                "reference": "https://attack.mitre.org/techniques/T1057/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "0c0cc2d2-9d64-445f-8581-bfa509381d9a",
        "rule_id": "0369e8a6-0fa7-4e7a-961a-53180a4c966e",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.529Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.529Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\", \"executed\", \"process_started\")\n and process.name == \"od\" and process.args in (\n  \"/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2\", \"/etc/ld.so.preload\", \"/lib64/ld-linux-x86-64.so.2\",\n  \"/usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2\", \"/usr/lib64/ld-linux-x86-64.so.2\"\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Potential Escalation via Vulnerable MSI Repair",
        "description": "Identifies when a browser process navigates to the Microsoft Help page followed by spawning an elevated process. This may indicate a successful exploitation for privilege escalation abusing a vulnerable Windows Installer repair setup.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 202,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon",
          "Data Source: SentinelOne",
          "Data Source: Microsoft Defender for Endpoint"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://sec-consult.com/blog/detail/msi-installer-repair-to-system-a-detailed-journey/",
          "https://msrc.microsoft.com/update-guide/en-US/advisory/CVE-2024-38014"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/",
                "subtechnique": [
                  {
                    "id": "T1218.007",
                    "name": "Msiexec",
                    "reference": "https://attack.mitre.org/techniques/T1218/007/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.domain",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "30f8c9a4-045f-4471-96c7-77096f557e5f",
        "rule_id": "043d80a3-c49e-43ef-9c72-1088f0c7b278",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.532Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.532Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where event.type == \"start\" and host.os.type == \"windows\" and\n user.domain : (\"NT AUTHORITY\", \"AUTORITE NT\", \"AUTORIDADE NT\") and\n process.parent.name : (\"chrome.exe\", \"msedge.exe\", \"brave.exe\", \"whale.exe\", \"browser.exe\", \"dragon.exe\", \"vivaldi.exe\",\n                        \"opera.exe\", \"iexplore\", \"firefox.exe\", \"waterfox.exe\", \"iexplore.exe\", \"tor.exe\", \"safari.exe\") and\n process.parent.command_line : \"*go.microsoft.com*\"\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "endgame-*",
          "logs-endpoint.events.process-*",
          "logs-windows.sysmon_operational-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-m365_defender.event-*"
        ]
      },
      {
        "name": "Processes with Trailing Spaces",
        "description": "Identify instances where adversaries include trailing space characters to mimic regular files, disguising their activity to evade default file handling mechanisms.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "OS: macOS",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Rule Type: BBR",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.006",
                    "name": "Space after Filename",
                    "reference": "https://attack.mitre.org/techniques/T1036/006/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "f7ac6df0-9e35-445b-93b9-0c5decd65b94",
        "rule_id": "0c093569-dff9-42b6-87b1-0242d9f7d9b4",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.535Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.535Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where event.type == \"start\" and event.action in (\"exec\", \"exec_event\", \"executed\", \"process_started\") and\nprocess.name : \"* \"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "AWS IAM Login Profile Added to User",
        "description": "Identifies when an AWS IAM login profile is added to a user. Adversaries may add a login profile to an IAM user who typically does not have one and is used only for programmatic access. This can be used to maintain access to the account even if the original access key is rotated or disabled. This is a building block rule and does not generate alerts on its own. It is meant to be used for correlation with other rules to detect suspicious activity.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS IAM",
          "Use Case: Identity and Access Audit",
          "Tactic: Persistence",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1078",
                "name": "Valid Accounts",
                "reference": "https://attack.mitre.org/techniques/T1078/",
                "subtechnique": [
                  {
                    "id": "T1078.004",
                    "name": "Cloud Accounts",
                    "reference": "https://attack.mitre.org/techniques/T1078/004/"
                  }
                ]
              },
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.003",
                    "name": "Additional Cloud Roles",
                    "reference": "https://attack.mitre.org/techniques/T1098/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "ed24516c-fcb5-4c73-b1dd-715d69974146",
        "rule_id": "10445cf0-0748-11ef-ba75-f661ea17fbcc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.539Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.539Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "query": "event.dataset: aws.cloudtrail and event.provider: \"iam.amazonaws.com\"\n    and event.action: \"CreateLoginProfile\" and event.outcome: success\n",
        "language": "kuery"
      },
      {
        "name": "Potential Process Injection from Malicious Document",
        "description": "Identifies child processes of frequently targeted Microsoft Office applications (Word, PowerPoint, Excel) with unusual process arguments and path. This behavior is often observed during exploitation of Office applications or from documents with malicious macros.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Tactic: Privilege Escalation",
          "Tactic: Initial Access",
          "Rule Type: BBR",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1055",
                "name": "Process Injection",
                "reference": "https://attack.mitre.org/techniques/T1055/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1055",
                "name": "Process Injection",
                "reference": "https://attack.mitre.org/techniques/T1055/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1566",
                "name": "Phishing",
                "reference": "https://attack.mitre.org/techniques/T1566/",
                "subtechnique": [
                  {
                    "id": "T1566.001",
                    "name": "Spearphishing Attachment",
                    "reference": "https://attack.mitre.org/techniques/T1566/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.code_signature.subject_name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "48844d6d-9a0f-4e8d-bb9a-b7bcdcb2a160",
        "rule_id": "1c5a04ae-d034-41bf-b0d8-96439b5cc774",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.554Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.554Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.action == \"start\" and\n  process.parent.name : (\"excel.exe\", \"powerpnt.exe\", \"winword.exe\") and\n  process.args_count == 1 and\n  process.executable : (\n    \"?:\\\\Windows\\\\SysWOW64\\\\*.exe\", \"?:\\\\Windows\\\\system32\\\\*.exe\"\n  ) and\n  not (process.executable : \"?:\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\x64\\\\*\" and\n       process.code_signature.trusted == true and not process.code_signature.subject_name : \"Microsoft *\") and\n  not process.executable : (\n    \"?:\\\\Windows\\\\Sys*\\\\Taskmgr.exe\",\n    \"?:\\\\Windows\\\\Sys*\\\\ctfmon.exe\",\n    \"?:\\\\Windows\\\\System32\\\\notepad.exe\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*"
        ]
      },
      {
        "name": "AWS Lambda Function Created or Updated",
        "description": "Identifies when an AWS Lambda function is created or updated. AWS Lambda lets you run code without provisioning or managing servers. Adversaries can create or update Lambda functions to execute malicious code, exfiltrate data, or escalate privileges. This is a [building block rule](https://www.elastic.co/guide/en/security/current/building-block-rule.html) that does not generate alerts, but signals when a Lambda function is created or updated that matches the rule's conditions. To generate alerts, create a rule that uses this signal as a building block.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS Lambda",
          "Use Case: Asset Visibility",
          "Tactic: Execution",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate changes to Lambda functions can trigger this signal. Ensure that the changes are authorized and align with your organization's policies."
        ],
        "references": [
          "https://mattslifebytes.com/2023/04/14/from-rebuilds-to-reloads-hacking-aws-lambda-to-enable-instant-code-updates/",
          "https://stratus-red-team.cloud/attack-techniques/AWS/aws.persistence.lambda-overwrite-code/",
          "https://docs.aws.amazon.com/lambda/latest/api/API_UpdateFunctionCode.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1648",
                "name": "Serverless Execution",
                "reference": "https://attack.mitre.org/techniques/T1648/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "b07b5761-2e0d-4957-8b19-458f7bda5960",
        "rule_id": "1251b98a-ff45-11ee-89a1-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.550Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.550Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "query": "event.dataset: \"aws.cloudtrail\"\n    and event.provider: \"lambda.amazonaws.com\"\n    and event.outcome: \"success\"\n    and event.action: (CreateFunction* or UpdateFunctionCode*)\n",
        "language": "kuery"
      },
      {
        "name": "AWS IAM Roles Anywhere Profile Creation",
        "description": "Identifies the creation of an AWS Roles Anywhere profile. AWS Roles Anywhere is a feature that allows you to use AWS Identity and Access Management (IAM) profiles to manage access to your AWS resources from any location via trusted anchors. This rule detects the creation of a profile that can be assumed from any service. Adversaries may create profiles tied to overly permissive roles to maintain access to AWS resources. Ensure that the profile creation is expected and that the trust policy is configured securely.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS IAM Roles Anywhere Profile Creation\n\nThis rule detects the creation of an AWS Roles Anywhere profile. AWS Roles Anywhere allows you to use AWS Identity and Access Management (IAM) profiles to manage access to your AWS resources from any location via trusted anchors. Adversaries may create profiles tied to overly permissive roles to maintain access to AWS resources. It is crucial to ensure that the profile creation is expected and that the trust policy is configured securely.\n\n#### Possible Investigation Steps:\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who created the profile. Verify if this actor typically performs such actions and if they have the necessary permissions.\n- **Review the Request Details**: Examine the `aws.cloudtrail.request_parameters` to understand the specific details of the profile creation. Look for any unusual parameters or overly permissive roles that could suggest unauthorized or malicious activity.\n- **Analyze the Source of the Request**: Investigate the `source.ip` and `source.geo` fields to determine the location and origin of the request. Ensure the request originated from a known and trusted location.\n- **Check the Created Profile’s Permissions**: Review the `roleArns` associated with the created profile. Verify that the roles are appropriate for the user's intended actions and do not grant excessive permissions.\n- **Verify the Profile’s Configuration**: Ensure that the profile's `durationSeconds`, `enabled`, and `tags` are configured according to your organization's security policies. Pay particular attention to any configuration that might allow prolonged access or concealment of activity.\n\n### False Positive Analysis:\n\n- **Legitimate Administrative Actions**: Confirm if the profile creation aligns with scheduled updates, development activities, or legitimate administrative tasks documented in change management systems.\n- **Consistency Check**: Compare the action against historical data of similar actions performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.\n- **Verify through Outcomes**: Check the `aws.cloudtrail.response_elements` and the `event.outcome` to confirm if the profile creation was successful and intended according to policy.\n\n### Response and Remediation:\n\n- **Immediate Review and Reversal if Necessary**: If the profile creation was unauthorized, disable or delete the created profile and review the associated roles and permissions for any potential misuse.\n- **Enhance Monitoring and Alerts**: Adjust monitoring systems to alert on similar actions, especially those involving sensitive roles or unexpected locations.\n- **Educate and Train**: Provide additional training to users with administrative rights on the importance of security best practices concerning profile and role management and the risks of unauthorized profile creation.\n- **Audit IAM Policies and Permissions**: Conduct a comprehensive audit of all IAM policies and associated permissions to ensure they adhere to the principle of least privilege.\n- **Incident Response**: If there's an indication of malicious intent or a security breach, initiate the incident response protocol to mitigate any damage and prevent future occurrences.\n\n### Additional Information:\n\nFor further guidance on managing AWS IAM Roles Anywhere profiles and securing AWS environments, refer to the [AWS Roles Anywhere documentation](https://docs.aws.amazon.com/rolesanywhere/latest/userguide/introduction.html) and AWS best practices for security. Additionally, consult the following resources for specific details on profile management and potential abuse:\n- [AWS IAM Roles Anywhere Profile Creation API Reference](https://docs.aws.amazon.com/rolesanywhere/latest/APIReference/API_CreateProfile.html)\n- [Ermetic Blog - Managing Third Party Access](https://ermetic.com/blog/aws/keep-your-iam-users-close-keep-your-third-parties-even-closer-part-1/)\n\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS IAM",
          "Use Case: Identity and Access Audit",
          "Tactic: Persistence"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-30m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "AWS Roles Anywhere profiles are legitimate profiles that can be created by administrators to allow access from any location. Ensure that the profile created is expected and that the trust policy is configured securely."
        ],
        "references": [
          "https://docs.aws.amazon.com/rolesanywhere/latest/userguide/introduction.html",
          "https://docs.datadoghq.com/security/default_rules/cloudtrail-aws-iam-roles-anywhere-trust-anchor-created/",
          "https://ermetic.com/blog/aws/keep-your-iam-users-close-keep-your-third-parties-even-closer-part-1/",
          "https://docs.aws.amazon.com/rolesanywhere/latest/APIReference/API_CreateProfile.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.003",
                    "name": "Additional Cloud Roles",
                    "reference": "https://attack.mitre.org/techniques/T1098/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "41e3c8fa-5032-4266-9f21-146a2beea06d",
        "rule_id": "1d4ca9c0-ff1e-11ee-91cc-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.557Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.557Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "query": "event.dataset:aws.cloudtrail\n    and event.provider: rolesanywhere.amazonaws.com\n    and event.action: CreateProfile\n    and event.outcome: success\n",
        "language": "kuery"
      },
      {
        "name": "Potential Widespread Malware Infection Across Multiple Hosts",
        "description": "This rule uses alert data to determine when a malware signature is triggered in multiple hosts. Analysts can use this to prioritize triage and response, as this can potentially indicate a widespread malware infection.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "Data Source: Elastic Defend",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Rule Type: Higher-Order Rule"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/elastic/protections-artifacts/tree/main/yara/rules"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1204",
                "name": "User Execution",
                "reference": "https://attack.mitre.org/techniques/T1204/",
                "subtechnique": [
                  {
                    "id": "T1204.002",
                    "name": "Malicious File",
                    "reference": "https://attack.mitre.org/techniques/T1204/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [],
        "id": "ea0f7902-7bec-4508-8535-dec3fcf0ad73",
        "rule_id": "28371aa1-14ed-46cf-ab5b-2fc7d1942278",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.560Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.560Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-endpoint.alerts-*\n| where event.code in (\"malicious_file\", \"memory_signature\", \"shellcode_thread\") and rule.name is not null\n| keep host.id, rule.name, event.code\n| stats hosts = count_distinct(host.id) by rule.name, event.code\n| where hosts >= 3\n"
      },
      {
        "name": "Root Network Connection via GDB CAP_SYS_PTRACE",
        "description": "Identifies instances where GDB (granted the CAP_SYS_PTRACE capability) is executed, after which an outbound network connection is initiated by UID/GID 0 (root). In Linux, the CAP_SYS_PTRACE capability grants a process the ability to use the ptrace system call, which is typically used for debugging and allows the process to trace and control other processes. Attackers may leverage this capability to hook and inject into a process that is running with root permissions in order to execute shell code and gain a reverse shell with root privileges.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Tactic: Execution",
          "Tactic: Command and Control",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1055",
                "name": "Process Injection",
                "reference": "https://attack.mitre.org/techniques/T1055/",
                "subtechnique": [
                  {
                    "id": "T1055.008",
                    "name": "Ptrace System Calls",
                    "reference": "https://attack.mitre.org/techniques/T1055/008/"
                  }
                ]
              },
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1071",
                "name": "Application Layer Protocol",
                "reference": "https://attack.mitre.org/techniques/T1071/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entry_leader.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.thread.capabilities.effective",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.thread.capabilities.permitted",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "977692d4-150a-41aa-b374-4f09f1e36d68",
        "rule_id": "28bc620d-b2f7-4132-b372-f77953881d05",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.563Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.563Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, process.entry_leader.entity_id with maxspan=30s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and process.name == \"gdb\" and\n   (process.thread.capabilities.effective : \"CAP_SYS_PTRACE\" or process.thread.capabilities.permitted : \"CAP_SYS_PTRACE\") and\n   user.id != \"0\"]\n  [network where host.os.type == \"linux\" and event.action == \"connection_attempted\" and event.type == \"start\" and\n   process.name != null and user.id == \"0\"]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Potential Foxmail Exploitation",
        "description": "Identifies the Foxmail client spawning a child process with argument pointing to the Foxmail temp directory. This may indicate the successful exploitation of a Foxmail vulnerability for initial access and execution via a malicious email.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 202,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Initial Access",
          "Tactic: Execution",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon",
          "Data Source: System",
          "Data Source: Elastic Endgame",
          "Data Source: SentinelOne",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: Crowdstrike"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://mp.weixin.qq.com/s/F8hNyESBdKhwXkQPgtGpew"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1203",
                "name": "Exploitation for Client Execution",
                "reference": "https://attack.mitre.org/techniques/T1203/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1189",
                "name": "Drive-by Compromise",
                "reference": "https://attack.mitre.org/techniques/T1189/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "crowdstrike",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "7037e09d-672e-4433-a381-791a1eff4186",
        "rule_id": "2c6a6acf-0dcb-404d-89fb-6b0327294cfa",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.567Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.567Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and \n process.parent.name : \"Foxmail.exe\" and process.args : (\"?:\\\\Users\\\\*\\\\AppData\\\\*\", \"\\\\\\\\*\")\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-windows.*",
          "endgame-*",
          "logs-system.security*",
          "logs-windows.sysmon_operational-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-m365_defender.event-*",
          "logs-endpoint.events.process-*",
          "logs-crowdstrike.fdr*"
        ]
      },
      {
        "name": "Suspicious /proc/maps Discovery",
        "description": "Monitors for /proc/*/maps file reads. The /proc/*/maps file in Linux provides a memory map for a specific process, detailing the memory segments, permissions, and what files are mapped to these segments. Attackers may read a process's memory map to identify memory addresses for code injection or process hijacking.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/arget13/DDexec"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1057",
                "name": "Process Discovery",
                "reference": "https://attack.mitre.org/techniques/T1057/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entry_leader.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "1051deba-32ec-4c53-9e37-ec8a581d64bc",
        "rule_id": "2f95540c-923e-4f57-9dae-de30169c68b9",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.570Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.570Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\nprocess.name in (\"cat\", \"grep\") and process.args : \"/proc/*/maps\" and process.entry_leader.name in (\n  \"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\"\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "AWS S3 Object Versioning Suspended",
        "description": "Identifies when object versioning is suspended for an Amazon S3 bucket. Object versioning allows for multiple versions of an object to exist in the same bucket. This allows for easy recovery of deleted or overwritten objects. When object versioning is suspended for a bucket, it could indicate an adversary's attempt to inhibit system recovery following malicious activity. Additionally, when versioning is suspended, buckets can then be deleted.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "\n## Triage and Analysis\n\n### Investigating AWS S3 Object Versioning Suspended\n\nThis rule detects when object versioning for an S3 bucket is suspended. Adversaries with access to a misconfigured S3 bucket may disable object versioning prior to replacing or deleting S3 objects, inhibiting recovery initiatives.\nThis rule uses [EQL](https://www.elastic.co/guide/en/security/master/rules-ui-create.html#create-eql-rule) to look for use of the `PutBucketVersioning` operation where the `request_parameters` include `Status=Suspended`.\n\n#### Possible Investigation Steps:\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who performed the action. Verify if this actor typically performs such actions and if they have the necessary permissions.\n- **Analyze the Source of the Request**: Investigate the `source.ip` and `source.geo` fields to determine the geographical origin of the request. An external or unexpected location might indicate compromised credentials or unauthorized access.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this action to see if the same actor or IP address engaged in other potentially suspicious activities.\n- **Check for Object Deletion or Access**: Look for `DeleteObject`, `DeleteObjects`, or `GetObject` API calls to the same S3 bucket that may indicate the adversary accessing and destroying objects including older object versions.\n- **Interview Relevant Personnel**: If the copy event was initiated by a user, verify the intent and authorization for this action with the person or team responsible for managing S3 buckets.\n\n### False Positive Analysis:\n\n- **Legitimate Administrative Actions**: Confirm if the action aligns with legitimate administrative tasks documented in change management systems.\n- **Consistency Check**: Compare the action against historical data of similar activities performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.\n\n### Response and Remediation:\n\n- **Immediate Review**: If the activity was unauthorized, search for replaced or deleted objects and review the bucket's access logs for any suspicious activity.\n- **Educate and Train**: Provide additional training to users with administrative rights on the importance of security best practices concerning S3 bucket management and the risks of ransomware.\n- **Audit S3 Bucket Policies and Permissions**: Conduct a comprehensive audit of all S3 bucket policies and associated permissions to ensure they adhere to the principle of least privilege.\n- **Incident Response**: If there's an indication of malicious intent or a security breach, initiate the incident response protocol to mitigate any damage and prevent future occurrences.\n\n### Additional Information:\n\nFor further guidance on managing S3 bucket security and protecting against ransomware, refer to the [AWS S3 documentation](https://docs.aws.amazon.com/AmazonS3/latest/userguide/Welcome.html) and AWS best practices for security. Additionally, consult the following resources for specific details on S3 ransomware protection:\n- [ERMETIC REPORT - AWS S3 Ransomware Exposure in the Wild](https://s3.amazonaws.com/bizzabo.file.upload/PtZzA0eFQwV2RA5ysNeo_ERMETIC%20REPORT%20-%20AWS%20S3%20Ransomware%20Exposure%20in%20the%20Wild.pdf)\n- [S3 Ransomware Part 1: Attack Vector](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS S3",
          "Use Case: Threat Detection",
          "Tactic: Impact"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Administrators within an AWS Organization structure may legitimately suspend object versioning. Ensure that this behavior is not part of a legitimate operation before taking action."
        ],
        "references": [
          "https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html/",
          "https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketVersioning.html/",
          "https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-post-exploitation/aws-s3-post-exploitation/",
          "https://www.invictus-ir.com/news/ransomware-in-the-cloud/",
          "https://rhinosecuritylabs.com/aws/s3-ransomware-part-2-prevention-and-defense/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1490",
                "name": "Inhibit System Recovery",
                "reference": "https://attack.mitre.org/techniques/T1490/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "48f21857-3449-40bc-936f-74035de40304",
        "rule_id": "30b5bb96-c7db-492c-80e9-1eab00db580b",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.573Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.573Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where event.dataset == \"aws.cloudtrail\" \n   and event.action == \"PutBucketVersioning\"\n   and event.outcome == \"success\" \n   and stringContains(aws.cloudtrail.request_parameters, \"Status=Suspended\")\n",
        "language": "eql",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ]
      },
      {
        "name": "AWS EC2 Multi-Region DescribeInstances API Calls",
        "description": "Identifies when a single AWS resource is making `DescribeInstances` API calls in more than 10 regions within a 30-second window. This could indicate a potential threat actor attempting to discover the AWS infrastructure across multiple regions using compromised credentials or a compromised instance. Adversaries may use this information to identify potential targets for further exploitation or to gain a better understanding of the target's infrastructure.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS EC2 Multi-Region DescribeInstances API Calls\n\nThis rule detects instances where a single AWS resource makes `DescribeInstances` API calls in over 10 regions within a 30-second window. This could indicate an adversary using compromised credentials or an exploited resource to enumerate AWS infrastructure across multiple regions. Attackers often leverage multi-region enumeration to assess the overall cloud environment and find potential targets for further exploitation.\n\n#### Possible Investigation Steps\n\n- **Identify the Resource and Actor**:\n  - **Actor ARN**: Check `aws.cloudtrail.user_identity.arn` to determine the exact identity performing the enumeration. Validate if the user is expected to perform region-wide `DescribeInstances` actions across multiple regions or if it seems unusual.\n  - **Account and Role Details**: Examine `cloud.account.id` and `aws.cloudtrail.user_identity.session_context.session_issuer` for information about the AWS account and specific role associated with the action.\n\n- **Analyze API Call Patterns**:\n  - **Frequency and Scope**: Review `cloud.region` field and confirm if this specific resource commonly performs `DescribeInstances` calls across multiple regions.\n  - **Time Window Context**: Compare the timing of the API calls within the `target_time_window` to determine if this burst pattern aligns with expected system usage or is potentially malicious.\n\n- **Check User Agent and Tooling**:\n  - **Source and User Agent**: Verify `user_agent.original` to determine if the request was made through expected tooling (e.g., AWS CLI or SDK) or a third-party tool that might indicate non-standard access.\n  - **Source IP Address**: Look into `source.address` to identify the origin of the calls. Unusual IP addresses, especially those outside expected ranges, may indicate compromised access.\n\n- **Evaluate for Potential Reconnaissance Behavior**:\n  - **Account and Region Enumeration**: Adversaries may use region-wide `DescribeInstances` requests to discover resources within an account across different regions. Confirm if this access aligns with operational practices or represents excessive access.\n  - **Permissions and Roles**: Investigate the permissions associated with the user role. Excessive permissions on a compromised role may allow broader enumeration, which should be restricted.\n\n- **Review Related CloudTrail Events**:\n  - **Additional Describe or List Actions**: Identify any associated `Describe` or `List` API calls that may indicate further enumeration of other AWS services within the same timeframe.\n  - **Potential Preceding Events**: Look for preceding login or access events from the same actor, as these may indicate potential credential compromise or unauthorized escalation of privileges.\n\n### False Positive Analysis\n\n- **Expected Enumeration**: Certain administrative or automation scripts may conduct broad `DescribeInstances` API calls for inventory purposes. Review usage patterns or consult relevant teams to validate the purpose.\n- **Automated Cloud Management**: Some automated services may perform regional checks for compliance or backup operations. If this rule is triggered repeatedly by a known service, consider whitelisting or tuning accordingly.\n\n### Response and Remediation\n\n- **Review IAM Policies and Role Permissions**: Limit the permissions of roles associated with this resource, restricting unnecessary multi-region enumeration access.\n- **Enforce Least Privilege Access**: Ensure that permissions for DescribeInstances are tightly controlled and restricted to specific roles or accounts that require multi-region access.\n- **Increase Monitoring and Alerts**: Set up additional monitoring on this role or account for further signs of unauthorized activity or lateral movement attempts.\n- **Access Review**: Conduct a review of users and entities with `DescribeInstances` permissions, especially for multi-region capabilities, and ensure these permissions are necessary for their functions.\n\n### Additional Information\n\nFor further information on AWS `DescribeInstances` permissions and best practices, refer to the [AWS DescribeInstances API documentation](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DescribeInstances.html).\n",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "aws.cloudtrail.user_identity.arn",
            "target_time_window",
            "region_count",
            "window_count"
          ]
        },
        "version": 3,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: AWS EC2",
          "Resources: Investigation Guide",
          "Use Case: Threat Detection",
          "Tactic: Discovery"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate use of the `DescribeInstances` API call by an AWS resource that requires information about instances in multiple regions.",
          "Scheduled tasks or scripts that require information about instances in multiple regions."
        ],
        "references": [
          "https://www.sentinelone.com/labs/exploring-fbot-python-based-malware-targeting-cloud-and-payment-services/",
          "https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DescribeInstances.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1580",
                "name": "Cloud Infrastructure Discovery",
                "reference": "https://attack.mitre.org/techniques/T1580/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [],
        "id": "4c25e503-840c-46e5-b281-51c1d30beb4a",
        "rule_id": "393ef120-63d1-11ef-8e38-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.576Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.576Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws.cloudtrail-*\n\n// filter for DescribeInstances API calls\n| where event.dataset == \"aws.cloudtrail\" and event.provider == \"ec2.amazonaws.com\" and event.action == \"DescribeInstances\"\n\n// truncate the timestamp to a 30-second window\n| eval target_time_window = DATE_TRUNC(30 seconds, @timestamp)\n\n// keep only the relevant fields\n| keep target_time_window, aws.cloudtrail.user_identity.arn, cloud.region\n\n// count the number of unique regions and total API calls within the 30-second window\n| stats region_count = count_distinct(cloud.region), window_count = count(*) by target_time_window, aws.cloudtrail.user_identity.arn\n\n// filter for resources making DescribeInstances API calls in more than 10 regions within the 30-second window\n| where region_count >= 10 and window_count >= 10\n\n// sort the results by time windows in descending order\n| sort target_time_window desc\n"
      },
      {
        "name": "AWS EC2 EBS Snapshot Shared with Another Account",
        "description": "Identifies AWS EC2 EBS snaphots being shared with another AWS account. EBS virtual disks can be copied into snapshots, which can then be shared with an external AWS account or made public. Adversaries may attempt this in order to copy the snapshot into an environment they control, to access the data.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "\n## Triage and Analysis\n\n### Investigating AWS EC2 EBS Snapshot Shared with Another Account\n\nThis rule detects when an AWS EC2 EBS snapshot is shared with another AWS account. EBS virtual disks can be copied into snapshots, which can then be shared with an external AWS account or made public. Adversaries may attempt this to copy the snapshot into an environment they control to access the data. Understanding the context and legitimacy of such changes is crucial to determine if the action is benign or malicious.\n\n#### Possible Investigation Steps:\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who made the change. Verify if this actor typically performs such actions and if they have the necessary permissions.\n- **Review the Request Details**: Examine the `aws.cloudtrail.request_parameters` to understand the specific changes made to the snapshot permissions. Look for any unusual parameters that could suggest unauthorized or malicious modifications.\n- **Analyze the Source of the Request**: Investigate the `source.ip` and `source.geo` fields to determine the geographical origin of the request. An external or unexpected location might indicate compromised credentials or unauthorized access.\n- **Contextualize with Timestamp**: Use the `@timestamp` field to check when the change occurred. Modifications during non-business hours or outside regular maintenance windows might require further scrutiny.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this change to see if the same actor or IP address engaged in other potentially suspicious activities.\n\n### False Positive Analysis:\n\n- **Legitimate Administrative Actions**: Confirm if the snapshot sharing aligns with scheduled updates, development activities, or legitimate administrative tasks documented in change management systems.\n- **Consistency Check**: Compare the action against historical data of similar actions performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.\n- **Verify through Outcomes**: Check the `aws.cloudtrail.response_elements` and the `event.outcome` to confirm if the change was successful and intended according to policy.\n\n### Response and Remediation:\n\n- **Immediate Review and Reversal if Necessary**: If the change was unauthorized, update the snapshot permissions to remove any unauthorized accounts and restore it to its previous state.\n- **Enhance Monitoring and Alerts**: Adjust monitoring systems to alert on similar actions, especially those involving sensitive data or permissions.\n- **Educate and Train**: Provide additional training to users with administrative rights on the importance of security best practices concerning snapshot management and sharing permissions.\n- **Audit Snapshots and Policies**: Conduct a comprehensive audit of all snapshots and associated policies to ensure they adhere to the principle of least privilege.\n- **Incident Response**: If there's an indication of malicious intent or a security breach, initiate the incident response protocol to mitigate any damage and prevent future occurrences.\n\n### Additional Information:\n\nFor further guidance on managing EBS snapshots and securing AWS environments, refer to the [AWS EBS documentation](https://docs.aws.amazon.com/ebs/latest/userguide/ebs-modifying-snapshot-permissions.html) and AWS best practices for security. Additionally, consult the following resources for specific details on EBS snapshot security:\n- [AWS EBS Snapshot Permissions](https://docs.aws.amazon.com/ebs/latest/userguide/ebs-modifying-snapshot-permissions.html)\n- [AWS API ModifySnapshotAttribute](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ModifySnapshotAttribute.html)\n- [AWS EBS Snapshot Dump](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/aws-ebs-snapshot-dump)\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS EC2",
          "Use Case: Threat Detection",
          "Tactic: Exfiltration"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "AMI sharing is a common practice in AWS environments. Ensure that the sharing is authorized before taking action."
        ],
        "references": [
          "https://docs.aws.amazon.com/ebs/latest/userguide/ebs-modifying-snapshot-permissions.html",
          "https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ModifySnapshotAttribute.html",
          "https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/aws-ebs-snapshot-dump"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": [
              {
                "id": "T1537",
                "name": "Transfer Data to Cloud Account",
                "reference": "https://attack.mitre.org/techniques/T1537/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [],
        "id": "7414b881-c53c-41b5-8cbc-8b6ea29274e1",
        "rule_id": "4182e486-fc61-11ee-a05d-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.580Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.580Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws.cloudtrail-* metadata _id, _version, _index\n| where event.provider == \"ec2.amazonaws.com\" and event.action == \"ModifySnapshotAttribute\" and event.outcome == \"success\"\n| dissect aws.cloudtrail.request_parameters \"{%{?snapshotId}=%{snapshotId},%{?attributeType}=%{attributeType},%{?createVolumePermission}={%{operationType}={%{?items}=[{%{?userId}=%{userId}}]}}}\"\n| where operationType == \"add\" and cloud.account.id != userId\n| keep @timestamp, aws.cloudtrail.user_identity.arn, cloud.account.id, event.action, snapshotId, attributeType, operationType, userId\n"
      },
      {
        "name": "Route53 Resolver Query Log Configuration Deleted",
        "description": "Identifies when a Route53 Resolver Query Log Configuration is deleted. When a Route53 Resolver query log configuration is deleted, Resolver stops logging DNS queries and responses for the specified configuration. Adversaries may delete query log configurations to evade detection or cover their tracks.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating Route53 Resolver Query Log Configuration Deleted\n\nThis rule detects when a Route53 Resolver Query Log Configuration is deleted. Deleting these configurations stops the logging of DNS queries and responses, which can significantly impede network monitoring and compromise security visibility. Adversaries may delete these configurations to evade detection, remove evidence, or obscure their activities within a network.\n\nAdversaries target Route53 Resolver query log configurations because these logs can contain evidence of malicious domain queries or responses. By deleting these logs, an adversary can prevent the capture of information that could reveal unauthorized network activities, aiding in avoiding detection and thwarting incident response efforts.\n\n#### Possible Investigation Steps\n\n- **Review the Deletion Details**: Examine the CloudTrail logs to identify when and by whom the deletion was initiated.\n    - Check the `event.action` and `user_identity` elements to understand the scope and authorization of the deletion.\n- **Contextualize with User Actions**: Assess whether the deletion aligns with the user’s role and job responsibilities.\n    - Investigate if similar modifications have occurred recently that could suggest a pattern or broader campaign.\n- **Analyze Access Patterns and Permissions**: Verify whether the user had the appropriate permissions to delete log configurations.\n    - Investigate any recent permission changes that might indicate role abuse or credentials compromise.\n- **Correlate with Other Security Incidents**: Look for related security alerts or incidents that could be connected to the log deletion.\n    - This includes unusual network traffic, alerts from other AWS services, or findings from intrusion detection systems.\n- **Interview the Responsible Team**: If the deletion was initiated by an internal team member, confirm their intent and authorization to ensure it was a legitimate action.\n\n### False Positive Analysis\n\n- **Legitimate Administrative Actions**: Confirm that the deletion was part of scheduled IT operations or network management activities, possibly linked to maintenance or infrastructure updates. Validate this action against change management records or through interviews with relevant personnel.\n\n### Response and Remediation\n\n- **Restore Logs if Feasible**: If the deletion was unauthorized, consider restoring the configuration from backups to ensure continuous visibility into DNS queries.\n- **Review and Tighten Permissions**: Ensure that only authorized personnel have the capability to delete critical configurations.\n    - Adjust AWS IAM policies to reinforce security measures.\n- **Enhance Monitoring of Log Management**: Implement or enhance monitoring rules to detect and alert on unauthorized changes to logging configurations, focusing on critical deletions.\n- **Conduct Comprehensive Security Review**: If the deletion is verified as malicious, initiate a thorough security assessment to identify any further unauthorized changes or ongoing malicious activities.\n\n### Additional Information\n\nFor detailed instructions on managing Route53 Resolver and securing its configurations, refer to the [Amazon Route53 Resolver documentation](https://docs.aws.amazon.com/Route53/latest/APIReference/API_route53resolver_DeleteResolverQueryLogConfig.html).\n\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: Amazon Route53",
          "Use Case: Log Auditing",
          "Resources: Investigation Guide",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate deletion of Route53 Resolver Query Log Configuration by authorized personnel."
        ],
        "references": [
          "https://docs.aws.amazon.com/Route53/latest/APIReference/API_route53resolver_DeleteResolverQueryLogConfig.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1562",
                "name": "Impair Defenses",
                "reference": "https://attack.mitre.org/techniques/T1562/",
                "subtechnique": [
                  {
                    "id": "T1562.008",
                    "name": "Disable or Modify Cloud Logs",
                    "reference": "https://attack.mitre.org/techniques/T1562/008/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "c4a87971-f281-4d55-a685-805ad8c6092e",
        "rule_id": "453183fa-f903-11ee-8e88-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.583Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.583Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail*"
        ],
        "query": "event.dataset:aws.cloudtrail and event.provider: route53resolver.amazonaws.com\n    and event.action: DeleteResolverQueryLogConfig and event.outcome: success\n",
        "language": "kuery"
      },
      {
        "name": "AWS RDS DB Snapshot Shared with Another Account",
        "description": "Identifies an AWS RDS DB snapshot being shared with another AWS account. DB snapshots contain a full backup of an entire DB instance including sensitive data that can be abused if shared with unauthorized accounts or made public. Adversaries may use snapshots to restore a DB Instance in an environment they control as a means of data exfiltration.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS RDS DB Snapshot Shared with Another Account\n\nThis rule identifies when an RDS DB snapshot is shared with another AWS account. While sharing DB snapshots is a common practice, adversaries may exploit this feature to exfiltrate data by sharing snapshots with external accounts under their control.\n\n#### Possible Investigation Steps\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who made the change. Verify if this actor typically performs such actions and if they have the necessary permissions.\n- **Review the Sharing Event**: Identify the DB snapshot involved and review the event details. Look for `ModifyDBSnapshotAttribute` or `ModifyDBClusterSnapshotAttribute` actions where the snapshot attributes were changed to include additional user accounts.\n    - **Request and Response Parameters**: Check the `aws.cloudtrail.request_parameters` and `aws.cloudtrail.response_elements` fields in the CloudTrail event to identify the DB Snapshot Identifier and account ID with which the snapshot was shared.\n- **Verify the Shared Snapshot**: Check the DB snapshot that was shared and its contents to determine the sensitivity of the data stored within it.\n- **Validate External Account**: Examine the AWS account to which the snapshot was shared. Determine whether this account is known and previously authorized to access such resources.\n- **Contextualize with Recent Changes**: Compare this sharing event against recent changes in RDS DB or Cluster configurations and deployments. Look for any other recent permissions changes or unusual administrative actions.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this change to see if the same actor or IP address engaged in other potentially suspicious activities.\n- **Interview Relevant Personnel**: If the share was initiated by a user, verify the intent and authorization for this action with the person or team responsible for managing DB backups and snapshots.\n\n### False Positive Analysis\n\n- **Legitimate Backup Actions**: Confirm if the Db snapshot sharing aligns with scheduled backups or legitimate automation tasks.\n- **Consistency Check**: Compare the action against historical data of similar actions performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.\n\n### Response and Remediation\n\n- **Immediate Review and Reversal**: If the change was unauthorized, update the snapshot permissions to remove any unauthorized accounts and restore it to its previous state.\n- **Enhance Monitoring and Alerts**: Adjust monitoring systems to alert on similar actions, especially those involving sensitive data or permissions.\n- **Audit Snapshots and Policies**: Conduct a comprehensive audit of all snapshots and associated policies to ensure they adhere to the principle of least privilege.\n- **Policy Update**: Review and possibly update your organization’s policies on DB snapshot sharing to tighten control and prevent unauthorized access.\n- **Incident Response**: If malicious intent is confirmed, consider it a data breach incident and initiate the incident response protocol. This includes further investigation, containment, and recovery.\n\n### Additional Information:\n\nFor further guidance on managing DB backups and securing AWS environments, refer to the [AWS RDS documentation](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_CommonTasks.BackupRestore.html) and AWS best practices for security. Additionally, consult the following resources for specific details on DB snapshot security:\n- [AWS RDS DB Snapshot Sharing](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_ShareSnapshot.html)\n- [AWS RDS ModifyDBSnapshotAttribute](https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_ModifyDBSnapshotAttribute.html)\n- [AWS RDS Snapshot Dump](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-post-exploitation/aws-rds-post-exploitation#rds-modifydbsnapshotattribute-rds-createdbsnapshot)\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS RDS",
          "Resources: Investigation Guide",
          "Use Case: Threat Detection",
          "Tactic: Exfiltration"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "DB snapshot sharing is a common practice in AWS environments. Ensure that the sharing is authorized before taking action."
        ],
        "references": [
          "https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_ModifyDBSnapshotAttribute.html",
          "https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_ShareSnapshot.html",
          "https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-post-exploitation/aws-rds-post-exploitation#rds-modifydbsnapshotattribute-rds-createdbsnapshot"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": [
              {
                "id": "T1537",
                "name": "Transfer Data to Cloud Account",
                "reference": "https://attack.mitre.org/techniques/T1537/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "dc4587be-4767-444e-9059-d837ddfc14de",
        "rule_id": "4577ef08-61d1-4458-909f-25a4b10c87fe",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.586Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.586Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where event.dataset == \"aws.cloudtrail\"\n    and event.provider == \"rds.amazonaws.com\"\n    and event.outcome == \"success\"\n    and event.action in (\"ModifyDBSnapshotAttribute\", \"ModifyDBClusterSnapshotAttribute\") \n    and stringContains(aws.cloudtrail.request_parameters, \"attributeName=restore\")\n    and stringContains(aws.cloudtrail.request_parameters, \"valuesToAdd=[*]\")\n",
        "language": "eql",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ]
      },
      {
        "name": "Tainted Out-Of-Tree Kernel Module Load",
        "description": "This rule monitors the syslog log file for messages related to instances of a out-of-tree kernel module load, indicating the taining of the kernel. Rootkits often leverage kernel modules as their main defense evasion technique. Detecting tainted kernel module loads is crucial for ensuring system security and integrity, as malicious or unauthorized modules can compromise the kernel and lead to system vulnerabilities or unauthorized access.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1547",
                "name": "Boot or Logon Autostart Execution",
                "reference": "https://attack.mitre.org/techniques/T1547/",
                "subtechnique": [
                  {
                    "id": "T1547.006",
                    "name": "Kernel Modules and Extensions",
                    "reference": "https://attack.mitre.org/techniques/T1547/006/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1014",
                "name": "Rootkit",
                "reference": "https://attack.mitre.org/techniques/T1014/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from one of the following integrations:\n- Filebeat\n\n### Filebeat Setup\nFilebeat is a lightweight shipper for forwarding and centralizing log data. Installed as an agent on your servers, Filebeat monitors the log files or locations that you specify, collects log events, and forwards them either to Elasticsearch or Logstash for indexing.\n\n#### The following steps should be executed in order to add the Filebeat for the Linux System:\n- Elastic provides repositories available for APT and YUM-based distributions. Note that we provide binary packages, but no source packages.\n- To install the APT and YUM repositories follow the setup instructions in this [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/setup-repositories.html).\n- To run Filebeat on Docker follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/running-on-docker.html).\n- To run Filebeat on Kubernetes follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/running-on-kubernetes.html).\n- For quick start information for Filebeat refer to the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/8.11/filebeat-installation-configuration.html).\n- For complete Setup and Run Filebeat information refer to the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/setting-up-and-running.html).\n\n#### Rule Specific Setup Note\n- This rule requires the Filebeat System Module to be enabled.\n- The system module collects and parses logs created by the system logging service of common Unix/Linux based distributions.\n- To run the system module of Filebeat on Linux follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html).\n",
        "related_integrations": [
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "message",
            "type": "match_only_text",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "b25fb600-9b83-4b26-8684-8ea3af2ff8a4",
        "rule_id": "51a09737-80f7-4551-a3be-dac8ef5d181a",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.589Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.589Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "logs-system.syslog-*"
        ],
        "query": "host.os.type:linux and event.dataset:\"system.syslog\" and process.name:kernel and \nmessage:\"loading out-of-tree module taints kernel.\"\n",
        "language": "kuery"
      },
      {
        "name": "Potential Chroot Container Escape via Mount",
        "description": "Monitors for the execution of a file system mount followed by a chroot execution. Given enough permissions, a user within a container is capable of mounting the root file system of the host, and leveraging chroot to escape its containarized environment. This behavior pattern is very uncommon and should be investigated.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Domain: Container",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://book.hacktricks.xyz/v/portugues-ht/linux-hardening/privilege-escalation/escaping-from-limited-bash"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1611",
                "name": "Escape to Host",
                "reference": "https://attack.mitre.org/techniques/T1611/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\nSession View uses process data collected by the Elastic Defend integration, but this data is not always collected by default. Session View is available on enterprise subscription for versions 8.3 and above.\n#### To confirm that Session View data is enabled:\n- Go to “Manage → Policies”, and edit one or more of your Elastic Defend integration policies.\n- Select the” Policy settings” tab, then scroll down to the “Linux event collection” section near the bottom.\n- Check the box for “Process events”, and turn on the “Include session data” toggle.\n- If you want to include file and network alerts in Session View, check the boxes for “Network and File events”.\n- If you want to enable terminal output capture, turn on the “Capture terminal output” toggle.\nFor more information about the additional fields collected when this setting is enabled and the usage of Session View for Analysis refer to the [helper guide](https://www.elastic.co/guide/en/security/current/session-view.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a5e85df4-d656-4afb-8515-4a04c813c19d",
        "rule_id": "5ae02ebc-a5de-4eac-afe6-c88de696477d",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.605Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.605Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, process.parent.entity_id with maxspan=5m\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.name == \"mount\" and process.args : \"/dev/sd*\" and process.args_count >= 3 and\n   process.parent.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\")]\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.name == \"chroot\"]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Windows Installer with Suspicious Properties",
        "description": "Identifies the execution of an installer from an archive or with suspicious properties. Adversaries may abuse msiexec.exe to launch local or network accessible MSI files in an attempt to bypass application whitelisting.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Rule Type: BBR",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://lolbas-project.github.io/lolbas/Binaries/Msiexec/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/",
                "subtechnique": [
                  {
                    "id": "T1218.007",
                    "name": "Msiexec",
                    "reference": "https://attack.mitre.org/techniques/T1218/007/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "registry.data.strings",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "registry.value",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "c34cc357-33f2-4d7a-9bc7-ef2b36b111db",
        "rule_id": "55f07d1b-25bc-4a0f-aa0c-05323c1319d0",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.602Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.602Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence with maxspan=1m\n  [registry where host.os.type == \"windows\" and event.type == \"change\" and process.name : \"msiexec.exe\" and\n   (\n    (registry.value : \"InstallSource\" and\n     registry.data.strings : (\"?:\\\\Users\\\\*\\\\Temp\\\\Temp?_*.zip\\\\*\",\n                             \"?:\\\\Users\\\\*\\\\*.7z\\\\*\",\n                             \"?:\\\\Users\\\\*\\\\*.rar\\\\*\")) or\n\n    (registry.value : (\"DisplayName\", \"ProductName\") and registry.data.strings : \"SetupTest\")\n    )]\n  [process where host.os.type == \"windows\" and event.action == \"start\" and\n    process.parent.name : \"msiexec.exe\" and\n    not process.name : \"msiexec.exe\" and\n    not (process.executable : (\"?:\\\\Program Files (x86)\\\\*.exe\", \"?:\\\\Program Files\\\\*.exe\") and process.code_signature.trusted == true)]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Process Capability Enumeration",
        "description": "Identifies recursive process capability enumeration of the entire filesystem through the getcap command. Malicious users may manipulate identified capabilities to gain root privileges.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1057",
                "name": "Process Discovery",
                "reference": "https://attack.mitre.org/techniques/T1057/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "3e60f593-e210-4406-94f1-bbe8852f2072",
        "rule_id": "5c351f54-4187-4ad8-abc8-29b0cfbef8b1",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.609Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.609Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and\nprocess.name == \"getcap\" and process.args == \"-r\" and process.args == \"/\" and process.args_count == 3 and\nuser.id != \"0\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "Sensitive Registry Hive Access via RegBack",
        "description": "Identifies attempts to access sensitive registry hives which contain credentials from the registry backup folder.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Sensitive Registry Hive Access via RegBack\n\nCollecting registry hives is a common way to access credential information as some hives store credential material.\n\nFor example, the SAM hive stores locally cached credentials (SAM Secrets), and the SECURITY hive stores domain cached credentials (LSA secrets).\n\nDumping these hives in combination with the SYSTEM hive enables the attacker to decrypt these secrets.\n\n#### Possible investigation steps\n\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Contact the account owner and confirm whether they are aware of this activity.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Investigate if the credential material was exfiltrated or processed locally by other tools.\n- Investigate potentially compromised accounts. Analysts can do this by searching for login events (e.g., 4624) to the target host.\n\n### False positive analysis\n\n- Administrators can export registry hives for backup purposes. Check whether the user is legitamitely performing this kind of activity.\n\n### Related rules\n\n- Registry Hive File Creation via SMB - a4c7473a-5cb4-4bc1-9d06-e4a75adbc494\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Reimage the host operating system and restore compromised files to clean versions.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Resources: Investigation Guide",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1003",
                "name": "OS Credential Dumping",
                "reference": "https://attack.mitre.org/techniques/T1003/",
                "subtechnique": [
                  {
                    "id": "T1003.002",
                    "name": "Security Account Manager",
                    "reference": "https://attack.mitre.org/techniques/T1003/002/"
                  },
                  {
                    "id": "T1003.004",
                    "name": "LSA Secrets",
                    "reference": "https://attack.mitre.org/techniques/T1003/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "548432c0-ce75-47ad-85f3-a08b6f61fc0a",
        "rule_id": "63e381a6-0ffe-4afb-9a26-72a59ad16d7b",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.612Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.612Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"windows\" and \n event.action == \"open\" and event.outcome == \"success\" and process.executable != null and \n file.path :\n      (\"?:\\\\Windows\\\\System32\\\\config\\\\RegBack\\\\SAM\",\n       \"?:\\\\Windows\\\\System32\\\\config\\\\RegBack\\\\SECURITY\",\n       \"?:\\\\Windows\\\\System32\\\\config\\\\RegBack\\\\SYSTEM\") and \n not (\n    user.id == \"S-1-5-18\" and process.executable : (\n        \"?:\\\\Windows\\\\system32\\\\taskhostw.exe\", \"?:\\\\Windows\\\\system32\\\\taskhost.exe\"\n    ))\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*"
        ]
      },
      {
        "name": "Dynamic Linker Creation or Modification",
        "description": "Detects the creation or modification of files related to the dynamic linker on Linux systems. The dynamic linker is a shared library that is used by the Linux kernel to load and execute programs. Attackers may attempt to hijack the execution flow of a program by modifying the dynamic linker configuration files.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Tactic: Persistence",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/",
                "subtechnique": [
                  {
                    "id": "T1574.006",
                    "name": "Dynamic Linker Hijacking",
                    "reference": "https://attack.mitre.org/techniques/T1574/006/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/",
                "subtechnique": [
                  {
                    "id": "T1574.006",
                    "name": "Dynamic Linker Hijacking",
                    "reference": "https://attack.mitre.org/techniques/T1574/006/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.original.extension",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "252c036b-d910-4c13-877b-d6eb3e8d95ee",
        "rule_id": "640f79d1-571d-4f96-a9af-1194fc8cf763",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.615Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.615Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.action in (\"creation\", \"rename\") and\nfile.path : (\"/etc/ld.so.preload\", \"/etc/ld.so.conf.d/*\", \"/etc/ld.so.conf\") and\nnot (\n  process.executable in (\n    \"/bin/dpkg\", \"/usr/bin/dpkg\", \"/bin/dockerd\", \"/usr/bin/dockerd\", \"/usr/sbin/dockerd\", \"/bin/microdnf\",\n    \"/usr/bin/microdnf\", \"/bin/rpm\", \"/usr/bin/rpm\", \"/bin/snapd\", \"/usr/bin/snapd\", \"/bin/yum\", \"/usr/bin/yum\",\n    \"/bin/dnf\", \"/usr/bin/dnf\", \"/bin/podman\", \"/usr/bin/podman\", \"/bin/dnf-automatic\", \"/usr/bin/dnf-automatic\",\n    \"/bin/pacman\", \"/usr/bin/pacman\", \"/usr/bin/dpkg-divert\", \"/bin/dpkg-divert\", \"/sbin/apk\", \"/usr/sbin/apk\",\n    \"/usr/local/sbin/apk\", \"/usr/bin/apt\", \"/usr/sbin/pacman\", \"/bin/podman\", \"/usr/bin/podman\", \"/usr/bin/puppet\",\n    \"/bin/puppet\", \"/opt/puppetlabs/puppet/bin/puppet\", \"/usr/bin/chef-client\", \"/bin/chef-client\",\n    \"/bin/autossl_check\", \"/usr/bin/autossl_check\", \"/proc/self/exe\", \"/dev/fd/*\",  \"/usr/bin/pamac-daemon\",\n    \"/bin/pamac-daemon\", \"/usr/lib/snapd/snapd\", \"/usr/local/bin/dockerd\", \"/usr/libexec/platform-python\",\n    \"/usr/lib/snapd/snap-update-ns\", \"/usr/bin/vmware-config-tools.pl\"\n  ) or\n  file.extension in (\"swp\", \"swpx\", \"swx\", \"dpkg-remove\") or\n  file.Ext.original.extension == \"dpkg-new\" or\n  process.executable : (\n    \"/nix/store/*\", \"/var/lib/dpkg/*\", \"/snap/*\", \"/dev/fd/*\", \"/usr/lib/virtualbox/*\", \"/opt/dynatrace/oneagent/*\"\n  ) or\n  process.executable == null or\n  process.name == \"java\" or\n  (process.name == \"sed\" and file.name : \"sed*\") or\n  (process.name == \"perl\" and file.name : \"e2scrub_all.tmp*\")\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Suspicious rc.local Error Message",
        "description": "This rule monitors the syslog log file for error messages related to the rc.local process. The rc.local file is a script that is executed during the boot process on Linux systems. Attackers may attempt to modify the rc.local file to execute malicious commands or scripts during system startup. This rule detects error messages such as \"Connection refused,\" \"No such file or directory,\" or \"command not found\" in the syslog log file, which may indicate that the rc.local file has been tampered with.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.intezer.com/blog/malware-analysis/hiddenwasp-malware-targeting-linux-systems/",
          "https://pberba.github.io/security/2022/02/06/linux-threat-hunting-for-persistence-initialization-scripts-and-shell-configuration/#8-boot-or-logon-initialization-scripts-rc-scripts",
          "https://www.cyberciti.biz/faq/how-to-enable-rc-local-shell-script-on-systemd-while-booting-linux-system/",
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1037",
                "name": "Boot or Logon Initialization Scripts",
                "reference": "https://attack.mitre.org/techniques/T1037/",
                "subtechnique": [
                  {
                    "id": "T1037.004",
                    "name": "RC Scripts",
                    "reference": "https://attack.mitre.org/techniques/T1037/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from one of the following integrations:\n- Filebeat\n\n### Filebeat Setup\nFilebeat is a lightweight shipper for forwarding and centralizing log data. Installed as an agent on your servers, Filebeat monitors the log files or locations that you specify, collects log events, and forwards them either to Elasticsearch or Logstash for indexing.\n\n#### The following steps should be executed in order to add the Filebeat for the Linux System:\n- Elastic provides repositories available for APT and YUM-based distributions. Note that we provide binary packages, but no source packages.\n- To install the APT and YUM repositories follow the setup instructions in this [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/setup-repositories.html).\n- To run Filebeat on Docker follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/running-on-docker.html).\n- To run Filebeat on Kubernetes follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/running-on-kubernetes.html).\n- For quick start information for Filebeat refer to the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/8.11/filebeat-installation-configuration.html).\n- For complete Setup and Run Filebeat information refer to the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/setting-up-and-running.html).\n\n#### Rule Specific Setup Note\n- This rule requires the Filebeat System Module to be enabled.\n- The system module collects and parses logs created by the system logging service of common Unix/Linux based distributions.\n- To run the system module of Filebeat on Linux follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html).\n",
        "related_integrations": [
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "message",
            "type": "match_only_text",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "5ac01126-23cd-465e-b613-d2d59a68191f",
        "rule_id": "69c116bb-d86f-48b0-857d-3648511a6cac",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.618Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.618Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "logs-system.syslog-*"
        ],
        "query": "host.os.type:linux and event.dataset:system.syslog and process.name:rc.local and\nmessage:(\"Connection refused\" or \"No such file or directory\" or \"command not found\")\n",
        "language": "kuery"
      },
      {
        "name": "EC2 AMI Shared with Another Account",
        "description": "Identifies an AWS Amazon Machine Image (AMI) being shared with another AWS account. Adversaries with access may share an AMI with an external AWS account as a means of data exfiltration. AMIs can contain secrets, bash histories, code artifacts, and other sensitive data that adversaries may abuse if shared with unauthorized accounts. AMIs can be made publicly available accidentally as well.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating EC2 AMI Shared with Another Account\n\nThis rule identifies when an Amazon Machine Image (AMI) is shared with another AWS account. While sharing AMIs is a common practice, adversaries may exploit this feature to exfiltrate data by sharing AMIs with external accounts under their control.\n\n#### Possible Investigation Steps\n\n- **Review the Sharing Event**: Identify the AMI involved and review the event details in AWS CloudTrail. Look for `ModifyImageAttribute` actions where the AMI attributes were changed to include additional user accounts.\n    - **Request and Response Parameters**: Check the `aws.cloudtrail.request_parameters` and `aws.response.response_elements` fields in the CloudTrail event to identify the AMI ID and the user ID of the account with which the AMI was shared.\n- **Verify the Shared AMI**: Check the AMI that was shared and its contents to determine the sensitivity of the data stored within it.\n- **Contextualize with Recent Changes**: Compare this sharing event against recent changes in AMI configurations and deployments. Look for any other recent permissions changes or unusual administrative actions.\n- **Validate External Account**: Examine the AWS account to which the AMI was shared. Determine whether this account is known and previously authorized to access such resources.\n- **Interview Relevant Personnel**: If the share was initiated by a user, verify the intent and authorization for this action with the person or team responsible for managing AMI deployments.\n- **Audit Related Security Policies**: Check the security policies governing AMI sharing within your organization to ensure they are being followed and are adequate to prevent unauthorized sharing.\n\n### False Positive Analysis\n\n- **Legitimate Sharing Practices**: AMI sharing is a common and legitimate practice for collaboration and resource management in AWS. Always verify that the sharing activity was unauthorized before escalating.\n- **Automation Tools**: Some organizations use automation tools for AMI management which might programmatically share AMIs. Verify if such tools are in operation and whether their actions are responsible for the observed behavior.\n\n### Response and Remediation\n\n- **Review and Revoke Unauthorized Shares**: If the share is found to be unauthorized, immediately revoke the shared permissions from the AMI.\n- **Enhance Monitoring of Shared AMIs**: Implement monitoring to track changes to shared AMIs and alert on unauthorized access patterns.\n- **Incident Response**: If malicious intent is confirmed, consider it a data breach incident and initiate the incident response protocol. This includes further investigation, containment, and recovery.\n- **Policy Update**: Review and possibly update your organization’s policies on AMI sharing to tighten control and prevent unauthorized access.\n- **Educate Users**: Conduct training sessions for users involved in managing AMIs to reinforce best practices and organizational policies regarding AMI sharing.\n\n### Additional Information\n\nFor more information on managing and sharing AMIs, refer to the [Amazon EC2 User Guide on AMIs](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html) and [Sharing AMIs](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/sharingamis-explicit.html). Additionally, explore adversarial techniques related to data exfiltration via AMI sharing as documented by Stratus Red Team [here](https://stratus-red-team.cloud/attack-techniques/AWS/aws.exfiltration.ec2-share-ami/).\n\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS EC2",
          "Use Case: Threat Detection",
          "Tactic: Exfiltration"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "AMI sharing is a common practice in AWS environments. Ensure that the sharing is authorized before taking action."
        ],
        "references": [
          "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html",
          "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/sharingamis-explicit.html",
          "https://stratus-red-team.cloud/attack-techniques/AWS/aws.exfiltration.ec2-share-ami/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": [
              {
                "id": "T1537",
                "name": "Transfer Data to Cloud Account",
                "reference": "https://attack.mitre.org/techniques/T1537/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "9ef0d6a1-78fa-472d-9248-273b4fe26b29",
        "rule_id": "6a309864-fc3f-11ee-b8cc-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.622Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.622Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "query": "event.dataset: \"aws.cloudtrail\" and event.provider: \"ec2.amazonaws.com\"\n    and event.action: ModifyImageAttribute and event.outcome: success\n    and aws.cloudtrail.request_parameters: (*imageId* and *add* and *userId*)\n",
        "language": "kuery"
      },
      {
        "name": "AWS IAM Roles Anywhere Trust Anchor Created with External CA",
        "description": "Identifies when an AWS IAM Roles Anywhere Trust Anchor with an external certificate authority is created. AWS Roles Anywhere profiles are legitimate profiles that can be created by administrators to allow access from any location. This rule detects when a trust anchor is created with an external certificate authority that is not managed by AWS Certificate Manager Private Certificate Authority (ACM PCA). Adversaries may accomplish this to maintain persistence in the environment.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS IAM Roles Anywhere Trust Anchor Created with External CA\n\nThis rule detects when an AWS IAM Roles Anywhere Trust Anchor with an external certificate authority is created. AWS Roles Anywhere profiles are legitimate profiles that can be created by administrators to allow access from any location. This rule identifies when a trust anchor is created with an external certificate authority that is not managed by AWS Certificate Manager Private Certificate Authority (ACM PCA). Adversaries may accomplish this to maintain persistence in the environment.\n\n#### Possible Investigation Steps:\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who made the change. Verify if this actor typically performs such actions and if they have the necessary permissions.\n- **Review the Request Details**: Examine the `aws.cloudtrail.request_parameters` to understand the specific details of the trust anchor creation. Look for any unusual parameters that could suggest unauthorized or malicious modifications.\n- **Analyze the Source of the Request**: Investigate the `source.ip` and `source.geo` fields to determine the geographical origin of the request. An external or unexpected location might indicate compromised credentials or unauthorized access.\n- **Contextualize with Timestamp**: Use the `@timestamp` field to check when the trust anchor was created. Changes during non-business hours or outside regular maintenance windows might require further scrutiny.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this change to see if the same actor or IP address engaged in other potentially suspicious activities.\n- **Verify the Certificate Authority**: Ensure that the external certificate authority used is authorized and recognized. Unauthorized external CAs can be a red flag for malicious activity.\n\n### False Positive Analysis:\n\n- **Legitimate Administrative Actions**: Confirm if the trust anchor creation aligns with scheduled updates, development activities, or legitimate administrative tasks documented in change management systems.\n- **Consistency Check**: Compare the action against historical data of similar actions performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.\n- **Verify through Outcomes**: Check the `aws.cloudtrail.response_elements` and the `event.outcome` to confirm if the creation was successful and intended according to policy.\n\n### Response and Remediation:\n\n- **Immediate Review and Reversal if Necessary**: If the creation was unauthorized, remove the trust anchor and revoke any associated permissions.\n- **Enhance Monitoring and Alerts**: Adjust monitoring systems to alert on similar actions, especially those involving the creation of trust anchors with external certificate authorities.\n- **Educate and Train**: Provide additional training to users with administrative rights on the importance of security best practices concerning IAM Roles Anywhere and the use of certificate authorities.\n- **Audit IAM Roles and Policies**: Conduct a comprehensive audit of all IAM roles and associated policies to ensure they adhere to the principle of least privilege.\n- **Incident Response**: If there's an indication of malicious intent or a security breach, initiate the incident response protocol to mitigate any damage and prevent future occurrences.\n\n### Additional Information:\n\nFor further guidance on managing IAM Roles Anywhere and securing AWS environments, refer to the [AWS IAM Roles Anywhere documentation](https://docs.aws.amazon.com/rolesanywhere/latest/userguide/introduction.html) and AWS best practices for security. Additionally, consult the following resources for specific details on IAM roles and trust anchors:\n- [AWS IAM Roles Anywhere Introduction](https://docs.aws.amazon.com/rolesanywhere/latest/userguide/introduction.html)\n- [Ermetic Blog on IAM Users and Third Parties](https://ermetic.com/blog/aws/keep-your-iam-users-close-keep-your-third-parties-even-closer-part-1/)\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS IAM",
          "Use Case: Identity and Access Audit",
          "Tactic: Persistence"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-30m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "AWS IAM Roles Anywhere Trust Anchors are legitimate profiles that can be created by administrators to allow access from any location. Ensure that the trust anchor is created by a legitimate administrator and that the external certificate authority is authorized."
        ],
        "references": [
          "https://docs.aws.amazon.com/rolesanywhere/latest/userguide/introduction.html",
          "https://ermetic.com/blog/aws/keep-your-iam-users-close-keep-your-third-parties-even-closer-part-1/",
          "https://docs.aws.amazon.com/rolesanywhere/latest/APIReference/API_CreateTrustAnchor.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.003",
                    "name": "Additional Cloud Roles",
                    "reference": "https://attack.mitre.org/techniques/T1098/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "5aa83d4d-228b-4023-a98b-2d7e66eacb31",
        "rule_id": "71de53ea-ff3b-11ee-b572-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.625Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.625Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "query": "event.dataset: aws.cloudtrail\n    and event.provider: rolesanywhere.amazonaws.com\n    and event.action: CreateTrustAnchor\n    and event.outcome: success\n    and not aws.cloudtrail.request_parameters: *sourceType=AWS_ACM_PCA*\n",
        "language": "kuery"
      },
      {
        "name": "AWS Bedrock Detected Multiple Validation Exception Errors by a Single User",
        "description": "Identifies multiple validation exeception errors within AWS Bedrock. Validation errors occur when you run the InvokeModel or InvokeModelWithResponseStream APIs on a foundation model that uses an incorrect inference parameter or corresponding value. These errors also occur when you use an inference parameter for one model with a model that doesn't have the same API parameter. This could indicate attempts to bypass limitations of other approved models, or to force an impact on the environment by incurring exhorbitant costs.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Amazon Bedrock Model Validation Exception Errors.\n\nAmazon Bedrock is AWS’s managed service that enables developers to build and scale generative AI applications using large foundation models (FMs) from top providers.\n\nBedrock offers a variety of pretrained models from Amazon (such as the Titan series), as well as models from providers like Anthropic, Meta, Cohere, and AI21 Labs.\n\n#### Possible investigation steps\n\n- Identify the user account that caused validation errors in accessing the Amazon Bedrock models.\n- Investigate other alerts associated with the user account during the past 48 hours.\n- Consider the time of day. If the user is a human (not a program or script), did the activity take place during a normal time of day?\n- Examine the account's attempts to access Amazon Bedrock models in the last 24 hours.\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking Amazon Bedrock model access, prompts generated, and responses to the prompts by the account in the last 24 hours.\n\n### False positive analysis\n\n- Verify the user account that that caused validation errors is a legitimate misunderstanding by users on accessing the bedrock models.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Identify if the attacker is moving laterally and compromising other Amazon Bedrock Services.\n    - Identify any regulatory or legal ramifications related to this activity.\n    - Identify if any implication to resource billing.\n- Review the permissions assigned to the implicated user group or role behind these requests to ensure they are authorized and expected to access bedrock and ensure that the least privilege principle is being followed.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "target_time_window",
            "user.id",
            "cloud.account.id",
            "total_denials"
          ]
        },
        "version": 3,
        "tags": [
          "Domain: LLM",
          "Data Source: AWS",
          "Data Source: AWS Bedrock",
          "Data Source: AWS S3",
          "Use Case: Policy Violation",
          "Mitre Atlas: T0015",
          "Mitre Atlas: T0034",
          "Mitre Atlas: T0046"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate misunderstanding by users on accessing the bedrock models."
        ],
        "references": [
          "https://atlas.mitre.org/techniques/AML.T0015",
          "https://atlas.mitre.org/techniques/AML.T0034",
          "https://atlas.mitre.org/techniques/AML.T0046",
          "https://www.elastic.co/security-labs/elastic-advances-llm-security"
        ],
        "max_signals": 100,
        "threat": [],
        "setup": "## Setup\n\nThis rule requires that AWS Bedrock Integration be configured. For more information, see the AWS Bedrock integration documentation:\n\nhttps://www.elastic.co/docs/current/integrations/aws_bedrock\n",
        "related_integrations": [],
        "required_fields": [],
        "id": "96e5ccbc-0345-498f-9f22-324e07be2de3",
        "rule_id": "725a048a-88c5-4fc7-8677-a44fc0031822",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.628Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.628Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws_bedrock.invocation-*\n// truncate the timestamp to a 1-minute window\n| eval target_time_window = DATE_TRUNC(1 minutes, @timestamp)\n| where gen_ai.response.error_code == \"ValidationException\"\n| keep user.id, gen_ai.request.model.id, cloud.account.id, gen_ai.response.error_code, target_time_window\n// count the number of users causing validation errors within a 1 minute window\n| stats total_denials = count(*) by target_time_window, user.id, cloud.account.id\n| where total_denials > 3\n"
      },
      {
        "name": "Unusual Discovery Signal Alert with Unusual Process Executable",
        "description": "This rule leverages Discovery building block rule alert data to alert on signals with unusual unique host.id, user.id and process.executable entries.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Rule Type: Higher-Order Rule"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": []
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [
          {
            "name": "event.kind",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "kibana.alert.rule.rule_id",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "f70517d3-7abf-43a0-86a3-7ae65545b97a",
        "rule_id": "72ed9140-fe9d-4a34-a026-75b50e484b17",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.632Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.632Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "host.os.type:windows and event.kind:signal and kibana.alert.rule.rule_id:\"1d72d014-e2ab-4707-b056-9b96abe7b511\"\n",
        "new_terms_fields": [
          "host.id",
          "user.id",
          "process.executable"
        ],
        "history_window_start": "now-14d",
        "index": [
          ".alerts-security.*"
        ],
        "language": "kuery"
      },
      {
        "name": "Potential Execution of rc.local Script",
        "description": "This rule detects the potential execution of the `/etc/rc.local` script through the `already_running` event action created by the `rc-local.service` systemd service. The `/etc/rc.local` script is a legacy initialization script that is executed at the end of the boot process. The `/etc/rc.local` script is not enabled by default on most Linux distributions. The `/etc/rc.local` script can be used by attackers to persistently execute malicious commands or scripts on a compromised system at reboot. As the rc.local file is executed prior to the initialization of Elastic Defend, the execution event is not ingested, and therefore the `already_running` event is leveraged to provide insight into the potential execution of `rc.local`.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.intezer.com/blog/malware-analysis/hiddenwasp-malware-targeting-linux-systems/",
          "https://pberba.github.io/security/2022/02/06/linux-threat-hunting-for-persistence-initialization-scripts-and-shell-configuration/#8-boot-or-logon-initialization-scripts-rc-scripts",
          "https://www.cyberciti.biz/faq/how-to-enable-rc-local-shell-script-on-systemd-while-booting-linux-system/",
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1037",
                "name": "Boot or Logon Initialization Scripts",
                "reference": "https://attack.mitre.org/techniques/T1037/",
                "subtechnique": [
                  {
                    "id": "T1037.004",
                    "name": "RC Scripts",
                    "reference": "https://attack.mitre.org/techniques/T1037/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.args",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a81c134e-9951-4485-a6b7-434e6c57d577",
        "rule_id": "7318affb-bfe8-4d50-a425-f617833be160",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.635Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.635Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"info\" and event.action == \"already_running\" and \nprocess.parent.args == \"/etc/rc.local\" and process.parent.args == \"start\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process*"
        ]
      },
      {
        "name": "Yum/DNF Plugin Status Discovery",
        "description": "This rule detects the execution of the `grep` command with the `plugins` argument on Linux systems. This command is used to search for YUM/DNF configurations and/or plugins with an enabled state. This behavior may indicate an attacker is attempting to establish persistence in a YUM or DNF plugin.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/linux/local/yum_package_manager_persistence.rb",
          "https://pwnshift.github.io/2020/10/01/persistence.html",
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1082",
                "name": "System Information Discovery",
                "reference": "https://attack.mitre.org/techniques/T1082/"
              }
            ]
          }
        ],
        "setup": "## Setup\nThis rule requires data coming in from Elastic Defend.\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "8b130631-4d0c-4de5-a6ee-4d78dc2c6f55",
        "rule_id": "78390eb5-c838-4c1d-8240-69dd7397cfb7",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.638Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.638Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and\nprocess.name == \"grep\" and process.args : \"plugins*\" and process.args : (\n  \"/etc/yum.conf\", \"/usr/lib/yum-plugins/*\", \"/etc/yum/pluginconf.d/*\",\n  \"/usr/lib/python*/site-packages/dnf-plugins/*\", \"/etc/dnf/plugins/*\", \"/etc/dnf/dnf.conf\"\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "Git Hook Child Process",
        "description": "This rule detects child processes spawned by Git hooks. Git hooks are scripts that Git executes before or after events such as commit, push, and receive. The rule identifies child processes spawned by Git hooks that are not typically spawned by the Git process itself. This behavior may indicate an attacker attempting to hide malicious activity by leveraging the legitimate Git process to execute unauthorized commands.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Execution",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://git-scm.com/docs/githooks/2.26.0",
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/"
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "82fe488c-7ac0-41a9-8cce-965339703f9e",
        "rule_id": "7ce5e1c7-6a49-45e6-a101-0720d185667f",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.641Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.641Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and process.parent.name in (\n  \"applypatch-msg\", \"commit-msg\", \"fsmonitor-watchman\", \"post-update\", \"post-checkout\", \"post-commit\",\n  \"pre-applypatch\", \"pre-commit\", \"pre-merge-commit\", \"prepare-commit-msg\", \"pre-push\", \"pre-rebase\", \"pre-receive\",\n  \"push-to-checkout\", \"update\", \"post-receive\", \"pre-auto-gc\", \"post-rewrite\", \"sendemail-validate\", \"p4-pre-submit\",\n  \"post-index-change\", \"post-merge\", \"post-applypatch\"\n) and (\n  process.name in (\"nohup\", \"setsid\", \"disown\", \"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") or \n  process.name : (\"php*\", \"perl*\", \"ruby*\", \"lua*\") or \n  process.executable : (\n    \"/boot/*\", \"/dev/shm/*\", \"/etc/cron.*/*\", \"/etc/init.d/*\", \"/etc/update-motd.d/*\",\n    \"/run/*\", \"/srv/*\", \"/tmp/*\", \"/var/tmp/*\", \"/var/log/*\"\n  )\n) and not process.name in (\"git\", \"dirname\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process*"
        ]
      },
      {
        "name": "AWS Lambda Layer Added to Existing Function",
        "description": "Identifies when an Lambda Layer is added to an existing Lambda function. AWS layers are a way to share code and data across multiple functions. By adding a layer to an existing function, an attacker can persist or execute code in the context of the function.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS Lambda Layer Added to Existing Function\n\nThis rule detects when a Lambda layer is added to an existing Lambda function. AWS Lambda layers are a mechanism for sharing code and data across multiple functions. By adding a layer to an existing function, an attacker can persist or execute code in the context of the function. Understanding the context and legitimacy of such changes is crucial to determine if the action is benign or malicious.\n\n#### Possible Investigation Steps:\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who made the change. Verify if this actor typically performs such actions and if they have the necessary permissions.\n- **Review the Request Details**: Examine the `aws.cloudtrail.request_parameters` to understand the specific layer added to the Lambda function. Look for any unusual parameters that could suggest unauthorized or malicious modifications.\n- **Analyze the Source of the Request**: Investigate the `source.ip` and `source.geo` fields to determine the geographical origin of the request. An external or unexpected location might indicate compromised credentials or unauthorized access.\n- **Contextualize with Timestamp**: Use the `@timestamp` field to check when the change occurred. Modifications during non-business hours or outside regular maintenance windows might require further scrutiny.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this change to see if the same actor or IP address engaged in other potentially suspicious activities.\n\n### False Positive Analysis:\n\n- **Legitimate Administrative Actions**: Confirm if the addition of the Lambda layer aligns with scheduled updates, development activities, or legitimate administrative tasks documented in change management systems.\n- **Consistency Check**: Compare the action against historical data of similar actions performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.\n- **Verify through Outcomes**: Check the `aws.cloudtrail.response_elements` and the `event.outcome` to confirm if the change was successful and intended according to policy.\n\n### Response and Remediation:\n\n- **Immediate Review and Reversal if Necessary**: If the change was unauthorized, remove the added layer from the Lambda function to mitigate any unintended code execution or persistence.\n- **Enhance Monitoring and Alerts**: Adjust monitoring systems to alert on similar actions, especially those involving sensitive functions or layers.\n- **Educate and Train**: Provide additional training to users with administrative rights on the importance of security best practices concerning Lambda function management and the use of layers.\n- **Audit Lambda Functions and Policies**: Conduct a comprehensive audit of all Lambda functions and associated policies to ensure they adhere to the principle of least privilege.\n- **Incident Response**: If there's an indication of malicious intent or a security breach, initiate the incident response protocol to mitigate any damage and prevent future occurrences.\n\n### Additional Information:\n\nFor further guidance on managing Lambda functions and securing AWS environments, refer to the [AWS Lambda documentation](https://docs.aws.amazon.com/lambda/latest/dg/welcome.html) and AWS best practices for security. Additionally, consult the following resources for specific details on Lambda layers and persistence techniques:\n- [AWS Lambda Layers Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-lambda-persistence/aws-lambda-layers-persistence)\n- [AWS API PublishLayerVersion](https://docs.aws.amazon.com/lambda/latest/api/API_PublishLayerVersion.html)\n- [AWS API UpdateFunctionConfiguration](https://docs.aws.amazon.com/lambda/latest/api/API_UpdateFunctionConfiguration.html)\n\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS Lambda",
          "Use Case: Threat Detection",
          "Tactic: Execution"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Lambda function owners may add layers to their functions for legitimate purposes."
        ],
        "references": [
          "https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-lambda-persistence/aws-lambda-layers-persistence",
          "https://docs.aws.amazon.com/lambda/latest/api/API_PublishLayerVersion.html",
          "https://docs.aws.amazon.com/lambda/latest/api/API_UpdateFunctionConfiguration.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1648",
                "name": "Serverless Execution",
                "reference": "https://attack.mitre.org/techniques/T1648/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "8aff0f11-dca8-43a2-9965-6b747deda4e2",
        "rule_id": "7d091a76-0737-11ef-8469-f661ea17fbcc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:25.645Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:25.645Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "query": "event.dataset: aws.cloudtrail\n    and event.provider: lambda.amazonaws.com\n    and event.outcome: success\n    and event.action: (PublishLayerVersion* or UpdateFunctionConfiguration)\n",
        "language": "kuery"
      },
      {
        "name": "Suspicious Windows Powershell Arguments",
        "description": "Identifies the execution of PowerShell with suspicious argument values. This behavior is often observed during malware installation leveraging PowerShell.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 202,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: System",
          "Data Source: Sysmon",
          "Data Source: SentinelOne",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: Crowdstrike"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.001",
                    "name": "PowerShell",
                    "reference": "https://attack.mitre.org/techniques/T1059/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "crowdstrike",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a6608a25-6e40-4810-9ef7-3907b75c14ec",
        "rule_id": "83bf249e-4348-47ba-9741-1202a09556ad",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:26.897Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:26.897Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n process.name : \"powershell.exe\" and \n  (\n   process.command_line :\n        (\n          \"*^*^*^*^*^*^*^*^*^*\",\n          \"*`*`*`*`*\",\n          \"*+*+*+*+*+*+*\",\n          \"*[char[]](*)*-join*\",\n          \"*Base64String*\",\n          \"*[*Convert]*\",\n          \"*.Compression.*\",\n          \"*-join($*\",\n          \"*.replace*\",\n          \"*MemoryStream*\",\n          \"*WriteAllBytes*\",\n          \"* -enc *\",\n          \"* -ec *\",\n          \"* /e *\",\n          \"* /enc *\",\n          \"* /ec *\",\n          \"*WebClient*\",\n          \"*DownloadFile*\",\n          \"*DownloadString*\",\n          \"* iex*\",\n          \"* iwr*\",\n          \"*Reflection.Assembly*\",\n          \"*Assembly.GetType*\",\n          \"*$env:temp\\\\*start*\",\n          \"*powercat*\",\n          \"*nslookup -q=txt*\",\n          \"*$host.UI.PromptForCredential*\",\n          \"*Net.Sockets.TCPClient*\",\n          \"*curl *;Start*\",\n          \"powershell.exe \\\"<#*\",\n          \"*ssh -p *\",\n          \"*http*|iex*\",\n          \"*@SSL\\\\DavWWWRoot\\\\*.ps1*\",\n          \"*.lnk*.Seek(0x*\",\n          \"*[string]::join(*\",\n          \"*[Array]::Reverse($*\",\n          \"* hidden $(gc *\",\n          \"*=wscri& set*\",\n          \"*http'+'s://*\",\n          \"*.content|i''Ex*\",\n          \"*//:sptth*\",\n          \"*//:ptth*\",\n          \"*$*=Get-Content*AppData*.SubString(*$*\",\n          \"*=cat *AppData*.substring(*);*$*\"\n        ) or\n\n      (process.args : \"-c\" and process.args : \"&{'*\") or\n\n      (process.args : \"-Outfile\" and process.args : \"Start*\") or\n\n      (process.args : \"-bxor\" and process.args : \"0x*\") or\n\n      process.args : \"$*$*;set-alias\" or\n\n      (process.parent.name : (\"explorer.exe\", \"cmd.exe\") and \n       process.command_line : (\"*-encodedCommand*\", \"*Invoke-webrequest*\", \"*WebClient*\", \"*Reflection.Assembly*\"))\n  )\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-windows.*",
          "logs-system.security*",
          "logs-windows.sysmon_operational-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-m365_defender.event-*",
          "logs-crowdstrike.fdr*"
        ]
      },
      {
        "name": "Suspicious Kworker UID Elevation",
        "description": "Monitors for the elevation of regular user permissions to root permissions through the kworker process. kworker, or kernel worker, processes are part of the kernel's workqueue mechanism. They are responsible for executing work that has been scheduled to be done in kernel space, which might include tasks like handling interrupts, background activities, and other kernel-related tasks. Attackers may attempt to evade detection by masquerading as a kernel worker process, and hijack the execution flow by hooking certain functions/syscalls through a rootkit in order to provide easy access to root via a special modified command.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/",
                "subtechnique": [
                  {
                    "id": "T1574.013",
                    "name": "KernelCallbackTable",
                    "reference": "https://attack.mitre.org/techniques/T1574/013/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1014",
                "name": "Rootkit",
                "reference": "https://attack.mitre.org/techniques/T1014/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows\nthe Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click Add integrations.\n- In the query bar, search for Elastic Defend and select the integration to see more details about it.\n- Click Add Elastic Defend.\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either Traditional Endpoints or Cloud Workloads.\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest to select \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in New agent policy name. If other agent policies already exist, you can click the Existing hosts tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click Save and Continue.\n- To complete the integration, select Add Elastic Agent to your hosts and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "ce4ebd39-1f77-4597-86ee-bf004bb4f9cb",
        "rule_id": "7dfaaa17-425c-4fe7-bd36-83705fde7c2b",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:26.867Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:26.867Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.action == \"session_id_change\" and process.name : \"kworker*\" and\nuser.id == \"0\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "Potential Enumeration via Active Directory Web Service",
        "description": "Identifies processes loading Active Directory related modules followed by a network connection to the ADWS dedicated TCP port. Adversaries may abuse the ADWS Windows service that allows Active Directory to be queried via this web service.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/FalconForceTeam/SOAPHound"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1018",
                "name": "Remote System Discovery",
                "reference": "https://attack.mitre.org/techniques/T1018/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "destination.port",
            "type": "long",
            "ecs": true
          },
          {
            "name": "dll.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "network.direction",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "network.transport",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "source.port",
            "type": "long",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "e5181228-0b7d-41b9-99d5-c7d5f455bcfd",
        "rule_id": "9c951837-7d13-4b0c-be7a-f346623c8795",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:27.430Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:27.430Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by process.entity_id with maxspan=3m\n [library where host.os.type == \"windows\" and \n  dll.name : (\"System.DirectoryServices*.dll\", \"System.IdentityModel*.dll\") and \n  not user.id in (\"S-1-5-18\", \"S-1-5-19\", \"S-1-5-20\") and \n  not process.executable : \n                (\"?:\\\\windows\\\\system32\\\\dsac.exe\", \n                 \"?:\\\\program files\\\\powershell\\\\?\\\\pwsh.exe\", \n                 \"?:\\\\windows\\\\system32\\\\windowspowershell\\\\*.exe\", \n                 \"?:\\\\windows\\\\syswow64\\\\windowspowershell\\\\*.exe\", \n                 \"?:\\\\program files\\\\microsoft monitoring agent\\\\*.exe\", \n                 \"?:\\\\windows\\\\adws\\\\microsoft.activedirectory.webservices.exe\")]\n [network where host.os.type == \"windows\" and destination.port == 9389 and source.port >= 49152 and\n  network.direction == \"egress\" and network.transport == \"tcp\" and not cidrmatch(destination.ip, \"127.0.0.0/8\", \"::1/128\")]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.library-*",
          "logs-endpoint.events.network-*"
        ]
      },
      {
        "name": "Git Hook Egress Network Connection",
        "description": "This rule detects a suspicious egress network connection attempt from a Git hook script. Git hooks are scripts that Git executes before or after events such as: commit, push, and receive. An attacker can abuse these features to execute arbitrary commands on the system, establish persistence or to initialize a network connection to a remote server and exfiltrate data or download additional payloads.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Execution",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://swisskyrepo.github.io/InternalAllTheThings/redteam/persistence/linux-persistence/#backdooring-git",
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/"
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "9a9c8bf8-d3d6-464e-9c0e-97051bb8e08a",
        "rule_id": "9822c5a1-1494-42de-b197-487197bb540c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:27.316Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:27.316Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id with maxspan=3s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.parent.name == \"git\" and process.args : \".git/hooks/*\" and\n   process.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\")] by process.entity_id\n  [network where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"connection_attempted\" and not (\n     destination.ip == null or destination.ip == \"0.0.0.0\" or cidrmatch(\n       destination.ip, \"10.0.0.0/8\", \"127.0.0.0/8\", \"169.254.0.0/16\", \"172.16.0.0/12\", \"192.0.0.0/24\", \"192.0.0.0/29\",\n       \"192.0.0.8/32\", \"192.0.0.9/32\", \"192.0.0.10/32\", \"192.0.0.170/32\", \"192.0.0.171/32\", \"192.0.2.0/24\",\n       \"192.31.196.0/24\", \"192.52.193.0/24\", \"192.168.0.0/16\", \"192.88.99.0/24\", \"224.0.0.0/4\", \"100.64.0.0/10\",\n       \"192.175.48.0/24\",\"198.18.0.0/15\", \"198.51.100.0/24\", \"203.0.113.0/24\", \"240.0.0.0/4\", \"::1\", \"FE80::/10\",\n       \"FF00::/8\", \"172.31.0.0/16\"\n     )\n   )\n  ] by process.parent.entity_id\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process*",
          "logs-endpoint.events.network*"
        ]
      },
      {
        "name": "GitHub UEBA - Multiple Alerts from a GitHub Account",
        "description": "This rule is part of the \"GitHub UEBA - Unusual Activity from Account Pack\", and leverages alert data to determine when multiple alerts are executed by the same user in a timespan of one hour. Analysts can use this to prioritize triage and response, as these alerts are a higher indicator of compromised user accounts or PATs.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 101,
        "tags": [
          "Domain: Cloud",
          "Use Case: Threat Detection",
          "Use Case: UEBA",
          "Tactic: Execution",
          "Rule Type: Higher-Order Rule",
          "Data Source: Github"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": []
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [
          {
            "name": "kibana.alert.workflow_status",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "signal.rule.tags",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "5ce87fd3-8cff-4098-9e23-3aa127b714b3",
        "rule_id": "929223b4-fba3-4a1c-a943-ec4716ad23ec",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:27.181Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:27.181Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "threshold",
        "query": "signal.rule.tags:(\"Use Case: UEBA\" and \"Data Source: Github\") and kibana.alert.workflow_status:\"open\"\n",
        "threshold": {
          "field": [
            "user.name"
          ],
          "value": 1,
          "cardinality": [
            {
              "field": "signal.rule.name",
              "value": 5
            }
          ]
        },
        "index": [
          ".alerts-security.*"
        ],
        "language": "kuery"
      },
      {
        "name": "RPM Package Installed by Unusual Parent Process",
        "description": "This rule leverages the new_terms rule type to identify the installation of RPM packages by an unusual parent process. RPM is a package management system used in Linux systems such as Red Hat, CentOS and Fedora. Attacks may backdoor RPM packages to gain initial access or install malicious RPM packages to maintain persistence.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/"
              },
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/",
                "subtechnique": [
                  {
                    "id": "T1546.016",
                    "name": "Installer Packages",
                    "reference": "https://attack.mitre.org/techniques/T1546/016/"
                  }
                ]
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1195",
                "name": "Supply Chain Compromise",
                "reference": "https://attack.mitre.org/techniques/T1195/",
                "subtechnique": [
                  {
                    "id": "T1195.002",
                    "name": "Compromise Software Supply Chain",
                    "reference": "https://attack.mitre.org/techniques/T1195/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\nThis rule requires data coming in from Elastic Defend.\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "c6441028-2224-4df4-b186-4175f37924c7",
        "rule_id": "8cc72fa3-70ae-4ea1-bee2-8e6aaf3c1fcf",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:27.093Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:27.093Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "host.os.type:linux and event.category:process and event.type:start and event.action:exec and process.name:rpm and\nprocess.args:(\"-i\" or \"--install\")\n",
        "new_terms_fields": [
          "process.parent.executable"
        ],
        "history_window_start": "now-7d",
        "index": [
          "logs-endpoint.events.*"
        ],
        "language": "kuery"
      },
      {
        "name": "At Job Created or Modified",
        "description": "This rule monitors for at jobs being created or renamed. Linux at jobs are scheduled tasks that can be leveraged by system administrators to set up scheduled tasks, but may be abused by malicious actors for persistence, privilege escalation and command execution. By creating or modifying cron job configurations, attackers can execute malicious commands or scripts at predefined intervals, ensuring their continued presence and enabling unauthorized activities.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Privilege Escalation",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/primer-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1053",
                "name": "Scheduled Task/Job",
                "reference": "https://attack.mitre.org/techniques/T1053/",
                "subtechnique": [
                  {
                    "id": "T1053.002",
                    "name": "At",
                    "reference": "https://attack.mitre.org/techniques/T1053/002/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1053",
                "name": "Scheduled Task/Job",
                "reference": "https://attack.mitre.org/techniques/T1053/",
                "subtechnique": [
                  {
                    "id": "T1053.002",
                    "name": "At",
                    "reference": "https://attack.mitre.org/techniques/T1053/002/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1053",
                "name": "Scheduled Task/Job",
                "reference": "https://attack.mitre.org/techniques/T1053/",
                "subtechnique": [
                  {
                    "id": "T1053.002",
                    "name": "At",
                    "reference": "https://attack.mitre.org/techniques/T1053/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.original.extension",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "cd93d44e-6429-47b0-a5f3-263f0d329f40",
        "rule_id": "84755a05-78c8-4430-8681-89cd6c857d71",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:27.069Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:27.069Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and\nevent.action in (\"rename\", \"creation\") and file.path : \"/var/spool/cron/atjobs/*\" and not (\n  process.executable in (\n    \"/bin/dpkg\", \"/usr/bin/dpkg\", \"/bin/dockerd\", \"/usr/bin/dockerd\", \"/usr/sbin/dockerd\", \"/bin/microdnf\",\n    \"/usr/bin/microdnf\", \"/bin/rpm\", \"/usr/bin/rpm\", \"/bin/snapd\", \"/usr/bin/snapd\", \"/bin/yum\", \"/usr/bin/yum\",\n    \"/bin/dnf\", \"/usr/bin/dnf\", \"/bin/podman\", \"/usr/bin/podman\", \"/bin/dnf-automatic\", \"/usr/bin/dnf-automatic\",\n    \"/bin/pacman\", \"/usr/bin/pacman\", \"/usr/bin/dpkg-divert\", \"/bin/dpkg-divert\", \"/sbin/apk\", \"/usr/sbin/apk\",\n    \"/usr/local/sbin/apk\", \"/usr/bin/apt\", \"/usr/sbin/pacman\", \"/bin/podman\", \"/usr/bin/podman\", \"/usr/bin/puppet\",\n    \"/bin/puppet\", \"/opt/puppetlabs/puppet/bin/puppet\", \"/usr/bin/chef-client\", \"/bin/chef-client\",\n    \"/bin/autossl_check\", \"/usr/bin/autossl_check\", \"/proc/self/exe\", \"/dev/fd/*\",  \"/usr/bin/pamac-daemon\",\n    \"/bin/pamac-daemon\", \"/usr/local/bin/dockerd\"\n  ) or\n  file.extension in (\"swp\", \"swpx\", \"swx\", \"dpkg-remove\") or\n  file.Ext.original.extension == \"dpkg-new\" or\n  process.executable : (\"/nix/store/*\", \"/var/lib/dpkg/*\", \"/tmp/vmis.*\", \"/snap/*\", \"/dev/fd/*\") or\n  process.executable == null or\n  (process.name == \"sed\" and file.name : \"sed*\") or\n  (process.name == \"perl\" and file.name : \"e2scrub_all.tmp*\") \n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*"
        ]
      },
      {
        "name": "AWS RDS DB Instance Made Public",
        "description": "Identifies the creation or modification of an AWS RDS DB instance to enable public access. DB instances may contain sensitive data that can be abused if shared with unauthorized accounts or made public. Adversaries may enable public access on a DB instance to maintain persistence or evade defenses by bypassing access controls.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS RDS DB Instance Made Public\n\nThis rule identifies when an RDS DB instance is created or modified to enable public access. While publicly accessible DB instances are a common practice, adversaries may exploit this feature to maintain persistence or evade defenses in a compromised environment.\n\n#### Possible Investigation Steps\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who made the change. Verify if this actor typically performs such actions and if they have the necessary permissions.\n- **Review the Creation/Modification Event**: Identify the DB instance involved and review the event details. Look for `ModifyDBInstance`, `CreateDBInstance` or `CreateDBCluster` actions where the publiclyAccessible parameter was set to true.\n    - **Request and Response Parameters**: Check the `aws.cloudtrail.request_parameters` field in the CloudTrail event to identify the DB Instance Identifier and any other modifications made to the instance.\n- **Verify the Created/Modified Instance**: Check the DB instance that was created or modified and its contents to determine the sensitivity of the data stored within it.\n- **Contextualize with Recent Changes**: Compare this event against recent changes in RDS DB or Cluster configurations and deployments. Look for any other recent permissions changes or unusual administrative actions.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this event to see if the same actor or IP address engaged in other potentially suspicious activities.\n- **Interview Relevant Personnel**: If the modification was initiated by a user, verify the intent and authorization for this action with the person or team responsible for managing DB instances.\n### False Positive Analysis\n\n- **Legitimate Instance Configuration**: Confirm if the DB instance creation or modification aligns with legitimate tasks.\n- **Consistency Check**: Compare the action against historical data of similar actions performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.\n\n### Response and Remediation\n\n- **Immediate Review and Reversal**: If the change was unauthorized, update the instance attributes to remove public access and restore it to its previous state. Determine whether attached security groups have been modified to allow additional access and revert any unauthorized changes. \n- **Enhance Monitoring and Alerts**: Adjust monitoring systems to alert on similar actions, especially those involving sensitive data or permissions.\n- **Audit Instances and Policies**: Conduct a comprehensive audit of all instances and associated policies to ensure they adhere to the principle of least privilege.\n- **Policy Update**: Review and possibly update your organization’s policies on DB instance access to tighten control and prevent unauthorized access.\n- **Incident Response**: If malicious intent is confirmed, consider it a data breach incident and initiate the incident response protocol. This includes further investigation, containment, and recovery.\n\n### Additional Information:\n\nFor further guidance on managing DB instances and securing AWS environments, refer to the [AWS RDS documentation](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_RDS_Managing.html) and AWS best practices for security. Additionally, consult the following resources for specific details on DB instance security:\n- [AWS RDS ModifyDBInstance](https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_ModifyDBInstance.html)\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS RDS",
          "Resources: Investigation Guide",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Public access is a common configuration used to enable access from outside a private VPC. Ensure that the instance should not be modified in this way before taking action."
        ],
        "references": [
          "https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_ModifyDBInstance.html",
          "https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.DBInstance.Modifying.html",
          "https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-rds-persistence#make-instance-publicly-accessible-rds-modifydbinstance",
          "https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-privilege-escalation/aws-rds-privesc#rds-createdbinstance"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1556",
                "name": "Modify Authentication Process",
                "reference": "https://attack.mitre.org/techniques/T1556/",
                "subtechnique": [
                  {
                    "id": "T1556.009",
                    "name": "Conditional Access Policies",
                    "reference": "https://attack.mitre.org/techniques/T1556/009/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": []
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "684e5eb2-b1b3-4236-b98d-9331ab8013dc",
        "rule_id": "9efb3f79-b77b-466a-9fa0-3645d22d1e7f",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:27.544Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:27.544Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where event.dataset == \"aws.cloudtrail\"\n    and event.provider == \"rds.amazonaws.com\"\n    and event.outcome == \"success\"\n    and (\n        (event.action == \"ModifyDBInstance\" and stringContains(aws.cloudtrail.request_parameters, \"publiclyAccessible=true\"))\n        or \n        (event.action in (\"CreateDBInstance\", \"CreateDBCluster\") and stringContains(aws.cloudtrail.request_parameters, \"publiclyAccessible=true\"))\n    )\n",
        "language": "eql",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ]
      },
      {
        "name": "AWS EC2 Instance Interaction with IAM Service",
        "description": "Identifies when an EC2 instance interacts with the AWS IAM service via an assumed role. This is uncommon behavior and could indicate an attacker using compromised credentials to further exploit an environment. For example, an assumed role could be used to create new users for persistence or add permissions for privilege escalation. An EC2 instance assumes a role using their EC2 ID as the session name. This rule looks for the pattern \"i-\" which is the beginning pattern for assumed role sessions started by an EC2 instance. This is a [building block](https://www.elastic.co/guide/en/security/current/building-block-rule.html) rule and does not generate alerts on its own. It is meant to be used for correlation with other rules to detect suspicious activity.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "@timestamp",
            "source.address",
            "user.name",
            "user.id",
            "aws.cloudtrail.user_identity.arn",
            "aws.cloudtrail.user_identity.type",
            "user_agent.original",
            "user.target.name",
            "event.action",
            "event.outcome",
            "cloud.region",
            "event.provider",
            "aws.cloudtrail.request_parameters",
            "aws.cloudtrail.response_elements"
          ]
        },
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS EC2",
          "Data Source: AWS IAM",
          "Use Case: Identity and Access Audit",
          "Tactic: Privilege Escalation",
          "Tactic: Persistence",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Administrators may use EC2 instances to interact with IAM services as part of an automation workflow, ensure validity of the triggered event and include exceptions where necessary."
        ],
        "references": [
          "https://redcanary.com/blog/aws-sts/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1078",
                "name": "Valid Accounts",
                "reference": "https://attack.mitre.org/techniques/T1078/",
                "subtechnique": [
                  {
                    "id": "T1078.004",
                    "name": "Cloud Accounts",
                    "reference": "https://attack.mitre.org/techniques/T1078/004/"
                  }
                ]
              },
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.001",
                    "name": "Additional Cloud Credentials",
                    "reference": "https://attack.mitre.org/techniques/T1098/001/"
                  },
                  {
                    "id": "T1098.003",
                    "name": "Additional Cloud Roles",
                    "reference": "https://attack.mitre.org/techniques/T1098/003/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": []
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.user_identity.type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "248e09cb-a540-4ec1-b996-e2e831a5059e",
        "rule_id": "a44bcb58-5109-4870-a7c6-11f5fe7dd4b1",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:27.937Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:27.937Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where event.dataset == \"aws.cloudtrail\"\n    and event.provider == \"iam.amazonaws.com\"\n    and aws.cloudtrail.user_identity.type == \"AssumedRole\"\n    and stringContains(user.id, \":i-\")\n    and (\n            startsWith(event.action, \"Update\")\n            or startsWith(event.action, \"Attach\")\n            or startsWith(event.action, \"Detach\")\n            or startsWith(event.action, \"Create\")\n            or startsWith(event.action, \"Delete\")\n            or startsWith(event.action, \"Add\")\n            or startsWith(event.action, \"Remove\")\n            or startsWith(event.action, \"Put\")\n            or startsWith(event.action, \"Tag\")\n    )\n",
        "language": "eql",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ]
      },
      {
        "name": "CAP_SYS_ADMIN Assigned to Binary",
        "description": "Identifies instances where a binary is granted the CAP_SYS_ADMIN capability. In Linux, the CAP_SYS_ADMIN capability is a powerful and broad capability that allows a process to perform a range of system administration operations, such as mounting and unmounting filesystems, configuring network interfaces, and accessing hardware devices. Attackers may leverage a misconfiguration for exploitation in order to escalate their privileges to root. The rule identifies previously unknown processes executing with CAP_SYS_ADMIN capabilities through the use of the new terms rule type.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Elastic Defend",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.thread.capabilities.effective",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.thread.capabilities.permitted",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "408da4ce-3398-41f4-9250-18a623f37c71",
        "rule_id": "a577e524-c2ee-47bd-9c5b-e917d01d3276",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:27.964Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:27.964Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.category:\"process\" and host.os.type:\"linux\" and event.type:\"start\" and event.action:\"exec\" and process.name:* and\n(process.thread.capabilities.effective:\"CAP_SYS_ADMIN\" or process.thread.capabilities.permitted:\"CAP_SYS_ADMIN\") and\nnot user.id:\"0\"\n",
        "new_terms_fields": [
          "host.id",
          "user.id",
          "process.executable"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-endpoint.events.*"
        ],
        "language": "kuery"
      },
      {
        "name": "Privileged Docker Container Creation",
        "description": "This rule leverages the new_terms rule type to identify the creation of a potentially unsafe docker container from an unusual parent process. Attackers can use the `--privileged` flag to create containers with escalated privileges, which can lead to trivial privilege escalation, docker escaping and persistence. access.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "Domain: Container",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              },
              {
                "id": "T1609",
                "name": "Container Administration Command",
                "reference": "https://attack.mitre.org/techniques/T1609/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1611",
                "name": "Escape to Host",
                "reference": "https://attack.mitre.org/techniques/T1611/"
              }
            ]
          }
        ],
        "setup": "## Setup\nThis rule requires data coming in from Elastic Defend.\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "ffaf9c6c-6abb-4e42-8ab5-54c8c42f7745",
        "rule_id": "a80d96cd-1164-41b3-9852-ef58724be496",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:27.973Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:27.973Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "host.os.type:linux and event.category:process and event.type:start and event.action:exec and process.name:docker and\nprocess.args:(run and --privileged)\n",
        "new_terms_fields": [
          "process.parent.executable"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-endpoint.events.process*"
        ],
        "language": "kuery"
      },
      {
        "name": "Veeam Backup Library Loaded by Unusual Process",
        "description": "Identifies potential credential decrypt operations by PowerShell or unsigned processes using the Veeam.Backup.Common.dll library. Attackers can use Veeam Credentials to target backups as part of destructive operations such as Ransomware attacks.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1003",
                "name": "OS Credential Dumping",
                "reference": "https://attack.mitre.org/techniques/T1003/"
              },
              {
                "id": "T1555",
                "name": "Credentials from Password Stores",
                "reference": "https://attack.mitre.org/techniques/T1555/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.001",
                    "name": "PowerShell",
                    "reference": "https://attack.mitre.org/techniques/T1059/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "dll.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "dll.pe.original_file_name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.exists",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "3c27cf0e-b61c-4134-8ade-4e77f0a2283e",
        "rule_id": "aaab30ec-b004-4191-95e1-4a14387ef6a6",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:27.982Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:27.982Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "library where host.os.type == \"windows\" and event.action == \"load\" and\n  (dll.name : \"Veeam.Backup.Common.dll\" or dll.pe.original_file_name : \"Veeam.Backup.Common.dll\") and\n  (\n    process.code_signature.trusted == false or\n    process.code_signature.exists == false or\n    process.name : (\"powershell.exe\", \"pwsh.exe\", \"powershell_ise.exe\")\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.library-*"
        ]
      },
      {
        "name": "AWS S3 Object Encryption Using External KMS Key",
        "description": "Identifies `CopyObject` events within an S3 bucket using an AWS KMS key from an external account for encryption. Adversaries with access to a misconfigured S3 bucket and the proper permissions may encrypt objects with an external KMS key to deny their victims access to their own data.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "\n## Triage and Analysis\n\n### Investigating AWS S3 Object Encryption Using External KMS Key\n\nThis rule detects the use of an external AWS KMS key to encrypt objects within an S3 bucket. Adversaries with access to a misconfigured S3 bucket may use an external key to copy objects within a bucket and deny victims the ability to access their own data.\nThis rule uses [ES|QL](https://www.elastic.co/guide/en/security/master/rules-ui-create.html#create-esql-rule) to look for use of the `CopyObject` operation where the target bucket's `cloud.account.id` is different from the `key.account.id` dissected from the AWS KMS key used for encryption.\n\n#### Possible Investigation Steps:\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who performed the action. Verify if this actor typically performs such actions and if they have the necessary permissions.\n- **Review the Request Details**: Examine the `aws.cloudtrail.request_parameters` to understand the specific details of the `CopyObject` action. Look for any unusual parameters that could suggest unauthorized or malicious modifications or usage of an unknown KMS keyId.\n- **Analyze the Source of the Request**: Investigate the `source.ip` and `source.geo` fields to determine the geographical origin of the request. An external or unexpected location might indicate compromised credentials or unauthorized access.\n- **Contextualize with Timestamp**: Use the `@timestamp` field to check when the object was copied. Changes during non-business hours or outside regular maintenance windows might require further scrutiny.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this action to see if the same actor or IP address engaged in other potentially suspicious activities.\n- **Check for Object Deletion or Access**: Look for `DeleteObject`, `DeleteObjects`, or `GetObject` API calls to the same S3 bucket that may indicate the adversary accessing and destroying objects including older object versions.\n- **Interview Relevant Personnel**: If the copy event was initiated by a user, verify the intent and authorization for this action with the person or team responsible for managing S3 buckets.\n\n### False Positive Analysis:\n\n- **Legitimate Administrative Actions**: Confirm if the `CopyObject` action aligns with scheduled updates, maintenance activities, or legitimate administrative tasks documented in change management systems.\n- **Consistency Check**: Compare the action against historical data of similar activities performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.\n\n### Response and Remediation:\n\n- **Immediate Review**: If the activity was unauthorized, search for potential ransom note placed in S3 bucket and review the bucket's access logs for any suspicious activity.\n- **Enhance Monitoring and Alerts**: Adjust monitoring systems to alert on similar `CopyObject` actions, especially those involving sensitive data or unusual file extensions.\n- **Educate and Train**: Provide additional training to users with administrative rights on the importance of security best practices concerning S3 bucket management and the risks of ransomware.\n- **Audit S3 Bucket Policies and Permissions**: Conduct a comprehensive audit of all S3 bucket policies and associated permissions to ensure they adhere to the principle of least privilege.\n- **Incident Response**: If there's an indication of malicious intent or a security breach, initiate the incident response protocol to mitigate any damage and prevent future occurrences.\n\n### Additional Information:\n\nFor further guidance on managing S3 bucket security and protecting against ransomware, refer to the [AWS S3 documentation](https://docs.aws.amazon.com/AmazonS3/latest/userguide/Welcome.html) and AWS best practices for security. Additionally, consult the following resources for specific details on S3 ransomware protection:\n- [ERMETIC REPORT - AWS S3 Ransomware Exposure in the Wild](https://s3.amazonaws.com/bizzabo.file.upload/PtZzA0eFQwV2RA5ysNeo_ERMETIC%20REPORT%20-%20AWS%20S3%20Ransomware%20Exposure%20in%20the%20Wild.pdf)\n- [S3 Ransomware Part 1: Attack Vector](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS S3",
          "Data Source: AWS KMS",
          "Use Case: Threat Detection",
          "Tactic: Impact"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Administrators within an AWS Organization structure may legitimately encrypt bucket objects with a key from an account different from the target bucket. Ensure that this behavior is not part of a legitimate operation before taking action."
        ],
        "references": [
          "https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingKMSEncryption.html/",
          "https://docs.aws.amazon.com/kms/latest/APIReference/API_GenerateDataKey.html/",
          "https://www.gem.security/post/cloud-ransomware-a-new-take-on-an-old-attack-pattern/",
          "https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1486",
                "name": "Data Encrypted for Impact",
                "reference": "https://attack.mitre.org/techniques/T1486/"
              }
            ]
          }
        ],
        "setup": "AWS S3 data event types need to be enabled in the CloudTrail trail configuration.",
        "related_integrations": [],
        "required_fields": [],
        "id": "a5fe8f04-fa0e-4a33-87b0-7b94de63150e",
        "rule_id": "ab8f074c-5565-4bc4-991c-d49770e19fc9",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:27.990Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:27.990Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws.cloudtrail-* metadata _id, _version, _index\n\n// any successful copy event\n| where event.dataset == \"aws.cloudtrail\"\n    and event.provider == \"s3.amazonaws.com\"\n    and event.action == \"CopyObject\"\n    and event.outcome == \"success\"\n\n// abstract key account id, key id, encrypted object bucket name and object name\n| dissect aws.cloudtrail.request_parameters \"{%{?bucketName}=%{target.bucketName},%{?x-amz-server-side-encryption-aws-kms-key-id}=%{?arn}:%{?aws}:%{?kms}:%{?region}:%{key.account.id}:%{?key}/%{keyId},%{?Host}=%{?tls.client.server_name},%{?x-amz-server-side-encryption}=%{?server-side-encryption},%{?x-amz-copy-source}=%{?bucket.objectName},%{?key}=%{target.objectName}}\"\n\n// filter for s3 objects whose account id is different from the encryption key's account id\n// add exceptions based on key.account.id or keyId for known external accounts or encryption keys\n| where cloud.account.id != key.account.id\n\n// keep relevant fields\n| keep @timestamp, aws.cloudtrail.user_identity.arn, cloud.account.id, event.action, target.bucketName, key.account.id, keyId, target.objectName\n"
      },
      {
        "name": "Outlook Home Page Registry Modification",
        "description": "Identifies modifications in registry keys associated with abuse of the Outlook Home Page functionality for command and control or persistence.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 201,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Command and Control",
          "Tactic: Persistence",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: SentinelOne"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://cloud.google.com/blog/topics/threat-intelligence/breaking-the-rules-tough-outlook-for-home-page-attacks/",
          "https://github.com/trustedsec/specula"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": []
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1137",
                "name": "Office Application Startup",
                "reference": "https://attack.mitre.org/techniques/T1137/",
                "subtechnique": [
                  {
                    "id": "T1137.004",
                    "name": "Outlook Home Page",
                    "reference": "https://attack.mitre.org/techniques/T1137/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "registry.data.strings",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "registry.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "registry.value",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d784165a-71a1-427d-a162-d1d575abca23",
        "rule_id": "ac5a2759-5c34-440a-b0c4-51fe674611d6",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.005Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.005Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "registry where host.os.type == \"windows\" and event.action != \"deletion\" and registry.value : \"URL\" and\n    registry.path : (\n        \"HKCU\\\\*\\\\SOFTWARE\\\\Microsoft\\\\Office\\\\*\\\\Outlook\\\\Webview\\\\Inbox\\\\URL\",\n        \"HKEY_USERS\\\\*\\\\SOFTWARE\\\\Microsoft\\\\Office\\\\*\\\\Outlook\\\\Webview\\\\Inbox\\\\URL\",\n        \"HKU\\\\*\\\\SOFTWARE\\\\Microsoft\\\\Office\\\\*\\\\Outlook\\\\Webview\\\\Inbox\\\\URL\",\n        \"\\\\REGISTRY\\\\USER\\\\*\\\\SOFTWARE\\\\Microsoft\\\\Office\\\\*\\\\Outlook\\\\Webview\\\\Inbox\\\\URL\",\n        \"USER\\\\*\\\\SOFTWARE\\\\Microsoft\\\\Office\\\\*\\\\Outlook\\\\Webview\\\\Inbox\\\\URL\"\n    ) and registry.data.strings : \"*http*\"\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-endpoint.events.registry-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*"
        ]
      },
      {
        "name": "AWS RDS Snapshot Deleted",
        "description": "Identifies the deletion of an AWS RDS DB snapshot. Snapshots contain a full backup of an entire DB instance. Unauthorized deletion of snapshots can make it impossible to recover critical or sensitive data. This rule detects deleted snapshots and instances modified so that backupRetentionPeriod is set to 0 which disables automated backups and is functionally similar to deleting the system snapshot.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS RDS",
          "Use Case: Asset Visibility",
          "Tactic: Impact"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Snapshots may be deleted by a system administrator. Verify whether the user identity should be making changes in your environment. Snapshot deletions by unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule."
        ],
        "references": [
          "https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_DeleteSnapshot.html",
          "https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_DeleteDBSnapshot.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1485",
                "name": "Data Destruction",
                "reference": "https://attack.mitre.org/techniques/T1485/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "584b35ad-ef0d-41ac-8c8b-8f27fb43dc5e",
        "rule_id": "b36c99af-b944-4509-a523-7e0fad275be1",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.014Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.014Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where event.dataset == \"aws.cloudtrail\"\n    and event.provider == \"rds.amazonaws.com\"\n    and event.outcome == \"success\"\n    and (\n        event.action in (\"DeleteDBSnapshot\", \"DeleteDBClusterSnapshot\") or \n        (event.action == \"ModifyDBInstance\" and stringContains(aws.cloudtrail.request_parameters, \"backupRetentionPeriod=0\"))\n    )\n",
        "language": "eql",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ]
      },
      {
        "name": "Discovery of Domain Groups",
        "description": "Identifies the execution of Linux built-in commands related to account or group enumeration. Adversaries may use account and group information to orient themselves before deciding how to act.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Rule Type: BBR",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1069",
                "name": "Permission Groups Discovery",
                "reference": "https://attack.mitre.org/techniques/T1069/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d641be9d-75a0-4ce1-9ab7-56d1db7f0702",
        "rule_id": "b92d5eae-70bb-4b66-be27-f98ba9d0ccdc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.023Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.023Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\", \"executed\", \"process_started\")\n and (\n  process.name in (\"ldapsearch\", \"dscacheutil\") or (process.name == \"dscl\" and process.args : \"*-list*\")\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Potential Privilege Escalation via Enlightenment",
        "description": "Identifies an attempt to exploit a local privilege escalation CVE-2022-37706 via a flaw in Linux window manager package Enlightenment. enlightenment_sys in Enlightenment before 0.25.4 allows local users to gain privileges because it is setuid root, and the system library function mishandles pathnames that begin with a /dev/.. substring.",
        "risk_score": 73,
        "severity": "high",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Use Case: Vulnerability",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://ubuntu.com/security/CVE-2022-37706",
          "https://www.exploit-db.com/exploits/51180"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "447ca46c-04f5-4161-b204-ef53117184f8",
        "rule_id": "bc0fc359-68db-421e-a435-348ced7a7f92",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.032Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.032Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, process.parent.entity_id with maxspan=5s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n    process.name == \"enlightenment_sys\" and process.args in (\"/bin/mount/\", \"-o\",\"noexec\",\"nosuid\",\"nodev\",\"uid=*\") ]\n  [process where host.os.type == \"linux\" and event.action == \"uid_change\" and event.type == \"change\" and user.id == \"0\"]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "File and Directory Permissions Modification",
        "description": "Identifies the change of permissions/ownership of files/folders through built-in Windows utilities. Threat actors may require permission modification of files/folders to change, modify or delete them.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Rule Type: BBR",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1222",
                "name": "File and Directory Permissions Modification",
                "reference": "https://attack.mitre.org/techniques/T1222/",
                "subtechnique": [
                  {
                    "id": "T1222.001",
                    "name": "Windows File and Directory Permissions Modification",
                    "reference": "https://attack.mitre.org/techniques/T1222/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pe.original_file_name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "88d8a612-e314-482b-b10f-71bcfdc1b059",
        "rule_id": "bc9e4f5a-e263-4213-a2ac-1edf9b417ada",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.041Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.041Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where event.type == \"start\" and host.os.type == \"windows\" and\n(\n  ((process.name: \"icacls.exe\" or process.pe.original_file_name == \"iCACLS.EXE\") and process.args: (\"*:F\", \"/reset\", \"/setowner\", \"*grant*\")) or\n  ((process.name: \"cacls.exe\" or process.pe.original_file_name == \"CACLS.EXE\") and process.args: (\"/g\", \"*:f\")) or\n  ((process.name: \"takeown.exe\" or process.pe.original_file_name == \"takeown.exe\") and process.args: (\"/F\")) or\n  ((process.name: \"attrib.exe\" or process.pe.original_file_name== \"ATTRIB.EXE\") and process.args: \"-r\")\n) and not user.id : \"S-1-5-18\" and\nnot (\n  process.args : (\"C:\\\\ProgramData\\\\Lenovo\\\\*\", \"C:\\\\ProgramData\\\\Adobe\\\\*\", \"C:\\\\ProgramData\\\\ASUS\\\\ASUS*\")\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*"
        ]
      },
      {
        "name": "Execution via Windows Command Debugging Utility",
        "description": "An adversary can use the Windows command line debugging utility cdb.exe to execute commands or shellcode. This rule looks for those instances and where the cdb.exe binary is outside of the normal WindowsKit installation paths.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 102,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon",
          "Data Source: SentinelOne",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: Crowdstrike"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://lolbas-project.github.io/lolbas/OtherMSBinaries/Cdb/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "crowdstrike",
            "version": "^1.1.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pe.original_file_name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "4797156e-858b-4297-8c06-6fd884c3dbd8",
        "rule_id": "bdfaddc4-4438-48b4-bc43-9f5cf8151c46",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.056Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.056Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n (?process.pe.original_file_name == \"CDB.Exe\" or process.name : \"cdb.exe\") and\n  process.args : (\"-cf\", \"-c\", \"-pd\") and\n  not process.executable : (\n        \"?:\\\\Program Files (x86)\\\\*\\\\cdb.exe\",\n        \"?:\\\\Program Files\\\\*\\\\cdb.exe\",\n        \"\\\\Device\\\\HarddiskVolume?\\\\Program Files (x86)\\\\*\\\\cdb.exe\",\n        \"\\\\Device\\\\HarddiskVolume?\\\\Program Files\\\\*\\\\cdb.exe\"\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-m365_defender.event-*",
          "logs-system.security-*",
          "logs-crowdstrike.fdr*"
        ]
      },
      {
        "name": "Memory Dump File with Unusual Extension",
        "description": "Identifies the creation of a memory dump file with an unusual extension, which can indicate an attempt to disguise a memory dump as another file type to bypass security defenses.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1003",
                "name": "OS Credential Dumping",
                "reference": "https://attack.mitre.org/techniques/T1003/",
                "subtechnique": [
                  {
                    "id": "T1003.001",
                    "name": "LSASS Memory",
                    "reference": "https://attack.mitre.org/techniques/T1003/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.008",
                    "name": "Masquerade File Type",
                    "reference": "https://attack.mitre.org/techniques/T1036/008/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.header_bytes",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "ba0fa1b9-c9cf-4909-9e22-1d2bac457a0e",
        "rule_id": "c0b9dc99-c696-4779-b086-0d37dc2b3778",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.065Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.065Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"windows\" and event.type == \"creation\" and\n\n  /* MDMP header */\n  file.Ext.header_bytes : \"4d444d50*\" and\n  not file.extension : (\"dmp\", \"mdmp\", \"hdmp\", \"edmp\", \"full\", \"tdref\", \"cg\", \"tmp\", \"dat\") and\n  not \n  (\n    process.executable : \"?:\\\\Program Files\\\\Endgame\\\\esensor.exe\" and\n    process.code_signature.trusted == true and length(file.extension) == 0\n  ) and\n  not\n  (\n    process.name : \"System\" and file.extension : \"tmpscan\"\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file-*"
        ]
      },
      {
        "name": "PowerShell Script with Windows Defender Tampering Capabilities",
        "description": "Identifies PowerShell scripts containing cmdlets and parameters that attackers can abuse to disable Windows Defender features. Attackers can tamper with antivirus to reduce the risk of detection when executing their payloads.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 103,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: PowerShell Logs",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1562",
                "name": "Impair Defenses",
                "reference": "https://attack.mitre.org/techniques/T1562/",
                "subtechnique": [
                  {
                    "id": "T1562.001",
                    "name": "Disable or Modify Tools",
                    "reference": "https://attack.mitre.org/techniques/T1562/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.001",
                    "name": "PowerShell",
                    "reference": "https://attack.mitre.org/techniques/T1059/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThe 'PowerShell Script Block Logging' logging policy must be enabled.\nSteps to implement the logging policy with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nAdministrative Templates >\nWindows PowerShell >\nTurn on PowerShell Script Block Logging (Enable)\n```\n\nSteps to implement the logging policy via registry:\n\n```\nreg add \"hklm\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging\" /v EnableScriptBlockLogging /t REG_DWORD /d 1\n```\n",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "powershell.file.script_block_text",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "7a12ffc0-63f1-4a44-9f45-7cfe190a5033",
        "rule_id": "c124dc1b-cef2-4d01-8d74-ff6b0d5096b6",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.074Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.074Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "winlogbeat-*",
          "logs-windows.powershell*"
        ],
        "query": "event.category: \"process\" and host.os.type:windows and\n(\n  powershell.file.script_block_text: \"Set-MpPreference\" and\n  powershell.file.script_block_text: (\n    DisableArchiveScanning or DisableBehaviorMonitoring or\n    DisableIntrusionPreventionSystem or DisableIOAVProtection or\n    DisableRemovableDriveScanning or DisableBlockAtFirstSeen or\n    DisableScanningMappedNetworkDrivesForFullScan or\n    DisableScanningNetworkFiles or DisableScriptScanning or\n    DisableRealtimeMonitoring or LowThreatDefaultAction or\n    ModerateThreatDefaultAction or HighThreatDefaultAction\n  )\n)\n",
        "language": "kuery"
      },
      {
        "name": "Attempt to Retrieve User Data from AWS EC2 Instance",
        "description": "Identifies discovery request `DescribeInstanceAttribute` with the attribute userData and instanceId in AWS CloudTrail logs. This may indicate an attempt to retrieve user data from an EC2 instance. Adversaries may use this information to gather sensitive data from the instance or to identify potential vulnerabilities. This is a building block rule that does not generate an alert on its own, but serves as a signal for anomalous activity.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: Amazon EC2",
          "Use Case: Log Auditing",
          "Tactic: Discovery",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DescribeInstanceAttribute.html",
          "https://hackingthe.cloud/aws/exploitation/local_ec2_priv_esc_through_user_data"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1580",
                "name": "Cloud Infrastructure Discovery",
                "reference": "https://attack.mitre.org/techniques/T1580/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "c4ab3c46-b458-4d32-8b13-6901c362cff4",
        "rule_id": "c1e79a70-fa6f-11ee-8bc8-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.083Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.083Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "query": "event.dataset:aws.cloudtrail\n    and event.action:DescribeInstanceAttribute\n    and aws.cloudtrail.request_parameters:(*attribute=userData* and *instanceId*)\n",
        "language": "kuery"
      },
      {
        "name": "Privilege Escalation via GDB CAP_SYS_PTRACE",
        "description": "Identifies instances where GDB (granted the CAP_SYS_PTRACE capability) is executed, after which the user's access is elevated to UID/GID 0 (root). In Linux, the CAP_SYS_PTRACE capability grants a process the ability to use the ptrace system call, which is typically used for debugging and allows the process to trace and control other processes. Attackers may leverage this capability to hook and inject into a process that is running with root permissions in order to escalate their privileges to root.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1055",
                "name": "Process Injection",
                "reference": "https://attack.mitre.org/techniques/T1055/",
                "subtechnique": [
                  {
                    "id": "T1055.008",
                    "name": "Ptrace System Calls",
                    "reference": "https://attack.mitre.org/techniques/T1055/008/"
                  }
                ]
              },
              {
                "id": "T1068",
                "name": "Exploitation for Privilege Escalation",
                "reference": "https://attack.mitre.org/techniques/T1068/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entry_leader.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.thread.capabilities.effective",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.thread.capabilities.permitted",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "25d901df-8e27-4822-b869-04a06ae2ff01",
        "rule_id": "c296f888-eac6-4543-8da5-b6abb0d3304f",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.098Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.098Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id, process.entry_leader.entity_id with maxspan=1m\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and process.name == \"gdb\" and\n   (process.thread.capabilities.effective : \"CAP_SYS_PTRACE\" or process.thread.capabilities.permitted : \"CAP_SYS_PTRACE\") and \n   user.id != \"0\"]\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.name != null and user.id == \"0\"]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "AWS SSM `SendCommand` with Run Shell Command Parameters",
        "description": "Identifies the use of the AWS Systems Manager (SSM) `SendCommand` API with the either `AWS-RunShellScript` or `AWS-RunPowerShellScript` parameters. The `SendCommand` API call allows users to execute commands on EC2 instances using the SSM service. Adversaries may use this technique to execute commands on EC2 instances without the need for SSH or RDP access. This behavior may indicate an adversary attempting to execute commands on an EC2 instance for malicious purposes. This is a [New Terms](https://www.elastic.co/guide/en/security/current/rules-ui-create.html#create-new-terms-rule) rule that only flags when this behavior is observed for the first time on a host in the last 7 days.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "@timestamp",
            "process.user.name",
            "process.entry_leader.group.name",
            "process.entry_leader.real_user.name",
            "event.action",
            "event.type",
            "host.os.type",
            "host.os.kernel",
            "process.entry_leader.executable",
            "process.entry_leader.working_directory",
            "process.parent.executable",
            "process.executable",
            "process.hash.sha256",
            "process.parent.command_line",
            "process.command_line",
            "process.args"
          ]
        },
        "version": 3,
        "tags": [
          "Domain: Endpoint",
          "Domain: Cloud",
          "OS: Linux",
          "OS: macOS",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate use of the `SendCommand` API call to execute commands on EC2 instances using the SSM service may be done by system administrators or DevOps engineers for legitimate purposes."
        ],
        "references": [
          "https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-privilege-escalation/aws-ssm-privesc",
          "https://securitycafe.ro/2023/01/17/aws-post-explitation-with-ssm-sendcommand/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1651",
                "name": "Cloud Administration Command",
                "reference": "https://attack.mitre.org/techniques/T1651/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "028eea31-a0eb-4b97-ade7-611c68ed6e34",
        "rule_id": "c371e9fc-6a10-11ef-a0ac-f661ea17fbcc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.107Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.107Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.category: \"process\" and event.type: \"start\" and process.name: \"aws\"\nand (\n    host.os.type: (\"windows\" or \"macos\")\n    or (\n        host.os.type: \"linux\"\n        and event.action: (\"exec\" or \"exec_event\" or \"executed\" or \"process_started\")\n    )\n)\nand process.args: (\n    \"send-command\" and \"--parameters\" and commands=*\n    and (\"AWS-RunShellScript\" or \"AWS-RunPowerShellScript\")\n)\n",
        "new_terms_fields": [
          "host.id"
        ],
        "history_window_start": "now-7d",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ],
        "language": "kuery"
      },
      {
        "name": "Shadow File Modification",
        "description": "This rule monitors for Linux Shadow file modifications. These modifications are indicative of a potential password change or user addition event. Threat actors may attempt to create new users or change the password of a user account to maintain access to a system.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/primer-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows\nthe Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click Add integrations.\n- In the query bar, search for Elastic Defend and select the integration to see more details about it.\n- Click Add Elastic Defend.\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either Traditional Endpoints or Cloud Workloads.\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest to select \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in New agent policy name. If other agent policies already exist, you can click the Existing hosts tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click Save and Continue.\n- To complete the integration, select Add Elastic Agent to your hosts and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.original.path",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "68a8fe36-d111-4c0d-9bf7-54ebf9ade289",
        "rule_id": "cdf1a39b-1ca5-4e2a-9739-17fc4d026029",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.116Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.116Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.type == \"change\" and event.action == \"rename\" and\nfile.path == \"/etc/shadow\" and file.Ext.original.path != null\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*"
        ]
      },
      {
        "name": "Unusual Discovery Activity by User",
        "description": "This rule leverages alert data from various Discovery building block rules to alert on signals with unusual unique host.id and user.id entries.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Rule Type: Higher-Order Rule",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": []
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [
          {
            "name": "event.kind",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "kibana.alert.rule.rule_id",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "138938f9-ac3a-417a-84b9-8aae3e37ca3c",
        "rule_id": "cf575427-0839-4c69-a9e6-99fde02606f3",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.125Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.125Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "host.os.type:windows and event.kind:signal and kibana.alert.rule.rule_id:(\n  \"d68e95ad-1c82-4074-a12a-125fe10ac8ba\" or \"7b8bfc26-81d2-435e-965c-d722ee397ef1\" or\n  \"0635c542-1b96-4335-9b47-126582d2c19a\" or \"6ea55c81-e2ba-42f2-a134-bccf857ba922\" or\n  \"e0881d20-54ac-457f-8733-fe0bc5d44c55\" or \"06568a02-af29-4f20-929c-f3af281e41aa\" or\n  \"c4e9ed3e-55a2-4309-a012-bc3c78dad10a\" or \"51176ed2-2d90-49f2-9f3d-17196428b169\" or\n  \"1d72d014-e2ab-4707-b056-9b96abe7b511\"\n)\n",
        "new_terms_fields": [
          "host.id",
          "user.id"
        ],
        "history_window_start": "now-14d",
        "index": [
          ".alerts-security.*"
        ],
        "language": "kuery"
      },
      {
        "name": "Trap Signals Execution",
        "description": "Identify activity related where adversaries can include a trap command which then allows programs and shells to specify commands that will be executed upon receiving interrupt signals.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "OS: macOS",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Rule Type: BBR",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/",
                "subtechnique": [
                  {
                    "id": "T1546.005",
                    "name": "Trap",
                    "reference": "https://attack.mitre.org/techniques/T1546/005/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "b789284c-ed52-41a5-bfb1-4e45d85b4faa",
        "rule_id": "cf6995ec-32a9-4b2d-9340-f8e61acf3f4e",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.134Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.134Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where event.type == \"start\" and event.action in (\"exec\", \"exec_event\", \"executed\", \"process_started\") and\nprocess.name == \"trap\" and process.args : \"SIG*\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "Archive File with Unusual Extension",
        "description": "Identifies the creation of an archive file with an unusual extension. Attackers may attempt to evade detection by masquerading files using the file extension values used by image, audio, or document file types.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.008",
                    "name": "Masquerade File Type",
                    "reference": "https://attack.mitre.org/techniques/T1036/008/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.header_bytes",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a4a7b185-07ea-4bc3-ae28-f402633a8101",
        "rule_id": "cffbaf47-9391-4e09-a83c-1f27d7474826",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.149Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.149Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"windows\" and event.action != \"deletion\" and\n\n  /* common archive file headers - Rar, 7z, GZIP, MSCF, XZ, ZIP */\n  file.Ext.header_bytes : (\"52617221*\", \"377ABCAF271C*\", \"1F8B*\", \"4d534346*\", \"FD377A585A00*\", \"504B0304*\", \"504B0708*\") and\n\n  (\n    /* common image file extensions */\n    file.extension : (\"jpg\", \"jpeg\", \"emf\", \"tiff\", \"gif\", \"png\", \"bmp\", \"ico\", \"fpx\", \"eps\", \"inf\") or\n\n    /* common audio and video file extensions */\n    file.extension : (\"mp3\", \"wav\", \"avi\", \"mpeg\", \"flv\", \"wma\", \"wmv\", \"mov\", \"mp4\", \"3gp\") or\n\n    /* common document file extensions */\n    (file.extension : (\"doc\", \"docx\", \"rtf\", \"ppt\", \"pptx\", \"xls\", \"xlsx\") and\n\n    /* exclude ZIP file header values for OPENXML documents */\n    not file.Ext.header_bytes : (\"504B0304*\", \"504B0708*\"))\n  ) and\n\n  not (process.executable : \"?:\\\\Windows\\\\System32\\\\inetsrv\\\\w3wp.exe\" and file.path : \"?:\\\\inetpub\\\\temp\\\\IIS Temporary Compressed Files\\\\*\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file-*"
        ]
      },
      {
        "name": "Unusual DPKG Execution",
        "description": "This rule detects the execution of the DPKG command by processes not associated with the DPKG package manager. The DPKG command is used to install, remove, and manage Debian packages on a Linux system. Attackers can abuse the DPKG command to install malicious packages on a system.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.makeuseof.com/how-deb-packages-are-backdoored-how-to-detect-it/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/",
                "subtechnique": [
                  {
                    "id": "T1546.016",
                    "name": "Installer Packages",
                    "reference": "https://attack.mitre.org/techniques/T1546/016/"
                  }
                ]
              },
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/"
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1195",
                "name": "Supply Chain Compromise",
                "reference": "https://attack.mitre.org/techniques/T1195/",
                "subtechnique": [
                  {
                    "id": "T1195.002",
                    "name": "Compromise Software Supply Chain",
                    "reference": "https://attack.mitre.org/techniques/T1195/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.group_leader.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.session_leader.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "cc18a37a-85e0-428a-b578-17f6721f009b",
        "rule_id": "d6241c90-99f2-44db-b50f-299b6ebd7ee9",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.159Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.159Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\nprocess.executable : \"/var/lib/dpkg/info/*\" and process.session_leader.name != null and\nprocess.group_leader.name != null and not (\n  process.parent.name in (\"dpkg\", \"dpkg-reconfigure\") or\n  process.session_leader.name == \"dpkg\" or\n  process.group_leader.name == \"dpkg\" or\n  process.parent.executable in (\"/usr/share/debconf/frontend\", \"/usr/bin/unattended-upgrade\")\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Git Hook Command Execution",
        "description": "This rule detects the execution of a potentially malicious process from a Git hook. Git hooks are scripts that Git executes before or after events such as: commit, push, and receive. An attacker can abuse Git hooks to execute arbitrary commands on the system and establish persistence.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Execution",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://swisskyrepo.github.io/InternalAllTheThings/redteam/persistence/linux-persistence/#backdooring-git",
          "https://www.elastic.co/security-labs/sequel-on-persistence-mechanisms"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/"
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "c21444c8-0e0b-4900-9eeb-83c63de582e3",
        "rule_id": "dc61f382-dc0c-4cc0-a845-069f2a071704",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.168Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.168Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id with maxspan=3s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.parent.name == \"git\" and process.args : \".git/hooks/*\" and\n   process.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\")\n  ] by process.entity_id\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.parent.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\")] by process.parent.entity_id\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process*"
        ]
      },
      {
        "name": "Unusual Execution via Microsoft Common Console File",
        "description": "Identifies the execution of a child process from a Microsoft Common Console file. Adversaries may embed a malicious command in an MSC file in order to trick victims into executing malicious commands.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Execution via Microsoft Common Console File\n\n- Investigate the source of the MSC file.\n- Investigate the process execution chain (all spawned child processes and their descendants).\n- Investigate the process and it's descendants network and file events.\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Contact the account owner and confirm whether they are aware of this activity.\n\n### Response and remediation\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 201,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Tactic: Initial Access",
          "Resources: Investigation Guide",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: SentinelOne"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.genians.co.kr/blog/threat_intelligence/facebook"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1204",
                "name": "User Execution",
                "reference": "https://attack.mitre.org/techniques/T1204/",
                "subtechnique": [
                  {
                    "id": "T1204.002",
                    "name": "Malicious File",
                    "reference": "https://attack.mitre.org/techniques/T1204/002/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1566",
                "name": "Phishing",
                "reference": "https://attack.mitre.org/techniques/T1566/",
                "subtechnique": [
                  {
                    "id": "T1566.001",
                    "name": "Spearphishing Attachment",
                    "reference": "https://attack.mitre.org/techniques/T1566/001/"
                  },
                  {
                    "id": "T1566.002",
                    "name": "Spearphishing Link",
                    "reference": "https://attack.mitre.org/techniques/T1566/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "5231635e-fa71-4938-8f75-c7b9989252a5",
        "rule_id": "e760c72b-bb1f-44f0-9f0d-37d51744ee75",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.177Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.177Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n process.parent.executable : \"?:\\\\Windows\\\\System32\\\\mmc.exe\" and endswith~(process.parent.args, \".msc\") and\n not process.parent.args : (\"?:\\\\Windows\\\\System32\\\\*.msc\", \"?:\\\\Windows\\\\SysWOW64\\\\*.msc\", \"?:\\\\Program files\\\\*.msc\", \"?:\\\\Program Files (x86)\\\\*.msc\")\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-endpoint.events.process-*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*"
        ]
      },
      {
        "name": "AWS S3 Bucket Policy Added to Share with External Account",
        "description": "Identifies an AWS S3 bucket policy change to share permissions with an external account. Adversaries may attempt to backdoor an S3 bucket by sharing it with an external account. This can be used to exfiltrate data or to provide access to other adversaries. This rule identifies changes to a bucket policy via the `PutBucketPolicy` API call where the policy includes an `Effect=Allow` statement that does not contain the AWS account ID of the bucket owner.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS S3 Bucket Policy Change to Share with External Account\n\nThis rule detects when an AWS S3 bucket policy is changed to share permissions with an external account. Adversaries may attempt to backdoor an S3 bucket by sharing it with an external account to exfiltrate data or provide access to other adversaries. This rule identifies changes to a bucket policy via the `PutBucketPolicy` API call where the policy includes an `Effect=Allow` statement that does not contain the AWS account ID of the bucket owner.\n\n#### Possible Investigation Steps:\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who made the change. Verify if this actor typically performs such actions and if they have the necessary permissions.\n- **Review the Request Details**: Examine the `aws.cloudtrail.request_parameters` to understand the specific changes made to the bucket policy. Look for any unusual parameters that could suggest unauthorized or malicious modifications.\n- **Analyze the Source of the Request**: Investigate the `source.ip` and `source.geo` fields to determine the geographical origin of the request. An external or unexpected location might indicate compromised credentials or unauthorized access.\n- **Contextualize with Timestamp**: Use the `@timestamp` field to check when the change occurred. Modifications during non-business hours or outside regular maintenance windows might require further scrutiny.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this change to see if the same actor or IP address engaged in other potentially suspicious activities.\n\n### False Positive Analysis:\n\n- **Legitimate Administrative Actions**: Confirm if the bucket policy change aligns with scheduled updates, development activities, or legitimate administrative tasks documented in change management systems.\n- **Consistency Check**: Compare the action against historical data of similar actions performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.\n- **Verify through Outcomes**: Check the `aws.cloudtrail.response_elements` and the `event.outcome` to confirm if the change was successful and intended according to policy.\n\n### Response and Remediation:\n\n- **Immediate Review and Reversal if Necessary**: If the change was unauthorized, update the bucket policy to remove any unauthorized permissions and restore it to its previous state.\n- **Enhance Monitoring and Alerts**: Adjust monitoring systems to alert on similar actions, especially those involving sensitive data or permissions.\n- **Educate and Train**: Provide additional training to users with administrative rights on the importance of security best practices concerning bucket policy management and sharing permissions.\n- **Audit Bucket Policies and Permissions**: Conduct a comprehensive audit of all bucket policies and associated permissions to ensure they adhere to the principle of least privilege.\n- **Incident Response**: If there's an indication of malicious intent or a security breach, initiate the incident response protocol to mitigate any damage and prevent future occurrences.\n\n### Additional Information:\n\nFor further guidance on managing S3 bucket policies and securing AWS environments, refer to the [AWS S3 documentation](https://docs.aws.amazon.com/AmazonS3/latest/userguide/enable-cloudtrail-logging-for-s3.html) and AWS best practices for security.\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS S3",
          "Use Case: Threat Detection",
          "Tactic: Exfiltration"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate changes to share an S3 bucket with an external account may be identified as false positive but are not best practice."
        ],
        "references": [
          "https://stratus-red-team.cloud/attack-techniques/AWS/aws.exfiltration.s3-backdoor-bucket-policy/",
          "https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketPolicy.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": [
              {
                "id": "T1537",
                "name": "Transfer Data to Cloud Account",
                "reference": "https://attack.mitre.org/techniques/T1537/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nS3 data event types must be collected in the AWS CloudTrail logs. Please refer to [AWS documentation](https://docs.aws.amazon.com/AmazonS3/latest/userguide/enable-cloudtrail-logging-for-s3.html) for more information.\n",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.recipient_account_id",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "6e8ff05d-085a-4a6c-ab66-39e8ccda2384",
        "rule_id": "e8c9ff14-fd1e-11ee-a0df-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.192Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.192Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where event.dataset == \"aws.cloudtrail\"\n    and event.provider == \"s3.amazonaws.com\"\n    and event.action == \"PutBucketPolicy\" and event.outcome == \"success\"\n    and stringContains(aws.cloudtrail.request_parameters, \"Effect=Allow\")\n    and not stringContains(aws.cloudtrail.request_parameters, aws.cloudtrail.recipient_account_id)\n",
        "language": "eql",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ]
      },
      {
        "name": "Executable File with Unusual Extension",
        "description": "Identifies the creation or modification of an executable file with an unexpected file extension. Attackers may attempt to evade detection by masquerading files using the file extension values used by image, audio, or document file types.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Rule Type: BBR",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.008",
                    "name": "Masquerade File Type",
                    "reference": "https://attack.mitre.org/techniques/T1036/008/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.header_bytes",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.pid",
            "type": "long",
            "ecs": true
          }
        ],
        "id": "6d19f45e-6848-441e-a63d-b5aa86588376",
        "rule_id": "ecd4857b-5bac-455e-a7c9-a88b66e56a9e",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.202Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.202Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"windows\" and event.action != \"deletion\" and\n\n /* MZ header or its common base64 equivalent TVqQ */\n file.Ext.header_bytes : (\"4d5a*\", \"54567151*\") and\n\n (\n   /* common image file extensions */\n   file.extension : (\"jpg\", \"jpeg\", \"emf\", \"tiff\", \"gif\", \"png\", \"bmp\", \"fpx\", \"eps\", \"svg\", \"inf\") or\n\n   /* common audio and video file extensions */\n   file.extension : (\"mp3\", \"wav\", \"avi\", \"mpeg\", \"flv\", \"wma\", \"wmv\", \"mov\", \"mp4\", \"3gp\") or\n\n   /* common document file extensions */\n   file.extension : (\"txt\", \"pdf\", \"doc\", \"docx\", \"rtf\", \"ppt\", \"pptx\", \"xls\", \"xlsx\", \"hwp\", \"html\")\n  ) and\n  not process.pid == 4 and\n  not process.executable : \"?:\\\\Program Files (x86)\\\\Trend Micro\\\\Client Server Security Agent\\\\Ntrtscan.exe\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file-*"
        ]
      },
      {
        "name": "Shortcut File Written or Modified on Startup Folder",
        "description": "Identifies shortcut files written to or modified in the startup folder. Adversaries may use this technique to maintain persistence.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Elastic Defend",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1547",
                "name": "Boot or Logon Autostart Execution",
                "reference": "https://attack.mitre.org/techniques/T1547/",
                "subtechnique": [
                  {
                    "id": "T1547.001",
                    "name": "Registry Run Keys / Startup Folder",
                    "reference": "https://attack.mitre.org/techniques/T1547/001/"
                  },
                  {
                    "id": "T1547.009",
                    "name": "Shortcut Modification",
                    "reference": "https://attack.mitre.org/techniques/T1547/009/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.code_signature.status",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "c69cd14f-df23-4ceb-9436-5c200ae833c8",
        "rule_id": "ee53d67a-5f0c-423c-a53c-8084ae562b5c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.212Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.212Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"windows\" and event.type != \"deletion\" and file.extension == \"lnk\" and\n  file.path : (\n    \"C:\\\\Users\\\\*\\\\AppData\\\\Roaming\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\*\",\n    \"C:\\\\ProgramData\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\StartUp\\\\*\"\n  ) and\n  not (\n    (process.name : \"ONENOTE.EXE\" and process.code_signature.status: \"trusted\" and file.name : \"*OneNote.lnk\") or\n    (process.name : \"OktaVerifySetup.exe\" and process.code_signature.status: \"trusted\" and file.name : \"Okta Verify.lnk\") or\n    (process.name : \"OneLaunch.exe\" and process.code_signature.status: \"trusted\" and file.name : \"OneLaunch*.lnk\") or\n    (process.name : \"APPServerClient.exe\" and process.code_signature.status: \"trusted\" and file.name : \"Parallels Client.lnk\")\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file-*"
        ]
      },
      {
        "name": "AWS RDS DB Instance or Cluster Password Modified",
        "description": "Identifies the modification of the master password for an AWS RDS DB instance or cluster. DB instances may contain sensitive data that can be abused if accessed by unauthorized actors. Amazon RDS API operations never return the password, so this operation provides a means to regain access if the password is lost. Adversaries with the proper permissions can take advantage of this to evade defenses and gain unauthorized access to a DB instance or cluster to support persistence mechanisms or privilege escalation.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS RDS DB Instance or Cluster Password Modified\n\nThis rule identifies when an RDS DB instance or cluster password is modified. While changing the master password is a legitimate means to regain access in the case of a lost password, adversaries may exploit this feature to maintain persistence or evade defenses in a compromised environment.\n\n#### Possible Investigation Steps\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who made the change. Verify if this actor typically performs such actions and if they have the necessary permissions.\n- **Review the Modification Event**: Identify the DB instance involved and review the event details. Look for `ModifyDBInstance` actions where the masterUserPassword parameter was changed.\n    - **Request and Response Parameters**: Check the `aws.cloudtrail.request_parameters` field in the CloudTrail event to identify the DB Instance Identifier and any other modifications made to the instance.\n- **Verify the Modified Instance**: Check the DB instance that was modified and its contents to determine the sensitivity of the data stored within it.\n- **Contextualize with Recent Changes**: Compare this modification event against recent changes in RDS DB or Cluster configurations and deployments. Look for any other recent permissions changes or unusual administrative actions.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this change to see if the same actor or IP address engaged in other potentially suspicious activities.\n- **Interview Relevant Personnel**: If the modification was initiated by a user, verify the intent and authorization for this action with the person or team responsible for managing DB instances.\n### False Positive Analysis\n\n- **Legitimate Instance Modification**: Confirm if the DB instance modification aligns with legitimate tasks.\n- **Consistency Check**: Compare the action against historical data of similar actions performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.\n\n### Response and Remediation\n\n- **Immediate Review and Reversal**: If the change was unauthorized, update the instance password. If the master user password was managed with AWS Secrets Manager, determine whether the `manageMasterUserPassword` attribute was changed to false and revert if necessary.\n- **Enhance Monitoring and Alerts**: Adjust monitoring systems to alert on similar actions, especially those involving sensitive data or permissions.\n- **Audit Instances and Policies**: Conduct a comprehensive audit of all instances and associated policies to ensure they adhere to the principle of least privilege.\n- **Policy Update**: Review and possibly update your organization’s policies on DB instance access to tighten control and prevent unauthorized access.\n- **Incident Response**: If malicious intent is confirmed, consider it a data breach incident and initiate the incident response protocol. This includes further investigation, containment, and recovery.\n\n### Additional Information:\n\nFor further guidance on managing DB instances and securing AWS environments, refer to the [AWS RDS documentation](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_RDS_Managing.html) and AWS best practices for security. Additionally, consult the following resources for specific details on DB instance security:\n- [AWS RDS ModifyDBInstance](https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_ModifyDBInstance.html)\n- [Amazon RDS and Secrets Manager](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/rds-secrets-manager.html)\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS RDS",
          "Resources: Investigation Guide",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Privilege Escalation",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Master password change is a legitimate means to regain access to a DB instance in the case of a lost password. Ensure that the instance should not be modified in this way before taking action."
        ],
        "references": [
          "https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_ModifyDBInstance.html",
          "https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.DBInstance.Modifying.html",
          "https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-privilege-escalation/aws-rds-privesc#rds-modifydbinstance"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.001",
                    "name": "Additional Cloud Credentials",
                    "reference": "https://attack.mitre.org/techniques/T1098/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": []
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": []
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d45e2da6-7640-4c00-843c-6eae89bf764e",
        "rule_id": "f2015527-7c46-4bb9-80db-051657ddfb69",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.221Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.221Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where event.dataset == \"aws.cloudtrail\"\n    and event.provider == \"rds.amazonaws.com\"\n    and event.action in (\"ModifyDBInstance\", \"ModifyDBCluster\")\n    and event.outcome == \"success\"\n    and stringContains(aws.cloudtrail.request_parameters, \"masterUserPassword=*\")\n",
        "language": "eql",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ]
      },
      {
        "name": "Creation or Modification of Pluggable Authentication Module or Configuration",
        "description": "This rule monitors for the creation or modification of Pluggable Authentication Module (PAM) shared object files or configuration files. Attackers may create or modify these files to maintain persistence on a compromised system, or harvest account credentials.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Tactic: Persistence",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Trusted system module updates or allowed Pluggable Authentication Module (PAM) daemon configuration changes."
        ],
        "references": [
          "https://github.com/zephrax/linux-pam-backdoor",
          "https://github.com/eurialo/pambd",
          "http://0x90909090.blogspot.com/2016/06/creating-backdoor-in-pam-in-5-line-of.html",
          "https://www.trendmicro.com/en_us/research/19/i/skidmap-linux-malware-uses-rootkit-capabilities-to-hide-cryptocurrency-mining-payload.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1556",
                "name": "Modify Authentication Process",
                "reference": "https://attack.mitre.org/techniques/T1556/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.Ext.original.extension",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "8c32c2f5-ee6e-482d-b47c-2c0d280be77d",
        "rule_id": "f48ecc44-7d02-437d-9562-b838d2c41987",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.231Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.231Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.action in (\"rename\", \"creation\") and \nprocess.executable != null and (\n  (file.path : (\"/lib/security/*\", \"/lib64/security/*\", \"/usr/lib/security/*\", \"/usr/lib64/security/*\",\n  \"/usr/lib/x86_64-linux-gnu/security/*\") and file.extension == \"so\") or\n  (file.path : \"/etc/pam.d/*\" and file.extension == null) or \n  (file.path : \"/etc/security/pam_*\" or file.path == \"/etc/pam.conf\")\n) and not (\n  process.executable in (\n    \"/bin/dpkg\", \"/usr/bin/dpkg\", \"/bin/dockerd\", \"/usr/bin/dockerd\", \"/usr/sbin/dockerd\", \"/bin/microdnf\",\n    \"/usr/bin/microdnf\", \"/bin/rpm\", \"/usr/bin/rpm\", \"/bin/snapd\", \"/usr/bin/snapd\", \"/bin/yum\", \"/usr/bin/yum\",\n    \"/bin/dnf\", \"/usr/bin/dnf\", \"/bin/podman\", \"/usr/bin/podman\", \"/bin/dnf-automatic\", \"/usr/bin/dnf-automatic\",\n    \"/bin/pacman\", \"/usr/bin/pacman\", \"/usr/bin/dpkg-divert\", \"/bin/dpkg-divert\", \"/sbin/apk\", \"/usr/sbin/apk\",\n    \"/usr/local/sbin/apk\", \"/usr/bin/apt\", \"/usr/sbin/pacman\", \"/bin/podman\", \"/usr/bin/podman\", \"/usr/bin/puppet\",\n    \"/bin/puppet\", \"/opt/puppetlabs/puppet/bin/puppet\", \"/usr/bin/chef-client\", \"/bin/chef-client\",\n    \"/bin/autossl_check\", \"/usr/bin/autossl_check\", \"/proc/self/exe\", \"/dev/fd/*\",  \"/usr/bin/pamac-daemon\",\n    \"/bin/pamac-daemon\", \"/usr/lib/snapd/snapd\", \"/usr/local/bin/dockerd\", \"/usr/sbin/pam-auth-update\",\n    \"/usr/lib/systemd/systemd\", \"/usr/libexec/packagekitd\", \"/usr/bin/bsdtar\", \"/sbin/pam-auth-update\"\n  ) or\n  file.path : (\n    \"/tmp/snap.rootfs_*/pam_*.so\", \"/tmp/newroot/lib/*/pam_*.so\", \"/tmp/newroot/usr/lib64/security/pam_*.so\"\n  ) or\n  file.extension in (\"swp\", \"swpx\", \"swx\", \"dpkg-remove\") or\n  file.Ext.original.extension == \"dpkg-new\" or\n  process.executable : (\n    \"/nix/store/*\", \"/var/lib/dpkg/*\", \"/snap/*\", \"/dev/fd/*\", \"/usr/lib/virtualbox/*\"\n  ) or\n  (process.name == \"sed\" and file.name : \"sed*\") or\n  (process.name == \"perl\" and file.name : \"e2scrub_all.tmp*\") \n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*"
        ]
      },
      {
        "name": "DPKG Package Installed by Unusual Parent Process",
        "description": "This rule detects the installation of a Debian package (dpkg) by an unusual parent process. The dpkg command is used to install, remove, and manage Debian packages on a Linux system. Attackers can abuse the dpkg command to install malicious packages on a system.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.makeuseof.com/how-deb-packages-are-backdoored-how-to-detect-it/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/"
              },
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/",
                "subtechnique": [
                  {
                    "id": "T1546.016",
                    "name": "Installer Packages",
                    "reference": "https://attack.mitre.org/techniques/T1546/016/"
                  }
                ]
              },
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1195",
                "name": "Supply Chain Compromise",
                "reference": "https://attack.mitre.org/techniques/T1195/",
                "subtechnique": [
                  {
                    "id": "T1195.002",
                    "name": "Compromise Software Supply Chain",
                    "reference": "https://attack.mitre.org/techniques/T1195/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "3644cb8c-e829-4343-8c3d-bc5ec2083a52",
        "rule_id": "f4d1c0ac-aedb-4063-9fa6-cc651eb5e6ee",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.246Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.246Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "host.os.type:linux and event.category:process and event.type:start and event.action:exec and process.name:dpkg and\nprocess.args:(\"-i\" or \"--install\")\n",
        "new_terms_fields": [
          "process.parent.executable"
        ],
        "history_window_start": "now-7d",
        "index": [
          "logs-endpoint.events.*"
        ],
        "language": "kuery"
      },
      {
        "name": "AWS RDS DB Instance or Cluster Deletion Protection Disabled",
        "description": "Identifies the modification of an AWS RDS DB instance or cluster to remove the deletionProtection feature. Deletion protection is enabled automatically for instances set up through the console and can be used to protect them from unintentional deletion activity. If disabled an instance or cluster can be deleted, destroying sensitive or critical information. Adversaries with the proper permissions can take advantage of this to set up future deletion events against a compromised environment.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS RDS DB Instance or Cluster Deletion Protection Disabled\n\nThis rule identifies when the deletion protection feature is removed from an RDS DB instance or cluster. Removing deletion protection is a prerequisite for deleting a DB instance. Adversaries may exploit this feature to permanently delete data in a compromised environment.\n\n#### Possible Investigation Steps\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who made the change. Verify if this actor typically performs such actions and if they have the necessary permissions.\n- **Review the Modification Event**: Identify the DB instance involved and review the event details. Look for `ModifyDBInstance` actions where the deletionProtection parameter was changed.\n    - **Request and Response Parameters**: Check the `aws.cloudtrail.request_parameters` field in the CloudTrail event to identify the DB instance or cluster identifier and any other modifications made to the instance.\n- **Verify the Modified Instance**: Check the DB instance that was modified and its contents to determine the sensitivity of the data stored within it.\n- **Contextualize with Recent Changes**: Compare this modification event against recent changes in RDS DB instance or cluster configurations and deployments. Look for any other recent permissions changes or unusual administrative actions.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this change to see if the same actor or IP address engaged in other potentially suspicious activities.\n- **Interview Relevant Personnel**: If the modification was initiated by a user, verify the intent and authorization for this action with the person or team responsible for managing DB instances.\n### False Positive Analysis\n\n- **Legitimate Instance Modification**: Confirm if the DB instance modification aligns with legitimate tasks.\n- **Consistency Check**: Compare the action against historical data of similar actions performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.\n\n### Response and Remediation\n\n- **Immediate Review and Reversal**: If the change was unauthorized, reset deletionProtection to true.\n- **Enhance Monitoring and Alerts**: Adjust monitoring systems to alert on similar actions, especially those involving sensitive data or permissions.\n- **Audit Instances and Policies**: Conduct a comprehensive audit of all instances and associated policies to ensure they adhere to the principle of least privilege.\n- **Policy Update**: Review and possibly update your organization’s policies on DB instance access to tighten control and prevent unauthorized access.\n- **Incident Response**: If malicious intent is confirmed, consider it a data breach incident and initiate the incident response protocol. This includes further investigation, containment, and recovery.\n\n### Additional Information:\n\nFor further guidance on managing DB instances and securing AWS environments, refer to the [AWS RDS documentation](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_RDS_Managing.html) and AWS best practices for security. Additionally, consult the following resources for specific details on DB instance security:\n- [AWS RDS ModifyDBInstance](https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_ModifyDBInstance.html)\n- [Deleting AWS RDS DB Instance](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_DeleteInstance.html)\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS RDS",
          "Resources: Investigation Guide",
          "Use Case: Threat Detection",
          "Tactic: Impact"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "The deletionProtection feature must be disabled as a prerequisite for deletion of a DB instance or cluster. Ensure that the instance should not be modified in this way before taking action."
        ],
        "references": [
          "https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_ModifyDBInstance.html",
          "https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_DeleteInstance.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1485",
                "name": "Data Destruction",
                "reference": "https://attack.mitre.org/techniques/T1485/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "e9c3d59a-e5c4-425b-a190-26a3230f688a",
        "rule_id": "f6652fb5-cd8e-499c-8311-2ce2bb6cac62",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.257Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.257Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where event.dataset == \"aws.cloudtrail\"\n    and event.provider == \"rds.amazonaws.com\"\n    and event.action in (\"ModifyDBInstance\", \"ModifyDBCluster\")\n    and event.outcome == \"success\"\n    and stringContains(aws.cloudtrail.request_parameters, \"deletionProtection=false\")\n",
        "language": "eql",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ]
      },
      {
        "name": "AWS Systems Manager SecureString Parameter Request with Decryption Flag",
        "description": "Detects the first occurrence of a user identity accessing AWS Systems Manager (SSM) SecureString parameters using the GetParameter or GetParameters API actions with credentials in the request parameters. This could indicate that the user is accessing sensitive information. This rule detects when a user accesses a SecureString parameter with the `withDecryption` parameter set to true. This is a [NewTerms](https://www.elastic.co/guide/en/security/current/rules-ui-create.html#create-new-terms-rule) rule that detects the first occurrence of a specific AWS ARN accessing SecureString parameters with decryption within the last 10 days.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS Systems Manager SecureString Parameter Request with Decryption Flag\n\nThis rule detects when an AWS resource accesses SecureString parameters within AWS Systems Manager (SSM) with the decryption flag set to true. SecureStrings are encrypted using a KMS key, and accessing these with decryption can indicate attempts to access sensitive data.\n\nAdversaries may target SecureStrings to retrieve sensitive information such as encryption keys, passwords, and other credentials that are stored securely. Accessing these parameters with decryption enabled is particularly concerning because it implies the adversary is attempting to bypass the encryption to obtain plain text values that can be immediately used or exfiltrated. This behavior might be part of a larger attack strategy aimed at escalating privileges or moving laterally within an environment to access protected data or critical infrastructure.\n\n#### Possible Investigation Steps\n\n- **Review the Access Event**: Identify the specific API call (`GetParameter` or `GetParameters`) that triggered the rule. Examine the `request_parameters` for `withDecryption` set to true and the name of the accessed parameter.\n- **Verify User Identity and Access Context**: Check the `user_identity` details to understand who accessed the parameter and their role within the organization. This includes checking the ARN and access key ID to determine if the access was authorized.\n- **Contextualize with User Behavior**: Assess whether the access pattern fits the user’s normal behavior or job responsibilities. Investigate any out-of-pattern activities around the time of the event.\n- **Analyze Geographic and IP Context**: Using the `source.ip` and `source.geo` information, verify if the request came from a trusted location or if there are any anomalies that suggest a compromised account.\n- **Inspect Related CloudTrail Events**: Look for other related events in CloudTrail to see if there was unusual activity before or after this event, such as unusual login attempts, changes to permissions, or other API calls that could indicate broader unauthorized actions.\n\n### False Positive Analysis\n\n- **Legitimate Administrative Use**: Verify if the decryption of SecureString parameters is a common practice for the user’s role, particularly if used in automation scripts or deployment processes like those involving Terraform or similar tools.\n\n### Response and Remediation\n\n- **Immediate Verification**: Contact the user or team responsible for the API call to verify their intent and authorization.\n- **Review and Revise Permissions**: If the access was unauthorized, review the permissions assigned to the user or role to ensure they align with the principle of least privilege.\n- **Audit Parameter Access Policies**: Ensure that policies governing access to SecureString parameters are strict and audit logs are enabled to track access with decryption.\n- **Incident Response**: If suspicious activity is confirmed, follow through with your organization's incident response plan to mitigate any potential security issues.\n- **Enhanced Monitoring and Alerting**: Strengthen monitoring rules to detect unusual accesses to SecureString parameters, especially those that involve decryption.\n\n### Additional Information\n\nThis rule focuses solely on SecureStrings in AWS Systems Manager (SSM) parameters. SecureStrings are encrypted using an AWS Key Management Service (KMS) key. When a user accesses a SecureString parameter, they can specify whether the parameter should be decrypted. If the user specifies that the parameter should be decrypted, the decrypted value is returned in the response.\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS Systems Manager",
          "Tactic: Credential Access",
          "Resources: Investigation Guide"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Users may legitimately access AWS Systems Manager (SSM) parameters using the GetParameter, GetParameters, or DescribeParameters API actions with credentials in the request parameters. Ensure that the user has a legitimate reason to access the parameters and that the credentials are secured."
        ],
        "references": [
          "https://docs.aws.amazon.com/vsts/latest/userguide/systemsmanager-getparameter.html",
          "https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1555",
                "name": "Credentials from Password Stores",
                "reference": "https://attack.mitre.org/techniques/T1555/",
                "subtechnique": [
                  {
                    "id": "T1555.006",
                    "name": "Cloud Secrets Management Stores",
                    "reference": "https://attack.mitre.org/techniques/T1555/006/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "This rule requires that AWS CloudTrail logs are ingested into the Elastic Stack. Ensure that the AWS integration is properly configured to collect AWS CloudTrail logs. This rule also requires event logging for AWS Systems Manager (SSM) API actions which can be enabled in CloudTrail's data events settings.\n",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "96201f97-22a5-451c-b2a4-ac1dc92ba74b",
        "rule_id": "fd332492-0bc6-11ef-b5be-f661ea17fbcc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.267Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.267Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset: aws.cloudtrail\n    and event.provider: \"ssm.amazonaws.com\"\n    and event.action: (GetParameters or GetParameter)\n    and event.outcome: success\n    and aws.cloudtrail.request_parameters: *withDecryption=true*\n",
        "new_terms_fields": [
          "aws.cloudtrail.user_identity.arn"
        ],
        "history_window_start": "now-10d",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail*"
        ],
        "language": "kuery"
      },
      {
        "name": "Image Loaded with Invalid Signature",
        "description": "Identifies binaries that are loaded and with an invalid code signature. This may indicate an attempt to masquerade as a signed binary.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Rule Type: BBR",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1036",
                "name": "Masquerading",
                "reference": "https://attack.mitre.org/techniques/T1036/",
                "subtechnique": [
                  {
                    "id": "T1036.001",
                    "name": "Invalid Code Signature",
                    "reference": "https://attack.mitre.org/techniques/T1036/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "dll.Ext.relative_file_creation_time",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "dll.Ext.relative_file_name_modify_time",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "dll.code_signature.status",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "dll.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "dll.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "4c38aa3b-e69c-4bce-bb99-fe7e8154ddcc",
        "rule_id": "fd9484f2-1c56-44ae-8b28-dc1354e3a0e8",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.277Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.277Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "library where host.os.type == \"windows\" and event.action == \"load\" and\n  dll.code_signature.status : (\"errorUntrustedRoot\", \"errorBadDigest\", \"errorUntrustedRoot\") and\n  (dll.Ext.relative_file_creation_time <= 500 or dll.Ext.relative_file_name_modify_time <= 500) and\n  not startswith~(dll.name, process.name) and\n  not dll.path : (\n    \"?:\\\\Windows\\\\System32\\\\DriverStore\\\\FileRepository\\\\*\"\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.library-*"
        ]
      },
      {
        "name": "Execution via MS VisualStudio Pre/Post Build Events",
        "description": "Identifies the execution of a command via Microsoft Visual Studio Pre or Post build events. Adversaries may backdoor a trusted visual studio project to execute a malicious command during the project build process.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Tactic: Execution",
          "Rule Type: BBR",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://docs.microsoft.com/en-us/visualstudio/ide/reference/pre-build-event-post-build-event-command-line-dialog-box?view=vs-2022",
          "https://www.pwc.com/gx/en/issues/cybersecurity/cyber-threat-intelligence/threat-actor-of-in-tur-est.html",
          "https://blog.google/threat-analysis-group/new-campaign-targeting-security-researchers/",
          "https://github.com/sbousseaden/EVTX-ATTACK-SAMPLES/blob/master/Execution/execution_evasion_visual_studio_prebuild_event.evtx"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1127",
                "name": "Trusted Developer Utilities Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1127/",
                "subtechnique": [
                  {
                    "id": "T1127.001",
                    "name": "MSBuild",
                    "reference": "https://attack.mitre.org/techniques/T1127/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": []
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "20ad8ec1-874f-4eb0-9a66-5f5280303d0c",
        "rule_id": "fec7ccb7-6ed9-4f98-93ab-d6b366b063a0",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.293Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.293Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence with maxspan=1m\n  [process where host.os.type == \"windows\" and event.action == \"start\" and\n   process.name : \"cmd.exe\" and process.parent.name : \"MSBuild.exe\" and\n   process.args : \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\tmp*.exec.cmd\"] by process.entity_id\n  [process where host.os.type == \"windows\" and event.action == \"start\" and\n    process.name : (\n      \"cmd.exe\", \"powershell.exe\",\n      \"MSHTA.EXE\", \"CertUtil.exe\",\n      \"CertReq.exe\", \"rundll32.exe\",\n      \"regsvr32.exe\", \"MSbuild.exe\",\n      \"cscript.exe\", \"wscript.exe\",\n      \"installutil.exe\"\n    ) and\n    not \n    (\n      process.name : (\"cmd.exe\", \"powershell.exe\") and\n      process.args : (\n        \"*\\\\vcpkg\\\\scripts\\\\buildsystems\\\\msbuild\\\\applocal.ps1\",\n        \"HKLM\\\\SOFTWARE\\\\Microsoft\\\\VisualStudio\\\\SxS\\\\VS?\",\n        \"process.versions.node*\",\n        \"?:\\\\Program Files\\\\nodejs\\\\node.exe\",\n        \"HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Microsoft\\\\MSBuild\\\\ToolsVersions\\\\*\",\n        \"*Get-ChildItem*Tipasplus.css*\",\n        \"Build\\\\GenerateResourceScripts.ps1\",\n        \"Shared\\\\Common\\\\..\\\\..\\\\BuildTools\\\\ConfigBuilder.ps1\\\"\",\n        \"?:\\\\Projets\\\\*\\\\PostBuild\\\\MediaCache.ps1\"\n      )\n    ) and\n    not process.executable : \"?:\\\\Program Files*\\\\Microsoft Visual Studio\\\\*\\\\MSBuild.exe\" and\n    not (process.name : \"cmd.exe\" and\n         process.command_line :\n                  (\"*vswhere.exe -property catalog_productSemanticVersion*\",\n                   \"*git log --pretty=format*\", \"*\\\\.nuget\\\\packages\\\\vswhere\\\\*\",\n                   \"*Common\\\\..\\\\..\\\\BuildTools\\\\*\"))\n  ] by process.parent.entity_id\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*"
        ]
      },
      {
        "name": "AWS S3 Bucket Expiration Lifecycle Configuration Added",
        "description": "Identifies an expiration lifecycle configuration added to an S3 bucket. Lifecycle configurations can be used to manage objects in a bucket, including setting expiration policies. This rule detects when a lifecycle configuration is added to an S3 bucket, which could indicate that objects in the bucket will be automatically deleted after a specified period of time. This could be used to evade detection by deleting objects that contain evidence of malicious activity.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS S3 Bucket Expiration Lifecycle Configuration Added\n\nThis rule detects when an expiration lifecycle configuration is added to an S3 bucket in AWS. Such configurations can automate the deletion of objects within a bucket after a specified period, potentially obfuscating evidence of unauthorized access or malicious activity by automatically removing logs or other data.\n\n#### Detailed Investigation Steps\n\n- **Review the Affected S3 Bucket**: Check the bucket details (`bucketName`) where the lifecycle configuration has been added.\n    - Determine the contents and importance of the data stored in this bucket to assess the impact of the lifecycle policy.\n- **Analyze the Lifecycle Configuration**:\n  - **Expiration Policy**: Note the `Days` parameter under `Expiration` in the lifecycle rule. This indicates how long after creation data will remain in the bucket before being automatically deleted.\n  - **Rule ID and Status**: Review the `ID` and `Status` of the lifecycle rule to understand its operational scope and activation status.\n- **User Identity and Activity**:\n  - **User Details**: Investigate the user (`user_identity.arn`) who made the change. Determine whether this user's role typically involves managing S3 bucket configurations.\n  - **Authentication Details**: Examine the authentication method and whether the access key used (`access_key_id`) is routinely used for such configurations or if it has deviated from normal usage patterns.\n- **Source IP and User Agent**:\n  - **Source IP Address**: The IP address (`source.ip`) from which the request was made can provide clues about the geographical location of the requester. Determine if this location aligns with the user’s known locations.\n  - **User Agent**: Analyze the user agent string to understand the type of client or service that made the request, which can help identify scripted automation versus manual changes.\n\n#### Possible Indicators of Compromise or Misuse\n\n- **Frequent Changes**: Look for frequent modifications to lifecycle policies in the same or multiple buckets, which can indicate attempts to manipulate data retention dynamically.\n- **Unusual User Activity**: Activities that do not correlate with the user's typical behavior patterns, such as making changes during odd hours or from unusual locations, should be flagged for further investigation.\n\n### False Positive Analysis\n\n- Verify the operational requirements that might necessitate such lifecycle policies, especially in environments where data retention policies are strictly governed for compliance and cost-saving reasons.\n\n### Response and Remediation\n\n- **Immediate Review**: If the change was unauthorized, consider reverting the lifecycle configuration change immediately to prevent potential data loss.\n- **Enhance Monitoring**: Implement monitoring to alert on changes to lifecycle configurations across your S3 environments.\n- **User Education**: Ensure that users with access to critical resources like S3 buckets are aware of the best practices and company policies regarding data retention and security.\n\n### Additional Information\n\nFor further guidance on managing S3 lifecycle policies and ensuring compliance with organizational data retention and security policies, refer to the AWS official documentation on [S3 Lifecycle Configuration](https://docs.aws.amazon.com/AmazonS3/latest/userguide/lifecycle-expire-general-considerations.html).\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: Amazon S3",
          "Use Case: Asset Visibility",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Bucket components may be deleted or adjusted by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Bucket component deletions by unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule."
        ],
        "references": [
          "https://docs.aws.amazon.com/AmazonS3/latest/userguide/lifecycle-expire-general-considerations.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1070",
                "name": "Indicator Removal",
                "reference": "https://attack.mitre.org/techniques/T1070/"
              }
            ]
          }
        ],
        "setup": "This rule requires S3 data events to be logged to CloudTrail. CloudTrail trails can be configured to log S3 data events in the AWS Management Console or using the AWS CLI.",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "0da4388b-9f20-4f72-a574-26a821b41c07",
        "rule_id": "ff320c56-f8fa-11ee-8c44-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.303Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.303Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail*"
        ],
        "query": "event.dataset: \"aws.cloudtrail\" and event.provider: \"s3.amazonaws.com\" and\n    event.action: PutBucketLifecycle and event.outcome: success and\n    aws.cloudtrail.request_parameters: (*LifecycleConfiguration* and *Expiration=*)\n",
        "language": "kuery"
      },
      {
        "name": "Alternate Data Stream Creation/Execution at Volume Root Directory",
        "description": "Identifies the creation of an Alternate Data Stream (ADS) at a volume root directory, which can indicate the attempt to hide tools and malware, as ADSs created in this directory are not displayed by system utilities.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 201,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: SentinelOne",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.crowdstrike.com/blog/anatomy-of-alpha-spider-ransomware/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1564",
                "name": "Hide Artifacts",
                "reference": "https://attack.mitre.org/techniques/T1564/",
                "subtechnique": [
                  {
                    "id": "T1564.004",
                    "name": "NTFS File Attributes",
                    "reference": "https://attack.mitre.org/techniques/T1564/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "cf2e70dc-ae24-4905-b0b6-46242f55f1f2",
        "rule_id": "ff6cf8b9-b76c-4cc1-ac1b-4935164d1029",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.313Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.313Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where host.os.type == \"windows\" and event.category in (\"file\", \"process\") and \n  (\n    (event.type == \"creation\" and file.path regex~ \"\"\"[A-Z]:\\\\:.+\"\"\") or \n    (event.type == \"start\" and process.executable regex~ \"\"\"[A-Z]:\\\\:.+\"\"\")\n  )\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-endpoint.events.process-*",
          "logs-endpoint.events.file-*",
          "logs-windows.sysmon_operational-*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*",
          "endgame-*"
        ]
      },
      {
        "name": "First Time AWS Cloudformation Stack Creation by User",
        "description": "This rule detects the first time a principal calls AWS Cloudwatch `CreateStack` or `CreateStackSet` API. Cloudformation is used to create a single collection of cloud resources called a stack, via a defined template file. An attacker with the appropriate privileges could leverage Cloudformation to create specific resources needed to further exploit the environment. This is a new terms rule that looks for the first instance of this behavior in the last 10 days for a role or IAM user within a particular account.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: Cloudformation",
          "Use Case: Asset Visibility",
          "Tactic: Execution"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Verify whether the user identity should be using the `CreateStack` or `CreateStackSet` APIs. If known behavior is causing false positives, it can be exempted from the rule. The \"history_window_start\" value can be modified to reflect the expected frequency of known activity within a particular environment."
        ],
        "references": [
          "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-cli-creating-stack.html/",
          "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-concepts.html/",
          "https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_CreateStack.html/",
          "https://docs.aws.amazon.com/AWSCloudFormation/latest/APIReference/API_CreateStackSet.html/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": []
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "6658e575-0639-4c73-9d17-1af8fe796aa1",
        "rule_id": "0415258b-a7b2-48a6-891a-3367cd9d4d31",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.322Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.322Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset:aws.cloudtrail and event.provider:cloudformation.amazonaws.com and\n    event.action: (CreateStack or CreateStackSet) and event.outcome:success\n",
        "new_terms_fields": [
          "cloud.account.id",
          "user.name"
        ],
        "history_window_start": "now-10d",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "language": "kuery"
      },
      {
        "name": "AWS IAM CompromisedKeyQuarantine Policy Attached to User",
        "description": "This rule looks for use of the IAM `AttachUserPolicy` API operation to attach the `CompromisedKeyQuarantine` or `CompromisedKeyQuarantineV2` AWS managed policies to an existing IAM user. This policy denies access to certain actions and is applied by the AWS team in the event that an IAM user's credentials have been compromised or exposed publicly.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS IAM CompromisedKeyQuarantine Policy Attached to User\n\nThe AWS IAM `CompromisedKeyQuarantine` and `CompromisedKeyQuarantineV2` managed policies deny certain action and is applied by the AWS team to a user with exposed credentials. \nThis action is accompanied by a support case which specifies instructions to follow before detaching the policy. \n\n#### Possible Investigation Steps\n\n- **Identify Potentially Compromised Identity**: Review the `userName` parameter of the `aws.cloudtrail.request_parameters` to determine the quarantined IAM entity.\n- **Contextualize with AWS Support Case**: Review any information from AWS comtaining additional information about the quarantined account and the reasoning for quarantine.\n- **Follow Support Case Instructions**: Do not revert the quarantine policy attachment or delete the compromised keys. Instead folow the instructions given in your support case.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this change to see if the same actor or IP address engaged in potentially suspicious activities.\n- **Interview Relevant Personnel**: If the compromised key belongs to a user, verify the intent and authorization for these correlated actions with the person or team responsible for managing the compromised key.\n\n### False Positive Analysis\n\n- There shouldn't be many false positives related to this action as it is inititated by AWS in response to compromised or publicly exposed credentials.\n\n### Response and Remediation\n\n- **Immediate Review and Reversal**: Update the user IAM permissions to remove the quarantine policy and disable the compromised credentials.\n- **Policy Update**: Review and possibly update your organization’s policies on credential storage to tighten control and prevent public exposure.\n- **Incident Response**: If malicious intent is confirmed, consider it a data breach incident and initiate the incident response protocol. This includes further investigation, containment, and recovery.\n\n### Additional Information:\n\nFor further guidance on managing and securing credentials in AWS environments, refer to the [AWS IAM User Guide](https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html) regarding security best practices and guidance on [Remediating Potentially Compromised AWS Credentials](https://docs.aws.amazon.com/guardduty/latest/ug/compromised-creds.html).\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS IAM",
          "Resources: Investigation Guide",
          "Use Case: Identity and Access Audit",
          "Tactic: Credential Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "This is an intentional action taken by AWS in the event of compromised credentials. Follow the instructions specified in the support case created for you regarding this event."
        ],
        "references": [
          "https://docs.aws.amazon.com/aws-managed-policy/latest/reference/AWSCompromisedKeyQuarantine.html/",
          "https://docs.aws.amazon.com/aws-managed-policy/latest/reference/AWSCompromisedKeyQuarantineV2.html/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1552",
                "name": "Unsecured Credentials",
                "reference": "https://attack.mitre.org/techniques/T1552/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "75ce32b9-d64f-4dc0-a56a-441c6defccc4",
        "rule_id": "0b79f5c0-2c31-4fea-86cd-e62644278205",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.332Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.332Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where event.dataset == \"aws.cloudtrail\" \n   and event.action == \"AttachUserPolicy\"\n   and event.outcome == \"success\" \n   and stringContains(aws.cloudtrail.request_parameters, \"AWSCompromisedKeyQuarantine\")\n",
        "language": "eql",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ]
      },
      {
        "name": "AWS Lambda Function Policy Updated to Allow Public Invocation",
        "description": "Identifies when an AWS Lambda function policy is updated to allow public invocation. This rule specifically looks for the `AddPermission` API call with the `Principal` set to `*` which allows any AWS account to invoke the Lambda function. Adversaries may abuse this permission to create a backdoor in the Lambda function that allows them to execute arbitrary code.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS Lambda Function Policy Updated to Allow Public Invocation\n\nThis rule detects when an AWS Lambda function policy is updated to allow public invocation. It specifically looks for the `AddPermission` API call with the `Principal` set to `*`, which allows any AWS account to invoke the Lambda function. Adversaries may abuse this permission to create a backdoor in the Lambda function that allows them to execute arbitrary code. Understanding the context and legitimacy of such changes is crucial to determine if the action is benign or malicious.\n\n#### Possible Investigation Steps:\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who made the change. Verify if this actor typically performs such actions and if they have the necessary permissions.\n- **Review the Request Details**: Examine the `aws.cloudtrail.request_parameters` to understand the specific changes made to the Lambda function policy. Look for any unusual parameters that could suggest unauthorized or malicious modifications.\n- **Analyze the Source of the Request**: Investigate the `source.ip` and `source.geo` fields to determine the geographical origin of the request. An external or unexpected location might indicate compromised credentials or unauthorized access.\n- **Contextualize with Timestamp**: Use the `@timestamp` field to check when the change occurred. Modifications during non-business hours or outside regular maintenance windows might require further scrutiny.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this change to see if the same actor or IP address engaged in other potentially suspicious activities.\n\n### False Positive Analysis:\n\n- **Legitimate Administrative Actions**: Confirm if the update to allow public invocation aligns with scheduled updates, development activities, or legitimate administrative tasks documented in change management systems.\n- **Consistency Check**: Compare the action against historical data of similar actions performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.\n- **Verify through Outcomes**: Check the `aws.cloudtrail.response_elements` and the `event.outcome` to confirm if the change was successful and intended according to policy.\n\n### Response and Remediation:\n\n- **Immediate Review and Reversal if Necessary**: If the change was unauthorized, update the Lambda function policy to remove the public invocation permission and restore it to its previous state.\n- **Enhance Monitoring and Alerts**: Adjust monitoring systems to alert on similar actions, especially those involving sensitive functions or permissions.\n- **Educate and Train**: Provide additional training to users with administrative rights on the importance of security best practices concerning Lambda function management and the use of permissions.\n- **Audit Lambda Functions and Policies**: Conduct a comprehensive audit of all Lambda functions and associated policies to ensure they adhere to the principle of least privilege.\n- **Incident Response**: If there's an indication of malicious intent or a security breach, initiate the incident response protocol to mitigate any damage and prevent future occurrences.\n\n### Additional Information:\n\nFor further guidance on managing Lambda functions and securing AWS environments, refer to the [AWS Lambda documentation](https://docs.aws.amazon.com/lambda/latest/dg/welcome.html) and AWS best practices for security. Additionally, consult the following resources for specific details on Lambda persistence techniques:\n- [AWS Lambda Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-lambda-persistence)\n- [AWS Lambda Backdoor Function](https://stratus-red-team.cloud/attack-techniques/AWS/aws.persistence.lambda-backdoor-function/)\n- [AWS API AddPermission](https://docs.aws.amazon.com/lambda/latest/api/API_AddPermission.html)\n\n\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS Lambda",
          "Use Case: Threat Detection",
          "Tactic: Persistence"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Lambda function owners may legitimately update the function policy to allow public invocation."
        ],
        "references": [
          "https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-lambda-persistence",
          "https://stratus-red-team.cloud/attack-techniques/AWS/aws.persistence.lambda-backdoor-function/",
          "https://docs.aws.amazon.com/lambda/latest/api/API_AddPermission.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1546",
                "name": "Event Triggered Execution",
                "reference": "https://attack.mitre.org/techniques/T1546/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d64434e5-b3d8-4e26-93fe-f65140bc5b5b",
        "rule_id": "151d8f72-0747-11ef-a0c2-f661ea17fbcc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.347Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.347Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "query": "event.dataset: aws.cloudtrail\n    and event.provider: lambda.amazonaws.com\n    and event.outcome: success\n    and event.action: AddPermission*\n    and aws.cloudtrail.request_parameters: (*lambda\\:InvokeFunction* and *principal=\\**)\n",
        "language": "kuery"
      },
      {
        "name": "Potential Container Escape via Modified release_agent File",
        "description": "This rule detects modification of the CGroup release_agent file from inside a privileged container. The release_agent is a script that is executed at the termination of any process on that CGroup and is invoked from the host. A privileged container with SYS_ADMIN capabilities, enables a threat actor to mount a CGroup directory and modify the release_agent which could be used for further privilege escalation and container escapes to the host machine.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Data Source: Elastic Defend for Containers",
          "Domain: Container",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://blog.aquasec.com/threat-alert-container-escape",
          "https://sysdig.com/blog/detecting-mitigating-cve-2022-0492-sysdig/",
          "https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-security/docker-breakout-privilege-escalation#privileged-escape-abusing-existent-release_agent-cve-2022-0492-poc1"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1611",
                "name": "Escape to Host",
                "reference": "https://attack.mitre.org/techniques/T1611/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "cloud_defend",
            "version": "^1.0.5"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.module",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "838bc0c1-d524-4fb3-81c1-49bdc9869fd4",
        "rule_id": "160896de-b66f-42cb-8fef-20f53a9006ea",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.358Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.358Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where event.module == \"cloud_defend\" and event.action == \"open\" and \nevent.type == \"change\" and file.name : \"release_agent\"\n",
        "language": "eql",
        "index": [
          "logs-cloud_defend*"
        ]
      },
      {
        "name": "Script Execution via Microsoft HTML Application",
        "description": "Identifies the execution of scripts via HTML applications using Windows utilities rundll32.exe or mshta.exe. Adversaries may bypass process and/or signature-based defenses by proxying execution of malicious content with signed binaries.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 201,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: System",
          "Data Source: Sysmon",
          "Data Source: SentinelOne",
          "Data Source: Microsoft Defender for Endpoint"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/",
                "subtechnique": [
                  {
                    "id": "T1218.005",
                    "name": "Mshta",
                    "reference": "https://attack.mitre.org/techniques/T1218/005/"
                  },
                  {
                    "id": "T1218.011",
                    "name": "Rundll32",
                    "reference": "https://attack.mitre.org/techniques/T1218/011/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "c3779cca-1f35-4e54-8743-d70f1ee66337",
        "rule_id": "181f6b23-3799-445e-9589-0018328a9e46",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.368Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.368Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n process.name : (\"rundll32.exe\", \"mshta.exe\") and\n  (\n     (process.command_line :\n        (\n        \"*script*eval(*\",\n         \"*script*GetObject*\",\n         \"*.regread(*\",\n         \"*WScript.Shell*\",\n         \"*.run(*\",\n         \"*).Exec()*\",\n         \"*mshta*http*\",\n         \"*mshtml*RunHTMLApplication*\",\n         \"*mshtml*,#135*\",\n         \"*StrReverse*\",\n         \"*.RegWrite*\",\n         /* Issue #379 */\n         \"*window.close(*\",\n         \"* Chr(*\"\n         )\n     and not process.parent.executable :\n                  (\"?:\\\\Program Files (x86)\\\\Citrix\\\\System32\\\\wfshell.exe\",\n                   \"?:\\\\Program Files (x86)\\\\Microsoft Office\\\\Office*\\\\MSACCESS.EXE\",\n                   \"?:\\\\Program Files\\\\Quokka.Works GTInstaller\\\\GTInstaller.exe\")\n     ) or\n\n    (process.name : \"mshta.exe\" and\n     not process.command_line : (\"*.hta*\", \"*.htm*\", \"-Embedding\") and process.args_count >=2) or\n\n     /* Execution of HTA file downloaded from the internet */\n     (process.name : \"mshta.exe\" and process.command_line : \"*\\\\Users\\\\*\\\\Downloads\\\\*.hta*\") or\n\n     /* Execution of HTA file from archive */\n     (process.name : \"mshta.exe\" and\n      process.args : (\"?:\\\\Users\\\\*\\\\Temp\\\\7z*\", \"?:\\\\Users\\\\*\\\\Temp\\\\Rar$*\", \"?:\\\\Users\\\\*\\\\Temp\\\\Temp?_*\", \"?:\\\\Users\\\\*\\\\Temp\\\\BNZ.*\"))\n   )\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-windows.*",
          "logs-system.security*",
          "logs-windows.sysmon_operational-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-m365_defender.event-*"
        ]
      },
      {
        "name": "Rapid Secret Retrieval Attempts from AWS SecretsManager",
        "description": "This rule attempts to identify rapid secret retrieval attempts from AWS SecretsManager. Adversaries may attempt to retrieve secrets from the Secrets Manager programmatically using the `GetSecretValue` or `BatchGetSecretValue` API actions.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Rapid Secret Retrieval Attempts from AWS SecretsManager\n\nAWS Secrets Manager is a service that enables the replacement of hardcoded credentials in code, including passwords, with an API call to Secrets Manager to retrieve the secret programmatically.\n\nThis rule looks for the rapid retrieval of credentials using `GetSecretValue` or `BatchGetSecretValue` actions in Secrets Manager programmatically. This is a [Threshold](https://www.elastic.co/guide/en/security/master/rules-ui-create.html#create-threshold-rule) rule indicating 20 or more successful attempts to retrieve a secret value from Secrets Manager by the same user identity within a short timespan. \n\n#### Possible investigation steps\n\n- Identify the account and its role in the environment, and inspect the related policy.\n- Identify the applications that should use this account.\n- Investigate other alerts associated with the user account during the past 48 hours.\n- Investigate abnormal values in the `user_agent.original` field by comparing them with the intended and authorized usage and historical data. Suspicious user agent values include non-SDK, AWS CLI, custom user agents, etc.\n- Assess whether this behavior is prevalent in the environment by looking for similar occurrences involving other users.\n- Contact the account owner and confirm whether they are aware of this activity.\n- Considering the source IP address and geolocation of the user who issued the command:\n    - Do they look normal for the calling user?\n    - If the source is an EC2 IP address, is it associated with an EC2 instance in one of your accounts or is the source IP from an EC2 instance that's not under your control?\n    - If it is an authorized EC2 instance, is the activity associated with normal behavior for the instance role or roles? Are there any other alerts or signs of suspicious activity involving this instance?\n- Review IAM permission policies for the user identity and specific secrets accessed.\n- Examine the request parameters. These might indicate the source of the program or the nature of its tasks.\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking servers, services, and data accessed by the account in the last 24 hours.\n\n### False positive analysis\n\n- False positives may occur due to the intended usage of the service. Tuning is needed in order to have higher confidence. Consider adding exceptions — preferably with a combination of user agent and IP address conditions.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Assess the criticality of affected services and servers.\n    - Work with your IT team to identify and minimize the impact on users.\n    - Identify if the attacker is moving laterally and compromising other accounts, servers, or services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Rotate secrets or delete API keys as needed to revoke the attacker's access to the environment. Work with your IT teams to minimize the impact on business operations during these actions.\n- Check if unauthorized new users were created, remove unauthorized new accounts, and request password resets for other IAM users.\n- Consider enabling multi-factor authentication for users.\n- Review the permissions assigned to the implicated user to ensure that the least privilege principle is being followed.\n- Implement security best practices [outlined](https://aws.amazon.com/premiumsupport/knowledge-center/security-best-practices/) by AWS.\n- Take the actions needed to return affected systems, data, or services to their normal operational levels.\n- Identify the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS Secrets Manager",
          "Tactic: Credential Access",
          "Resources: Investigation Guide"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-5m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Verify whether the user identity, user agent, and/or hostname should be using GetSecretString or BatchGetSecretValue APIs for the specified SecretId. If known behavior is causing false positives, it can be exempted from the rule."
        ],
        "references": [
          "https://docs.aws.amazon.com/secretsmanager/latest/apireference/API_GetSecretValue.html",
          "https://detectioninthe.cloud/ttps/credential_access/access_secret_in_secrets_manager/",
          "https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-services/aws-secrets-manager-enum",
          "https://docs.aws.amazon.com/secretsmanager/latest/apireference/API_BatchGetSecretValue.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1555",
                "name": "Credentials from Password Stores",
                "reference": "https://attack.mitre.org/techniques/T1555/",
                "subtechnique": [
                  {
                    "id": "T1555.006",
                    "name": "Cloud Secrets Management Stores",
                    "reference": "https://attack.mitre.org/techniques/T1555/006/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user_agent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "eea49f3d-0a10-4c31-8b67-f3d99f87db5e",
        "rule_id": "185c782e-f86a-11ee-9d9f-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.378Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.378Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "threshold",
        "query": "event.dataset:aws.cloudtrail and event.provider:secretsmanager.amazonaws.com and\n    event.action: (GetSecretValue or BatchGetSecretValue) and event.outcome:success and\n    not user_agent.name: (\"Chrome\" or \"Firefox\" or \"Safari\" or \"Edge\" or \"Brave\" or \"Opera\")\n",
        "threshold": {
          "field": [
            "user.id"
          ],
          "value": 20
        },
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail*"
        ],
        "language": "kuery"
      },
      {
        "name": "AWS EC2 Admin Credential Fetch via Assumed Role",
        "description": "Identifies the first occurrence of a user identity in AWS using `GetPassword` for the administrator password of an EC2 instance with an assumed role. Adversaries may use this API call to escalate privileges or move laterally within EC2 instances.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS EC2 Admin Credential Fetch via Assumed Role\n\nThis rule detects the first occurrence of a user identity using the `GetPasswordData` API call in AWS, which retrieves the administrator password of an EC2 instance. This can be an indicator of an adversary attempting to escalate privileges or move laterally within EC2 instances.\n\nThis is a New Terms rule, which means it will only trigger once for each unique value of the `aws.cloudtrail.user_identity.session_context.session_issuer.arn` field that has not been seen making this API request within the last 7 days. This field contains the Amazon Resource Name (ARN) of the assumed role that triggered the API call.\n\n#### Possible Investigation Steps\n\n- **Identify the User Identity and Role**: Examine the AWS CloudTrail logs to determine the user identity that made the `GetPasswordData` request. Pay special attention to the role and permissions associated with the user.\n- **Review Request and Response Parameters**: Analyze the `aws.cloudtrail.request_parameters` and `aws.cloudtrail.response_elements` fields to understand the context of the API call and the retrieved password.\n- **Contextualize with User Behavior**: Compare this activity against the user's typical behavior patterns. Look for unusual login times, IP addresses, or other anomalous actions taken by the user or role prior to and following the incident.\n- **Review EC2 Instance Details**: Check the details of the EC2 instance from which the password was retrieved. Assess the criticality and sensitivity of the applications running on this instance.\n- **Examine Related CloudTrail Events**: Search for other API calls made by the same user identity, especially those modifying security groups, network access controls, or instance metadata.\n- **Check for Lateral Movement**: Look for evidence that the obtained credentials have been used to access other resources or services within AWS.\n- **Investigate the Origin of the API Call**: Analyze the IP address and geographical location from which the request originated. Determine if it aligns with expected locations for legitimate administrative activity.\n\n### False Positive Analysis\n\n- **Legitimate Administrative Actions**: Ensure that the activity was not part of legitimate administrative tasks such as system maintenance or updates.\n- **Automation Scripts**: Verify if the activity was generated by automation or deployment scripts that are authorized to use `GetPasswordData` for legitimate purposes.\n\n### Response and Remediation\n\n- **Immediate Isolation**: If suspicious, isolate the affected instance to prevent any potential lateral movement or further unauthorized actions.\n- **Credential Rotation**: Rotate credentials of the affected instance or assumed role and any other potentially compromised credentials.\n- **User Account Review**: Review the permissions of the implicated user identity. Apply the principle of least privilege by adjusting permissions to prevent misuse.\n- **Enhanced Monitoring**: Increase monitoring on the user identity that triggered the rule and similar EC2 instances.\n- **Incident Response**: If malicious intent is confirmed, initiate the incident response protocol. This includes further investigation, containment of the threat, eradication of any threat actor presence, and recovery of affected systems.\n- **Preventative Measures**: Implement or enhance security measures such as multi-factor authentication and continuous audits of sensitive operations like `GetPasswordData`.\n\n### Additional Information\n\nRefer to resources like [AWS privilege escalation methods](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-privilege-escalation/aws-ec2-privesc) and the MITRE ATT&CK technique [T1552.005 - Cloud Instance Metadata API](https://attack.mitre.org/techniques/T1552/005/) for more details on potential vulnerabilities and mitigation strategies.\n\n",
        "output_index": "",
        "version": 3,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: Amazon EC2",
          "Use Case: Identity and Access Audit",
          "Resources: Investigation Guide",
          "Tactic: Credential Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-privilege-escalation/aws-ec2-privesc"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1552",
                "name": "Unsecured Credentials",
                "reference": "https://attack.mitre.org/techniques/T1552/",
                "subtechnique": [
                  {
                    "id": "T1552.005",
                    "name": "Cloud Instance Metadata API",
                    "reference": "https://attack.mitre.org/techniques/T1552/005/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.error_code",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "aws.cloudtrail.user_identity.type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "513113e5-067b-49da-81d2-154b1769fec7",
        "rule_id": "8446517c-f789-11ee-8ad0-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.394Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.394Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset:\"aws.cloudtrail\"\n    and event.provider:\"ec2.amazonaws.com\" and event.action:\"GetPasswordData\"\n    and aws.cloudtrail.user_identity.type:\"AssumedRole\" and aws.cloudtrail.error_code:\"Client.UnauthorizedOperation\"\n",
        "new_terms_fields": [
          "aws.cloudtrail.user_identity.session_context.session_issuer.arn"
        ],
        "history_window_start": "now-7d",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail*"
        ],
        "language": "kuery"
      },
      {
        "name": "AWS Service Quotas Multi-Region `GetServiceQuota` Requests",
        "description": "Identifies when a single AWS resource is making `GetServiceQuota` API calls for the EC2 service quota L-1216C47A in more than 10 regions within a 30-second window. Quota code L-1216C47A represents on-demand instances which are used by adversaries to deploy malware and mine cryptocurrency. This could indicate a potential threat actor attempting to discover the AWS infrastructure across multiple regions using compromised credentials or a compromised instance.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS Service Quotas",
          "Use Case: Threat Detection",
          "Tactic: Discovery"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.sentinelone.com/labs/exploring-fbot-python-based-malware-targeting-cloud-and-payment-services/",
          "https://docs.aws.amazon.com/servicequotas/2019-06-24/apireference/API_GetServiceQuota.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1580",
                "name": "Cloud Infrastructure Discovery",
                "reference": "https://attack.mitre.org/techniques/T1580/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [],
        "id": "8d079d9e-5dab-4b33-98eb-7718b59b23df",
        "rule_id": "19be0164-63d2-11ef-8e38-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.919Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.919Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws.cloudtrail-*\n\n// filter for GetServiceQuota API calls\n| where event.dataset == \"aws.cloudtrail\" and event.provider == \"servicequotas.amazonaws.com\" and event.action == \"GetServiceQuota\"\n\n// truncate the timestamp to a 30-second window\n| eval target_time_window = DATE_TRUNC(30 seconds, @timestamp)\n\n// pre-process the request parameters to extract the service code and quota code\n| dissect aws.cloudtrail.request_parameters \"{%{?service_code_key}=%{service_code}, %{?quota_code_key}=%{quota_code}}\"\n\n// filter for EC2 service quota L-1216C47A (vCPU on-demand instances)\n| where service_code == \"ec2\" and quota_code == \"L-1216C47A\"\n\n// keep only the relevant fields\n| keep target_time_window, aws.cloudtrail.user_identity.arn, cloud.region, service_code, quota_code\n\n// count the number of unique regions and total API calls within the 30-second window\n| stats region_count = count_distinct(cloud.region), window_count = count(*) by target_time_window, aws.cloudtrail.user_identity.arn\n\n// filter for resources making DescribeInstances API calls in more than 10 regions within the 30-second window\n| where region_count >= 10 and window_count >= 10\n\n// sort the results by time windows in descending order\n| sort target_time_window desc\n"
      },
      {
        "name": "AWS Signin Single Factor Console Login with Federated User",
        "description": "Identifies when a federated user logs into the AWS Management Console without using multi-factor authentication (MFA). Federated users are typically given temporary credentials to access AWS services. If a federated user logs into the AWS Management Console without using MFA, it may indicate a security risk, as MFA adds an additional layer of security to the authentication process. This could also indicate the abuse of STS tokens to bypass MFA requirements.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: Amazon Web Services",
          "Data Source: AWS",
          "Data Source: AWS Sign-In",
          "Use Case: Threat Detection",
          "Tactic: Initial Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://hackingthe.cloud/aws/post_exploitation/create_a_console_session_from_iam_credentials/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1078",
                "name": "Valid Accounts",
                "reference": "https://attack.mitre.org/techniques/T1078/",
                "subtechnique": [
                  {
                    "id": "T1078.004",
                    "name": "Cloud Accounts",
                    "reference": "https://attack.mitre.org/techniques/T1078/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [],
        "id": "37a779ea-272b-47f8-b8fe-c14668cac1a8",
        "rule_id": "1f45720e-5ea8-11ef-90d2-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:28.927Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:28.927Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws.cloudtrail-* metadata _id, _version, _index\n| where\n    event.provider == \"signin.amazonaws.com\"\n    and event.action == \"GetSigninToken\"\n    and aws.cloudtrail.event_type == \"AwsConsoleSignIn\"\n    and aws.cloudtrail.user_identity.type == \"FederatedUser\"\n| dissect aws.cloudtrail.additional_eventdata \"{%{?mobile_version_key}=%{mobile_version}, %{?mfa_used_key}=%{mfa_used}}\"\n| where mfa_used == \"No\"\n| keep @timestamp, event.action, aws.cloudtrail.event_type, aws.cloudtrail.user_identity.type\n"
      },
      {
        "name": "Insecure AWS EC2 VPC Security Group Ingress Rule Added",
        "description": "Identifies when a specified inbound (ingress) rule is added or adjusted for a VPC security group in AWS EC2. This rule detects when a security group rule is added that allows traffic from any IP address or from a specific IP address to common remote access ports, such as 22 (SSH) or 3389 (RDP). Adversaries may add these rules to allow remote access to VPC instances from any location, increasing the attack surface and potentially exposing the instances to unauthorized access.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating Insecure AWS EC2 VPC Security Group Ingress Rule Added\n\nThis rule detects the addition of ingress rules to a VPC security group that allow traffic from any IP address (`0.0.0.0/0` or `::/0`) to sensitive ports commonly used for remote access, such as SSH (port 22) and RDP (port 3389). This configuration change can significantly increase the exposure of EC2 instances to potential threats, making it crucial to understand the context and legitimacy of such changes.\n\n#### Possible Investigation Steps:\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who made the change. Investigate whether this actor has the necessary permissions and typically performs these actions.\n- **Review the Request Details**: Examine the `aws.cloudtrail.request_parameters` to understand exactly what changes were made to the security group. Check for any unusual parameters that could suggest a misconfiguration or malicious intent.\n- **Analyze the Source of the Request**: Look at the `source.ip` and `source.geo` fields to determine the geographical origin of the request. An external or unusual location could indicate compromised credentials.\n- **Contextualize with Timestamp**: Use the `@timestamp` field to check when the change occurred. Modifications outside of typical business hours might warrant additional scrutiny.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this change to see if the same actor engaged in other potentially suspicious activities.\n\n### False Positive Analysis:\n\n- **Legitimate Administrative Actions**: Verify if the ingress rule change aligns with scheduled updates, maintenance activities, or legitimate administrative tasks documented in change management tickets or systems.\n- **Consistency Check**: Compare the action against historical data of similar actions performed by the user or within the organization. Consistency with past legitimate actions might indicate a false alarm.\n- **Verify through Outcomes**: Check the `aws.cloudtrail.response_elements` and the `event.outcome` to confirm if the change was successful and intended as per policy.\n\n### Response and Remediation:\n\n- **Immediate Review and Reversal if Necessary**: If the change was unauthorized, revert the security group rules to their previous state to close any unintended access.\n- **Enhance Monitoring and Alerts**: Adjust monitoring systems to alert on similar security group changes, especially those that open access to well-known ports from any IP address.\n- **Educate and Train**: Provide additional training to users with administrative rights on the importance of security best practices concerning security group management.\n- **Audit Security Groups and Policies**: Conduct a comprehensive audit of all security groups and associated policies to ensure they adhere to the principle of least privilege.\n- **Incident Response**: If there's an indication of malicious intent or a security breach, initiate the incident response protocol to mitigate any damage and prevent future occurrences.\n\n### Additional Information:\n\nFor further guidance on managing security group rules and securing AWS environments, refer to the [Amazon VPC Security Groups documentation](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html) and AWS best practices for security.\n\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS EC2",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Administrators may legitimately add security group rules to allow traffic from any IP address or from specific IP addresses to common remote access ports."
        ],
        "references": [
          "https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupEgress.html",
          "https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_AuthorizeSecurityGroupIngress.html",
          "https://www.linkedin.com/pulse/my-backdoors-your-aws-infrastructure-part-3-network-micha%C5%82-brygidyn/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1562",
                "name": "Impair Defenses",
                "reference": "https://attack.mitre.org/techniques/T1562/",
                "subtechnique": [
                  {
                    "id": "T1562.007",
                    "name": "Disable or Modify Cloud Firewall",
                    "reference": "https://attack.mitre.org/techniques/T1562/007/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.flattened.request_parameters.cidrIp",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "aws.cloudtrail.flattened.request_parameters.fromPort",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "4894cd5c-dd7f-45d5-99b6-1541fc871dfa",
        "rule_id": "25e7fee6-fc25-11ee-ba0f-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.205Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.205Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "query": "event.dataset: \"aws.cloudtrail\"\n    and event.provider: ec2.amazonaws.com\n    and event.action: AuthorizeSecurityGroupIngress\n    and event.outcome: success\n    and aws.cloudtrail.flattened.request_parameters.cidrIp: (\"0.0.0.0/0\" or \"::/0\")\n    and aws.cloudtrail.flattened.request_parameters.fromPort: (\n        21 or 22 or 23 or 445 or 3389 or 5985 or 5986)\n",
        "language": "kuery"
      },
      {
        "name": "Unusual Discovery Signal Alert with Unusual Process Command Line",
        "description": "This rule leverages alert data from various Discovery building block rules to alert on signals with unusual unique host.id, user.id and process.command_line entries.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Rule Type: Higher-Order Rule"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": []
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [
          {
            "name": "event.kind",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "kibana.alert.rule.rule_id",
            "type": "unknown",
            "ecs": false
          }
        ],
        "id": "59dd26ce-f5e3-40d3-9237-b98fda1ea7e6",
        "rule_id": "29ef5686-9b93-433e-91b5-683911094698",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.216Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.216Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "host.os.type:windows and event.kind:signal and kibana.alert.rule.rule_id:(\n  \"d68e95ad-1c82-4074-a12a-125fe10ac8ba\" or \"7b8bfc26-81d2-435e-965c-d722ee397ef1\" or\n  \"0635c542-1b96-4335-9b47-126582d2c19a\" or \"6ea55c81-e2ba-42f2-a134-bccf857ba922\" or\n  \"e0881d20-54ac-457f-8733-fe0bc5d44c55\" or \"06568a02-af29-4f20-929c-f3af281e41aa\" or\n  \"c4e9ed3e-55a2-4309-a012-bc3c78dad10a\" or \"51176ed2-2d90-49f2-9f3d-17196428b169\"\n)\n",
        "new_terms_fields": [
          "host.id",
          "user.id",
          "process.command_line"
        ],
        "history_window_start": "now-14d",
        "index": [
          ".alerts-security.*"
        ],
        "language": "kuery"
      },
      {
        "name": "Suspicious PowerShell Execution via Windows Scripts",
        "description": "Identifies suspicious PowerShell execution spawning from Windows Script Host processes (cscript or wscript.exe).",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 201,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: System",
          "Data Source: Sysmon",
          "Data Source: SentinelOne",
          "Data Source: Microsoft Defender for Endpoint"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.001",
                    "name": "PowerShell",
                    "reference": "https://attack.mitre.org/techniques/T1059/001/"
                  },
                  {
                    "id": "T1059.005",
                    "name": "Visual Basic",
                    "reference": "https://attack.mitre.org/techniques/T1059/005/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "06139d56-aeab-4494-a6ff-b38e93eb9f50",
        "rule_id": "2d62889e-e758-4c5e-b57e-c735914ee32a",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.223Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.223Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.action == \"start\" and\n  process.name : (\"powershell.exe\", \"pwsh.exe\") and\n  process.parent.name : (\"wscript.exe\", \"cscript.exe\", \"mshta.exe\") and\n   (\n   process.args_count == 1 or\n   process.command_line :\n             (\"*^*^*^*^*^*^*^*^*^*\",\n              \"*''*''*''*\",\n              \"*`*`*`*`*\",\n              \"*{*{*{*{*{*{*{*{*{*{*{*{*{*{*{*{*{*{*{*\",\n              \"*+*+*+*+*+*\",\n              \"*$*$*$*$*\",\n              \"*[char[]](*)*-join\",\n              \"*Base64String*\",\n              \"*[*Convert]*\",\n              \"*.Text.Encoding*\",\n              \"*.Compression.*\",\n              \"*.replace(*\",\n              \"*MemoryStream*\",\n              \"*WriteAllBytes*\",\n              \"* -en* *\",\n              \"* -ec *\",\n              \"* -e *\",\n              \"* -ep *\",\n              \"* /e *\",\n              \"* /en* *\",\n              \"* /ec *\",\n              \"* /ep *\",\n              \"*WebClient*\",\n              \"*DownloadFile*\",\n              \"*DownloadString*\",\n              \"*BitsTransfer*\",\n              \"*Invoke-Exp*\",\n              \"*invoke-web*\",\n              \"*iex*\",\n              \"*iwr*\",\n              \"*Reflection.Assembly*\",\n              \"*Assembly.GetType*\",\n              \"*.Sockets.*\",\n              \"*Add-MpPreference*ExclusionPath*\",\n              \"*raw.githubusercontent*\")\n   ) and\n\n   /* many legit powershell commands uses those non shortened execution flags excluding Sync-AppvPublishingServer lolbas */\n   not (process.args : (\"-EncodedCommand\", \"Import-Module*\", \"-NonInteractive\") and\n        process.args : \"-ExecutionPolicy\" and not process.args : \"Sync-AppvPublishingServer\") and\n\n   /* third party installation related FPs */\n   not ?process.parent.args : \"?:\\\\Windows\\\\system32\\\\gatherNetworkInfo.vbs\" and\n   not (?process.parent.args : \"Microsoft.SystemCenter.ICMPProbe.WithConsecutiveSamples.vbs\" and process.args : \"Get-SCOMAgent\") and\n   not (process.command_line : \"*WEBLOGIC_ARGS_CURRENT_1.DATA*\" and ?process.parent.command_line : \"*Impact360*\") and\n   not process.args :  \"$package = Get-AppxPackage Microsoft.Office.Desktop -allUsers;*\" and\n   not process.command_line : (\"*.Access.IdentityReference*win32_SID.SID*\", \"*AGIAbQB4AC0AYQBwAC4AcwAzAC4AdQBzAC0AZQBhAHMAd*\") and\n   not (?process.parent.args : \"?:\\\\Users\\\\Prestige\\\\AppData\\\\Local\\\\Temp\\\\Rar$*\\\\KMS_VL_ALL_AIO.cmd  -elevated\" and process.command_line : \"*KMS_VL_ALL_AIO.cmd*\") and\n   not process.args : \"iwr https://*.s3.us-east-1.amazonaws.com/scripts/Start-SpeedTest.ps1 -UserAgent * -UseBasicParsing | invoke-expression\" and\n   not (process.parent.name : \"wscript.exe\" and\n        ?process.parent.args : \"C:\\\\Program Files (x86)\\\\Telivy\\\\Telivy Agent\\\\telivy.js\")\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-windows.*",
          "logs-system.security*",
          "logs-windows.sysmon_operational-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-m365_defender.event-*"
        ]
      },
      {
        "name": "Microsoft 365 Portal Login from Rare Location",
        "description": "Detects successful Microsoft 365 portal logins from rare locations. Rare locations are defined as locations that are not commonly associated with the user's account. This behavior may indicate an adversary attempting to access a Microsoft 365 account from an unusual location or behind a VPN.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: Microsoft 365",
          "Use Case: Threat Detection",
          "Tactic: Initial Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "False positives may occur when users are using a VPN or when users are traveling to different locations."
        ],
        "references": [
          "https://www.huntress.com/blog/time-travelers-busted-how-to-detect-impossible-travel-"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1078",
                "name": "Valid Accounts",
                "reference": "https://attack.mitre.org/techniques/T1078/",
                "subtechnique": [
                  {
                    "id": "T1078.004",
                    "name": "Cloud Accounts",
                    "reference": "https://attack.mitre.org/techniques/T1078/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "o365",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "o365.audit.Target.Type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "o365.audit.UserId",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "977f2d8e-25b7-405c-90c4-4f36f68eaf06",
        "rule_id": "32d3ad0e-6add-11ef-8c7b-f661ea17fbcc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.231Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.231Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset: \"o365.audit\"\n    and event.provider: \"AzureActiveDirectory\"\n    and event.action: \"UserLoggedIn\"\n    and event.outcome: \"success\"\n    and not o365.audit.UserId: \"Not Available\"\n    and o365.audit.Target.Type: (\"0\" or \"2\" or \"3\" or \"5\" or \"6\" or \"10\")\n",
        "new_terms_fields": [
          "o365.audit.UserId",
          "source.geo.country_name"
        ],
        "history_window_start": "now-14d",
        "index": [
          "filebeat-*",
          "logs-o365.audit-*"
        ],
        "language": "kuery"
      },
      {
        "name": "Azure Entra Sign-in Brute Force against Microsoft 365 Accounts",
        "description": "Identifies potential brute-force attempts against Microsoft 365 user accounts by detecting a high number of failed interactive or non-interactive login attempts within a 30-minute window. Attackers may attempt to brute force user accounts to gain unauthorized access to Microsoft 365 services via different services such as Exchange, SharePoint, or Teams.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "This rule relies on Azure Entra ID sign-in logs, but filters for Microsoft 365 resources.",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Domain: SaaS",
          "Data Source: Azure",
          "Data Source: Entra ID",
          "Data Source: Entra ID Sign-in",
          "Use Case: Identity and Access Audit",
          "Use Case: Threat Detection",
          "Tactic: Credential Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Automated processes that attempt to authenticate using expired credentials or have misconfigured authentication settings may lead to false positives."
        ],
        "references": [
          "https://cloud.hacktricks.xyz/pentesting-cloud/azure-security/az-unauthenticated-enum-and-initial-entry/az-password-spraying",
          "https://github.com/0xZDH/o365spray"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1110",
                "name": "Brute Force",
                "reference": "https://attack.mitre.org/techniques/T1110/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [],
        "id": "dc7ba4f2-e21b-439b-b407-23dc89b2e3f5",
        "rule_id": "35ab3cfa-6c67-11ef-ab4d-f661ea17fbcc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.238Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.238Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-azure.signinlogs*\n// truncate the timestamp to a 30-minute window\n| eval target_time_window = DATE_TRUNC(30 minutes, @timestamp)\n| WHERE\n  event.dataset == \"azure.signinlogs\"\n  and event.category == \"authentication\"\n  and to_lower(azure.signinlogs.properties.resource_display_name) rlike \"(.*)365(.*)\"\n  and azure.signinlogs.category in (\"NonInteractiveUserSignInLogs\", \"SignInLogs\")\n  and event.outcome != \"success\"\n  // for tuning review azure.signinlogs.properties.status.error_code\n  // https://learn.microsoft.com/en-us/entra/identity-platform/reference-error-codes\n\n// keep only relevant fields\n| keep target_time_window, event.dataset, event.category, azure.signinlogs.properties.resource_display_name, azure.signinlogs.category, event.outcome, azure.signinlogs.properties.user_principal_name, source.ip\n\n// count the number of login sources and failed login attempts\n| stats\n  login_source_count = count(source.ip),\n  failed_login_count = count(*) by target_time_window, azure.signinlogs.properties.user_principal_name\n\n// filter for users with more than 20 login sources or failed login attempts\n| where (login_source_count >= 20 or failed_login_count >= 20)\n"
      },
      {
        "name": "Microsoft 365 Portal Logins from Impossible Travel Locations",
        "description": "Detects successful Microsoft 365 portal logins from impossible travel locations. Impossible travel locations are defined as two different countries within a short time frame. This behavior may indicate an adversary attempting to access a Microsoft 365 account from a compromised account or a malicious actor attempting to access a Microsoft 365 account from a different location.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Data Source: Microsoft 365",
          "Use Case: Threat Detection",
          "Tactic: Initial Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-15m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "False positives may occur when users are using a VPN or when users are traveling to different locations for legitimate purposes."
        ],
        "references": [
          "https://www.huntress.com/blog/time-travelers-busted-how-to-detect-impossible-travel-"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1078",
                "name": "Valid Accounts",
                "reference": "https://attack.mitre.org/techniques/T1078/",
                "subtechnique": [
                  {
                    "id": "T1078.004",
                    "name": "Cloud Accounts",
                    "reference": "https://attack.mitre.org/techniques/T1078/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "o365",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "o365.audit.Target.Type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "o365.audit.UserId",
            "type": "keyword",
            "ecs": false
          }
        ],
        "id": "601b1183-b2b3-486c-b21e-80d220db7990",
        "rule_id": "3896d4c0-6ad1-11ef-8c7b-f661ea17fbcc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.246Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.246Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "threshold",
        "query": "event.dataset: \"o365.audit\"\n    and event.provider: \"AzureActiveDirectory\"\n    and event.action: \"UserLoggedIn\"\n    and event.outcome: \"success\"\n    and not o365.audit.UserId: \"Not Available\"\n    and o365.audit.Target.Type: (\"0\" or \"2\" or \"3\" or \"5\" or \"6\" or \"10\")\n",
        "threshold": {
          "field": [
            "o365.audit.UserId"
          ],
          "value": 1,
          "cardinality": [
            {
              "field": "source.geo.country_name",
              "value": 2
            }
          ]
        },
        "index": [
          "filebeat-*",
          "logs-o365.audit-*"
        ],
        "language": "kuery"
      },
      {
        "name": "Mount Launched Inside a Privileged Container",
        "description": "This rule detects the use of the mount utility from inside a privileged container. The mount command is used to make a device or file system accessible to the system, and then to connect its root directory to a specified mount point on the local file system. When launched inside a privileged container--a container deployed with all the capabilities of the host machine-- an attacker can access sensitive host level files which could be used for further privilege escalation and container escapes to the host machine. Any usage of mount inside a running privileged container should be further investigated.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Data Source: Elastic Defend for Containers",
          "Domain: Container",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-security/docker-breakout-privilege-escalation#privileged"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1611",
                "name": "Escape to Host",
                "reference": "https://attack.mitre.org/techniques/T1611/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "cloud_defend",
            "version": "^1.0.5"
          }
        ],
        "required_fields": [
          {
            "name": "container.security_context.privileged",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "event.module",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "93b2aa4e-7ed8-4b44-8790-d645f9d49668",
        "rule_id": "41f7da9e-4e9f-4a81-9b58-40d725d83bc0",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.258Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.258Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where event.module == \"cloud_defend\" and  event.type== \"start\" and \n(process.name== \"mount\" or process.args== \"mount\") and container.security_context.privileged == true\n",
        "language": "eql",
        "index": [
          "logs-cloud_defend*"
        ]
      },
      {
        "name": "Cupsd or Foomatic-rip Shell Execution",
        "description": "This detection rule addresses multiple vulnerabilities in the CUPS printing system, including CVE-2024-47176, CVE-2024-47076, CVE-2024-47175, and CVE-2024-47177. Specifically, this rule detects shell executions from the foomatic-rip parent process. These flaws impact components like cups-browsed, libcupsfilters, libppd, and foomatic-rip, allowing remote unauthenticated attackers to manipulate IPP URLs or inject malicious data through crafted UDP packets or network spoofing. This can result in arbitrary command execution when a print job is initiated.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Cupsd or Foomatic-rip Shell Execution\n\nThis rule identifies potential exploitation attempts of several vulnerabilities in the CUPS printing system (CVE-2024-47176, CVE-2024-47076, CVE-2024-47175, CVE-2024-47177). These vulnerabilities allow attackers to send crafted IPP requests or manipulate UDP packets to execute arbitrary commands or modify printer configurations. Attackers can exploit these flaws to inject malicious data, leading to Remote Code Execution (RCE) on affected systems.\n\n#### Possible Investigation Steps\n\n- Investigate the incoming IPP requests or UDP packets targeting port 631.\n- Examine the printer configurations on the system to determine if any unauthorized printers or URLs have been added.\n- Investigate the process tree to check if any unexpected processes were triggered as a result of IPP activity. Review the executable files for legitimacy.\n- Check for additional alerts related to the compromised system or user within the last 48 hours.\n- Investigate network traffic logs for suspicious outbound connections to unrecognized domains or IP addresses.\n- Check if any of the contacted domains or addresses are newly registered or have a suspicious reputation.\n- Retrieve any scripts or executables dropped by the attack for further analysis in a private sandbox environment:\n- Analyze potential malicious activity, including:\n  - Attempts to communicate with external servers.\n  - File access or creation of unauthorized executables.\n  - Cron jobs, services, or other persistence mechanisms.\n\n### Related Rules\n- Printer User (lp) Shell Execution - f86cd31c-5c7e-4481-99d7-6875a3e31309\n- Network Connection by Cups or Foomatic-rip Child - e80ee207-9505-49ab-8ca8-bc57d80e2cab\n- File Creation by Cups or Foomatic-rip Child - b9b14be7-b7f4-4367-9934-81f07d2f63c4\n- Suspicious Execution from Foomatic-rip or Cupsd Parent - 986361cd-3dac-47fe-afa1-5c5dd89f2fb4\n\n### False Positive Analysis\n\n- This activity is rarely legitimate. However, verify the context to rule out non-malicious printer configuration changes or legitimate IPP requests.\n\n### Response and Remediation\n\n- Initiate the incident response process based on the triage outcome.\n- Isolate the compromised host to prevent further exploitation.\n- If the investigation confirms malicious activity, search the environment for additional compromised hosts.\n- Implement network segmentation or restrictions to contain the attack.\n- Stop suspicious processes or services tied to CUPS exploitation.\n- Block identified Indicators of Compromise (IoCs), including IP addresses, domains, or hashes of involved files.\n- Review compromised systems for backdoors, such as reverse shells or persistence mechanisms like cron jobs.\n- Investigate potential credential exposure on compromised systems and reset passwords for any affected accounts.\n- Restore the original printer configurations or uninstall unauthorized printer entries.\n- Perform a thorough antimalware scan to identify any lingering threats or artifacts from the attack.\n- Investigate how the attacker gained initial access and address any weaknesses to prevent future exploitation.\n- Use insights from the incident to improve detection and response times in future incidents (MTTD and MTTR).\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Use Case: Vulnerability",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/cups-overflow",
          "https://www.evilsocket.net/2024/09/26/Attacking-UNIX-systems-via-CUPS-Part-I/",
          "https://gist.github.com/stong/c8847ef27910ae344a7b5408d9840ee1",
          "https://github.com/RickdeJager/cupshax/blob/main/cupshax.py"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1203",
                "name": "Exploitation for Client Execution",
                "reference": "https://attack.mitre.org/techniques/T1203/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "9b7d4d57-8a71-4a40-9b74-4972aed4096d",
        "rule_id": "476267ff-e44f-476e-99c1-04c78cb3769d",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.265Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.265Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\nprocess.parent.name == \"foomatic-rip\" and\nprocess.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") and not (\n  process.command_line like (\n    \"*/tmp/foomatic-*\", \"*-sDEVICE=ps2write*\", \"*printf*\", \"/bin/sh -e -c cat\", \"/bin/bash -c cat\",\n    \"/bin/bash -e -c cat\"\n  ) or\n  process.args like \"gs*\"\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Execution via Microsoft DotNet ClickOnce Host",
        "description": "Identifies the execution of DotNet ClickOnce installer via Dfsvc.exe trampoline. Adversaries may take advantage of ClickOnce to proxy execution of malicious payloads via trusted Microsoft processes.",
        "risk_score": 21,
        "severity": "low",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Rule Type: BBR",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "60m",
        "from": "now-119m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1127",
                "name": "Trusted Developer Utilities Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1127/"
              },
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/",
                "subtechnique": [
                  {
                    "id": "T1218.011",
                    "name": "Rundll32",
                    "reference": "https://attack.mitre.org/techniques/T1218/011/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "aa313930-9f3c-4183-b6ca-51a4fd095049",
        "rule_id": "5297b7f1-bccd-4611-93fa-ea342a01ff84",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.272Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.272Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by user.id with maxspan=5s\n [process where host.os.type == \"windows\" and event.action == \"start\" and\n  process.name : \"rundll32.exe\" and process.command_line : (\"*dfshim*ShOpenVerbApplication*\", \"*dfshim*#*\")]\n [network where host.os.type == \"windows\" and process.name : \"dfsvc.exe\"]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Segfault Detected",
        "description": "Monitors kernel logs for segfault messages. A segfault, or segmentation fault, is an error that occurs when a program tries to access a memory location that it's not allowed to access, typically leading to program termination. A segfault can be an indication of malicious behavior if it results from attempts to exploit buffer overflows or other vulnerabilities in software to execute arbitrary code or disrupt its normal operation.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from one of the following integrations:\n- Filebeat\n\n### Filebeat Setup\n\nFilebeat is a lightweight shipper for forwarding and centralizing log data. Installed as an agent on your servers, Filebeat monitors the log files or locations that you specify, collects log events, and forwards them either to Elasticsearch or Logstash for indexing.\n\n#### The following steps should be executed in order to add the Filebeat for the Linux System:\n\n- Elastic provides repositories available for APT and YUM-based distributions. Note that we provide binary packages, but no source packages.\n- To install the APT and YUM repositories follow the setup instructions in this [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/setup-repositories.html).\n- To run Filebeat on Docker follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/running-on-docker.html).\n- To run Filebeat on Kubernetes follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/running-on-kubernetes.html).\n- For quick start information for Filebeat refer to the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/8.11/filebeat-installation-configuration.html).\n- For complete Setup and Run Filebeat information refer to the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/setting-up-and-running.html).\n\n#### Rule Specific Setup Note\n\n- This rule requires the Filebeat System Module to be enabled.\n- The system module collects and parses logs created by the system logging service of common Unix/Linux based distributions.\n- To run the system module of Filebeat on Linux follow the setup instructions in the [helper guide](https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-module-system.html).\n",
        "related_integrations": [
          {
            "package": "system",
            "version": "^1.6.4"
          }
        ],
        "required_fields": [
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "message",
            "type": "match_only_text",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "bea0362b-09dc-4c71-af4c-6f8a6ac998d9",
        "rule_id": "5c81fc9d-1eae-437f-ba07-268472967013",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.278Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.278Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "logs-system.syslog-*"
        ],
        "query": "host.os.type:linux and event.dataset:\"system.syslog\" and process.name:kernel and message:segfault\n",
        "language": "kuery"
      },
      {
        "name": "Docker Escape via Nsenter",
        "description": "This rule identifies a UID change event via `nsenter`. The `nsenter` command is used to enter a namespace, which is a way to isolate processes and resources. Attackers can use `nsenter` to escape from a container to the host, which can lead to privilege escalation and lateral movement.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "Domain: Container",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.cyberark.com/resources/threat-research-blog/the-route-to-root-container-escape-using-kernel-exploitation"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1611",
                "name": "Escape to Host",
                "reference": "https://attack.mitre.org/techniques/T1611/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.entry_leader.entry_meta.type",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "7d0c3111-75eb-482a-8357-d69131a20d94",
        "rule_id": "5f3ab3ce-7b41-4168-a06a-68d2af8ebc88",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.285Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.285Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"change\" and event.action == \"uid_change\" and\nprocess.entry_leader.entry_meta.type == \"container\" and process.args == \"nsenter\" and\nprocess.args in (\"-t\", \"--target\") and process.args_count >= 4\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process*"
        ]
      },
      {
        "name": "MsiExec Service Child Process With Network Connection",
        "description": "Identifies the execution of an MsiExec service child process followed by network or dns lookup activity. Adversaries may abuse Windows Installers for initial access and delivery of malware.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 201,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon",
          "Data Source: SentinelOne"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/",
                "subtechnique": [
                  {
                    "id": "T1218.007",
                    "name": "Msiexec",
                    "reference": "https://attack.mitre.org/techniques/T1218/007/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "73a3bfab-3f1d-455a-91b4-6a046c94a697",
        "rule_id": "65432f4a-e716-4cc1-ab11-931c4966da2d",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.295Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.295Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by process.entity_id with maxspan=1m\n [process where host.os.type == \"windows\" and event.type : \"start\" and\n  process.parent.name : \"msiexec.exe\" and process.parent.args : \"/v\" and\n  not process.executable :\n        (\"?:\\\\Windows\\\\System32\\\\msiexec.exe\",\n         \"?:\\\\Windows\\\\sysWOW64\\\\msiexec.exe\",\n         \"?:\\\\Windows\\\\system32\\\\srtasks.exe\",\n         \"?:\\\\Windows\\\\syswow64\\\\srtasks.exe\",\n         \"?:\\\\Windows\\\\sys*\\\\taskkill.exe\",\n         \"?:\\\\Program Files\\\\*.exe\",\n         \"?:\\\\Program Files (x86)\\\\*.exe\",\n         \"?:\\\\Windows\\\\Installer\\\\MSI*.tmp\",\n         \"?:\\\\Windows\\\\Microsoft.NET\\\\Framework*\\\\RegSvcs.exe\") and\n not (process.name : (\"rundll32.exe\", \"regsvr32.exe\") and process.args : (\"?:\\\\Program Files\\\\*\", \"?:\\\\Program Files (x86)\\\\*\"))]\n[any where host.os.type == \"windows\" and event.category in (\"network\", \"dns\") and process.name != null]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-endpoint.events.network-*",
          "logs-windows.sysmon_operational-*",
          "logs-sentinel_one_cloud_funnel.*"
        ]
      },
      {
        "name": "AWS RDS DB Snapshot Created",
        "description": "Identifies when an AWS RDS DB Snapshot is created. This can be used to evade defenses by allowing an attacker to bypass access controls or cover their tracks by reverting an instance to a previous state. This is a [building block rule](https://www.elastic.co/guide/en/security/current/building-block-rule.html) and does not generate alerts on its own. It is meant to be used for correlation with other rules to detect suspicious activity. To generate alerts, create a rule that uses this signal as a building block.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "building_block_type": "default",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS RDS",
          "Use Case: Asset Visibility",
          "Tactic: Defense Evasion",
          "Rule Type: BBR"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate manual or automated snapshots created for backups can trigger this rule. Ensure that the snapshots are authorized and align with your organization's policies."
        ],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1578",
                "name": "Modify Cloud Compute Infrastructure",
                "reference": "https://attack.mitre.org/techniques/T1578/",
                "subtechnique": [
                  {
                    "id": "T1578.001",
                    "name": "Create Snapshot",
                    "reference": "https://attack.mitre.org/techniques/T1578/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "9cc43b1d-8027-4c74-b796-77217235672e",
        "rule_id": "68c5c9d1-38e5-48bb-b1b2-8b5951d39738",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.302Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.302Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "query": "event.dataset: \"aws.cloudtrail\" and event.provider: \"rds.amazonaws.com\" \n    and event.action: (\"CreateDBSnapshot\" or \"CreateDBClusterSnapshot\") and event.outcome: \"success\" \n",
        "language": "kuery"
      },
      {
        "name": "Root Certificate Installation",
        "description": "This rule detects the installation of root certificates on a Linux system. Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to their command and control servers. Root certificates are used in public key cryptography to identify a root certificate authority (CA). When a root certificate is installed, the system or application will trust certificates in the root's chain of trust that have been signed by the root certificate.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1553.004/T1553.004.md"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1553",
                "name": "Subvert Trust Controls",
                "reference": "https://attack.mitre.org/techniques/T1553/",
                "subtechnique": [
                  {
                    "id": "T1553.004",
                    "name": "Install Root Certificate",
                    "reference": "https://attack.mitre.org/techniques/T1553/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "1ed9ed32-f531-4e0a-a4c7-6c92aa163162",
        "rule_id": "6ded0996-7d4b-40f2-bf4a-6913e7591795",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.309Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.309Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\nprocess.name in (\"update-ca-trust\", \"update-ca-certificates\") and not (\n  process.parent.name like (\n    \"ca-certificates.postinst\", \"ca-certificates-*.trigger\", \"pacman\", \"pamac-daemon\", \"autofirma.postinst\",\n    \"ipa-client-install\", \"su\", \"platform-python\", \"python*\", \"kesl\", \"execd\"\n  ) or\n  process.parent.args like \"/var/tmp/rpm*\" or\n  (process.parent.name in (\"sh\", \"bash\", \"zsh\") and process.args == \"-e\")\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process*"
        ]
      },
      {
        "name": "SSM Session Started to EC2 Instance",
        "description": "Identifies the first occurrence of an AWS resource establishing a session via SSM to an EC2 instance. Adversaries may use AWS Systems Manager to establish a session to an EC2 instance to execute commands on the instance. This can be used to gain access to the instance and perform actions such as privilege escalation. This rule helps detect the first occurrence of this activity for a given AWS resource.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating SSM Session Started to EC2 Instance\n\nThis rule detects the first instance of an AWS resource initiating an SSM session to an EC2 instance, which could be indicative of legitimate administrative activities or potential malicious actions like command execution or lateral movement.\n\n#### Possible Investigation Steps\n\n- **Examine the Session Start Event**: Review the AWS CloudTrail log for the event.\n    - Look for the `StartSession` action and verify details such as the `user_identity.arn`, `event.action`, and the target EC2 instance (`aws.cloudtrail.flattened.request_parameters`).\n- **Verify User Identity and Role**: Check the user’s ARN and access key ID (`aws.cloudtrail.user_identity.access_key_id`).\n    - Cross-reference this with IAM to verify if the user had the necessary permissions and if their role typically requires initiating SSM sessions.\n- **Assess Geographic and IP Context**: Analyze the source IP (`source.ip`) and geographic location (`source.geo`) from which the session was initiated.\n    - Determine if these are consistent with typical user locations or if they raise suspicions of compromise or misuse.\n- **Review Session Details**: Examine details like the session ID and stream URL (`aws.cloudtrail.flattened.response_elements`) to understand the scope and nature of the session.\n    - Check if any commands executed during the session were unauthorized or out of ordinary practices.\n- **Correlate with Other Security Events**: Look for other related security events around the time of the session start to identify any pattern or broader attack vector that may involve this user or EC2 instance.\n\n### False Positive Analysis\n\n- **Legitimate Administrative Activities**: Confirm whether the SSM session was initiated for valid administrative purposes such as system maintenance, patching, or configuration updates. Verify with the respective teams or personnel.\n\n### Response and Remediation\n\n- **Immediate Session Review**: If the session initiation seems suspicious, review all actions taken during the session.\n    - If possible, terminate the session to prevent any potential harm.\n- **Validate and Reinforce Security Policies**: Ensure that policies around SSM session initiation are strict and adhere to the principle of least privilege.\n    - Update IAM policies if necessary to tighten controls.\n- **Incident Response Activation**: If malicious intent or actions are confirmed, activate the incident response protocol.\n    - This includes containment of the threat, eradication of the adversary’s presence, recovery of affected systems, and a thorough investigation.\n- **Enhance Monitoring and Alerts**: Improve monitoring of SSM sessions, particularly focusing on sessions that involve sensitive or critical EC2 instances.\n    - Adjust alerting mechanisms to flag unusual session initiations promptly.\n\n### Additional Information\n\nFor more in-depth understanding of managing SSM sessions and security best practices, refer to the [AWS Systems Manager documentation](https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_StartSession.html). Additionally, consider the security implications and best practices outlined in [AWS SSM privilege escalation techniques](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-privilege-escalation/aws-ssm-privesc).\n\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS SSM",
          "Use Case: Threat Detection",
          "Tactic: Lateral Movement"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate use of AWS Systems Manager to establish a session to an EC2 instance."
        ],
        "references": [
          "https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_StartSession.html",
          "https://hackingthe.cloud/aws/post_exploitation/intercept_ssm_communications/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1021",
                "name": "Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1021/",
                "subtechnique": [
                  {
                    "id": "T1021.007",
                    "name": "Cloud Services",
                    "reference": "https://attack.mitre.org/techniques/T1021/007/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a90bf378-614d-43d7-a4a7-e56b3a506392",
        "rule_id": "804a7ac8-fc00-11ee-924b-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.315Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.315Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset:\"aws.cloudtrail\" and event.provider:\"ssm.amazonaws.com\"\n    and event.action:\"StartSession\" and event.outcome:\"success\"\n",
        "new_terms_fields": [
          "aws.cloudtrail.user_identity.arn"
        ],
        "history_window_start": "now-10d",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "language": "kuery"
      },
      {
        "name": "AWS EC2 Instance Connect SSH Public Key Uploaded",
        "description": "Identifies when a new SSH public key is uploaded to an AWS EC2 instance using the EC2 Instance Connect service. This action could indicate an adversary attempting to maintain access to the instance. The rule also detects the `SendSerialConsoleSSHPublicKey` API action, which could be used for privilege escalation if the serial console is enabled. Monitoring these activities helps ensure unauthorized access attempts are detected and mitigated promptly.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS EC2 Instance Connect SSH Public Key Uploaded\n\nThis rule detects when a new SSH public key is uploaded to an AWS EC2 instance using the EC2 Instance Connect service. Adversaries may upload SSH public keys to EC2 instances to maintain access to the instance. The rule also covers cases where the `SendSerialConsoleSSHPublicKey` API action is used to upload an SSH public key to a serial connection, which can be exploited for privilege escalation.\n\n#### Possible Investigation Steps:\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who performed the action. Verify if this actor typically performs such actions and if they have the necessary permissions.\n- **Review the Request Details**: Examine the `aws.cloudtrail.request_parameters` to understand the specific details of the SSH public key upload. Look for any unusual parameters that could suggest unauthorized or malicious modifications.\n- **Analyze the Source of the Request**: Investigate the `source.ip` and `source.geo` fields to determine the geographical origin of the request. An external or unexpected location might indicate compromised credentials or unauthorized access.\n- **Contextualize with Timestamp**: Use the `@timestamp` field to check when the SSH public key was uploaded. Changes during non-business hours or outside regular maintenance windows might require further scrutiny.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this action to see if the same actor or IP address engaged in other potentially suspicious activities.\n- **Check for Serial Console Access**: If the `SendSerialConsoleSSHPublicKey` action was used, verify if the `ec2:EnableSerialConsoleAccess` permission was also used, which might indicate an attempt to enable and exploit the serial console.\n\n### False Positive Analysis:\n\n- **Legitimate Administrative Actions**: Confirm if the SSH public key upload aligns with scheduled updates, development activities, or legitimate administrative tasks documented in change management systems.\n- **Consistency Check**: Compare the action against historical data of similar actions performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.\n- **Verify through Outcomes**: Check the `aws.cloudtrail.response_elements` and the `event.outcome` to confirm if the upload was successful and intended according to policy.\n\n### Response and Remediation:\n\n- **Immediate Review and Reversal if Necessary**: If the upload was unauthorized, remove the uploaded SSH public key from the EC2 instance and review the instance's access logs for any suspicious activity.\n- **Enhance Monitoring and Alerts**: Adjust monitoring systems to alert on similar actions, especially those involving sensitive instances or unusual file extensions.\n- **Educate and Train**: Provide additional training to users with administrative rights on the importance of security best practices concerning SSH key management and the risks of unauthorized key uploads.\n- **Audit EC2 Instance Policies and Permissions**: Conduct a comprehensive audit of all EC2 instance policies and associated permissions to ensure they adhere to the principle of least privilege.\n- **Incident Response**: If there's an indication of malicious intent or a security breach, initiate the incident response protocol to mitigate any damage and prevent future occurrences.\n\n### Additional Information:\n\nFor further guidance on managing EC2 instances and securing AWS environments, refer to the [AWS EC2 Instance Connect documentation](https://docs.aws.amazon.com/ec2-instance-connect/latest/APIReference/API_SendSSHPublicKey.html) and AWS best practices for security. Additionally, consult the following resources for specific details on SSH key management and privilege escalation techniques:\n- [Stratus Red Team - AWS EC2 Instance Connect](https://stratus-red-team.cloud/attack-techniques/AWS/aws.lateral-movement.ec2-instance-connect/)\n- [HackTricks - AWS EC2 Privilege Escalation](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-privilege-escalation/aws-ec2-privesc)\n- [AWS EC2 Instance Connect API Reference](https://docs.aws.amazon.com/ec2-instance-connect/latest/APIReference/API_SendSSHPublicKey.html)\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS EC2",
          "Use Case: Identity and Access Audit",
          "Tactic: Privilege Escalation"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Administrators may upload SSH public keys to EC2 instances for legitimate purposes."
        ],
        "references": [
          "https://stratus-red-team.cloud/attack-techniques/AWS/aws.lateral-movement.ec2-instance-connect/",
          "https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-privilege-escalation/aws-ec2-privesc",
          "https://medium.parttimepolymath.net/aws-ec2-instance-connect-a-very-neat-trick-4d2fc0c28010",
          "https://docs.aws.amazon.com/ec2-instance-connect/latest/APIReference/API_SendSSHPublicKey.html",
          "https://docs.aws.amazon.com/ec2-instance-connect/latest/APIReference/API_SendSerialConsoleSSHPublicKey.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.004",
                    "name": "SSH Authorized Keys",
                    "reference": "https://attack.mitre.org/techniques/T1098/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a4b7311c-c6a7-4fd9-b981-d7e3124365e5",
        "rule_id": "873b5452-074e-11ef-852e-f661ea17fbcc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.321Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.321Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "query": "event.dataset: aws.cloudtrail\n    and event.provider: ec2-instance-connect.amazonaws.com\n    and event.action: (SendSSHPublicKey or SendSerialConsoleSSHPublicKey)\n    and event.outcome: success\n",
        "language": "kuery"
      },
      {
        "name": "File System Debugger Launched Inside a Privileged Container",
        "description": "This rule detects the use of the built-in Linux DebugFS utility from inside a privileged container. DebugFS is a special file system debugging utility which supports reading and writing directly from a hard drive device. When launched inside a privileged container, a container deployed with all the capabilities of the host machine, an attacker can access sensitive host level files which could be used for further privilege escalation and container escapes to the host machine.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Data Source: Elastic Defend for Containers",
          "Domain: Container",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://cyberark.wistia.com/medias/ygbzkzx93q?wvideo=ygbzkzx93q",
          "https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-security/docker-breakout-privilege-escalation#privileged"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1611",
                "name": "Escape to Host",
                "reference": "https://attack.mitre.org/techniques/T1611/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "cloud_defend",
            "version": "^1.0.5"
          }
        ],
        "required_fields": [
          {
            "name": "container.security_context.privileged",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "event.module",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "3924e01e-f202-4fa9-9491-0bbd8c3f6b76",
        "rule_id": "97697a52-4a76-4f0a-aa4f-25c178aae6eb",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.331Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.331Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where event.module == \"cloud_defend\" and     \n  event.type == \"start\" and process.name == \"debugfs\" and \n  process.args : \"/dev/sd*\" and not process.args == \"-R\" and\n  container.security_context.privileged == true\n",
        "language": "eql",
        "index": [
          "logs-cloud_defend*"
        ]
      },
      {
        "name": "Suspicious Execution from Foomatic-rip or Cupsd Parent",
        "description": "This detection rule addresses multiple vulnerabilities in the CUPS printing system, including CVE-2024-47176, CVE-2024-47076, CVE-2024-47175, and CVE-2024-47177. Specifically, this rule detects suspicious process command lines executed by child processes of foomatic-rip and cupsd. These flaws impact components like cups-browsed, libcupsfilters, libppd, and foomatic-rip, allowing remote unauthenticated attackers to manipulate IPP URLs or inject malicious data through crafted UDP packets or network spoofing. This can result in arbitrary command execution when a print job is initiated.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Suspicious Execution from Foomatic-rip or Cupsd Parent\n\nThis rule identifies potential exploitation attempts of several vulnerabilities in the CUPS printing system (CVE-2024-47176, CVE-2024-47076, CVE-2024-47175, CVE-2024-47177). These vulnerabilities allow attackers to send crafted IPP requests or manipulate UDP packets to execute arbitrary commands or modify printer configurations. Attackers can exploit these flaws to inject malicious data, leading to Remote Code Execution (RCE) on affected systems.\n\n#### Possible Investigation Steps\n\n- Investigate the incoming IPP requests or UDP packets targeting port 631.\n- Examine the printer configurations on the system to determine if any unauthorized printers or URLs have been added.\n- Investigate the process tree to check if any unexpected processes were triggered as a result of IPP activity. Review the executable files for legitimacy.\n- Check for additional alerts related to the compromised system or user within the last 48 hours.\n- Investigate network traffic logs for suspicious outbound connections to unrecognized domains or IP addresses.\n- Check if any of the contacted domains or addresses are newly registered or have a suspicious reputation.\n- Retrieve any scripts or executables dropped by the attack for further analysis in a private sandbox environment:\n- Analyze potential malicious activity, including:\n  - Attempts to communicate with external servers.\n  - File access or creation of unauthorized executables.\n  - Cron jobs, services, or other persistence mechanisms.\n\n### Related Rules\n- Cupsd or Foomatic-rip Shell Execution - 476267ff-e44f-476e-99c1-04c78cb3769d\n- Printer User (lp) Shell Execution - f86cd31c-5c7e-4481-99d7-6875a3e31309\n- Network Connection by Cups or Foomatic-rip Child - e80ee207-9505-49ab-8ca8-bc57d80e2cab\n- File Creation by Cups or Foomatic-rip Child - b9b14be7-b7f4-4367-9934-81f07d2f63c4\n\n### False Positive Analysis\n\n- This activity is rarely legitimate. However, verify the context to rule out non-malicious printer configuration changes or legitimate IPP requests.\n\n### Response and Remediation\n\n- Initiate the incident response process based on the triage outcome.\n- Isolate the compromised host to prevent further exploitation.\n- If the investigation confirms malicious activity, search the environment for additional compromised hosts.\n- Implement network segmentation or restrictions to contain the attack.\n- Stop suspicious processes or services tied to CUPS exploitation.\n- Block identified Indicators of Compromise (IoCs), including IP addresses, domains, or hashes of involved files.\n- Review compromised systems for backdoors, such as reverse shells or persistence mechanisms like cron jobs.\n- Investigate potential credential exposure on compromised systems and reset passwords for any affected accounts.\n- Restore the original printer configurations or uninstall unauthorized printer entries.\n- Perform a thorough antimalware scan to identify any lingering threats or artifacts from the attack.\n- Investigate how the attacker gained initial access and address any weaknesses to prevent future exploitation.\n- Use insights from the incident to improve detection and response times in future incidents (MTTD and MTTR).\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Use Case: Vulnerability",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/cups-overflow",
          "https://www.evilsocket.net/2024/09/26/Attacking-UNIX-systems-via-CUPS-Part-I/",
          "https://gist.github.com/stong/c8847ef27910ae344a7b5408d9840ee1",
          "https://github.com/RickdeJager/cupshax/blob/main/cupshax.py"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1203",
                "name": "Exploitation for Client Execution",
                "reference": "https://attack.mitre.org/techniques/T1203/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "823b8b09-241c-482a-b225-aec817ff8af4",
        "rule_id": "986361cd-3dac-47fe-afa1-5c5dd89f2fb4",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.338Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.338Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\nprocess.parent.name in (\"foomatic-rip\", \"cupsd\") and process.command_line like (\n  // persistence\n  \"*cron*\", \"*/etc/rc.local*\", \"*/dev/tcp/*\", \"*/etc/init.d*\", \"*/etc/update-motd.d*\", \"*/etc/sudoers*\",\n  \"*/etc/profile*\", \"*autostart*\", \"*/etc/ssh*\", \"*/home/*/.ssh/*\", \"*/root/.ssh*\", \"*~/.ssh/*\", \"*udev*\",\n  \"*/etc/shadow*\", \"*/etc/passwd*\",\n\n  // Downloads\n  \"*curl*\", \"*wget*\",\n\n  // encoding and decoding\n  \"*base64 *\", \"*base32 *\", \"*xxd *\", \"*openssl*\",\n\n  // reverse connections\n  \"*GS_ARGS=*\", \"*/dev/tcp*\", \"*/dev/udp/*\", \"*import*pty*spawn*\", \"*import*subprocess*call*\", \"*TCPSocket.new*\",\n  \"*TCPSocket.open*\", \"*io.popen*\", \"*os.execute*\", \"*fsockopen*\", \"*disown*\", \"*nohup*\",\n\n  // SO loads\n  \"*openssl*-engine*.so*\", \"*cdll.LoadLibrary*.so*\", \"*ruby*-e**Fiddle.dlopen*.so*\", \"*Fiddle.dlopen*.so*\",\n  \"*cdll.LoadLibrary*.so*\",\n\n  // misc. suspicious command lines\n   \"*/etc/ld.so*\", \"*/dev/shm/*\", \"*/var/tmp*\", \"*echo*\", \"*>>*\", \"*|*\"\n) and not process.args like \"gs*\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Access Control List Modification via setfacl",
        "description": "This rule detects Linux Access Control List (ACL) modification via the setfacl command.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.uptycs.com/blog/threat-research-report-team/evasive-techniques-used-by-malicious-linux-shell-scripts"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1222",
                "name": "File and Directory Permissions Modification",
                "reference": "https://attack.mitre.org/techniques/T1222/",
                "subtechnique": [
                  {
                    "id": "T1222.002",
                    "name": "Linux and Mac File and Directory Permissions Modification",
                    "reference": "https://attack.mitre.org/techniques/T1222/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "f1621961-bac5-4c4c-836c-3acce16482e9",
        "rule_id": "999565a2-fc52-4d72-91e4-ba6712c0377e",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.345Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.345Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and\nevent.action in (\"exec\", \"exec_event\", \"executed\", \"process_started\") and\nprocess.name == \"setfacl\" and not (\n  process.command_line == \"/bin/setfacl --restore=-\" or\n  process.args == \"/var/log/journal/\"\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*",
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ]
      },
      {
        "name": "AWS S3 Bucket Server Access Logging Disabled",
        "description": "Identifies when server access logging is disabled for an Amazon S3 bucket. Server access logs provide a detailed record of requests made to an S3 bucket. When server access logging is disabled for a bucket, it could indicate an adversary's attempt to impair defenses by disabling logs that contain evidence of malicious activity.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "\n## Triage and Analysis\n\n### Investigating AWS S3 Bucket Server Access Logging Disabled\n\nThis rule detects when server access logging is disabled for an S3 bucket in AWS. Such configurations could potentially hide evidence of unauthorized access or malicious activity by preventing the recording of those requests.\n\n#### Detailed Investigation Steps\n\n- **Review the Affected S3 Bucket**: Check the bucket details (`bucketName`) where server access logging has been disabled.\n    - Determine the contents and importance of the data stored in this bucket to assess the impact of disabled logging.\n- **Review User Identity and Activity**:\n  - Investigate the user (`user_identity.arn`) who made the change. Determine whether this user's role typically involves managing S3 bucket configurations.\n  - Examine the authentication method and whether the access key used (`access_key_id`) is routinely used for such configurations or if it has deviated from normal usage patterns.\n  - Contact the account owner and confirm whether they are aware of this activity.\n  - Considering the source IP address and geolocation of the user who issued the command:\n      - Do they look normal for the calling user?\n      - If the source is an EC2 IP address, is it associated with an EC2 instance in one of your accounts or is the source IP from an EC2 instance that's not under your control?\n      - If it is an authorized EC2 instance, is the activity associated with normal behavior for the instance role or roles? Are there any other alerts or signs of suspicious activity involving this instance?\n- **Contextualize with Recent Changes**: Compare this event against recent changes in S3 configurations. Look for any other recent permissions changes or unusual administrative actions.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this change to see if the same actor or IP address engaged in other potentially suspicious activities.\n  - Assess whether this behavior is prevalent in the environment by looking for similar occurrences involving other users.\n\n### False Positive Analysis\n\n- Verify the operational requirements that might necessitate disabling access logging, especially in environments where data retention policies are strictly governed for compliance and cost-saving reasons.\n\n### Response and Remediation\n\n- **Immediate Review**: If the change was unauthorized, consider reverting the change immediately to prevent potential data loss.\n- **Enhance Monitoring**: Implement monitoring to alert on changes to logging configurations across your S3 environments.\n- **User Education**: Ensure that users with access to critical resources like S3 buckets are aware of the best practices and company policies regarding data retention and security.\n\n### Additional Information\n\nFor further guidance on monitoring Amazon S3 and ensuring compliance with organizational data retention and security policies, refer to the AWS official documentation on [Monitoring Amazon S3](https://docs.aws.amazon.com/AmazonS3/latest/userguide/monitoring-overview.html).\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: Amazon S3",
          "Use Case: Asset Visibility",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Bucket logging may be disabled by a system or network administrator. Verify whether the user identity and/or user agent should be making changes in your environment. Bucket component deletions by unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule."
        ],
        "references": [
          "https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketLogging.html",
          "https://docs.aws.amazon.com/AmazonS3/latest/userguide/enable-server-access-logging.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1562",
                "name": "Impair Defenses",
                "reference": "https://attack.mitre.org/techniques/T1562/",
                "subtechnique": [
                  {
                    "id": "T1562.008",
                    "name": "Disable or Modify Cloud Logs",
                    "reference": "https://attack.mitre.org/techniques/T1562/008/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "753f5bd9-feac-45da-b0ba-82e18d1c34cc",
        "rule_id": "a6788d4b-b241-4bf0-8986-a3b4315c5b70",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.351Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.351Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where event.dataset == \"aws.cloudtrail\" \n   and event.action == \"PutBucketLogging\" \n   and event.outcome == \"success\" \n   and not stringContains(aws.cloudtrail.request_parameters, \"LoggingEnabled\")\n",
        "language": "eql",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail*"
        ]
      },
      {
        "name": "Entra ID Device Code Auth with Broker Client",
        "description": "Identifies device code authentication with an Azure broker client for Entra ID. Adversaries abuse Primary Refresh Tokens (PRTs) to bypass multi-factor authentication (MFA) and gain unauthorized access to Azure resources. PRTs are used in Conditional Access policies to enforce device-based controls. Compromising PRTs allows attackers to bypass these policies and gain unauthorized access. This rule detects successful sign-ins using device code authentication with the Entra ID broker client application ID (29d9ed98-a469-4536-ade2-f981bc1d605e).",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: Azure",
          "Data Source: Microsoft Entra ID",
          "Use Case: Identity and Access Audit",
          "Tactic: Credential Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://dirkjanm.io/assets/raw/Phishing%20the%20Phishing%20Resistant.pdf",
          "https://learn.microsoft.com/en-us/troubleshoot/azure/entra/entra-id/governance/verify-first-party-apps-sign-in",
          "https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/signinlogs"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1528",
                "name": "Steal Application Access Token",
                "reference": "https://attack.mitre.org/techniques/T1528/"
              }
            ]
          }
        ],
        "setup": "This rule optionally requires Azure Sign-In logs from the Azure integration. Ensure that the Azure integration is correctly set up and that the required data is being collected.\n",
        "related_integrations": [
          {
            "package": "azure",
            "version": "^1.0.0",
            "integration": "activitylogs"
          },
          {
            "package": "azure",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "azure.activitylogs.properties.appId",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "azure.activitylogs.properties.authentication_protocol",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "azure.signinlogs.properties.authentication_protocol",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "azure.signinlogs.properties.conditional_access_audiences.application_id",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "0819f5fd-6db9-412d-b5a1-c04da348b891",
        "rule_id": "a83b3dac-325a-11ef-b3e6-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.358Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.358Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "query",
        "index": [
          "filebeat-*",
          "logs-azure.signinlogs-*",
          "logs-azure.activitylogs-*"
        ],
        "query": " event.dataset:(azure.activitylogs or azure.signinlogs)\n    and azure.signinlogs.properties.authentication_protocol:deviceCode\n    and azure.signinlogs.properties.conditional_access_audiences.application_id:29d9ed98-a469-4536-ade2-f981bc1d605e\n    and event.outcome:success or (\n        azure.activitylogs.properties.appId:29d9ed98-a469-4536-ade2-f981bc1d605e\n        and azure.activitylogs.properties.authentication_protocol:deviceCode)\n",
        "language": "kuery"
      },
      {
        "name": "Authentication via Unusual PAM Grantor",
        "description": "This rule detects successful authentications via PAM grantors that are not commonly used. This could indicate an attacker is attempting to escalate privileges or maintain persistence on the system by modifying the default PAM configuration.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Tactic: Persistence",
          "Data Source: Auditd Manager"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1543",
                "name": "Create or Modify System Process",
                "reference": "https://attack.mitre.org/techniques/T1543/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1556",
                "name": "Modify Authentication Process",
                "reference": "https://attack.mitre.org/techniques/T1556/"
              }
            ]
          }
        ],
        "setup": "## Setup\nThis rule requires the use of the `auditd_manager` integration. `Auditd_manager` is a tool designed to simplify and enhance the management of the audit subsystem in Linux systems. It provides a user-friendly interface and automation capabilities for configuring and monitoring system auditing through the auditd daemon. With `auditd_manager`, administrators can easily define audit rules, track system events, and generate comprehensive audit reports, improving overall security and compliance in the system. The following steps should be executed in order to install and deploy `auditd_manager` on a Linux system.\n```\nKibana -->\nManagement -->\nIntegrations -->\nAuditd Manager -->\nAdd Auditd Manager\n```\n`Auditd_manager` subscribes to the kernel and receives events as they occur without any additional configuration. However, if more advanced configuration is required to detect specific behavior, audit rules can be added to the integration in either the \"audit rules\" configuration box or the \"auditd rule files\" box by specifying a file to read the audit rules from.\nFor this detection rule to trigger, no additional configuration is required.\n",
        "related_integrations": [
          {
            "package": "auditd_manager",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "auditd.data.grantors",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d9e3b538-b32c-490f-84ff-c1649c1eba53",
        "rule_id": "a8aaa49d-9834-462d-bf8f-b1255cebc004",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.368Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.368Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.category:authentication and host.os.type:linux and event.action:authenticated and event.outcome:success and\nauditd.data.grantors:(* and not (pam_rootok or *pam_cap* or *pam_permit*))\n",
        "new_terms_fields": [
          "auditd.data.grantors",
          "agent.id"
        ],
        "history_window_start": "now-14d",
        "index": [
          "auditbeat-*",
          "logs-auditd_manager.auditd-*"
        ],
        "language": "kuery"
      },
      {
        "name": "WPS Office Exploitation via DLL Hijack",
        "description": "Identifies the load of a remote library by the WPS Office promecefpluginhost.exe executable. This may indicate the successful exploitation of CVE-2024-7262 or CVE-2024-7263 via DLL hijack abusing the ksoqing custom protocol handler.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 101,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Initial Access",
          "Tactic: Execution",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.welivesecurity.com/en/eset-research/analysis-of-two-arbitrary-code-execution-vulnerabilities-affecting-wps-office/",
          "https://mp.weixin.qq.com/s/F8hNyESBdKhwXkQPgtGpew"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1203",
                "name": "Exploitation for Client Execution",
                "reference": "https://attack.mitre.org/techniques/T1203/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1189",
                "name": "Drive-by Compromise",
                "reference": "https://attack.mitre.org/techniques/T1189/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "dll.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "64170284-9f89-4e92-baae-4887831dbbb9",
        "rule_id": "ac6bc744-e82b-41ad-b58d-90654fa4ebfb",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.375Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.375Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where host.os.type == \"windows\" and process.name : \"promecefpluginhost.exe\" and \n(\n (event.category == \"library\" and \n  ?dll.path : \n     (\"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\wps\\\\INetCache\\\\*\", \n      \"\\\\Device\\\\Mup\\\\**\", \"\\\\\\\\*\")) or \n\n  ((event.category == \"process\" and event.action : \"Image loaded*\") and \n  ?file.path : \n     (\"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\wps\\\\INetCache\\\\*\", \n      \"\\\\Device\\\\Mup\\\\**\", \"\\\\\\\\*\"))\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.library-*",
          "logs-windows.sysmon_operational-*"
        ]
      },
      {
        "name": "Openssl Client or Server Activity",
        "description": "This rule identifies when the openssl client or server is used to establish a connection. Attackers may use openssl to establish a secure connection to a remote server or to create a secure server to receive connections. This activity may be used to exfiltrate data or establish a command and control channel.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://gtfobins.github.io/gtfobins/openssl/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1071",
                "name": "Application Layer Protocol",
                "reference": "https://attack.mitre.org/techniques/T1071/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "cdc35598-3ca2-4f68-b1dd-cc55f6a50dfd",
        "rule_id": "ad5a3757-c872-4719-8c72-12d3f08db655",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.382Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.382Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and\nprocess.name == \"openssl\" and (\n  (process.args == \"s_client\" and process.args : (\"-connect\", \"*:*\") and not process.args == \"-showcerts\") or\n  (process.args == \"s_server\" and process.args == \"-port\")\n) and\nnot process.parent.executable in (\"/pro/xymon/client/ext/awsXymonCheck.sh\", \"/opt/antidot-svc/nrpe/plugins/check_cert\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*",
          "endgame-*"
        ]
      },
      {
        "name": "Azure Entra Sign-in Brute Force Microsoft 365 Accounts by Repeat Source",
        "description": "Identifies potential brute-force attempts against Microsoft 365 user accounts by detecting a high number of failed interactive or non-interactive login attempts within a 30-minute window from a single source. Attackers may attempt to brute force user accounts to gain unauthorized access to Microsoft 365 services via different services such as Exchange, SharePoint, or Teams.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "This rule relies on Azure Entra ID sign-in logs, but filters for Microsoft 365 resources.",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Cloud",
          "Domain: SaaS",
          "Data Source: Azure",
          "Data Source: Entra ID",
          "Data Source: Entra ID Sign-in",
          "Use Case: Identity and Access Audit",
          "Use Case: Threat Detection",
          "Tactic: Credential Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-30m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Automated processes that attempt to authenticate using expired credentials or have misconfigured authentication settings may lead to false positives."
        ],
        "references": [
          "https://cloud.hacktricks.xyz/pentesting-cloud/azure-security/az-unauthenticated-enum-and-initial-entry/az-password-spraying",
          "https://github.com/0xZDH/o365spray"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1110",
                "name": "Brute Force",
                "reference": "https://attack.mitre.org/techniques/T1110/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [],
        "id": "1a4a90cb-a100-4a3a-a0ee-2f95f3f9a4a1",
        "rule_id": "c6655282-6c79-11ef-bbb5-f661ea17fbcc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.388Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.388Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-azure.signinlogs*\n| WHERE\n  event.dataset == \"azure.signinlogs\"\n  and event.category == \"authentication\"\n  and to_lower(azure.signinlogs.properties.resource_display_name) rlike \"(.*)365(.*)\"\n  and azure.signinlogs.category in (\"NonInteractiveUserSignInLogs\", \"SignInLogs\")\n  and event.outcome != \"success\"\n\n  // For tuning, review azure.signinlogs.properties.status.error_code\n  // https://learn.microsoft.com/en-us/entra/identity-platform/reference-error-codes\n\n// keep only relevant fields\n| keep event.dataset, event.category, azure.signinlogs.properties.resource_display_name, azure.signinlogs.category, event.outcome, azure.signinlogs.properties.user_principal_name, source.ip\n\n// Count the number of unique targets per source IP\n| stats\n  target_count = count_distinct(azure.signinlogs.properties.user_principal_name) by source.ip\n\n// Filter for at least 10 distinct failed login attempts from a single source\n| where target_count >= 10\n"
      },
      {
        "name": "Egress Connection from Entrypoint in Container",
        "description": "This rule identifies a sequence of events where a process named `entrypoint.sh` is started in a container, followed by a network connection attempt. This sequence indicates a potential egress connection from an entrypoint in a container. An entrypoint is a command or script specified in the Dockerfile and executed when the container starts. Attackers can use this technique to establish a foothold in the environment, escape from a container to the host, or establish persistence.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "Domain: Container",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1611",
                "name": "Escape to Host",
                "reference": "https://attack.mitre.org/techniques/T1611/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entry_leader.entry_meta.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "08a50894-1635-4a51-8e3e-b03d43862b92",
        "rule_id": "c75d0c86-38d6-4821-98a1-465cff8ff4c8",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.395Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.395Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id with maxspan=3s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.entry_leader.entry_meta.type == \"container\" and process.name == \"entrypoint.sh\"] by process.entity_id\n  [network where event.type == \"start\" and event.action == \"connection_attempted\" and not (\n     destination.ip == null or destination.ip == \"0.0.0.0\" or cidrmatch(\n       destination.ip, \"10.0.0.0/8\", \"127.0.0.0/8\", \"169.254.0.0/16\", \"172.16.0.0/12\", \"192.0.0.0/24\", \"192.0.0.0/29\",\n       \"192.0.0.8/32\", \"192.0.0.9/32\", \"192.0.0.10/32\", \"192.0.0.170/32\", \"192.0.0.171/32\", \"192.0.2.0/24\",\n       \"192.31.196.0/24\", \"192.52.193.0/24\", \"192.168.0.0/16\", \"192.88.99.0/24\", \"224.0.0.0/4\", \"100.64.0.0/10\",\n       \"192.175.48.0/24\",\"198.18.0.0/15\", \"198.51.100.0/24\", \"203.0.113.0/24\", \"240.0.0.0/4\", \"::1\", \"FE80::/10\",\n       \"FF00::/8\", \"172.31.0.0/16\"\n       )\n    )] by process.parent.entity_id\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "AWS EC2 Instance Console Login via Assumed Role",
        "description": "Identifies a successful console login activity by an EC2 instance profile using an assumed role. This is uncommon behavior and could indicate an attacker using compromised credentials to further exploit an environment. An EC2 instance assumes a role using their EC2 ID as the session name. This rule looks for the pattern \"i-\" which is the beginning pattern for assumed role sessions started by an EC2 instance and a successful `ConsoleLogin` or `GetSigninToken` API call.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS EC2",
          "Data Source: AWS STS",
          "Use Case: Identity and Access Audit",
          "Tactic: Lateral Movement",
          "Tactic: Credential Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "This is very uncommon behavior and should result in minimal false positives, ensure validity of the triggered event and include exceptions where necessary."
        ],
        "references": [
          "https://redcanary.com/blog/aws-sts/",
          "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers_enable-console-custom-url.html/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1021",
                "name": "Remote Services",
                "reference": "https://attack.mitre.org/techniques/T1021/",
                "subtechnique": [
                  {
                    "id": "T1021.007",
                    "name": "Cloud Services",
                    "reference": "https://attack.mitre.org/techniques/T1021/007/"
                  }
                ]
              },
              {
                "id": "T1550",
                "name": "Use Alternate Authentication Material",
                "reference": "https://attack.mitre.org/techniques/T1550/",
                "subtechnique": [
                  {
                    "id": "T1550.001",
                    "name": "Application Access Token",
                    "reference": "https://attack.mitre.org/techniques/T1550/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": []
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.user_identity.type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "cf1ba32d-a015-483c-a9af-988ef0164321",
        "rule_id": "d1e5e410-3e34-412e-9b1f-dd500b3b55cd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.420Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.420Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where event.dataset == \"aws.cloudtrail\"\n   and event.provider == \"signin.amazonaws.com\"\n   and event.action in (\"ConsoleLogin\", \"GetSigninToken\") \n   and event.outcome == \"success\"\n   and aws.cloudtrail.user_identity.type == \"AssumedRole\"\n   and stringContains (user.id, \":i-\")\n",
        "language": "eql",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ]
      },
      {
        "name": "AWS S3 Bucket Replicated to Another Account",
        "description": "Identifies when the `PutBucketReplication` operation is used to replicate S3 objects to a bucket in another AWS account. Adversaries may use bucket replication to exfiltrate sensitive data to an environment they control.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS S3 Bucket Replicated to Another Account\n\nThis rule identifies when an S3 bucket is replicated to another AWS account. While sharing bucket replication is a common practice, adversaries may exploit this feature to exfiltrate data by replicating objects to external accounts under their control.\n\n#### Possible Investigation Steps\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id` fields to identify who made the change. Verify if this actor typically performs such actions and if they have the necessary permissions.\n- **Review the Sharing Event**: Identify the S3 bucket involved and review the event details. Look for `PutBucketReplication` actions where an `Account` key-value pair is included signifying replication to an external account.\n    - **Request and Response Parameters**: Check the `aws.cloudtrail.request_parameters` and `aws.cloudtrail.response_elements` fields in the CloudTrail event to identify the role used and account ID where the bucket was replicated.\n- **Verify the Shared Bucket**: Check the S3 bucket that was replicated and its contents to determine the sensitivity of the data stored within it.\n- **Validate External Account**: Examine the AWS account to which the bucket was replicated. Determine whether this account is known and previously authorized to access such resources.\n- **Contextualize with Recent Changes**: Compare this sharing event against recent changes in S3 configurations. Look for any other recent permissions changes or unusual administrative actions.\n- **Correlate with Other Activities**: Search for related CloudTrail events before and after this change to see if the same actor or IP address engaged in other potentially suspicious activities.\n- **Interview Relevant Personnel**: If the share was initiated by a user, verify the intent and authorization for this action with the person or team responsible for managing DB backups and snapshots.\n\n### False Positive Analysis\n\n- **Legitimate Backup Actions**: Confirm if the S3 bucket replication aligns with scheduled backups or legitimate automation tasks.\n- **Consistency Check**: Compare the action against historical data of similar actions performed by the user or within the organization. If the action is consistent with past legitimate activities, it might indicate a false alarm.\n\n### Response and Remediation\n\n- **Immediate Review and Reversal**: If the change was unauthorized, update the S3 configurations to remove any unauthorized replication rules.\n- **Enhance Monitoring and Alerts**: Adjust monitoring systems to alert on similar actions, especially those involving sensitive data or permissions.\n- **Policy Update**: Review and possibly update your organization’s policies on S3 bucket/object sharing to tighten control and prevent unauthorized access.\n- **Incident Response**: If malicious intent is confirmed, consider it a data breach incident and initiate the incident response protocol. This includes further investigation, containment, and recovery.\n\n### Additional Information:\n\nFor further guidance on managing and securing S3 buckets in AWS environments, refer to the [AWS S3 documentation](https://docs.aws.amazon.com/AmazonS3/latest/userguide/security.html/) and AWS best practices for security.\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS S3",
          "Resources: Investigation Guide",
          "Use Case: Threat Detection",
          "Tactic: Exfiltration"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Bucket replication accross accounts is a legitimate practice in some AWS environments. Ensure that the sharing is authorized before taking action."
        ],
        "references": [
          "https://docs.aws.amazon.com/AmazonS3/latest/userguide/replication-walkthrough-2.html/",
          "https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketReplication.html/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": [
              {
                "id": "T1537",
                "name": "Transfer Data to Cloud Account",
                "reference": "https://attack.mitre.org/techniques/T1537/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "9437aa49-dc0c-492b-83e3-c6f387191cf9",
        "rule_id": "d488f026-7907-4f56-ad51-742feb3db01c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.426Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.426Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where event.dataset == \"aws.cloudtrail\" \n   and event.action == \"PutBucketReplication\"\n   and event.outcome == \"success\" \n   and stringContains(aws.cloudtrail.request_parameters, \"Account\")\n",
        "language": "eql",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ]
      },
      {
        "name": "Suspicious Windows Command Shell Arguments",
        "description": "Identifies the execution of the Windows Command Shell process (cmd.exe) with suspicious argument values. This behavior is often observed during malware installation.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 201,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: System",
          "Data Source: Sysmon",
          "Data Source: SentinelOne",
          "Data Source: Microsoft Defender for Endpoint"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.003",
                    "name": "Windows Command Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "3e723343-10de-4799-8f75-833b35155951",
        "rule_id": "d9ffc3d6-9de9-4b29-9395-5757d0695ecf",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.433Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.433Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and\n process.name : \"cmd.exe\" and \n (\n\n  process.command_line : (\"*).Run(*\", \"*GetObject*\", \"* curl*regsvr32*\", \"*echo*wscript*\", \"*echo*ZONE.identifier*\",\n  \"*ActiveXObject*\", \"*dir /s /b *echo*\", \"*unescape(*\",  \"*findstr*TVNDRgAAAA*\", \"*findstr*passw*\", \"*start*\\\\\\\\*\\\\DavWWWRoot\\\\*\",\n  \"* explorer*%CD%*\", \"*%cd%\\\\*.js*\", \"*attrib*%CD%*\", \"*/?cMD<*\", \"*/AutoIt3ExecuteScript*..*\", \"*&cls&cls&cls&cls&cls&*\",\n  \"*&#*;&#*;&#*;&#*;*\", \"* &&s^eT*\", \"*& ChrW(*\", \"*&explorer /root*\", \"*start __ & __\\\\*\", \"*findstr /V /L *forfiles*\",\n  \"*=wscri& set *\", \"*http*!COmpUternaME!*\", \"*start *.pdf * start /min cmd.exe /c *\\\\\\\\*\", \"*pip install*System.Net.WebClient*\",\n  \"*Invoke-WebReques*Start-Process*\", \"*-command (Invoke-webrequest*\", \"*copy /b *\\\\\\\\* ping *-n*\", \"*echo*.ToCharArray*\") or\n\n  (process.args : \"echo\" and process.parent.name : (\"wscript.exe\", \"mshta.exe\")) or\n\n  process.args : (\"1>?:\\\\*.vbs\", \"1>?:\\\\*.js\") or\n\n  (process.args : \"explorer.exe\" and process.args : \"type\" and process.args : \">\" and process.args : \"start\") or\n\n  (process.parent.name : \"explorer.exe\" and\n   process.command_line :\n           (\"*&&S^eT *\",\n            \"*&& set *&& set *&& set *&& set *&& set *&& call*\",\n            \"**\\\\u00??\\\\u00??\\\\u00??\\\\u00??\\\\u00??\\\\u00??\\\\u00??\\\\u00??*\")) or\n\n   (process.parent.name : \"explorer.exe\" and process.args : \"copy\" and process.args : \"&&\" and process.args : \"\\\\\\\\*@*\\\\*\")\n  ) and\n\n  /* false positives */\n  not (process.args : \"%TEMP%\\\\Spiceworks\\\\*\" and process.parent.name : \"wmiprvse.exe\") and\n  not process.parent.executable :\n                (\"?:\\\\Perl64\\\\bin\\\\perl.exe\",\n                 \"?:\\\\Program Files\\\\nodejs\\\\node.exe\",\n                 \"?:\\\\Program Files\\\\HP\\\\RS\\\\pgsql\\\\bin\\\\pg_dumpall.exe\",\n                 \"?:\\\\Program Files (x86)\\\\PRTG Network Monitor\\\\64 bit\\\\PRTG Server.exe\",\n                 \"?:\\\\Program Files (x86)\\\\Spiceworks\\\\bin\\\\spiceworks-finder.exe\",\n                 \"?:\\\\Program Files (x86)\\\\Zuercher Suite\\\\production\\\\leds\\\\leds.exe\",\n                 \"?:\\\\Program Files\\\\Tripwire\\\\Agent\\\\Plugins\\\\twexec\\\\twexec.exe\",\n                 \"D:\\\\Agents\\\\?\\\\_work\\\\_tasks\\\\*\\\\SonarScanner.MSBuild.exe\",\n                 \"?:\\\\Program Files\\\\Microsoft VS Code\\\\Code.exe\",\n                 \"?:\\\\programmiweb\\\\NetBeans-*\\\\netbeans\\\\bin\\\\netbeans64.exe\",\n                 \"?:\\\\Program Files (x86)\\\\Public Safety Suite Professional\\\\production\\\\leds\\\\leds.exe\",\n                 \"?:\\\\Program Files (x86)\\\\Tier2Tickets\\\\button_gui.exe\",\n                 \"?:\\\\Program Files\\\\NetBeans-*\\\\netbeans\\\\bin\\\\netbeans*.exe\",\n                 \"?:\\\\Program Files (x86)\\\\Public Safety Suite Professional\\\\production\\\\leds\\\\leds.exe\",\n                 \"?:\\\\Program Files (x86)\\\\Tier2Tickets\\\\button_gui.exe\",\n                 \"?:\\\\Program Files (x86)\\\\Helpdesk Button\\\\button_gui.exe\",\n                 \"?:\\\\VTSPortable\\\\VTS\\\\jre\\\\bin\\\\javaw.exe\",\n                 \"?:\\\\Program Files\\\\Bot Framework Composer\\\\Bot Framework Composer.exe\",\n                 \"?:\\\\Program Files\\\\KMSYS Worldwide\\\\eQuate\\\\*\\\\SessionMgr.exe\",\n                 \"?:\\\\Program Files (x86)\\\\Craneware\\\\Pricing Analyzer\\\\Craneware.Pricing.Shell.exe\",\n                 \"?:\\\\Program Files (x86)\\\\jumpcloud-agent-app\\\\jumpcloud-agent-app.exe\",\n                 \"?:\\\\Program Files\\\\PostgreSQL\\\\*\\\\bin\\\\pg_dumpall.exe\",\n                 \"?:\\\\Program Files (x86)\\\\Vim\\\\vim*\\\\vimrun.exe\") and\n  not (process.args :  \"?:\\\\Program Files\\\\Citrix\\\\Secure Access Client\\\\nsauto.exe\" and process.parent.name : \"userinit.exe\") and\n  not process.args :\n            (\"?:\\\\Program Files (x86)\\\\PCMatic\\\\PCPitstopScheduleService.exe\",\n             \"?:\\\\Program Files (x86)\\\\AllesTechnologyAgent\\\\*\",\n             \"https://auth.axis.com/oauth2/oauth-authorize*\") and\n  not process.command_line :\n               (\"\\\"cmd\\\" /c %NETBEANS_MAVEN_COMMAND_LINE%\",\n                \"?:\\\\Windows\\\\system32\\\\cmd.exe /q /d /s /c \\\"npm.cmd ^\\\"install^\\\" ^\\\"--no-bin-links^\\\" ^\\\"--production^\\\"\\\"\") and\n  not (process.name : \"cmd.exe\" and process.args : \"%TEMP%\\\\Spiceworks\\\\*\" and process.args : \"http*/dataloader/persist_netstat_data\") and \n  not (process.args == \"echo\" and process.args == \"GEQ\" and process.args == \"1073741824\")\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-windows.*",
          "logs-system.security*",
          "logs-windows.sysmon_operational-*",
          "logs-sentinel_one_cloud_funnel.*",
          "logs-m365_defender.event-*"
        ]
      },
      {
        "name": "Potential Windows Session Hijacking via CcmExec",
        "description": "This detection rule identifies when 'SCNotification.exe' loads an untrusted DLL, which is a potential indicator of an attacker attempt to hijack/impersonate a Windows user session.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://cloud.google.com/blog/topics/threat-intelligence/windows-session-hijacking-via-ccmexec",
          "https://mayfly277.github.io/posts/SCCM-LAB-part0x3/#impersonate-users---revshell-connected-users"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1574",
                "name": "Hijack Execution Flow",
                "reference": "https://attack.mitre.org/techniques/T1574/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "dll.Ext.relative_file_creation_time",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "dll.Ext.relative_file_name_modify_time",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "dll.code_signature.status",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "03752916-41bd-48a6-8ead-aa407032f81e",
        "rule_id": "e7357fec-6e9c-41b9-b93d-6e4fc40c7d47",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.439Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.439Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "library where host.os.type == \"windows\" and process.name : \"SCNotification.exe\" and\n  (dll.Ext.relative_file_creation_time < 86400 or dll.Ext.relative_file_name_modify_time <= 500) and dll.code_signature.status != \"trusted\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.library-*"
        ]
      },
      {
        "name": "Unusual Instance Metadata Service (IMDS) API Request",
        "description": "This rule identifies potentially malicious processes attempting to access the cloud service provider's instance metadata service (IMDS) API endpoint, which can be used to retrieve sensitive instance-specific information such as instance ID, public IP address, and even temporary security credentials if role's are assumed by that instance. The rule monitors for various tools and scripts like curl, wget, python, and perl that might be used to interact with the metadata API.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Tactic: Discovery",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://hackingthe.cloud/aws/general-knowledge/intro_metadata_service/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1552",
                "name": "Unsecured Credentials",
                "reference": "https://attack.mitre.org/techniques/T1552/",
                "subtechnique": [
                  {
                    "id": "T1552.005",
                    "name": "Cloud Instance Metadata API",
                    "reference": "https://attack.mitre.org/techniques/T1552/005/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1580",
                "name": "Cloud Infrastructure Discovery",
                "reference": "https://attack.mitre.org/techniques/T1580/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "destination.ip",
            "type": "ip",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.working_directory",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "9d76ca10-f99d-4ea9-87d5-24ecdba757ad",
        "rule_id": "ecc0cd54-608e-11ef-ab6d-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.446Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.446Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id,  process.parent.entity_id with maxspan=1s\n[process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and process.name : (\n    \"curl\", \"wget\", \"python*\", \"perl*\", \"php*\", \"ruby*\", \"lua*\", \"telnet\", \"pwsh\",\n    \"openssl\", \"nc\", \"ncat\", \"netcat\", \"awk\", \"gawk\", \"mawk\", \"nawk\", \"socat\", \"node\"\n    ) or process.executable : (\n      \"./*\", \"/tmp/*\", \"/var/tmp/*\", \"/var/www/*\", \"/dev/shm/*\", \"/etc/init.d/*\", \"/etc/rc*.d/*\",\n      \"/etc/cron*\", \"/etc/update-motd.d/*\", \"/boot/*\", \"/srv/*\", \"/run/*\", \"/etc/rc.local\"\n    ) or\n    process.command_line: \"*169.254.169.254*\" and\n    not (process.working_directory: (\n          \"/opt/rapid7*\",\n          \"/opt/nessus*\",\n          \"/snap/amazon-ssm-agent*\",\n          \"/var/snap/amazon-ssm-agent/*\",\n          \"/var/log/amazon/ssm/*\",\n          \"/srv/snp/docker/overlay2*\",\n          \"/opt/nessus_agent/var/nessus/*\") or\n        process.executable: (\n          \"/opt/rumble/bin/rumble-agent*\",\n          \"/opt/aws/inspector/bin/inspectorssmplugin\") or\n        process.parent.executable: (\n          \"/usr/bin/setup-policy-routes\",\n          \"/usr/share/ec2-instance-connect/*\",\n          \"/var/lib/amazon/ssm/*\")\n        )\n]\n[network where host.os.type == \"linux\"\n  and event.action == \"connection_attempted\"\n  and destination.ip == \"169.254.169.254\"]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Potential Container Escape via Modified notify_on_release File",
        "description": "This rule detects modification of the cgroup notify_on_release file from inside a container. When the notify_on_release flag is enabled (1) in a cgroup, then whenever the last task in the cgroup exits or attaches to another cgroup, the command specified in the release_agent file is run and invoked from the host. A privileged container with SYS_ADMIN capabilities, enables a threat actor to mount a cgroup directory and modify the notify_on_release flag in order to take advantage of this feature, which could be used for further privilege escalation and container escapes to the host machine.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Data Source: Elastic Defend for Containers",
          "Domain: Container",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://blog.trailofbits.com/2019/07/19/understanding-docker-container-escapes/",
          "https://sysdig.com/blog/detecting-mitigating-cve-2022-0492-sysdig/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1611",
                "name": "Escape to Host",
                "reference": "https://attack.mitre.org/techniques/T1611/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "cloud_defend",
            "version": "^1.0.5"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.module",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "128d4444-dbc0-4178-8171-ca60531e2d4a",
        "rule_id": "ef65e82c-d8b4-4895-9824-5f6bc6166804",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.456Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.456Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where event.module == \"cloud_defend\" and event.action == \"open\" and \nevent.type == \"change\" and file.name : \"notify_on_release\"\n",
        "language": "eql",
        "index": [
          "logs-cloud_defend*"
        ]
      },
      {
        "name": "Process Capability Set via setcap Utility",
        "description": "This rule detects the use of the setcap utility to set capabilities on a process. The setcap utility is used to set the capabilities of a binary to allow it to perform privileged operations without needing to run as root. This can be used by attackers to establish persistence by creating a backdoor, or escalate privileges by abusing a misconfiguration on a system.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Privilege Escalation",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": []
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows\nthe Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest to select \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "9bebb7a9-2db3-4622-9a52-17b4ac4b6ebe",
        "rule_id": "f18a474c-3632-427f-bcf5-363c994309ee",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.463Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.463Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and\nprocess.name == \"setcap\" and not (\n  process.parent.executable == null or\n  process.parent.executable : (\"/var/lib/dpkg/*\", \"/var/lib/docker/*\", \"/tmp/newroot/*\", \"/var/tmp/newroot/*\") or \n  process.parent.name in (\"jem\", \"vzctl\")\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process*",
          "endgame-*"
        ]
      },
      {
        "name": "Printer User (lp) Shell Execution",
        "description": "This detection rule addresses multiple vulnerabilities in the CUPS printing system, including CVE-2024-47176, CVE-2024-47076, CVE-2024-47175, and CVE-2024-47177. Specifically, this rule detects shell executions from the foomatic-rip parent process through the default printer user (lp). These flaws impact components like cups-browsed, libcupsfilters, libppd, and foomatic-rip, allowing remote unauthenticated attackers to manipulate IPP URLs or inject malicious data through crafted UDP packets or network spoofing. This can result in arbitrary command execution when a print job is initiated.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Printer User (lp) Shell Execution\n\nThis rule identifies potential exploitation attempts of several vulnerabilities in the CUPS printing system (CVE-2024-47176, CVE-2024-47076, CVE-2024-47175, CVE-2024-47177). These vulnerabilities allow attackers to send crafted IPP requests or manipulate UDP packets to execute arbitrary commands or modify printer configurations. Attackers can exploit these flaws to inject malicious data, leading to Remote Code Execution (RCE) on affected systems.\n\n#### Possible Investigation Steps\n\n- Investigate the incoming IPP requests or UDP packets targeting port 631.\n- Examine the printer configurations on the system to determine if any unauthorized printers or URLs have been added.\n- Investigate the process tree to check if any unexpected processes were triggered as a result of IPP activity. Review the executable files for legitimacy.\n- Check for additional alerts related to the compromised system or user within the last 48 hours.\n- Investigate network traffic logs for suspicious outbound connections to unrecognized domains or IP addresses.\n- Check if any of the contacted domains or addresses are newly registered or have a suspicious reputation.\n- Retrieve any scripts or executables dropped by the attack for further analysis in a private sandbox environment:\n- Analyze potential malicious activity, including:\n  - Attempts to communicate with external servers.\n  - File access or creation of unauthorized executables.\n  - Cron jobs, services, or other persistence mechanisms.\n\n### Related Rules\n- Cupsd or Foomatic-rip Shell Execution - 476267ff-e44f-476e-99c1-04c78cb3769d\n- Network Connection by Cups or Foomatic-rip Child - e80ee207-9505-49ab-8ca8-bc57d80e2cab\n- File Creation by Cups or Foomatic-rip Child - b9b14be7-b7f4-4367-9934-81f07d2f63c4\n- Suspicious Execution from Foomatic-rip or Cupsd Parent - 986361cd-3dac-47fe-afa1-5c5dd89f2fb4\n\n### False Positive Analysis\n\n- This activity is rarely legitimate. However, verify the context to rule out non-malicious printer configuration changes or legitimate IPP requests.\n\n### Response and Remediation\n\n- Initiate the incident response process based on the triage outcome.\n- Isolate the compromised host to prevent further exploitation.\n- If the investigation confirms malicious activity, search the environment for additional compromised hosts.\n- Implement network segmentation or restrictions to contain the attack.\n- Stop suspicious processes or services tied to CUPS exploitation.\n- Block identified Indicators of Compromise (IoCs), including IP addresses, domains, or hashes of involved files.\n- Review compromised systems for backdoors, such as reverse shells or persistence mechanisms like cron jobs.\n- Investigate potential credential exposure on compromised systems and reset passwords for any affected accounts.\n- Restore the original printer configurations or uninstall unauthorized printer entries.\n- Perform a thorough antimalware scan to identify any lingering threats or artifacts from the attack.\n- Investigate how the attacker gained initial access and address any weaknesses to prevent future exploitation.\n- Use insights from the incident to improve detection and response times in future incidents (MTTD and MTTR).\n",
        "output_index": "",
        "version": 2,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Use Case: Vulnerability",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/cups-overflow",
          "https://www.evilsocket.net/2024/09/26/Attacking-UNIX-systems-via-CUPS-Part-I/",
          "https://gist.github.com/stong/c8847ef27910ae344a7b5408d9840ee1",
          "https://github.com/RickdeJager/cupshax/blob/main/cupshax.py"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1203",
                "name": "Exploitation for Client Execution",
                "reference": "https://attack.mitre.org/techniques/T1203/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "4f38cd04-a3b7-4c47-b22d-c67aacb63b39",
        "rule_id": "f86cd31c-5c7e-4481-99d7-6875a3e31309",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.469Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.469Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and user.name == \"lp\" and\nprocess.parent.name in (\"cupsd\", \"foomatic-rip\", \"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") and\nprocess.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") and not (\n  process.command_line like (\n    \"*/tmp/foomatic-*\", \"*-sDEVICE=ps2write*\", \"*printf*\", \"/bin/sh -e -c cat\", \"/bin/bash -c cat\",\n    \"/bin/bash -e -c cat\"\n  ) or\n  process.args like \"gs*\"\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "User Added to the Admin Group",
        "description": "Identifies users being added to the admin group. This could be an indication of privilege escalation activity.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\nTo thoroughly investigate the actions that occurred **after a user was elevated to administrator**, it's essential to conduct a search on the Timeline. This allows you to review and understand the sequence of events that followed the elevation, helping to identify any potentially malicious or unauthorized activities that might have taken place. **Analyzing these actions is crucial for maintaining security and ensuring that the elevation was not exploited for harmful purposes.**\n\n> **Note**:\n> This investigation guide uses the [Investigate Markdown Plugin](https://www.elastic.co/guide/en/security/master/interactive-investigation-guides.html) introduced in Elastic Stack version 8.8.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n\n**Consider reviewing these actions:**\n\n- Have persistency items been added?\n- Is any software installed after elevation?\n- Were any additional users created after elevation?\n\n!{investigate{\"label\":\"Show events after Privilege Escalation\",\"providers\":[[{\"excluded\":false,\"field\":\"host.hostname\",\"queryType\":\"phrase\",\"value\":\"{{host.hostname}}\",\"valueType\":\"string\"}]],\"relativeFrom\":\"now\",\"relativeTo\":\"now+30m\"}}\n!{investigate{\"label\":\"Show events having the same reponsible process\",\"providers\":[[{\"excluded\":false,\"field\":\"host.hostname\",\"queryType\":\"phrase\",\"value\":\"{{host.hostname}}\",\"valueType\":\"string\"},{\"excluded\":false,\"field\":\"process.entity_id\",\"queryType\":\"phrase\",\"value\":\"{{process.group_leader.entity_id}}\",\"valueType\":\"string\"}]]}}\n!{investigate{\"label\":\"Show events having the same parent process\",\"providers\":[[{\"excluded\":false,\"field\":\"host.hostname\",\"queryType\":\"phrase\",\"value\":\"{{host.hostname}}\",\"valueType\":\"string\"},{\"excluded\":false,\"field\":\"process.entity_id\",\"queryType\":\"phrase\",\"value\":\"{{process.parent.entity_id}}\",\"valueType\":\"string\"}]]}}\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: macOS",
          "Use Case: Threat Detection",
          "Tactic: Privilege Escalation",
          "Data Source: Jamf Protect"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Thijs Xhaflaire"
        ],
        "false_positives": [],
        "references": [
          "https://www.loobins.io/binaries/dscl/",
          "https://managingosx.wordpress.com/2010/01/14/add-a-user-to-the-admin-group-via-command-line-3-0/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1078",
                "name": "Valid Accounts",
                "reference": "https://attack.mitre.org/techniques/T1078/",
                "subtechnique": [
                  {
                    "id": "T1078.003",
                    "name": "Local Accounts",
                    "reference": "https://attack.mitre.org/techniques/T1078/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Jamf Protect.\n\n### Jamf Protect Integration Setup\nJamf Protect is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events incoming events and send data to the Elastic.\n\n#### Prerequisite Requirements:\n- Fleet is required for Jamf Protect.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Jamf Protect integration:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Jamf Protect\" and select the integration to see more details about it.\n- Click \"Add Jamf Protect\".\n- Configure the integration name.\n- Click \"Save and Continue\".\n",
        "related_integrations": [
          {
            "package": "jamf_protect",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "group.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "927d6647-6f9a-47af-a11f-34ea43c4476d",
        "rule_id": "04e65517-16e9-4fc4-b7f1-94dc21ecea0d",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.476Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.476Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "configuration where host.os.type == \"macos\" and event.type == \"change\" and\n  event.action == \"od_group_add\" and group.name:\"admin\"\n",
        "language": "eql",
        "index": [
          "logs-jamf_protect*"
        ]
      },
      {
        "name": "Potential Hex Payload Execution",
        "description": "This rule detects potential hex payload execution on Linux systems. Adversaries may use hex encoding to obfuscate payloads and evade detection mechanisms.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1027",
                "name": "Obfuscated Files or Information",
                "reference": "https://attack.mitre.org/techniques/T1027/"
              },
              {
                "id": "T1140",
                "name": "Deobfuscate/Decode Files or Information",
                "reference": "https://attack.mitre.org/techniques/T1140/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              },
              {
                "id": "T1204",
                "name": "User Execution",
                "reference": "https://attack.mitre.org/techniques/T1204/",
                "subtechnique": [
                  {
                    "id": "T1204.002",
                    "name": "Malicious File",
                    "reference": "https://attack.mitre.org/techniques/T1204/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "b7d29ea2-52f8-493d-87ba-23c07b7ef669",
        "rule_id": "0c1e8fda-4f09-451e-bc77-a192b6cbfc32",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.482Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.482Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and (\n  (process.name == \"xxd\" and process.args like (\"-r*\", \"-p*\")) or\n  (process.name like \"python*\" and process.command_line like \"*fromhex*\" and process.command_line like (\"*decode*\", \"*encode*\")) or\n  (process.name like \"php*\" and process.command_line like \"*hex2bin*\") or\n  (process.name like \"ruby*\" and process.command_line like \"*].pack(\\\"H*\\\")*\") or\n  (process.name like \"perl*\" and process.command_line like \"*pack(\\\"H*\\\",*\") or\n  (process.name like \"lua*\" and process.command_line like \"*tonumber(cc, 16)*\")\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process*"
        ]
      },
      {
        "name": "Unusual High Denied Sensitive Information Policy Blocks Detected",
        "description": "Detects repeated compliance violation 'BLOCKED' actions coupled with specific policy name such as 'sensitive_information_policy', indicating persistent misuse or attempts to probe the model's denied topics.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Amazon Bedrock Guardrail High Sensitive Information Policy Blocks.\n\nAmazon Bedrock Guardrail is a set of features within Amazon Bedrock designed to help businesses apply robust safety and privacy controls to their generative AI applications.\n\nIt enables users to set guidelines and filters that manage content quality, relevancy, and adherence to responsible AI practices.\n\nThrough Guardrail, organizations can define \"sensitive information filters\" to prevent the model from generating content on specific, undesired subjects,\nand they can establish thresholds for harmful content categories.\n\n#### Possible investigation steps\n\n- Identify the user account that queried sensitive information and whether it should perform this kind of action.\n- Investigate other alerts associated with the user account during the past 48 hours.\n- Consider the time of day. If the user is a human (not a program or script), did the activity take place during a normal time of day?\n- Examine the account's prompts and responses in the last 24 hours.\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking Amazon Bedrock model access, prompts generated, and responses to the prompts by the account in the last 24 hours.\n\n### False positive analysis\n\n- Verify the user account that queried denied topics, is not testing any new model deployments or updated compliance policies in Amazon Bedrock guardrails.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Identify if the attacker is moving laterally and compromising other Amazon Bedrock Services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Review the permissions assigned to the implicated user group or role behind these requests to ensure they are authorized and expected to access bedrock and ensure that the least privilege principle is being followed.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: LLM",
          "Data Source: AWS Bedrock",
          "Data Source: AWS S3",
          "Use Case: Policy Violation",
          "Mitre Atlas: T0051",
          "Mitre Atlas: T0054"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "New model deployments.",
          "Testing updates to compliance policies."
        ],
        "references": [
          "https://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-components.html",
          "https://atlas.mitre.org/techniques/AML.T0051",
          "https://atlas.mitre.org/techniques/AML.T0054",
          "https://www.elastic.co/security-labs/elastic-advances-llm-security"
        ],
        "max_signals": 100,
        "threat": [],
        "setup": "## Setup\n\nThis rule requires that guardrails are configured in AWS Bedrock. For more information, see the AWS Bedrock documentation:\n\nhttps://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-create.html\n",
        "related_integrations": [],
        "required_fields": [],
        "id": "7bc75dff-5150-49c1-9e08-13a3f827c364",
        "rule_id": "0e1af929-42ed-4262-a846-55a7c54e7c84",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.492Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.492Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws_bedrock.invocation-*\n| MV_EXPAND gen_ai.policy.name \n| where gen_ai.policy.action == \"BLOCKED\" and gen_ai.compliance.violation_detected == \"true\" and gen_ai.policy.name == \"sensitive_information_policy\"\n| keep user.id\n| stats sensitive_information_block = count() by user.id\n| where sensitive_information_block > 5\n| sort sensitive_information_block desc\n"
      },
      {
        "name": "Persistence via a Windows Installer",
        "description": "Identifies when the Windows installer process msiexec.exe creates a new persistence entry via scheduled tasks or startup.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate scheduled tasks may be created during installation of new software."
        ],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1053",
                "name": "Scheduled Task/Job",
                "reference": "https://attack.mitre.org/techniques/T1053/",
                "subtechnique": [
                  {
                    "id": "T1053.005",
                    "name": "Scheduled Task",
                    "reference": "https://attack.mitre.org/techniques/T1053/005/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1218",
                "name": "System Binary Proxy Execution",
                "reference": "https://attack.mitre.org/techniques/T1218/",
                "subtechnique": [
                  {
                    "id": "T1218.007",
                    "name": "Msiexec",
                    "reference": "https://attack.mitre.org/techniques/T1218/007/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "Effective_process.name",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "registry.path",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "78553783-e3b8-41d4-88ce-6760e6614131",
        "rule_id": "1719ee47-89b8-4407-9d55-6dff2629dd4c",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.499Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.499Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where host.os.type == \"windows\" and \n (process.name : \"msiexec.exe\" or Effective_process.name : \"msiexec.exe\") and\n (\n  (event.category == \"file\" and event.action == \"creation\" and\n   file.path : (\"?:\\\\Windows\\\\System32\\\\Tasks\\\\*\",\n                \"?:\\\\programdata\\\\microsoft\\\\windows\\\\start menu\\\\programs\\\\startup\\\\*\",\n                \"?:\\\\Users\\\\*\\\\AppData\\\\Roaming\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\*\")) or\n\n  (event.category == \"registry\" and event.action == \"modification\" and\n   registry.path : (\"H*\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\*\",\n                    \"H*\\\\Software\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\*\",\n                    \"H*\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\Run\\\\*\",\n                    \"H*\\\\Software\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\Run\\\\*\"))\n  )\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.registry-*",
          "logs-endpoint.events.file-*"
        ]
      },
      {
        "name": "Unusual High Denied Topic Blocks Detected",
        "description": "Detects repeated compliance violation 'BLOCKED' actions coupled with specific policy name such as 'topic_policy', indicating persistent misuse or attempts to probe the model's denied topics.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Amazon Bedrock Guardrail High Denied Topic Blocks.\n\nAmazon Bedrock Guardrail is a set of features within Amazon Bedrock designed to help businesses apply robust safety and privacy controls to their generative AI applications.\n\nIt enables users to set guidelines and filters that manage content quality, relevancy, and adherence to responsible AI practices.\n\nThrough Guardrail, organizations can define \"denied topics\" to prevent the model from generating content on specific, undesired subjects,\nand they can establish thresholds for harmful content categories, including hate speech, violence, or offensive language.\n\n#### Possible investigation steps\n\n- Identify the user account that queried denied topics and whether it should perform this kind of action.\n- Investigate other alerts associated with the user account during the past 48 hours.\n- Consider the time of day. If the user is a human (not a program or script), did the activity take place during a normal time of day?\n- Examine the account's prompts and responses in the last 24 hours.\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking Amazon Bedrock model access, prompts generated, and responses to the prompts by the account in the last 24 hours.\n\n### False positive analysis\n\n- Verify the user account that queried denied topics, is not testing any new model deployments or updated compliance policies in Amazon Bedrock guardrails.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Identify if the attacker is moving laterally and compromising other Amazon Bedrock Services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Review the permissions assigned to the implicated user group or role behind these requests to ensure they are authorized and expected to access bedrock and ensure that the least privilege principle is being followed.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: LLM",
          "Data Source: AWS Bedrock",
          "Data Source: AWS S3",
          "Use Case: Policy Violation",
          "Mitre Atlas: T0051",
          "Mitre Atlas: T0054"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "New model deployments.",
          "Testing updates to compliance policies."
        ],
        "references": [
          "https://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-components.html",
          "https://atlas.mitre.org/techniques/AML.T0051",
          "https://atlas.mitre.org/techniques/AML.T0054",
          "https://www.elastic.co/security-labs/elastic-advances-llm-security"
        ],
        "max_signals": 100,
        "threat": [],
        "setup": "## Setup\n\nThis rule requires that guardrails are configured in AWS Bedrock. For more information, see the AWS Bedrock documentation:\n\nhttps://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-create.html\n",
        "related_integrations": [],
        "required_fields": [],
        "id": "45d61f5b-e359-4d0c-b4b7-72810aaf96ea",
        "rule_id": "266bbea8-fcf9-4b0e-ba7b-fc00f6b1dc73",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.506Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.506Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws_bedrock.invocation-*\n| MV_EXPAND gen_ai.policy.name \n| where gen_ai.policy.action == \"BLOCKED\" and gen_ai.compliance.violation_detected == \"true\" and gen_ai.policy.name == \"topic_policy\"\n| keep user.id\n| stats denied_topics = count() by user.id\n| where denied_topics > 5\n| sort denied_topics desc\n"
      },
      {
        "name": "Potential Defense Evasion via Doas",
        "description": "This rule detects the creation or rename of the Doas configuration file on a Linux system. Adversaries may create or modify the Doas configuration file to elevate privileges and execute commands as other users while attempting to evade detection.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://wiki.archlinux.org/title/Doas"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1548",
                "name": "Abuse Elevation Control Mechanism",
                "reference": "https://attack.mitre.org/techniques/T1548/",
                "subtechnique": [
                  {
                    "id": "T1548.003",
                    "name": "Sudo and Sudo Caching",
                    "reference": "https://attack.mitre.org/techniques/T1548/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "9c599b52-1ba9-4103-8c54-4f124677a7a6",
        "rule_id": "26a726d7-126e-4267-b43d-e9a70bfdee1e",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.512Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.512Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.type != \"deletion\" and file.path == \"/etc/doas.conf\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*",
          "endgame-*"
        ]
      },
      {
        "name": "AWS STS Role Assumption by User",
        "description": "Identifies when a user or role has assumed a role in AWS Security Token Service (STS). Users can assume a role to obtain temporary credentials and access AWS resources. Adversaries can use this technique for credential access and privilege escalation. This is a [New Terms](https://www.elastic.co/guide/en/security/current/rules-ui-create.html#create-new-terms-rule) rule that identifies when a service assumes a role in AWS Security Token Service (STS) to obtain temporary credentials and access AWS resources. While often legitimate, adversaries may use this technique for unauthorized access, privilege escalation, or lateral movement within an AWS environment.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS STS Role Assumption by User\n\nThis rule detects when a user assumes a role in AWS Security Token Service (STS), receiving temporary credentials to access AWS resources. While often used for legitimate purposes, this action can be leveraged by adversaries to obtain unauthorized access, escalate privileges, or move laterally within an AWS environment.\n\n#### Possible Investigation Steps\n\n- **Identify the User and Assumed Role**:\n  - **User Identity**: Check `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.type` for details about the initiator of the `AssumeRole` action.\n  - **Role Assumed**: Review `aws.cloudtrail.flattened.request_parameters.roleArn` to confirm the role assumed and ensure it aligns with the user’s standard permissions.\n  - **Session Name**: Note `aws.cloudtrail.flattened.request_parameters.roleSessionName` for context on the purpose of the session.\n\n- **Evaluate Session Context and Credential Duration**:\n  - **Session Details**: Look into `aws.cloudtrail.user_identity.session_context.creation_date` for the start of the session and `aws.cloudtrail.user_identity.session_context.mfa_authenticated` to check for MFA usage.\n  - **Credential Validity**: Examine `aws.cloudtrail.flattened.request_parameters.durationSeconds` for how long the credentials are valid.\n  - **Expiration Time**: Use `aws.cloudtrail.flattened.response_elements.credentials.expiration` to confirm the credential expiration.\n\n- **Inspect User Agent and Source Information**:\n  - **User Agent**: Analyze the `user_agent.original` field to identify if specific tooling or SDKs like AWS CLI, Boto3, or custom agents were used.\n  - **Source IP and Geolocation**: Examine `source.address` and `source.geo` fields to determine the origin of the request, confirming if it aligns with expected locations.\n\n- **Correlate with Related Events**:\n  - **Identify Patterns**: Review related CloudTrail events for unusual access patterns, such as resource access or sensitive actions following this `AssumeRole` action.\n  - **Filter High-Volume Roles**: If this role or user has a high volume of access, evaluate `roleArn` or `user_agent` values for common patterns and add trusted entities as exceptions.\n\n- **Review the Privileges of the Assumed Role**:\n  - **Permissions**: Examine permissions associated with the `roleArn` to assess its access scope.\n  - **Authorized Usage**: Confirm if the role is used frequently for administrative purposes and if this aligns with the user’s regular responsibilities.\n\n### False Positive Analysis\n\n- **Automated Processes and Applications**: Applications or scheduled tasks may assume roles regularly for operational purposes. Validate the consistency of the `user_agent` or `roleArn` with known automated workflows.\n- **Standard IAM Policy Usage**: Confirm if the user or application routinely assumes this specific role for normal operations by reviewing historical activity.\n\n### Response and Remediation\n\n- **Terminate Unauthorized Sessions**: If the role assumption is deemed unauthorized, revoke the session by modifying IAM policies or the permissions associated with the assumed role.\n- **Strengthen Monitoring and Alerts**: Implement additional monitoring for specific high-risk roles, especially those with elevated permissions.\n- **Regularly Manage Exceptions**: Regularly review high-volume roles and user agent patterns to refine alerts, minimizing noise by adding trusted patterns as exceptions.\n- **Incident Response**: If confirmed as malicious, follow incident response protocols for containment, investigation, and remediation.\n\n### Additional Information\n\nFor more details on managing and securing AWS STS in your environment, refer to the [AWS STS documentation](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html).\n",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "@timestamp",
            "user.name",
            "user_agent.original",
            "source.address",
            "aws.cloudtrail.user_identity.arn",
            "aws.cloudtrail.user_identity.type",
            "aws.cloudtrail.resources.arn",
            "aws.cloudtrail.resources.type",
            "aws.cloudtrail.flattened.request_parameters.roleArn",
            "aws.cloudtrail.flattened.request_parameters.roleSessionName",
            "event.action",
            "event.outcome",
            "cloud.region",
            "aws.cloudtrail.request_parameters",
            "aws.cloudtrail.response_elements"
          ]
        },
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS STS",
          "Resources: Investigation Guide",
          "Use Case: Identity and Access Audit",
          "Tactic: Privilege Escalation"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "AWS administrators or automated processes might regularly assume roles for legitimate administrative purposes.",
          "Applications integrated with AWS might assume roles to access AWS resources.",
          "Automated workflows might assume roles to perform periodic tasks such as data backups, updates, or deployments."
        ],
        "references": [
          "https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1548",
                "name": "Abuse Elevation Control Mechanism",
                "reference": "https://attack.mitre.org/techniques/T1548/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1550",
                "name": "Use Alternate Authentication Material",
                "reference": "https://attack.mitre.org/techniques/T1550/",
                "subtechnique": [
                  {
                    "id": "T1550.001",
                    "name": "Application Access Token",
                    "reference": "https://attack.mitre.org/techniques/T1550/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.user_identity.type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "eb227a5f-ff5b-40f6-862c-076b161ed747",
        "rule_id": "288a198e-9b9b-11ef-a0a8-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.519Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.519Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset: \"aws.cloudtrail\"\n    and event.provider: \"sts.amazonaws.com\"\n    and event.action: \"AssumeRole\"\n    and event.outcome: \"success\"\n    and aws.cloudtrail.user_identity.type: (\"AssumedRole\" or \"IAMUser\")\n",
        "new_terms_fields": [
          "user.name",
          "aws.cloudtrail.flattened.request_parameters.roleArn"
        ],
        "history_window_start": "now-10d",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "language": "kuery"
      },
      {
        "name": "Unusual High Word Policy Blocks Detected",
        "description": "Detects repeated compliance violation 'BLOCKED' actions coupled with specific policy name such as 'word_policy', indicating persistent misuse or attempts to probe the model's denied topics.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Amazon Bedrock Guardrail High Word Policy Blocks.\n\nAmazon Bedrock Guardrail is a set of features within Amazon Bedrock designed to help businesses apply robust safety and privacy controls to their generative AI applications.\n\nIt enables users to set guidelines and filters that manage content quality, relevancy, and adherence to responsible AI practices.\n\nThrough Guardrail, organizations can define \"word filters\" to prevent the model from generating content on profanity, undesired subjects,\nand they can establish thresholds for harmful content categories, including hate speech, violence, or offensive language.\n\n#### Possible investigation steps\n\n- Identify the user account whose prompts contained profanity and whether it should perform this kind of action.\n- Investigate other alerts associated with the user account during the past 48 hours.\n- Consider the time of day. If the user is a human (not a program or script), did the activity take place during a normal time of day?\n- Examine the account's prompts and responses in the last 24 hours.\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking Amazon Bedrock model access, prompts generated, and responses to the prompts by the account in the last 24 hours.\n\n### False positive analysis\n\n- Verify the user account that queried denied topics, is not testing any new model deployments or updated compliance policies in Amazon Bedrock guardrails.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Identify if the attacker is moving laterally and compromising other Amazon Bedrock Services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Review the permissions assigned to the implicated user group or role behind these requests to ensure they are authorized and expected to access bedrock and ensure that the least privilege principle is being followed.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: LLM",
          "Data Source: AWS Bedrock",
          "Data Source: AWS S3",
          "Use Case: Policy Violation",
          "Mitre Atlas: T0051",
          "Mitre Atlas: T0054"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "New model deployments.",
          "Testing updates to compliance policies."
        ],
        "references": [
          "https://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-components.html",
          "https://atlas.mitre.org/techniques/AML.T0051",
          "https://atlas.mitre.org/techniques/AML.T0054",
          "https://www.elastic.co/security-labs/elastic-advances-llm-security"
        ],
        "max_signals": 100,
        "threat": [],
        "setup": "## Setup\n\nThis rule requires that guardrails are configured in AWS Bedrock. For more information, see the AWS Bedrock documentation:\n\nhttps://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-create.html\n",
        "related_integrations": [],
        "required_fields": [],
        "id": "45a3220c-85e0-4901-b5c9-a40b80e72b9c",
        "rule_id": "3216949c-9300-4c53-b57a-221e364c6457",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.525Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.525Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws_bedrock.invocation-*\n| MV_EXPAND gen_ai.policy.name \n| where gen_ai.policy.action == \"BLOCKED\" and gen_ai.compliance.violation_detected == \"true\" and gen_ai.policy.name == \"word_policy\"\n| keep user.id\n| stats profanity_words= count() by user.id\n| where profanity_words > 5\n| sort profanity_words desc\n"
      },
      {
        "name": "Directory Creation in /bin directory",
        "description": "This rule identifies the creation of directories in the /bin directory. The /bin directory contains essential binary files that are required for the system to function properly. The creation of directories in this location could be an attempt to hide malicious files or executables, as these /bin directories usually just contain binaries.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Tactic: Persistence",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1564",
                "name": "Hide Artifacts",
                "reference": "https://attack.mitre.org/techniques/T1564/",
                "subtechnique": [
                  {
                    "id": "T1564.001",
                    "name": "Hidden Files and Directories",
                    "reference": "https://attack.mitre.org/techniques/T1564/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "ca6d6aa3-2e67-4fc5-ba2f-d39677e74c3a",
        "rule_id": "3302835b-0049-4004-a325-660b1fba1f67",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.535Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.535Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and process.name == \"mkdir\" and\nprocess.args like (\"/bin/*\", \"/usr/bin/*\", \"/usr/local/bin/*\", \"/sbin/*\", \"/usr/sbin/*\", \"/usr/local/sbin/*\") and\nnot process.args in (\"/bin/mkdir\", \"/usr/bin/mkdir\", \"/usr/local/bin/mkdir\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "AWS CLI Command with Custom Endpoint URL",
        "description": "Detects the use of the AWS CLI with the `--endpoint-url` argument, which allows users to specify a custom endpoint URL for AWS services. This can be leveraged by adversaries to redirect API requests to non-standard or malicious endpoints, potentially bypassing typical security controls and logging mechanisms. This behavior may indicate an attempt to interact with unauthorized or compromised infrastructure, exfiltrate data, or perform other malicious activities under the guise of legitimate AWS operations.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Data Source: Elastic Defend",
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Command and Control"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://sysdig.com/blog/scarleteel-2-0/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1102",
                "name": "Web Service",
                "reference": "https://attack.mitre.org/techniques/T1102/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a331331c-5446-41d0-91ec-35356a1a1cd1",
        "rule_id": "349276c0-5fcf-11ef-b1a9-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.542Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.542Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "host.os.type: \"linux\" and event.category: \"process\" and process.name: \"aws\" and process.args:  \"--endpoint-url\"\n",
        "new_terms_fields": [
          "user.name"
        ],
        "history_window_start": "now-10d",
        "index": [
          "logs-endpoint.events.process-*"
        ],
        "language": "kuery"
      },
      {
        "name": "AWS SNS Email Subscription by Rare User",
        "description": "Identifies when an SNS topic is subscribed to by an email address of a user who does not typically perform this action. Adversaries may subscribe to an SNS topic to collect sensitive information or exfiltrate data via an external email address.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS SNS Email Subscription by Rare User\n\nThis rule identifies when an SNS topic is subscribed to by an email address of a user who does not typically perform this action. While subscribing to SNS topics is a common practice, adversaries may exploit this feature to collect sensitive information or exfiltrate data via an external email address.\n\n#### Possible Investigation Steps\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` field to identify the user who requested the subscription. Verify if this actor typically performs such actions and has the necessary permissions. It may be unusual for this activity to originate from certain user types, such as an assumed role or federated user.\n- **Review the SNS Subscription Event**: Analyze the specifics of the `Subscribe` action in CloudTrail logs:\n  - **Topic**: Look at the `aws.cloudtrail.request_parameters.topicArn` field to identify the SNS topic involved in the subscription.\n  - **Protocol and Endpoint**: Review the `aws.cloudtrail.request_parameters.protocol` and `aws.cloudtrail.request_parameters.endpoint` fields to confirm the subscription's protocol and email address. Confirm if this endpoint is associated with a known or trusted entity.\n  - **Subscription Status**: Check the `aws.cloudtrail.response_elements.subscriptionArn` field for the subscription's current status, noting if it requires confirmation.\n- **Verify Authorization**: Evaluate whether the user typically engages in SNS subscription actions and if they are authorized to do so for the specified topic.\n- **Contextualize with Related Events**: Review related CloudTrail logs around the event time for other actions by the same user or IP address. Look for activities involving other AWS services, such as S3 or IAM, that may indicate further suspicious behavior.\n- **Evaluate the Subscription Endpoint**: Determine whether the email endpoint is legitimate or associated with any known entity. This may require checking internal documentation or reaching out to relevant AWS account administrators.\n- **Check for Publish Actions**: Investigate for any subsequent `Publish` actions on the same SNS topic that may indicate exfiltration attempts or data leakage. If Publish actions are detected, further investigate the contents of the messages.\n- **Review IAM Policies**: Examine the user or role's IAM policies to ensure that the subscription action is within the scope of their permissions or should be.\n\n### False Positive Analysis\n\n- **Historical User Actions**: Verify if the user has a history of performing similar actions on SNS topics. Consistent, repetitive actions may suggest legitimate usage.\n- **Scheduled or Automated Tasks**: Confirm if the subscription action aligns with scheduled tasks or automated notifications authorized by your organization.\n\n### Response and Remediation\n\n- **Immediate Review and Reversal**: If the subscription was unauthorized, take appropriate action to cancel it and adjust SNS permissions as necessary.\n- **Strengthen Monitoring and Alerts**: Configure monitoring systems to flag similar actions involving sensitive topics or unapproved endpoints.\n- **Policy Review**: Review and update policies related to SNS subscriptions and access, tightening control as needed to prevent unauthorized subscriptions.\n- **Incident Response**: If there is evidence of malicious intent, treat the event as a potential data exfiltration incident and follow incident response protocols, including further investigation, containment, and recovery.\n\n### Additional Information\n\nFor further guidance on managing and securing SNS topics in AWS environments, refer to the [AWS SNS documentation](https://docs.aws.amazon.com/sns/latest/dg/welcome.html) and AWS best practices for security.\n\n",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "@timestamp",
            "user.name",
            "source.address",
            "aws.cloudtrail.user_identity.arn",
            "aws.cloudtrail.user_identity.type",
            "user_agent.original",
            "event.action",
            "event.outcome",
            "cloud.region",
            "aws.cloudtrail.flattened.request_parameters.protocol",
            "aws.cloudtrail.flattened.request_parameters.topicArn",
            "aws.cloudtrail.flattened.response_elements.subscriptionArn",
            "aws.cloudtrail.request_parameters"
          ]
        },
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS SNS",
          "Resources: Investigation Guide",
          "Use Case: Threat Detection",
          "Tactic: Exfiltration"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate users may subscribe to SNS topics for legitimate purposes. Ensure that the subscription is authorized and the subscription email address is known before taking action."
        ],
        "references": [
          "https://docs.aws.amazon.com/sns/latest/api/API_Subscribe.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": [
              {
                "id": "T1567",
                "name": "Exfiltration Over Web Service",
                "reference": "https://attack.mitre.org/techniques/T1567/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.request_parameters",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d37108fb-0a3f-4e84-9829-e3fa44d0c544",
        "rule_id": "3df49ff6-985d-11ef-88a1-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.549Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.549Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset: \"aws.cloudtrail\"\n    and event.provider: \"sns.amazonaws.com\"\n    and event.action: \"Subscribe\"\n    and aws.cloudtrail.request_parameters: *protocol=email*\n",
        "new_terms_fields": [
          "aws.cloudtrail.user_identity.arn"
        ],
        "history_window_start": "now-14d",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "language": "kuery"
      },
      {
        "name": "AWS SSM Command Document Created by Rare User",
        "description": "Identifies when an AWS Systems Manager (SSM) command document is created by a user who does not typically perform this action. Adversaries may create SSM command documents to execute commands on managed instances, potentially leading to unauthorized access, command and control, data exfiltration and more.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS SSM Command Document Created by Rare User\n\nThis rule identifies when an AWS Systems Manager (SSM) command document is created by a user who does not typically perform this action. Creating SSM command documents can be a legitimate action but may also indicate malicious intent if done by an unusual or compromised user. Adversaries may leverage SSM documents to execute commands on managed instances, potentially leading to unauthorized access, command and control, or data exfiltration.\n\n#### Possible Investigation Steps\n\n- **Identify the Actor**: Review the `aws.cloudtrail.user_identity.arn` field to identify who created the SSM document. Verify if this user typically creates such documents and has the appropriate permissions. It may be unexpected for certain types of users, like assumed roles or federated users, to perform this action.\n- **Analyze the Document Details**:\n  - **Document Name**: Check the `aws.cloudtrail.request_parameters.name` field for the document name to understand its intended purpose.\n  - **Document Content**: If possible, review `aws.cloudtrail.request_parameters.content` for any sensitive or unexpected instructions (e.g., actions for data exfiltration or privilege escalation). If not available via logs, consider reviewing the document in the AWS Management Console.\n- **Contextualize the Activity with Related Events**: Look for other CloudTrail events involving the same user ARN or IP address (`source.address`). Examine actions performed in other AWS services, such as IAM, EC2, or S3, to identify if additional suspicious behavior exists. The `SendCommand` API call may indicate attempts to execute the SSM document on managed instances.\n- **Check Document Status and Metadata**:\n  - **Document Status**: Confirm the document creation status in `aws.cloudtrail.response_elements.documentDescription.status`. A status of `Creating` may indicate that the document is in progress.\n  - **Execution Permissions**: Review if the document specifies `platformTypes` and `documentVersion` in `aws.cloudtrail.response_elements.documentDescription` to understand which environments may be impacted and if multiple versions exist.\n\n### False Positive Analysis\n\n- **Authorized Administrative Actions**: Determine if this document creation aligns with scheduled administrative tasks or actions by authorized personnel.\n- **Historical User Actions**: Compare this action against historical activities for the user to determine if they have a history of creating similar documents, which may indicate legitimate usage.\n\n### Response and Remediation\n\n- **Immediate Document Review and Deletion**: If the document creation is deemed unauthorized, delete the document immediately and check for other similar documents created recently.\n- **Enhance Monitoring and Alerts**: Configure additional monitoring for SSM document creation events, especially when associated with untrusted or rare users.\n- **Policy Update**: Consider restricting SSM document creation permissions to specific, trusted roles or users to prevent unauthorized document creation.\n- **Incident Response**: If the document is confirmed as part of malicious activity, treat this as a security incident. Follow incident response protocols, including containment, investigation, and remediation.\n\n### Additional Information\n\nFor further guidance on managing and securing AWS Systems Manager in your environment, refer to the [AWS SSM documentation](https://docs.aws.amazon.com/systems-manager/latest/userguide/what-is-systems-manager.html) and AWS security best practices.\n",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "@timestamp",
            "user.name",
            "source.address",
            "aws.cloudtrail.user_identity.arn",
            "aws.cloudtrail.user_identity.type",
            "user_agent.original",
            "event.action",
            "event.outcome",
            "cloud.region",
            "aws.cloudtrail.request_parameters",
            "aws.cloudtrail.response_elements"
          ]
        },
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS SNS",
          "Data Source: AWS Systems Manager",
          "Resources: Investigation Guide",
          "Use Case: Threat Detection",
          "Tactic: Execution"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate users may create SSM command documents for legitimate purposes. Ensure that the document is authorized and the user is known before taking action."
        ],
        "references": [
          "https://docs.aws.amazon.com/systems-manager/latest/APIReference/API_CreateDocument.html",
          "https://docs.aws.amazon.com/systems-manager/latest/userguide/documents.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": []
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.response_elements",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "718fff44-0be3-4e27-b7b1-e9ab692fca1e",
        "rule_id": "50a2bdea-9876-11ef-89db-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.555Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.555Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset: \"aws.cloudtrail\"\n    and event.provider: \"ssm.amazonaws.com\"\n    and event.action: \"CreateDocument\"\n    and event.outcome: \"success\"\n    and aws.cloudtrail.response_elements: *documentType=Command*\n",
        "new_terms_fields": [
          "aws.cloudtrail.user_identity.arn"
        ],
        "history_window_start": "now-14d",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "language": "kuery"
      },
      {
        "name": "IPv4/IPv6 Forwarding Activity",
        "description": "This rule monitors for the execution of commands that enable IPv4 and IPv6 forwarding on Linux systems. Enabling IP forwarding can be used to route network traffic between different network interfaces, potentially allowing attackers to pivot between networks, exfiltrate data, or establish command and control channels.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Command and Control",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1572",
                "name": "Protocol Tunneling",
                "reference": "https://attack.mitre.org/techniques/T1572/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "028e82c5-abc3-474f-959a-b6c8d976fa4b",
        "rule_id": "5a138e2e-aec3-4240-9843-56825d0bc569",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.562Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.562Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\nprocess.parent.executable != null and process.command_line like (\n  \"*net.ipv4.ip_forward*\", \"*/proc/sys/net/ipv4/ip_forward*\", \"*net.ipv6.conf.all.forwarding*\",\n  \"*/proc/sys/net/ipv6/conf/all/forwarding*\"\n) and (\n  (process.name == \"sysctl\" and process.args like (\"*-w*\", \"*--write*\", \"*=*\")) or\n  (\n    process.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") and process.args == \"-c\" and\n    process.command_line like \"*echo *\"\n  )\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "ROT Encoded Python Script Execution",
        "description": "Identifies the execution of a Python script that uses the ROT cipher for letters substitution. Adversaries may use this method to encode and obfuscate part of their malicious code in legit python packages.",
        "risk_score": 47,
        "severity": "medium",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "OS: macOS",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/dprk-code-of-conduct",
          "https://www.reversinglabs.com/blog/fake-recruiter-coding-tests-target-devs-with-malicious-python-packages"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1140",
                "name": "Deobfuscate/Decode Files or Information",
                "reference": "https://attack.mitre.org/techniques/T1140/"
              },
              {
                "id": "T1027",
                "name": "Obfuscated Files or Information",
                "reference": "https://attack.mitre.org/techniques/T1027/",
                "subtechnique": [
                  {
                    "id": "T1027.013",
                    "name": "Encrypted/Encoded File",
                    "reference": "https://attack.mitre.org/techniques/T1027/013/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "a1322a02-9e3f-4789-aeb3-11e18e972e9f",
        "rule_id": "5ab49127-b1b3-46e6-8a38-9e8512a2a363",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.572Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.572Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by process.entity_id with maxspan=1m\n [process where host.os.type in (\"windows\", \"macos\") and event.type == \"start\" and process.name : \"python*\"]\n [file where host.os.type in (\"windows\", \"macos\") and\n  event.action != \"deletion\" and process.name : \"python*\" and file.name : \"rot_??.cpython-*.pyc*\"]\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process-*",
          "logs-endpoint.events.file-*"
        ]
      },
      {
        "name": "Web Server Spawned via Python",
        "description": "This rule identifies when a web server is spawned via Python. Attackers may use Python to spawn a web server to exfiltrate/infiltrate data or to move laterally within a network.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.006",
                    "name": "Python",
                    "reference": "https://attack.mitre.org/techniques/T1059/006/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1570",
                "name": "Lateral Tool Transfer",
                "reference": "https://attack.mitre.org/techniques/T1570/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "18b108bd-fc93-44d7-b480-21f752fb89fe",
        "rule_id": "99c2b626-de44-4322-b1f9-157ca408c17e",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.838Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.838Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and (\n  (process.name like \"python*\" and process.args in (\"http.server\", \"SimpleHTTPServer\")) or\n  (\n    process.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") and\n    process.command_line like~ \"*python* -m http.server*\"\n  )\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Unusual Interactive Shell Launched from System User",
        "description": "This rule detects interactive shells launched from system users. System users typically do not require interactive shells, and their presence may indicate malicious activity.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1564",
                "name": "Hide Artifacts",
                "reference": "https://attack.mitre.org/techniques/T1564/",
                "subtechnique": [
                  {
                    "id": "T1564.002",
                    "name": "Hidden Users",
                    "reference": "https://attack.mitre.org/techniques/T1564/002/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\n\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\n\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.interactive",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "97b1fa15-b24e-4eb6-a016-c8ff59cc0966",
        "rule_id": "9c5b2382-19d2-4b5d-8f14-9e1631a3acdb",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.845Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.845Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.category:process and host.os.type:linux and event.type:start and event.action:exec and user.name:(\n   daemon or bin or sys or sync or games or man or mail or news or uucp or proxy or backup or list or irc\n   or gnats or _apt or Debian-exim or systemd-timesync or messagebus or uuidd or _chrony or sshd or\n   gamer or shutdown or halt or dbus or polkitd or rtkit or pipewire or tcpdump or clevis or\n   libstoreagemgmt or geoclue or tss or sssd or gnome-initial-setup or pesign or dnsmasq or chrony \n) and process.interactive:true and process.parent.executable:* and not (\n  process.parent.name:(\n    apt-key or apt-config or gpgv or gpgconf or man-db.postinst or sendmail or rpm or nullmailer-inject\n  ) or\n  process.args:(/etc/apt/trusted.gpg.d/* or /tmp/apt-key-gpg*) or\n  process.name:(awk or apt-config or dpkg or grep or gpgv or sed) or\n  (user.name:daemon and process.name:at)\n)\n",
        "new_terms_fields": [
          "process.executable"
        ],
        "history_window_start": "now-14d",
        "index": [
          "logs-endpoint.events.process*"
        ],
        "language": "kuery"
      },
      {
        "name": "Memory Swap Modification",
        "description": "This rule detects memory swap modification events on Linux systems. Memory swap modification can be used to manipulate the system's memory and potentially impact the system's performance. This behavior is commonly observed in malware that deploys miner software such as XMRig.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Impact",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1496",
                "name": "Resource Hijacking",
                "reference": "https://attack.mitre.org/techniques/T1496/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1059",
                "name": "Command and Scripting Interpreter",
                "reference": "https://attack.mitre.org/techniques/T1059/",
                "subtechnique": [
                  {
                    "id": "T1059.004",
                    "name": "Unix Shell",
                    "reference": "https://attack.mitre.org/techniques/T1059/004/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\n\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\n\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "d71db2bc-46ef-4aad-8f1e-1bae5ba94cc9",
        "rule_id": "5e4023e7-6357-4061-ae1c-9df33e78c674",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:30.935Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:30.935Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\nprocess.parent.executable != null and\nprocess.name in (\"swapon\", \"swapoff\") or (\n  process.command_line like (\"*vm.swappiness*\", \"*/proc/sys/vm/swappiness*\") and (\n    (process.name == \"sysctl\" and process.args like (\"*-w*\", \"*--write*\", \"*=*\")) or\n    (\n      process.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") and process.args == \"-c\" and\n      process.command_line like \"*echo *\"\n    )\n  )\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Security File Access via Common Utilities",
        "description": "This rule detects sensitive security file access via common utilities on Linux systems. Adversaries may attempt to read from sensitive files using common utilities to gather information about the system and its security configuration.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "0f3eba0f-b9a7-49b7-8724-684ab134fc28",
        "rule_id": "7efca3ad-a348-43b2-b544-c93a78a0ef92",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.770Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.770Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\nprocess.name in (\"cat\", \"grep\", \"less\", \"more\", \"strings\", \"awk\", \"find\", \"xargs\") and\nprocess.args like (\n  \"/etc/security/*\", \"/etc/pam.d/*\", \"/etc/login.defs\", \"/lib/security/*\", \"/lib64/security/*\",\n  \"/usr/lib/security/*\", \"/usr/lib64/security/*\", \"/usr/lib/x86_64-linux-gnu/security/*\",\n  \"/home/*/.aws/credentials\", \"/home/*/.aws/config\", \"/home/*/.config/gcloud/*credentials.json\",\n  \"/home/*/.config/gcloud/configurations/config_default\", \"/home/*/.azure/accessTokens.json\",\n  \"/home/*/.azure/azureProfile.json\"\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "SELinux Configuration Creation or Renaming",
        "description": "This rule detects the creation or renaming of the SELinux configuration file. SELinux is a security module that provides access control security policies. Modifications to the SELinux configuration file may indicate an attempt to impair defenses by disabling or modifying security tools.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1562",
                "name": "Impair Defenses",
                "reference": "https://attack.mitre.org/techniques/T1562/",
                "subtechnique": [
                  {
                    "id": "T1562.001",
                    "name": "Disable or Modify Tools",
                    "reference": "https://attack.mitre.org/techniques/T1562/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from one of the following integrations:\n- Elastic Defend\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "98889c5a-8ece-4a3d-9af5-7dfe6df64790",
        "rule_id": "7b981906-86b7-4544-8033-c30ec6eb45fc",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.763Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.763Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.action in (\"creation\", \"file_create_event\", \"rename\", \"file_rename_event\")\nand file.path : \"/etc/selinux/config\"\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*",
          "endgame-*"
        ]
      },
      {
        "name": "First Occurrence of STS GetFederationToken Request by User",
        "description": "Identifies the first occurrence of an AWS Security Token Service (STS) `GetFederationToken` request made by a user within the last 10 days. The `GetFederationToken` API call allows users to request temporary security credentials to access AWS resources. Adversaries may use this API to obtain temporary credentials to access resources they would not normally have access to.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: Amazon Web Services",
          "Data Source: AWS",
          "Data Source: AWS STS",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://hackingthe.cloud/aws/post_exploitation/survive_access_key_deletion_with_sts_getfederationtoken/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1550",
                "name": "Use Alternate Authentication Material",
                "reference": "https://attack.mitre.org/techniques/T1550/",
                "subtechnique": [
                  {
                    "id": "T1550.001",
                    "name": "Application Access Token",
                    "reference": "https://attack.mitre.org/techniques/T1550/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "17c1a8fe-0099-4e99-b6e0-a03691f38adf",
        "rule_id": "7a5cc9a8-5ea3-11ef-beec-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.756Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.756Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset: \"aws.cloudtrail\"\n    and event.provider: sts.amazonaws.com\n    and event.action: GetFederationToken\n",
        "new_terms_fields": [
          "aws.cloudtrail.user_identity.arn"
        ],
        "history_window_start": "now-10d",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "language": "kuery"
      },
      {
        "name": "SSL Certificate Deletion",
        "description": "This rule detects the deletion of SSL certificates on a Linux system. Adversaries may delete SSL certificates to subvert trust controls and negatively impact the system.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Tactic: Impact",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1070",
                "name": "Indicator Removal",
                "reference": "https://attack.mitre.org/techniques/T1070/",
                "subtechnique": [
                  {
                    "id": "T1070.004",
                    "name": "File Deletion",
                    "reference": "https://attack.mitre.org/techniques/T1070/004/"
                  }
                ]
              },
              {
                "id": "T1553",
                "name": "Subvert Trust Controls",
                "reference": "https://attack.mitre.org/techniques/T1553/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0040",
              "name": "Impact",
              "reference": "https://attack.mitre.org/tactics/TA0040/"
            },
            "technique": [
              {
                "id": "T1485",
                "name": "Data Destruction",
                "reference": "https://attack.mitre.org/techniques/T1485/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.extension",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "327e0cc1-e33d-4450-b5da-f6aa140286d0",
        "rule_id": "7957f3b9-f590-4062-b9f9-003c32bfc7d6",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.749Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.749Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "file where host.os.type == \"linux\" and event.type == \"deletion\" and file.path : \"/etc/ssl/certs/*\" and\nfile.extension in (\"pem\", \"crt\") and not process.name in (\"dockerd\", \"pacman\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.file*"
        ]
      },
      {
        "name": "AWS Discovery API Calls via CLI from a Single Resource",
        "description": "Detects when a single AWS resource is running multiple `Describe` and `List` API calls in a 10-second window. This behavior could indicate an actor attempting to discover the AWS infrastructure using compromised credentials or a compromised instance. Adversaries may use this information to identify potential targets for further exploitation or to gain a better understanding of the target's infrastructure.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS Discovery API Calls via CLI from a Single Resource\n\nThis rule detects multiple discovery-related API calls (`Describe`, `List`, or `Get` actions) within a short time window (30 seconds) from a single AWS resource. High volumes of such calls may indicate attempts to enumerate AWS infrastructure for reconnaissance purposes, which is often a tactic used by adversaries with compromised credentials or unauthorized access.\n\n#### Possible Investigation Steps\n\n- **Identify the Actor and Resource**:\n  - **User Identity and Resource**: Examine `aws.cloudtrail.user_identity.arn` to identify the actor making the discovery requests. Verify the user or resource associated with these actions to ensure they are recognized and expected.\n  - **User Agent and Tooling**: Check `user_agent.name` to confirm whether the `aws-cli` tool was used for these requests. Use of the CLI in an atypical context might indicate unauthorized or automated access.\n\n- **Evaluate the Context and Scope of API Calls**:\n  - **API Action Types**: Look into the specific actions under `event.action` for API calls like `Describe*`, `List*`, or `Get*`. Note if these calls are targeting sensitive services, such as `EC2`, `IAM`, or `S3`, which may suggest an attempt to identify high-value assets.\n  - **Time Pattern Analysis**: Review the `time_window` and `unique_api_count` to assess whether the frequency of these calls is consistent with normal patterns for this resource or user.\n\n- **Analyze Potential Compromise Indicators**:\n  - **Identity Type**: Review `aws.cloudtrail.user_identity.type` to determine if the calls originated from an assumed role, a root user, or a service role. Unusual identity types for discovery operations may suggest misuse or compromise.\n  - **Source IP and Geographic Location**: Examine the `source.ip` and `source.geo` fields to identify any unusual IP addresses or locations associated with the activity, which may help confirm or rule out external access.\n\n- **Examine Related CloudTrail Events**:\n  - **Pivot for Related Events**: Identify any additional IAM or CloudTrail events tied to the same actor ARN. Activities such as `AssumeRole`, `GetSessionToken`, or `CreateAccessKey` in proximity to these discovery calls may signal an attempt to escalate privileges.\n  - **Look for Anomalous Patterns**: Determine if this actor or resource has performed similar discovery actions previously, or if these actions coincide with other alerts related to credential use or privilege escalation.\n\n### False Positive Analysis\n\n- **Expected Discovery Activity**: Regular discovery or enumeration API calls may be conducted by security, automation, or monitoring scripts to maintain an inventory of resources. Validate if this activity aligns with known automation or inventory tasks.\n- **Routine Admin or Automated Access**: If specific roles or resources, such as automation tools or monitoring services, regularly trigger this rule, consider adding exceptions for these known, benign users to reduce false positives.\n\n### Response and Remediation\n\n- **Confirm Authorized Access**: If the discovery activity appears unauthorized, consider immediate steps to restrict the user or resource’s permissions.\n- **Review and Remove Unauthorized API Calls**: If the actor is not authorized to perform discovery actions, investigate and potentially disable their permissions or access keys to prevent further misuse.\n- **Enhance Monitoring for Discovery Patterns**: Consider additional logging or alerting for high-frequency discovery API calls, especially if triggered from new or unrecognized resources.\n- **Policy Review and Updates**: Review IAM policies associated with the actor, ensuring restrictive permissions and MFA enforcement where possible to prevent unauthorized discovery.\n\n### Additional Information\n\nFor further guidance on AWS infrastructure discovery and best practices, refer to [AWS CloudTrail documentation](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference.html) and MITRE ATT&CK’s [Cloud Infrastructure Discovery](https://attack.mitre.org/techniques/T1580/).\n",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "time_window",
            "aws.cloudtrail.user_identity.arn",
            "unique_api_count"
          ]
        },
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: AWS EC2",
          "Data Source: AWS IAM",
          "Data Source: AWS S3",
          "Use Case: Threat Detection",
          "Tactic: Discovery"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Administrators or automated systems may legitimately perform multiple `Describe` and `List` API calls in a short time frame. Verify the user identity and the purpose of the API calls to determine if the behavior is expected."
        ],
        "references": [
          "https://stratus-red-team.cloud/attack-techniques/AWS/aws.discovery.ec2-enumerate-from-instance/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": [
              {
                "id": "T1580",
                "name": "Cloud Infrastructure Discovery",
                "reference": "https://attack.mitre.org/techniques/T1580/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [],
        "id": "046203b3-29b4-467b-b446-907e95505276",
        "rule_id": "74f45152-9aee-11ef-b0a5-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.742Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.742Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws.cloudtrail*\n\n// create time window buckets of 10 seconds\n| eval time_window = date_trunc(10 seconds, @timestamp)\n| where\n    event.dataset == \"aws.cloudtrail\"\n\n    // filter on CloudTrail audit logs for IAM, EC2, and S3 events only\n    and event.provider in (\n      \"iam.amazonaws.com\",\n      \"ec2.amazonaws.com\",\n      \"s3.amazonaws.com\",\n      \"rds.amazonaws.com\",\n      \"lambda.amazonaws.com\",\n      \"dynamodb.amazonaws.com\",\n      \"kms.amazonaws.com\",\n      \"cloudfront.amazonaws.com\",\n      \"elasticloadbalancing.amazonaws.com\",\n      \"cloudfront.amazonaws.com\"\n    )\n\n    // ignore AWS service actions\n    and aws.cloudtrail.user_identity.type != \"AWSService\"\n\n    // filter for aws-cli specifically\n    and user_agent.name == \"aws-cli\"\n\n    // exclude DescribeCapacityReservations events related to AWS Config\n    and not event.action in (\"DescribeCapacityReservations\")\n\n// filter for Describe, Get, List, and Generate API calls\n| where true in (\n    starts_with(event.action, \"Describe\"),\n    starts_with(event.action, \"Get\"),\n    starts_with(event.action, \"List\"),\n    starts_with(event.action, \"Generate\")\n)\n// extract owner, identity type, and actor from the ARN\n| dissect aws.cloudtrail.user_identity.arn \"%{}::%{owner}:%{identity_type}/%{actor}\"\n| where starts_with(actor, \"AWSServiceRoleForConfig\") != true\n| keep @timestamp, time_window, event.action, aws.cloudtrail.user_identity.arn\n| stats\n    // count the number of unique API calls per time window and actor\n    unique_api_count = count_distinct(event.action) by time_window, aws.cloudtrail.user_identity.arn\n\n// filter for more than 5 unique API calls per time window\n| where unique_api_count > 5\n\n// sort the results by the number of unique API calls in descending order\n| sort unique_api_count desc\n"
      },
      {
        "name": "Curl SOCKS Proxy Activity from Unusual Parent",
        "description": "This rule detects the use of the `curl` command-line tool with SOCKS proxy options, launched from an unusual parent process. Attackers may use `curl` to establish a SOCKS proxy connection to bypass network restrictions and exfiltrate data or communicate with C2 servers.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Command and Control",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": [
              {
                "id": "T1572",
                "name": "Protocol Tunneling",
                "reference": "https://attack.mitre.org/techniques/T1572/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n\nElastic Defend integration does not collect environment variable logging by default.\nIn order to capture this behavior, this rule requires a specific configuration option set within the advanced settings of the Elastic Defend integration.\n #### To set up environment variable capture for an Elastic Agent policy:\n- Go to “Security → Manage → Policies”.\n- Select an “Elastic Agent policy”.\n- Click “Show advanced settings”.\n- Scroll down or search for “linux.advanced.capture_env_vars”.\n- Enter the names of environment variables you want to capture, separated by commas.\n- For this rule the linux.advanced.capture_env_vars variable should be set to \"HTTP_PROXY,HTTPS_PROXY,ALL_PROXY\".\n- Click “Save”.\nAfter saving the integration change, the Elastic Agents running this policy will be updated and the rule will function properly.\nFor more information on capturing environment variables refer to the [helper guide](https://www.elastic.co/guide/en/security/current/environment-variable-capture.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.env_vars",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "072ba8d8-f7f5-485f-b2c0-5c22a46b702e",
        "rule_id": "734239fe-eda8-48c0-bca8-9e3dafd81a88",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.735Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.735Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\nprocess.name == \"curl\" and (\n  process.parent.executable like (\n    \"/dev/shm/*\", \"/tmp/*\", \"/var/tmp/*\", \"/var/run/*\", \"/root/*\", \"/boot/*\", \"/var/www/html/*\", \"/opt/.*\"\n  ) or\n  process.parent.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\")\n) and (\n  process.args like (\"--socks5-hostname\", \"--proxy\", \"--preproxy\", \"socks5*\") or\n  process.args == \"-x\" or \n  process.env_vars like (\"http_proxy=socks5h://*\", \"HTTPS_PROXY=socks5h://*\", \"ALL_PROXY=socks5h://*\")\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Attempt to Disable Auditd Service",
        "description": "Adversaries may attempt to disable the Auditd service to evade detection. Auditd is a Linux service that provides system auditing and logging. Disabling the Auditd service can prevent the system from logging important security events, which can be used to detect malicious activity.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Data Source: Elastic Endgame"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1562",
                "name": "Impair Defenses",
                "reference": "https://attack.mitre.org/techniques/T1562/",
                "subtechnique": [
                  {
                    "id": "T1562.001",
                    "name": "Disable or Modify Tools",
                    "reference": "https://attack.mitre.org/techniques/T1562/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "ea365bc8-bc6b-4e92-8993-8c1d285dbbc8",
        "rule_id": "6a058ed6-4e9f-49f3-8f8e-f32165ae7ebf",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.725Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.725Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action in (\"exec\", \"exec_event\") and (\n  (process.name == \"service\" and process.args == \"stop\") or\n  (process.name == \"chkconfig\" and process.args == \"off\") or\n  (process.name == \"systemctl\" and process.args in (\"disable\", \"stop\", \"kill\"))\n) and\nprocess.args in (\"auditd\", \"auditd.service\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.process*",
          "endgame-*"
        ]
      },
      {
        "name": "Private Key Searching Activity",
        "description": "This rule detects private key searching activity on Linux systems. Searching for private keys can be an indication of an attacker attempting to escalate privileges or exfiltrate sensitive information.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Discovery",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0007",
              "name": "Discovery",
              "reference": "https://attack.mitre.org/tactics/TA0007/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "f1b4d3bf-4c9c-40e3-bb11-76fa448fd685",
        "rule_id": "627374ab-7080-4e4d-8316-bef1122444af",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.718Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.718Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and process.name == \"find\" and\nprocess.command_line like (\"*id_dsa*\", \"*id_rsa*\", \"*id_ed*\", \"*id_ecdsa*\", \"*id_xmss*\", \"*id_dh*\") and\nprocess.command_line like (\"*/home/*\", \"*/etc/ssh*\", \"*/root/*\", \"/\")\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "AWS STS AssumeRole with New MFA Device",
        "description": "Identifies when a user has assumed a role using a new MFA device. Users can assume a role to obtain temporary credentials and access AWS resources using the AssumeRole API of AWS Security Token Service (STS). While a new MFA device is not always indicative of malicious behavior it should be verified as adversaries can use this technique for persistence and privilege escalation.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS STS",
          "Use Case: Identity and Access Audit",
          "Tactic: Privilege Escalation",
          "Tactic: Persistence",
          "Tactic: Lateral Movement"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "AWS administrators or automated processes might regularly assume roles for legitimate administrative purposes and to perform periodic tasks such as data backups, updates, or deployments."
        ],
        "references": [
          "https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html",
          "https://github.com/RhinoSecurityLabs/cloudgoat/blob/d5863b80afd082d853f2e8df1955c6393695a4da/scenarios/iam_privesc_by_key_rotation/README.md"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1556",
                "name": "Modify Authentication Process",
                "reference": "https://attack.mitre.org/techniques/T1556/",
                "subtechnique": [
                  {
                    "id": "T1556.006",
                    "name": "Multi-Factor Authentication",
                    "reference": "https://attack.mitre.org/techniques/T1556/006/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1548",
                "name": "Abuse Elevation Control Mechanism",
                "reference": "https://attack.mitre.org/techniques/T1548/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1550",
                "name": "Use Alternate Authentication Material",
                "reference": "https://attack.mitre.org/techniques/T1550/",
                "subtechnique": [
                  {
                    "id": "T1550.001",
                    "name": "Application Access Token",
                    "reference": "https://attack.mitre.org/techniques/T1550/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "The AWS Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.flattened.request_parameters.serialNumber",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "user.id",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "e21b6e85-bdea-4797-9b36-364c67b2f699",
        "rule_id": "a22f566b-5b23-4412-880d-c6c957acd321",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.852Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.852Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset:aws.cloudtrail\n    and event.provider:sts.amazonaws.com\n    and event.action:(AssumeRole or AssumeRoleWithSAML or AssumeRoleWithWebIdentity)\n    and event.outcome:success\n    and user.id:* \n    and aws.cloudtrail.flattened.request_parameters.serialNumber:*\n",
        "new_terms_fields": [
          "user.id",
          "aws.cloudtrail.flattened.request_parameters.serialNumber"
        ],
        "history_window_start": "now-10d",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "language": "kuery"
      },
      {
        "name": "First Occurrence of Entra ID Auth via DeviceCode Protocol",
        "description": "Identifies when a user is observed for the first time in the last 14 days authenticating using the deviceCode protocol. The device code authentication flow can be abused by attackers to phish users and steal access tokens to impersonate the victim. By its very nature, device code should only be used when logging in to devices without keyboards, where it is difficult to enter emails and passwords.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: Azure",
          "Data Source: Microsoft Entra ID",
          "Use Case: Identity and Access Audit",
          "Tactic: Credential Access"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic",
          "Matteo Potito Giorgio"
        ],
        "false_positives": [],
        "references": [
          "https://aadinternals.com/post/phishing/",
          "https://www.blackhillsinfosec.com/dynamic-device-code-phishing/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1528",
                "name": "Steal Application Access Token",
                "reference": "https://attack.mitre.org/techniques/T1528/"
              }
            ]
          }
        ],
        "setup": "This rule optionally requires Azure Sign-In logs from the Azure integration. Ensure that the Azure integration is correctly set up and that the required data is being collected.\n",
        "related_integrations": [
          {
            "package": "azure",
            "version": "^1.0.0",
            "integration": "activitylogs"
          },
          {
            "package": "azure",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "azure.activitylogs.properties.authentication_protocol",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "azure.signinlogs.properties.authentication_protocol",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "f472930b-f6c8-4c75-a909-d26c3d5f2882",
        "rule_id": "af22d970-7106-45b4-b5e3-460d15333727",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.858Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.858Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": " event.dataset:(azure.activitylogs or azure.signinlogs) and \n     (azure.signinlogs.properties.authentication_protocol:deviceCode or azure.activitylogs.properties.authentication_protocol:deviceCode) and event.outcome:success\n",
        "new_terms_fields": [
          "azure.signinlogs.properties.user_principal_name"
        ],
        "history_window_start": "now-14d",
        "index": [
          "filebeat-*",
          "logs-azure.signinlogs-*",
          "logs-azure.activitylogs-*"
        ],
        "language": "kuery"
      },
      {
        "name": "Hidden Directory Creation via Unusual Parent",
        "description": "This rule detects the creation of a hidden directory via an unusual parent executable. Hidden directories are directories that are not visible to the user by default. They are often used by attackers to hide malicious files or tools.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Defense Evasion",
          "Data Source: Elastic Defend",
          "Tactic: Persistence"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Certain tools may create hidden temporary directories upon installation or as part of their normal behavior. These events can be filtered by the process arguments, username, or process name values."
        ],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": [
              {
                "id": "T1564",
                "name": "Hide Artifacts",
                "reference": "https://attack.mitre.org/techniques/T1564/",
                "subtechnique": [
                  {
                    "id": "T1564.001",
                    "name": "Hidden Files and Directories",
                    "reference": "https://attack.mitre.org/techniques/T1564/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args_count",
            "type": "long",
            "ecs": true
          },
          {
            "name": "process.command_line",
            "type": "wildcard",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.executable",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "340d89e1-50f1-48ea-a875-a9bbb3913b59",
        "rule_id": "b15a15f2-becf-475d-aa69-45c9e0ff1c49",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.869Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.869Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\nprocess.name == \"mkdir\" and process.parent.executable like (\n  \"/dev/shm/*\", \"/tmp/*\", \"/var/tmp/*\", \"/var/run/*\", \"/root/*\", \"/boot/*\", \"/var/www/html/*\", \"/opt/.*\"\n) and process.args like (\".*\", \"/*/.*\") and process.args_count <= 3 and not (\n  process.parent.executable like (\"/tmp/newroot/*\", \"/run/containerd/*\") or\n  process.command_line like (\"mkdir -p .\", \"mkdir ./*\") or\n  process.parent.executable like (\n    \"/tmp/pear/temp/*\", \"/var/tmp/buildah*\", \"/tmp/python-build.*\", \"/tmp/cliphist-wofi-img\"\n  )\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "File Creation by Cups or Foomatic-rip Child",
        "description": "This detection rule addresses multiple vulnerabilities in the CUPS printing system, including CVE-2024-47176, CVE-2024-47076, CVE-2024-47175, and CVE-2024-47177. Specifically, this rule detects suspicious file creation events executed by child processes of foomatic-rip. These flaws impact components like cups-browsed, libcupsfilters, libppd, and foomatic-rip, allowing remote unauthenticated attackers to manipulate IPP URLs or inject malicious data through crafted UDP packets or network spoofing. This can result in arbitrary command execution when a print job is initiated.",
        "risk_score": 73,
        "severity": "high",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating File Creation by Cups or Foomatic-rip Child\n\nThis rule identifies potential exploitation attempts of several vulnerabilities in the CUPS printing system (CVE-2024-47176, CVE-2024-47076, CVE-2024-47175, CVE-2024-47177). These vulnerabilities allow attackers to send crafted IPP requests or manipulate UDP packets to execute arbitrary commands or modify printer configurations. Attackers can exploit these flaws to inject malicious data, leading to Remote Code Execution (RCE) on affected systems.\n\n#### Possible Investigation Steps\n\n- Investigate the incoming IPP requests or UDP packets targeting port 631.\n- Examine the printer configurations on the system to determine if any unauthorized printers or URLs have been added.\n- Investigate the process tree to check if any unexpected processes were triggered as a result of IPP activity. Review the executable files for legitimacy.\n- Check for additional alerts related to the compromised system or user within the last 48 hours.\n- Investigate network traffic logs for suspicious outbound connections to unrecognized domains or IP addresses.\n- Check if any of the contacted domains or addresses are newly registered or have a suspicious reputation.\n- Retrieve any scripts or executables dropped by the attack for further analysis in a private sandbox environment:\n- Analyze potential malicious activity, including:\n  - Attempts to communicate with external servers.\n  - File access or creation of unauthorized executables.\n  - Cron jobs, services, or other persistence mechanisms.\n\n### Related Rules\n- Cupsd or Foomatic-rip Shell Execution - 476267ff-e44f-476e-99c1-04c78cb3769d\n- Printer User (lp) Shell Execution - f86cd31c-5c7e-4481-99d7-6875a3e31309\n- Network Connection by Cups or Foomatic-rip Child - e80ee207-9505-49ab-8ca8-bc57d80e2cab\n- Suspicious Execution from Foomatic-rip or Cupsd Parent - 986361cd-3dac-47fe-afa1-5c5dd89f2fb4\n\n### False Positive Analysis\n\n- This activity is rarely legitimate. However, verify the context to rule out non-malicious printer configuration changes or legitimate IPP requests.\n\n### Response and Remediation\n\n- Initiate the incident response process based on the triage outcome.\n- Isolate the compromised host to prevent further exploitation.\n- If the investigation confirms malicious activity, search the environment for additional compromised hosts.\n- Implement network segmentation or restrictions to contain the attack.\n- Stop suspicious processes or services tied to CUPS exploitation.\n- Block identified Indicators of Compromise (IoCs), including IP addresses, domains, or hashes of involved files.\n- Review compromised systems for backdoors, such as reverse shells or persistence mechanisms like cron jobs.\n- Investigate potential credential exposure on compromised systems and reset passwords for any affected accounts.\n- Restore the original printer configurations or uninstall unauthorized printer entries.\n- Perform a thorough antimalware scan to identify any lingering threats or artifacts from the attack.\n- Investigate how the attacker gained initial access and address any weaknesses to prevent future exploitation.\n- Use insights from the incident to improve detection and response times in future incidents (MTTD and MTTR).\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Use Case: Vulnerability",
          "Tactic: Execution",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/cups-overflow",
          "https://www.evilsocket.net/2024/09/26/Attacking-UNIX-systems-via-CUPS-Part-I/",
          "https://gist.github.com/stong/c8847ef27910ae344a7b5408d9840ee1",
          "https://github.com/RickdeJager/cupshax/blob/main/cupshax.py"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1203",
                "name": "Exploitation for Client Execution",
                "reference": "https://attack.mitre.org/techniques/T1203/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "36a3073f-f7ad-420e-b41f-8aaf7a6da2c9",
        "rule_id": "b9b14be7-b7f4-4367-9934-81f07d2f63c4",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.875Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.875Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id with maxspan=10s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.parent.name == \"foomatic-rip\" and\n   process.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\")] by process.entity_id\n  [file where host.os.type == \"linux\" and event.type != \"deletion\" and\n   not (process.name == \"gs\" and file.path like \"/tmp/gs_*\")] by process.parent.entity_id\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "AWS STS Role Chaining",
        "description": "Identifies role chaining activity. Role chaining is when you use one assumed role to assume a second role through the AWS CLI or API. While this a recognized functionality in AWS, role chaining can be abused for privilege escalation if the subsequent assumed role provides additional privileges. Role chaining can also be used as a persistence mechanism as each AssumeRole action results in a refreshed session token with a 1 hour maximum duration. This rule looks for role chaining activity happening within a single account, to eliminate false positives produced by common cross-account behavior.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS STS",
          "Use Case: Threat Detection",
          "Tactic: Persistence",
          "Tactic: Privilege Escalation",
          "Tactic: Lateral Movement"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-6m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Role chaining can be used as an access control. Ensure that this behavior is not part of a legitimate operation before taking action."
        ],
        "references": [
          "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html#id_roles_terms-and-concepts",
          "https://www.uptycs.com/blog/detecting-anomalous-aws-sessions-temporary-credentials",
          "https://hackingthe.cloud/aws/post_exploitation/role-chain-juggling/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1548",
                "name": "Abuse Elevation Control Mechanism",
                "reference": "https://attack.mitre.org/techniques/T1548/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0008",
              "name": "Lateral Movement",
              "reference": "https://attack.mitre.org/tactics/TA0008/"
            },
            "technique": [
              {
                "id": "T1550",
                "name": "Use Alternate Authentication Material",
                "reference": "https://attack.mitre.org/techniques/T1550/",
                "subtechnique": [
                  {
                    "id": "T1550.001",
                    "name": "Application Access Token",
                    "reference": "https://attack.mitre.org/techniques/T1550/001/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": []
          }
        ],
        "setup": "The AWS Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.",
        "related_integrations": [],
        "required_fields": [],
        "id": "99231efc-19ff-49e5-ab08-9360e7130bc1",
        "rule_id": "ba5a0b0c-b477-4729-a3dc-0147c2049cf1",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.881Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.881Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws.cloudtrail-* metadata _id, _version, _index\n\n// filter for AssumeRole API calls where access key id is a short term token beginning with ASIA\n| where event.dataset == \"aws.cloudtrail\" and event.provider == \"sts.amazonaws.com\" and event.action == \"AssumeRole\" and aws.cloudtrail.resources.account_id == aws.cloudtrail.recipient_account_id and aws.cloudtrail.user_identity.access_key_id like \"ASIA*\"\n\n// keep only the relevant fields\n| keep aws.cloudtrail.user_identity.arn, cloud.region, aws.cloudtrail.resources.account_id, aws.cloudtrail.recipient_account_id, aws.cloudtrail.user_identity.access_key_id\n"
      },
      {
        "name": "AWS IAM Login Profile Added for Root",
        "description": "Detects when an AWS IAM login profile is added to a root user account and is self-assigned. Adversaries, with temporary access to the root account, may add a login profile to the root user account to maintain access even if the original access key is rotated or disabled.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Investigating AWS IAM Login Profile Added for Root\n\nThis rule detects when a login profile is added to the AWS root account. Adding a login profile to the root account, especially if self-assigned, is highly suspicious as it might indicate an adversary trying to establish persistence in the environment.\n\n### Possible Investigation Steps\n\n- **Identify the Source and Context of the Action**:\n    - Examine the `source.address` field to identify the IP address from which the request originated.\n        - Check the geographic location (`source.address`) to determine if the access is from an expected or unexpected region.\n    - Look at the `user_agent.original` field to identify the tool or browser used for this action.\n        - For example, a user agent like `Mozilla/5.0` might indicate interactive access, whereas `aws-cli` or SDKs suggest scripted activity.\n\n- **Confirm Root User and Request Details**:\n    - Validate the root user's identity through `aws.cloudtrail.user_identity.arn` and ensure this activity aligns with legitimate administrative actions.\n    - Review `aws.cloudtrail.user_identity.access_key_id` to identify if the action was performed using temporary or permanent credentials. This access key could be used to pivot into other actions.\n\n- **Analyze the Login Profile Creation**:\n    - Review the `aws.cloudtrail.request_parameters` and `aws.cloudtrail.response_elements` fields for details of the created login profile.\n        - For example, confirm the `userName` of the profile and whether `passwordResetRequired` is set to `true`.\n    - Compare the `@timestamp` of this event with other recent actions by the root account to identify potential privilege escalation or abuse.\n\n- **Correlate with Other Events**:\n    - Investigate for related IAM activities, such as:\n        - `CreateAccessKey` or `AttachUserPolicy` events targeting the root account.\n        - Unusual data access, privilege escalation, or management console logins.\n    - Check for any anomalies involving the same `source.address` or `aws.cloudtrail.user_identity.access_key_id` in the environment.\n\n- **Evaluate Policy and Permissions**:\n    - Verify the current security policies for the root account:\n        - Ensure password policies enforce complexity and rotation requirements.\n        - Check if MFA is enforced on the root account.\n    - Assess the broader IAM configuration for deviations from least privilege principles.\n\n### False Positive Analysis\n\n- **Routine Administrative Tasks**: Adding a login profile might be a legitimate action during certain administrative processes. Verify with the relevant AWS administrators if this event aligns with routine account maintenance or emergency recovery scenarios.\n\n- **Automation**: If the action is part of an approved automation process (e.g., account recovery workflows), consider excluding these activities from alerting using specific user agents, IP addresses, or session attributes.\n\n### Response and Remediation\n\n- **Immediate Access Review**:\n    - Disable the newly created login profile (`aws iam delete-login-profile`) if it is determined to be unauthorized.\n    - Rotate or disable the credentials associated with the root account to prevent further abuse.\n\n- **Enhance Monitoring and Alerts**:\n    - Enable real-time monitoring and alerting for IAM actions involving the root account.\n    - Increase the logging verbosity for root account activities.\n\n- **Review and Update Security Policies**:\n    - Enforce MFA for all administrative actions, including root account usage.\n    - Restrict programmatic access to the root account by disabling access keys unless absolutely necessary.\n\n- **Conduct Post-Incident Analysis**:\n    - Investigate how the credentials for the root account were compromised or misused.\n    - Strengthen the security posture by implementing account-specific guardrails and continuous monitoring.\n\n### Additional Resources\n\n- AWS documentation on [Login Profile Management](https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateLoginProfile.html).\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS IAM",
          "Use Case: Identity and Access Audit",
          "Tactic: Persistence",
          "Resources: Investigation Guide"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1078",
                "name": "Valid Accounts",
                "reference": "https://attack.mitre.org/techniques/T1078/",
                "subtechnique": [
                  {
                    "id": "T1078.004",
                    "name": "Cloud Accounts",
                    "reference": "https://attack.mitre.org/techniques/T1078/004/"
                  }
                ]
              },
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [],
        "required_fields": [],
        "id": "617909a5-e301-4c59-b9ce-1230e3014279",
        "rule_id": "c04be7e0-b0fc-11ef-a826-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.888Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.888Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws.cloudtrail* metadata _id, _version, _index\n| where\n    // filter for CloudTrail logs from IAM\n    event.dataset == \"aws.cloudtrail\"\n    and event.provider == \"iam.amazonaws.com\"\n\n    // filter for successful CreateLoginProfile API call\n    and event.action == \"CreateLoginProfile\"\n    and event.outcome == \"success\"\n\n    // filter for Root member account\n    and aws.cloudtrail.user_identity.type == \"Root\"\n\n    // filter for an access key existing which sources from AssumeRoot\n    and aws.cloudtrail.user_identity.access_key_id IS NOT NULL\n\n    // filter on the request parameters not including UserName which assumes self-assignment\n    and NOT TO_LOWER(aws.cloudtrail.request_parameters) LIKE \"*username*\"\n| keep\n    @timestamp,\n    aws.cloudtrail.request_parameters,\n    aws.cloudtrail.response_elements,\n    aws.cloudtrail.user_identity.type,\n    aws.cloudtrail.user_identity.arn,\n    aws.cloudtrail.user_identity.access_key_id,\n    cloud.account.id,\n    event.action,\n    source.address\n"
      },
      {
        "name": "Suspicious pbpaste High Volume Activity",
        "description": "Identifies a high volume of `pbpaste` executions, which may indicate a bash loop continuously collecting clipboard contents, potentially allowing an attacker to harvest user credentials or other sensitive information.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\nTo investigate `pbpaste` activity, focus on determining whether the binary is being used maliciously to collect clipboard data. Follow these steps:\n\n> **Note**:\n> This investigation guide uses the [Investigate Markdown Plugin](https://www.elastic.co/guide/en/security/master/interactive-investigation-guides.html) introduced in Elastic Stack version 8.8.0. Older Elastic Stack versions will display unrendered Markdown in this guide.\n\n1. **Identify Frequency and Pattern of Execution:**\n   - **What to check:** Analyze the frequency and timing of `pbpaste` executions. Look for consistent intervals that might indicate a script or loop is running.\n   - **Why:** A high volume of regular `pbpaste` executions could suggest a bash loop designed to continuously capture clipboard data.\n\n2. **Examine Associated Scripts or Processes:**\n   - **What to check:** Investigate the parent processes or scripts invoking `pbpaste`. Look for any cron jobs, bash scripts, or automated tasks linked to these executions.\n   - **Why:** Understanding what is triggering `pbpaste` can help determine if this activity is legitimate or part of a malicious attempt to gather sensitive information.\n   - !{investigate{\"label\":\"Show events having the same parent process\",\"providers\":[[{\"excluded\":false,\"field\":\"host.hostname\",\"queryType\":\"phrase\",\"value\":\"{{host.hostname}}\",\"valueType\":\"string\"},{\"excluded\":false,\"field\":\"process.entity_id\",\"queryType\":\"phrase\",\"value\":\"{{process.parent.entity_id}}\",\"valueType\":\"string\"}]]}}\n   - $investigate_2\n\n3. **Review Clipboard Contents:**\n   - **What to check:** If possible, capture and review the clipboard contents during `pbpaste` executions to identify if sensitive data, such as user credentials, is being targeted.\n   - **Why:** Attackers may use `pbpaste` to harvest valuable information from the clipboard. Identifying the type of data being collected can indicate the severity of the threat.\n\n4. **Check for Data Exfiltration:**\n   - **What to check:** Investigate any output files or network activity associated with `pbpaste` usage. Look for signs that the collected data is being saved to a file, transmitted over the network, or sent to an external location.\n   - **Why:** If data is being stored or transmitted, it may be part of an exfiltration attempt. Identifying this can help prevent sensitive information from being leaked.\n\n5. **Correlate with User Activity:**\n   - **What to check:** Compare the `pbpaste` activity with the user’s normal behavior and system usage patterns.\n   - **Why:** If the `pbpaste` activity occurs during times when the user is not active, or if the user denies initiating such tasks, it could indicate unauthorized access or a compromised account.\n\nBy thoroughly investigating these aspects of `pbpaste` activity, you can determine whether this is part of a legitimate process or a potential security threat that needs to be addressed.\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: macOS",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: Jamf Protect",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Thijs Xhaflaire"
        ],
        "false_positives": [],
        "references": [
          "https://www.loobins.io/binaries/pbpaste/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1056",
                "name": "Input Capture",
                "reference": "https://attack.mitre.org/techniques/T1056/"
              }
            ]
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Jamf Protect.\n\n### Jamf Protect Integration Setup\nJamf Protect is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events incoming events and send data to the Elastic.\n\n#### Prerequisite Requirements:\n- Fleet is required for Jamf Protect.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Jamf Protect integration:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Jamf Protect\" and select the integration to see more details about it.\n- Click \"Add Jamf Protect\".\n- Configure the integration name.\n- Click \"Save and Continue\".\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "jamf_protect",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.hostname",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "293870dc-69aa-4dc4-8f69-d96b218d2f6b",
        "rule_id": "e29599ee-d6ad-46a9-9c6a-dc39f361890d",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.895Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.895Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.hostname, host.id with maxspan=1m\n[process where host.os.type == \"macos\" and event.type == \"start\" and event.action == \"exec\" and process.name: \"pbpaste\"] with runs = 5\n",
        "language": "eql",
        "index": [
          "logs-jamf_protect*",
          "logs-endpoint.events.process-*"
        ]
      },
      {
        "name": "Potential Data Splitting Detected",
        "description": "This rule looks for the usage of common data splitting utilities with specific arguments that indicate data splitting for exfiltration on Linux systems. Data splitting is a technique used by adversaries to split data into smaller parts to avoid detection and exfiltrate data.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Tactic: Exfiltration",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "c2ed87e4-dcd6-4e8c-b3d8-6c7743b23be8",
        "rule_id": "e302e6c3-448c-4243-8d9b-d41da70db582",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.905Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.905Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and (\n  (process.name == \"dd\" and process.args like \"bs=*\" and process.args like \"if=*\") or\n  (process.name in (\"split\", \"rsplit\") and (\n    (process.args == \"-b\" or process.args like \"--bytes*\") or\n    (process.args == \"-C\" or process.args like \"--line-bytes*\")\n    )\n  )\n) and not (\n  process.parent.name in (\"apport\", \"overlayroot\") or\n  process.args like (\n    \"if=/tmp/nvim*\", \"if=/boot/*\", \"if=/dev/random\", \"if=/dev/urandom\", \"/dev/mapper/*\",\n    \"if=*.iso\", \"of=/dev/stdout\", \"if=/dev/zero\", \"if=/dev/sda\", \"/proc/sys/kernel/*\"\n  )\n)\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "Network Connection by Cups or Foomatic-rip Child",
        "description": "This detection rule addresses multiple vulnerabilities in the CUPS printing system, including CVE-2024-47176, CVE-2024-47076, CVE-2024-47175, and CVE-2024-47177. Specifically, this rule detects network connections initiated by a child processes of foomatic-rip. These flaws impact components like cups-browsed, libcupsfilters, libppd, and foomatic-rip, allowing remote unauthenticated attackers to manipulate IPP URLs or inject malicious data through crafted UDP packets or network spoofing. This can result in arbitrary command execution when a print job is initiated.",
        "risk_score": 73,
        "severity": "high",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Network Connection by Cups or Foomatic-rip Child\n\nThis rule identifies potential exploitation attempts of several vulnerabilities in the CUPS printing system (CVE-2024-47176, CVE-2024-47076, CVE-2024-47175, CVE-2024-47177). These vulnerabilities allow attackers to send crafted IPP requests or manipulate UDP packets to execute arbitrary commands or modify printer configurations. Attackers can exploit these flaws to inject malicious data, leading to Remote Code Execution (RCE) on affected systems.\n\n#### Possible Investigation Steps\n\n- Investigate the incoming IPP requests or UDP packets targeting port 631.\n- Examine the printer configurations on the system to determine if any unauthorized printers or URLs have been added.\n- Investigate the process tree to check if any unexpected processes were triggered as a result of IPP activity. Review the executable files for legitimacy.\n- Check for additional alerts related to the compromised system or user within the last 48 hours.\n- Investigate network traffic logs for suspicious outbound connections to unrecognized domains or IP addresses.\n- Check if any of the contacted domains or addresses are newly registered or have a suspicious reputation.\n- Retrieve any scripts or executables dropped by the attack for further analysis in a private sandbox environment:\n- Analyze potential malicious activity, including:\n  - Attempts to communicate with external servers.\n  - File access or creation of unauthorized executables.\n  - Cron jobs, services, or other persistence mechanisms.\n\n### Related Rules\n- Cupsd or Foomatic-rip Shell Execution - 476267ff-e44f-476e-99c1-04c78cb3769d\n- Printer User (lp) Shell Execution - f86cd31c-5c7e-4481-99d7-6875a3e31309\n- Suspicious Execution from Foomatic-rip or Cupsd Parent - 986361cd-3dac-47fe-afa1-5c5dd89f2fb4\n- File Creation by Cups or Foomatic-rip Child - b9b14be7-b7f4-4367-9934-81f07d2f63c4\n\n### False Positive Analysis\n\n- This activity is rarely legitimate. However, verify the context to rule out non-malicious printer configuration changes or legitimate IPP requests.\n\n### Response and Remediation\n\n- Initiate the incident response process based on the triage outcome.\n- Isolate the compromised host to prevent further exploitation.\n- If the investigation confirms malicious activity, search the environment for additional compromised hosts.\n- Implement network segmentation or restrictions to contain the attack.\n- Stop suspicious processes or services tied to CUPS exploitation.\n- Block identified Indicators of Compromise (IoCs), including IP addresses, domains, or hashes of involved files.\n- Review compromised systems for backdoors, such as reverse shells or persistence mechanisms like cron jobs.\n- Investigate potential credential exposure on compromised systems and reset passwords for any affected accounts.\n- Restore the original printer configurations or uninstall unauthorized printer entries.\n- Perform a thorough antimalware scan to identify any lingering threats or artifacts from the attack.\n- Investigate how the attacker gained initial access and address any weaknesses to prevent future exploitation.\n- Use insights from the incident to improve detection and response times in future incidents (MTTD and MTTR).\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Linux",
          "Use Case: Threat Detection",
          "Use Case: Vulnerability",
          "Tactic: Command and Control",
          "Data Source: Elastic Defend"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.elastic.co/security-labs/cups-overflow",
          "https://www.evilsocket.net/2024/09/26/Attacking-UNIX-systems-via-CUPS-Part-I/",
          "https://gist.github.com/stong/c8847ef27910ae344a7b5408d9840ee1",
          "https://github.com/RickdeJager/cupshax/blob/main/cupshax.py"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0011",
              "name": "Command and Control",
              "reference": "https://attack.mitre.org/tactics/TA0011/"
            },
            "technique": []
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0002",
              "name": "Execution",
              "reference": "https://attack.mitre.org/tactics/TA0002/"
            },
            "technique": [
              {
                "id": "T1203",
                "name": "Exploitation for Client Execution",
                "reference": "https://attack.mitre.org/techniques/T1203/"
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0005",
              "name": "Defense Evasion",
              "reference": "https://attack.mitre.org/tactics/TA0005/"
            },
            "technique": []
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0010",
              "name": "Exfiltration",
              "reference": "https://attack.mitre.org/tactics/TA0010/"
            },
            "technique": []
          }
        ],
        "setup": "## Setup\n\nThis rule requires data coming in from Elastic Defend.\n\n### Elastic Defend Integration Setup\nElastic Defend is integrated into the Elastic Agent using Fleet. Upon configuration, the integration allows the Elastic Agent to monitor events on your host and send data to the Elastic Security app.\n\n#### Prerequisite Requirements:\n- Fleet is required for Elastic Defend.\n- To configure Fleet Server refer to the [documentation](https://www.elastic.co/guide/en/fleet/current/fleet-server.html).\n\n#### The following steps should be executed in order to add the Elastic Defend integration on a Linux System:\n- Go to the Kibana home page and click \"Add integrations\".\n- In the query bar, search for \"Elastic Defend\" and select the integration to see more details about it.\n- Click \"Add Elastic Defend\".\n- Configure the integration name and optionally add a description.\n- Select the type of environment you want to protect, either \"Traditional Endpoints\" or \"Cloud Workloads\".\n- Select a configuration preset. Each preset comes with different default settings for Elastic Agent, you can further customize these later by configuring the Elastic Defend integration policy. [Helper guide](https://www.elastic.co/guide/en/security/current/configure-endpoint-integration-policy.html).\n- We suggest selecting \"Complete EDR (Endpoint Detection and Response)\" as a configuration setting, that provides \"All events; all preventions\"\n- Enter a name for the agent policy in \"New agent policy name\". If other agent policies already exist, you can click the \"Existing hosts\" tab and select an existing policy instead.\nFor more details on Elastic Agent configuration settings, refer to the [helper guide](https://www.elastic.co/guide/en/fleet/8.10/agent-policy.html).\n- Click \"Save and Continue\".\n- To complete the integration, select \"Add Elastic Agent to your hosts\" and continue to the next section to install the Elastic Agent on your hosts.\nFor more details on Elastic Defend refer to the [helper guide](https://www.elastic.co/guide/en/security/current/install-endpoint.html).\n",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.entity_id",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.parent.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "7ae90046-8f90-426f-9873-391fd666194d",
        "rule_id": "e80ee207-9505-49ab-8ca8-bc57d80e2cab",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.912Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.912Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "sequence by host.id with maxspan=10s\n  [process where host.os.type == \"linux\" and event.type == \"start\" and event.action == \"exec\" and\n   process.parent.name == \"foomatic-rip\" and\n   process.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\")] by process.entity_id\n  [network where host.os.type == \"linux\" and event.type == \"start\" and\n   event.action == \"connection_attempted\"] by process.parent.entity_id\n",
        "language": "eql",
        "index": [
          "logs-endpoint.events.*"
        ]
      },
      {
        "name": "AWS Bedrock Invocations without Guardrails Detected by a Single User Over a Session",
        "description": "Identifies multiple AWS Bedrock executions in a one minute time window without guardrails by the same user in the same account over a session. Multiple consecutive executions implies that a user may be intentionally attempting to bypass security controls, by not routing the requests with the desired guardrail configuration in order to access sensitive information, or possibly exploit a vulnerability in the system.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and analysis\n\n### Investigating Amazon Bedrock Invocations without Guardrails Detected by a Single User Over a Session.\n\nUsing Amazon Bedrock Guardrails during model invocation is critical for ensuring the safe, reliable, and ethical use of AI models. \nGuardrails help manage risks associated with AI usage and ensure the output aligns with desired policies and standards.\n\n#### Possible investigation steps\n\n- Identify the user account that caused multiple model violations over a session without desired guardrail configuration and whether it should perform this kind of action.\n- Investigate the user activity that might indicate a potential brute force attack.\n- Investigate other alerts associated with the user account during the past 48 hours.\n- Consider the time of day. If the user is a human (not a program or script), did the activity take place during a normal time of day?\n- Examine the account's prompts and responses in the last 24 hours.\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking Amazon Bedrock model access, prompts generated, and responses to the prompts by the account in the last 24 hours.\n\n### False positive analysis\n\n- Verify the user account that caused multiple policy violations by a single user over session, is not testing any new model deployments or updated compliance policies in Amazon Bedrock guardrails.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Identify if the attacker is moving laterally and compromising other Amazon Bedrock Services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Review the permissions assigned to the implicated user group or role behind these requests to ensure they are authorized and expected to access bedrock and ensure that the least privilege principle is being followed.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: LLM",
          "Data Source: AWS Bedrock",
          "Data Source: AWS S3",
          "Resources: Investigation Guide",
          "Use Case: Policy Violation",
          "Mitre Atlas: T0051",
          "Mitre Atlas: T0054"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "10m",
        "from": "now-60m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Users testing new model deployments or updated compliance policies without Amazon Bedrock guardrails."
        ],
        "references": [
          "https://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-components.html",
          "https://atlas.mitre.org/techniques/AML.T0051",
          "https://atlas.mitre.org/techniques/AML.T0054",
          "https://www.elastic.co/security-labs/elastic-advances-llm-security"
        ],
        "max_signals": 100,
        "threat": [],
        "setup": "## Setup\n\nThis rule requires that guardrails are configured in AWS Bedrock. For more information, see the AWS Bedrock documentation:\n\nhttps://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-create.html\n",
        "related_integrations": [],
        "required_fields": [],
        "id": "3243c500-b962-4ea3-a0d0-ac893c3256c9",
        "rule_id": "f2c653b7-7daf-4774-86f2-34cdbd1fc528",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.919Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.919Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "esql",
        "language": "esql",
        "query": "from logs-aws_bedrock.invocation-*\n// create time window buckets of 1 minute\n| eval time_window = date_trunc(1 minute, @timestamp)\n| where gen_ai.guardrail_id is NULL\n| KEEP @timestamp, time_window, gen_ai.guardrail_id , user.id\n| stats model_invocation_without_guardrails = count() by user.id\n| where model_invocation_without_guardrails > 5\n| sort model_invocation_without_guardrails desc\n"
      },
      {
        "name": "Remote Desktop File Opened from Suspicious Path",
        "description": "Identifies attempts to open a remote desktop file from suspicious paths. Adversaries may abuse RDP files for initial access.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 1,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Initial Access",
          "Tactic: Command and Control",
          "Data Source: Elastic Endgame",
          "Data Source: Elastic Defend",
          "Data Source: System",
          "Data Source: Microsoft Defender for Endpoint",
          "Data Source: Sysmon",
          "Data Source: SentinelOne"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [],
        "references": [
          "https://www.microsoft.com/en-us/security/blog/2024/10/29/midnight-blizzard-conducts-large-scale-spear-phishing-campaign-using-rdp-files/",
          "https://www.blackhillsinfosec.com/rogue-rdp-revisiting-initial-access-methods/",
          "https://shorsec.io/blog/malrdp-implementing-rouge-rdp-manually/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0001",
              "name": "Initial Access",
              "reference": "https://attack.mitre.org/tactics/TA0001/"
            },
            "technique": [
              {
                "id": "T1566",
                "name": "Phishing",
                "reference": "https://attack.mitre.org/techniques/T1566/",
                "subtechnique": [
                  {
                    "id": "T1566.001",
                    "name": "Spearphishing Attachment",
                    "reference": "https://attack.mitre.org/techniques/T1566/001/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          },
          {
            "package": "system",
            "version": "^1.6.4"
          },
          {
            "package": "m365_defender",
            "version": "^2.0.0"
          },
          {
            "package": "sentinel_one_cloud_funnel",
            "version": "^1.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "event.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.args",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "523c9918-ec25-4f7d-a03f-7b45f0d5fb15",
        "rule_id": "f401a0e3-5eeb-4591-969a-f435488e7d12",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.925Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.925Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "process where host.os.type == \"windows\" and event.type == \"start\" and  \n process.name : \"mstsc.exe\" and\n process.args : (\"?:\\\\Users\\\\*\\\\Downloads\\\\*.rdp\", \n                 \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\Temp?_*.rdp\", \n                 \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\7z*.rdp\", \n                 \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\Rar$*\\\\*.rdp\", \n                 \"?:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Temp\\\\BNZ.*.rdp\",\n                 \"C:\\\\Users\\\\*\\\\AppData\\\\Local\\\\Microsoft\\\\Windows\\\\INetCache\\\\Content.Outlook\\\\*.rdp\")\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-endpoint.events.process-*",
          "logs-windows.forwarded*",
          "logs-windows.sysmon_operational-*",
          "endgame-*",
          "logs-system.security*",
          "logs-m365_defender.event-*",
          "logs-sentinel_one_cloud_funnel.*"
        ]
      },
      {
        "name": "AWS IAM Customer-Managed Policy Attached to Role by Rare User",
        "description": "Detects when an AWS Identity and Access Management (IAM) customer-managed policy is attached to a role by an unusual or unauthorized user. Customer-managed policies are policies created and controlled within an AWS account, granting specific permissions to roles or users when attached. This rule identifies potential privilege escalation by flagging cases where a customer-managed policy is attached to a role by an unexpected actor, which could signal unauthorized access or misuse. Attackers may attach policies to roles to expand permissions and elevate their privileges within the AWS environment. This is a [New Terms](https://www.elastic.co/guide/en/security/current/rules-ui-create.html#create-new-terms-rule) rule that uses the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.flattened.request_parameters.roleName` fields to check if the combination of the actor ARN and target role name has not been seen in the last 14 days.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS IAM Customer-Managed Policy Attachment to Role by Unusual User\n\nThis rule detects when a customer-managed IAM policy is attached to a role by an unusual or unauthorized user. This activity may indicate a potential privilege escalation attempt within the AWS environment. Adversaries could attach policies to roles to expand permissions, thereby increasing their capabilities and achieving elevated access.\n\n#### Possible Investigation Steps\n\n- **Identify the Initiating User and Target Role**:\n  - **User Identity**: Examine the `aws.cloudtrail.user_identity.arn` field to determine the user who initiated the policy attachment. Confirm if this user typically has permissions to modify IAM roles and if their activity is consistent with their usual responsibilities.\n  - **Target Role**: Review `aws.cloudtrail.flattened.request_parameters.roleName` to identify the role to which the policy was attached. Assess whether modifying this role is expected for this user or if this action is unusual in your environment.\n\n- **Analyze the Attached Policy**:\n  - **Policy ARN**: Inspect the `aws.cloudtrail.flattened.request_parameters.policyArn` field to identify the specific customer-managed policy attached to the role. Evaluate if this policy grants sensitive permissions, especially permissions that could enable privileged actions or data access.\n  - **Policy Permissions**: Examine the policy content to determine the scope of permissions granted. Policies enabling actions like `s3:*`, `ec2:*`, or `iam:*` could be leveraged for broader access, persistence, or lateral movement.\n\n- **Review Source and User Agent Details**:\n  - **Source IP and Location**: Analyze the `source.address` and `source.geo` fields to confirm the IP address and geographic location where the policy attachment originated. Verify if this matches expected locations for the initiating user.\n  - **User Agent Analysis**: Examine `user_agent.original` to determine if AWS CLI, SDK, or other tooling was used to perform this action. Tool identifiers like `aws-cli` or `boto3` may indicate automation, while others may suggest interactive sessions.\n\n- **Evaluate Anomalous Behavior Patterns**:\n  - **User’s Historical Activity**: Check if the initiating user has a history of attaching policies to roles. An unusual pattern in policy attachments could indicate suspicious behavior, especially if the user lacks authorization.\n  - **Role Modification History**: Investigate if the targeted role is frequently modified by this or other users. Repeated, unauthorized modifications to a role could signal an attempt to maintain elevated access.\n\n- **Correlate with Related CloudTrail Events**:\n  - **Other IAM or CloudTrail Activities**: Look for recent actions associated with the same user or role by reviewing `event.action` by `event.provider` to identify which AWS services were accessed. This may provide context on the user’s intent or additional actions taken.\n  - **Broader Suspicious Patterns**: Identify if similar anomalous events have recently occurred, potentially suggesting a coordinated or escalating attack pattern within the AWS account.\n\n### False Positive Analysis\n\n- **Authorized Administrative Actions**: IAM administrators may legitimately attach policies to roles as part of routine role management. Verify if the user is authorized and if the activity aligns with expected administrative tasks.\n- **Role-Specific Modifications**: Roles that frequently undergo policy updates may trigger this rule during standard operations. Consider monitoring for patterns or establishing known exceptions for specific users or roles where appropriate.\n\n### Response and Remediation\n\n- **Immediate Access Review**: If the policy attachment is unauthorized, consider detaching the policy and reviewing the permissions granted to the initiating user.\n- **Restrict Role Modification Permissions**: Limit which users or roles can attach policies to critical IAM roles. Apply least privilege principles to reduce the risk of unauthorized policy changes.\n- **Enhance Monitoring and Alerts**: Enable real-time alerts and monitoring on IAM policy modifications to detect similar actions promptly.\n- **Regular Policy Audits**: Conduct periodic audits of IAM policies and role permissions to ensure that unauthorized changes are quickly identified and addressed.\n\n### Additional Information\n\nFor more information on managing IAM policies and roles in AWS environments, refer to the [AWS IAM Documentation](https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html) and AWS security best practices.\n",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "@timestamp",
            "user.name",
            "source.address",
            "aws.cloudtrail.user_identity.arn",
            "aws.cloudtrail.user_identity.type",
            "user_agent.original",
            "aws.cloudtrail.flattened.request_parameters.policyArn",
            "aws.cloudtrail.flattened.request_parameters.roleName",
            "event.action",
            "event.outcome",
            "cloud.region",
            "event.provider",
            "aws.cloudtrail.request_parameters"
          ]
        },
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS IAM",
          "Resources: Investigation Guide",
          "Use Case: Identity and Access Audit",
          "Tactic: Privilege Escalation"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Legitimate IAM administrators may attach customer-managed policies to roles for various reasons, such as granting temporary permissions or updating existing policies. Ensure that the user attaching the policy is authorized to do so and that the action is expected."
        ],
        "references": [
          "https://docs.aws.amazon.com/IAM/latest/APIReference/API_AttachRolePolicy.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1548",
                "name": "Abuse Elevation Control Mechanism",
                "reference": "https://attack.mitre.org/techniques/T1548/",
                "subtechnique": [
                  {
                    "id": "T1548.005",
                    "name": "Temporary Elevated Cloud Access",
                    "reference": "https://attack.mitre.org/techniques/T1548/005/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.flattened.request_parameters.policyArn",
            "type": "unknown",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "5fb96c00-11ba-4c8a-8723-42095158b29b",
        "rule_id": "f6d07a70-9ad0-11ef-954f-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.932Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.932Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset: \"aws.cloudtrail\"\n    and event.provider: \"iam.amazonaws.com\"\n    and event.action: \"AttachRolePolicy\"\n    and event.outcome: \"success\"\n    and not aws.cloudtrail.flattened.request_parameters.policyArn: arn\\:aws\\:iam\\:\\:aws\\:policy*\n",
        "new_terms_fields": [
          "aws.cloudtrail.user_identity.arn",
          "aws.cloudtrail.flattened.request_parameters.roleName"
        ],
        "history_window_start": "now-14d",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "language": "kuery"
      },
      {
        "name": "AWS IAM Create User via Assumed Role on EC2 Instance",
        "description": "Detects the creation of an AWS Identity and Access Management (IAM) user initiated by an assumed role on an EC2 instance. Assumed roles allow users or services to temporarily adopt different AWS permissions, but the creation of IAM users through these roles—particularly from within EC2 instances—may indicate a compromised instance. Adversaries might exploit such permissions to establish persistence by creating new IAM users under unauthorized conditions.",
        "risk_score": 47,
        "severity": "medium",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS IAM User Creation via Assumed Role on an EC2 Instance\n\nThis rule detects when an AWS Identity and Access Management (IAM) user is created through an assumed role on an EC2 instance. This action may indicate a potentially compromised instance where an adversary could be using the instance’s permissions to create a new IAM user, enabling persistent unauthorized access.\n\n#### Possible Investigation Steps\n\n- **Identify the Assumed Role and Initiating Instance**:\n  - **Role and Instance**: Examine the `aws.cloudtrail.user_identity.arn` field to determine the specific EC2 instance and role used for this action (e.g., `arn:aws:sts::[account-id]:assumed-role/[role-name]/[instance-id]`). Verify if this behavior aligns with expected usage or represents an anomaly.\n  - **Session Context**: Check the `session_issuer` fields in `aws.cloudtrail.user_identity.session_context` for details about the role assumed by the instance, along with `mfa_authenticated` to determine if Multi-Factor Authentication (MFA) was used.\n\n- **Analyze the Target IAM User**:\n  - **New User Details**: Inspect `aws.cloudtrail.flattened.request_parameters.userName` to see the username that was created. Look at `aws.cloudtrail.flattened.response_elements.user.userName` for confirmation of successful user creation, and validate if the user is expected or authorized.\n  - **Review Creation Time and Context**: Compare the creation time (`@timestamp`) of the user with other activities from the same instance and role to assess if this creation was part of a larger chain of actions.\n\n- **Check User Agent and Tooling**:\n  - **User Agent Analysis**: Review `user_agent.original` to see if AWS CLI, SDK, or other tooling was used for this request. Identifiers such as `aws-cli`, `boto3`, or similar SDK names can indicate the method used, which may differentiate automation from interactive actions.\n  - **Source IP and Location**: Use the `source.address` and `source.geo` fields to identify the IP address and geographic location of the event. Verify if this aligns with expected access patterns for your environment.\n\n- **Evaluate for Persistence Indicators**:\n  - **Role Permissions**: Check the permissions associated with the assumed role (`arn:aws:iam::[account-id]:role/[role-name]`) to determine if creating IAM users is a legitimate activity for this role.\n  - **Automated Role Patterns**: If the assumed role or instance typically creates IAM users for automation purposes, validate this action against historical records to confirm if the event is consistent with normal patterns.\n\n- **Review Related CloudTrail Events**:\n  - **Additional IAM Actions**: Investigate for other recent IAM or CloudTrail events tied to this role or instance, especially `CreateAccessKey` or `AttachUserPolicy` actions. These could signal further attempts to empower or utilize the newly created user.\n  - **Correlate with Other Suspicious Activities**: Determine if other roles or instances recently initiated similar unusual actions, such as privilege escalations or data access.\n\n### False Positive Analysis\n\n- **Expected Automation**: Assumed roles may be used by legitimate automated systems that create users for specific workflows. Confirm if this event aligns with known automation activities.\n- **User Agent and Role Exceptions**: If this action is routine for specific roles or user agents (e.g., `aws-cli`, `boto3`), consider adding those roles or user agents to a monitored exception list for streamlined review.\n\n### Response and Remediation\n\n- **Immediate Access Review**: If user creation was unauthorized, restrict the assumed role’s permissions to prevent further user creation.\n- **Delete Unauthorized Users**: Confirm and remove any unauthorized IAM users, adjusting IAM policies to reduce similar risks.\n- **Enhance Monitoring and Alerts**: Enable enhanced logging or real-time alerts for this role or instance to detect further unauthorized access attempts.\n- **Policy Update**: Consider updating IAM policies associated with roles on EC2 instances to limit sensitive actions like IAM user creation.\n\n### Additional Information\n\nFor further guidance on managing IAM roles and permissions within AWS environments, refer to the [AWS IAM documentation](https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateUser.html) and AWS best practices for security.\n",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "@timestamp",
            "user.name",
            "source.address",
            "aws.cloudtrail.user_identity.arn",
            "aws.cloudtrail.user_identity.type",
            "user_agent.original",
            "event.action",
            "event.outcome",
            "cloud.region",
            "aws.cloudtrail.request_parameters",
            "aws.cloudtrail.response_elements"
          ]
        },
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS IAM",
          "Use Case: Identity and Access Audit",
          "Tactic: Persistence"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "Assumed roles may be used by legitimate automated systems to create IAM users for specific workflows. Verify if this event aligns with known automation activities. If the action is routine for specific roles or user agents (e.g., `aws-cli`, `boto3`), consider adding those roles or user agents to a monitored exception list for streamlined review."
        ],
        "references": [
          "https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateUser.html",
          "https://www.dionach.com/en-us/breaking-into-the-cloud-red-team-tactics-for-aws-compromise/"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1136",
                "name": "Create Account",
                "reference": "https://attack.mitre.org/techniques/T1136/",
                "subtechnique": [
                  {
                    "id": "T1136.003",
                    "name": "Cloud Account",
                    "reference": "https://attack.mitre.org/techniques/T1136/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "aws.cloudtrail.user_identity.arn",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "aws.cloudtrail.user_identity.type",
            "type": "keyword",
            "ecs": false
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "b417045d-414c-4bad-aea7-d88c7385830f",
        "rule_id": "f7a1c536-9ac0-11ef-9911-f661ea17fbcd",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.943Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.943Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset: \"aws.cloudtrail\"\n    and event.provider: \"iam.amazonaws.com\"\n    and event.action: \"CreateUser\"\n    and event.outcome: \"success\"\n    and aws.cloudtrail.user_identity.type: \"AssumedRole\"\n    and aws.cloudtrail.user_identity.arn: *i-*\n",
        "new_terms_fields": [
          "aws.cloudtrail.user_identity.arn"
        ],
        "history_window_start": "now-14d",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "language": "kuery"
      },
      {
        "name": "Untrusted DLL Loaded by Azure AD Sync Service",
        "description": "Identifies the load of a DLL without a valid code signature by the Azure AD Sync process, which may indicate an attempt to persist or collect sensitive credentials passing through the Azure AD synchronization server.",
        "risk_score": 73,
        "severity": "high",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "output_index": "",
        "version": 101,
        "tags": [
          "Domain: Endpoint",
          "OS: Windows",
          "Use Case: Threat Detection",
          "Tactic: Credential Access",
          "Data Source: Elastic Defend",
          "Data Source: Sysmon"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic",
          "Matteo Potito Giorgio"
        ],
        "false_positives": [],
        "references": [
          "https://blog.xpnsec.com/azuread-connect-for-redteam/",
          "https://medium.com/@breakingmhet/detect-azure-pass-through-authentication-abuse-azure-hybrid-environments-ed4274784252",
          "https://learn.microsoft.com/en-us/azure/active-directory/hybrid/tshoot-connect-pass-through-authentication"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0006",
              "name": "Credential Access",
              "reference": "https://attack.mitre.org/tactics/TA0006/"
            },
            "technique": [
              {
                "id": "T1003",
                "name": "OS Credential Dumping",
                "reference": "https://attack.mitre.org/techniques/T1003/"
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "endpoint",
            "version": "^8.2.0"
          },
          {
            "package": "windows",
            "version": "^2.0.0"
          }
        ],
        "required_fields": [
          {
            "name": "dll.code_signature.trusted",
            "type": "boolean",
            "ecs": true
          },
          {
            "name": "dll.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.category",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.code_signature.status",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "file.path",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "host.os.type",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "process.name",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "3f833f93-d525-430e-89a4-02164df03b4a",
        "rule_id": "f909075d-afc7-42d7-b399-600b94352fd9",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.950Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.950Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "eql",
        "query": "any where host.os.type == \"windows\" and process.name : \"AzureADConnectAuthenticationAgentService.exe\" and \n(\n (event.category == \"library\" and event.action == \"load\") or \n (event.category == \"process\" and event.action : \"Image loaded*\")\n) and \n\nnot (?dll.code_signature.trusted == true or file.code_signature.status == \"Valid\") and not \n\n  (\n   /* Elastic defend DLL path */\n   ?dll.path :\n         (\"?:\\\\Windows\\\\assembly\\\\NativeImages*\",\n          \"?:\\\\Windows\\\\Microsoft.NET\\\\*\",\n          \"?:\\\\Windows\\\\WinSxS\\\\*\",\n          \"?:\\\\Windows\\\\System32\\\\DriverStore\\\\FileRepository\\\\*\") or \n          \n   /* Sysmon DLL path is mapped to file.path */\n   file.path :\n         (\"?:\\\\Windows\\\\assembly\\\\NativeImages*\",\n          \"?:\\\\Windows\\\\Microsoft.NET\\\\*\",\n          \"?:\\\\Windows\\\\WinSxS\\\\*\",\n          \"?:\\\\Windows\\\\System32\\\\DriverStore\\\\FileRepository\\\\*\")\n  )\n",
        "language": "eql",
        "index": [
          "winlogbeat-*",
          "logs-endpoint.events.library*",
          "logs-windows.sysmon_operational-*"
        ]
      },
      {
        "name": "AWS STS AssumeRoot by Rare User and Member Account",
        "description": "Identifies when the STS `AssumeRoot` action is performed by a rare user in AWS. The AssumeRoot action allows users to assume the root member account role, granting elevated but specific permissions based on the task policy specified. Adversaries whom may have compromised user credentials, such as access and secret keys, can use this technique to escalate privileges and gain unauthorized access to AWS resources. This is a [New Terms](https://www.elastic.co/guide/en/security/current/rules-ui-create.html#create-new-terms-rule) rule that identifies when the STS `AssumeRoot` action is performed by a user that rarely assumes this role and specific member account.",
        "risk_score": 21,
        "severity": "low",
        "timestamp_override": "event.ingested",
        "license": "Elastic License v2",
        "note": "## Triage and Analysis\n\n### Investigating AWS STS AssumeRoot by Rare User and Member Account\n\nThis rule identifies instances where AWS STS (Security Token Service) is used to assume a root role, granting temporary credentials for AWS resource access. While this action is often legitimate, it can be exploited by adversaries to obtain unauthorized access, escalate privileges, or move laterally within an AWS environment.\n\n#### Possible Investigation Steps\n\n- **Identify the Actor and Assumed Role**:\n  - **User Identity**: Review the `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.type` fields to determine who initiated the `AssumeRoot` action.\n  - **Account Context**: Check the `aws.cloudtrail.recipient_account_id` field for the account affected by the action. This is likely the management account.\n  - **Authentication**: If available, review the `aws.cloudtrail.user_identity.access_key_id` to identify the access key used for the action. This key may be compromised in the case of unauthorized activity.\n  - **Resources**: Inspect `aws.cloudtrail.resources.type` and `aws.cloudtrail.resources.arn` to determine the resource or role assumed. This is the member account where the root role was assumed.\n\n- **Analyze Request Parameters**:\n  - **Session Details**: Check `aws.cloudtrail.flattened.request_parameters.durationSeconds` for session duration.\n  - **Permissions**: Review `aws.cloudtrail.flattened.request_parameters.taskPolicyArn` for the associated policy. These policies are predefined and grant specific permissions to the assumed root account.\n  - **Target Entity**: Inspect the `aws.cloudtrail.flattened.request_parameters.targetPrincipal` field for the entity being accessed. This is typically the member account.\n  - **Target Policy**: Inspect the `aws.cloudtrail.flattened.request_parameters.targetPolicyArn` field for the policy applied to temporary root credentials. This can help determine the scope of the permissions granted.\n\n- **Examine Response Details**:\n  - **Credentials Issued**: Review `aws.cloudtrail.flattened.response_elements.credentials` to confirm credentials were issued and note their expiration (`expiration` field). The temporary access key can be used to pivot into other actions done by the assumed root account by searching for the value in `aws.cloudtrail.user_identity.access_key_id`.\n\n- **Inspect Source Details**:\n  - **Source IP and Location**: Evaluate `source.address` and `source.geo` fields to confirm the request's origin. Unusual locations might indicate unauthorized activity.\n  - **User Agent**: Analyze `user_agent.original` to determine the tool or application used (e.g., AWS CLI, SDK, or custom tooling).\n\n- **Correlate with Related Events**:\n  - **Concurrent Events**: Look for surrounding CloudTrail events that indicate follow-up actions, such as access to sensitive resources or privilege escalation attempts.\n  - **Historical Activity**: Review historical activity for the `aws.cloudtrail.user_identity.arn` to determine if this action is anomalous.\n\n- **Evaluate Privilege Escalation Risk**:\n  - **Role Privileges**: Inspect the privileges granted by the assumed role or task policy (`aws.cloudtrail.flattened.request_parameters.taskPolicyArn`).\n  - **Operational Context**: Confirm whether the action aligns with routine operations or is unusual.\n\n### False Positive Analysis\n\n- **Authorized Administrative Activity**:\n  - Verify if the activity was initiated by an AWS administrator for legitimate purposes.\n- **Automated Workflows**:\n  - Identify if the action was part of an automated process or workflow.\n\n### Response and Remediation\n\n1. **Revoke Unauthorized Credentials**:\n   - If malicious activity is identified, immediately revoke the session tokens and access keys associated with the `AssumeRoot` action.\n   - It may be worth removing the compromised access key from the affected user or service account.\n2. **Enhance Monitoring**:\n   - Increase the monitoring frequency for sensitive roles and actions, especially `AssumeRoot`.\n3. **Review IAM Policies**:\n   - Limit permissions for accounts or roles to assume root and enforce multi-factor authentication (MFA) where applicable.\n4. **Contain and Investigate**:\n   - Isolate affected accounts or roles and follow incident response procedures to determine the scope and impact of the activity.\n\n### Additional Information\n\nFor more information on AssumeRoot, refer to the [AWS STS documentation](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoot.html).\n",
        "output_index": "",
        "investigation_fields": {
          "field_names": [
            "@timestamp",
            "aws.cloudtrail.user_identity.type",
            "aws.cloudtrail.user_identity.arn",
            "aws.cloudtrail.user_identity.access_key_id",
            "source.address",
            "aws.cloudtrail.resources.account_id",
            "aws.cloudtrail.recipient_account_id",
            "aws.cloudtrail.flattened.request_parameters",
            "event.action",
            "event.outcome",
            "aws.cloudtrail.flattened.request_parameters.taskPolicyArn",
            "cloud.region",
            "aws.cloudtrail.request_parameters",
            "aws.cloudtrail.response_elements"
          ]
        },
        "version": 1,
        "tags": [
          "Domain: Cloud",
          "Data Source: AWS",
          "Data Source: Amazon Web Services",
          "Data Source: AWS STS",
          "Resources: Investigation Guide",
          "Use Case: Identity and Access Audit",
          "Tactic: Privilege Escalation"
        ],
        "enabled": false,
        "risk_score_mapping": [],
        "severity_mapping": [],
        "interval": "5m",
        "from": "now-9m",
        "to": "now",
        "actions": [],
        "exceptions_list": [],
        "author": [
          "Elastic"
        ],
        "false_positives": [
          "AWS administrators or automated processes might regularly assume root for legitimate administrative purposes.",
          "AWS services might assume root to access AWS resources as part of their standard operations.",
          "Automated workflows might assume root to perform periodic administrative tasks."
        ],
        "references": [
          "https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoot.html"
        ],
        "max_signals": 100,
        "threat": [
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0004",
              "name": "Privilege Escalation",
              "reference": "https://attack.mitre.org/tactics/TA0004/"
            },
            "technique": [
              {
                "id": "T1548",
                "name": "Abuse Elevation Control Mechanism",
                "reference": "https://attack.mitre.org/techniques/T1548/",
                "subtechnique": [
                  {
                    "id": "T1548.005",
                    "name": "Temporary Elevated Cloud Access",
                    "reference": "https://attack.mitre.org/techniques/T1548/005/"
                  }
                ]
              }
            ]
          },
          {
            "framework": "MITRE ATT&CK",
            "tactic": {
              "id": "TA0003",
              "name": "Persistence",
              "reference": "https://attack.mitre.org/tactics/TA0003/"
            },
            "technique": [
              {
                "id": "T1098",
                "name": "Account Manipulation",
                "reference": "https://attack.mitre.org/techniques/T1098/",
                "subtechnique": [
                  {
                    "id": "T1098.003",
                    "name": "Additional Cloud Roles",
                    "reference": "https://attack.mitre.org/techniques/T1098/003/"
                  }
                ]
              }
            ]
          }
        ],
        "setup": "",
        "related_integrations": [
          {
            "package": "aws",
            "version": "^2.0.0",
            "integration": "cloudtrail"
          }
        ],
        "required_fields": [
          {
            "name": "event.action",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.dataset",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.outcome",
            "type": "keyword",
            "ecs": true
          },
          {
            "name": "event.provider",
            "type": "keyword",
            "ecs": true
          }
        ],
        "id": "48197a22-b60a-48ff-8b0d-691c6c05eb4a",
        "rule_id": "962a71ae-aac9-11ef-9348-f661ea17fbce",
        "immutable": true,
        "rule_source": {
          "type": "external",
          "is_customized": false
        },
        "updated_at": "2024-12-13T19:41:31.956Z",
        "updated_by": "elastic",
        "created_at": "2024-12-13T19:41:31.956Z",
        "created_by": "elastic",
        "revision": 0,
        "type": "new_terms",
        "query": "event.dataset: \"aws.cloudtrail\"\n    and event.provider: \"sts.amazonaws.com\"\n    and event.action: \"AssumeRoot\"\n    and event.outcome: \"success\"\n",
        "new_terms_fields": [
          "aws.cloudtrail.user_identity.arn",
          "aws.cloudtrail.resources.account_id"
        ],
        "history_window_start": "now-10d",
        "index": [
          "filebeat-*",
          "logs-aws.cloudtrail-*"
        ],
        "language": "kuery"
      }
    ],
    "skipped": []
  },
  "errors": []
}