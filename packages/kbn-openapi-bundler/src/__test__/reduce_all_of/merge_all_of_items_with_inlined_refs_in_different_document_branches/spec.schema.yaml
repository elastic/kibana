openapi: 3.0.3
info:
  title: Test endpoint GET
  version: '2023-10-31'
paths:
  /api/some_api:
    get:
      operationId: TestEndpointGet
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  responseSchemaFieldA:
                    $ref: '#/components/schemas/SchemaToInline'
                  responseSchemaFieldB:
                    $ref: '#/components/schemas/MySchema'

components:
  schemas:
    MySchema:
      allOf:
        - $ref: '#/components/schemas/SchemaToInline'
        - type: object
          properties:
            mySchemaSubfield:
              type: boolean

    # SchemaToInline is referenced in two branches
    #
    # - responseSchemaFieldA -> #/components/schemas/SchemaToInline
    #
    # - responseSchemaFieldB -> #/components/schemas/MySchema -> #/components/schemas/SchemaToInline
    #
    # The second path includes intermediate "mySchemaSubfield" expected to be merged with
    # #/components/schemas/SchemaToInline but responseSchemaFieldA shouldn't have
    # mySchemaSubfield
    #
    SchemaToInline:
      x-inline: true
      allOf:
        - type: object
          properties:
            SchemaToInlineField1:
              type: string
        - type: object
          properties:
            SchemaToInlineField2:
              type: number
          required:
            - field2
