"use strict";

var _ast = require("./ast");

var _get_type = require("./get_type");

/*
 * Licensed to Elasticsearch B.V. under one or more contributor
 * license agreements. See the NOTICE file distributed with
 * this work for additional information regarding copyright
 * ownership. Elasticsearch B.V. licenses this file to you under
 * the Apache License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
describe('ast fromExpression', function () {
  describe('invalid expression', function () {
    it('throws with invalid expression', function () {
      var check = function check() {
        return (0, _ast.fromExpression)('wat!');
      };

      expect(check).toThrowError(/Unable to parse expression/i);
    });
  });
  describe('zero-item expression', function () {
    it('yields a zero-length chain when empty', function () {
      var expression = '';
      var astObject = (0, _ast.fromExpression)(expression);
      expect(astObject).toHaveProperty('chain');
      expect(astObject.chain).toEqual([]);
    });
  });
  describe('single item expression', function () {
    it('is a chain', function () {
      var expression = 'whatever';
      expect((0, _ast.fromExpression)(expression)).toHaveProperty('chain');
    });
    it('is a value', function () {
      var expression = '"hello"';
      expect((0, _ast.fromExpression)(expression, 'argument')).toBe('hello');
    });
    describe('function without arguments', function () {
      var expression;
      var astObject;
      var block;
      beforeEach(function () {
        expression = 'csv';
        astObject = (0, _ast.fromExpression)(expression);
        block = astObject.chain[0];
      });
      it('is a function ', function () {
        expect((0, _get_type.getType)(block)).toBe('function');
      });
      it('is csv function', function () {
        expect(block.function).toBe('csv');
      });
      it('has no arguments', function () {
        expect(block.arguments).toEqual({});
      });
    });
    describe('with string values', function () {
      var expression;
      var astObject;
      var block;
      beforeEach(function () {
        expression = 'elasticsearch index="logstash-*" oranges=bananas';
        astObject = (0, _ast.fromExpression)(expression);
        block = astObject.chain[0];
      });
      it('has arguemnts properties', function () {
        expect(block.arguments).not.toEqual({});
      });
      it('has index argument with string value', function () {
        expect(block.arguments).toHaveProperty('index');
        expect(block.arguments.index).toEqual(['logstash-*']);
      });
      it('has oranges argument with string value', function () {
        expect(block.arguments).toHaveProperty('oranges');
        expect(block.arguments.oranges).toEqual(['bananas']);
      });
    });
    describe('with function value', function () {
      var expression;
      var astObject;
      var block;
      beforeEach(function () {
        expression = 'it exampleFunction={someFunction q="do something"}';
        astObject = (0, _ast.fromExpression)(expression);
        block = astObject.chain[0];
      });
      it('is expression type', function () {
        expect(block.arguments).toHaveProperty('exampleFunction');
        expect(block.arguments.exampleFunction[0]).toHaveProperty('type');
      });
      it('has expected shape', function () {
        expect(block.arguments.exampleFunction).toEqual([{
          type: 'expression',
          chain: [{
            type: 'function',
            function: 'someFunction',
            arguments: {
              q: ['do something']
            }
          }]
        }]);
      });
    });
    describe('with partial value', function () {
      var expression;
      var astObject;
      var block;
      beforeEach(function () {
        expression = 'it examplePartial=${somePartialFunction q="do something"}';
        astObject = (0, _ast.fromExpression)(expression);
        block = astObject.chain[0];
      });
      it('is expression type', function () {
        expect(block.arguments).toHaveProperty('examplePartial');
        expect(block.arguments.examplePartial[0]).toHaveProperty('type');
      });
      it('has expected shape', function () {
        expect(block.arguments.examplePartial).toEqual([{
          type: 'expression',
          chain: [{
            type: 'function',
            function: 'somePartialFunction',
            arguments: {
              q: ['do something']
            }
          }]
        }]);
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tb24vbGliL2FzdC5mcm9tX2V4cHJlc3Npb24udGVzdC5qcyJdLCJuYW1lcyI6WyJkZXNjcmliZSIsIml0IiwiY2hlY2siLCJleHBlY3QiLCJ0b1Rocm93RXJyb3IiLCJleHByZXNzaW9uIiwiYXN0T2JqZWN0IiwidG9IYXZlUHJvcGVydHkiLCJjaGFpbiIsInRvRXF1YWwiLCJ0b0JlIiwiYmxvY2siLCJiZWZvcmVFYWNoIiwiZnVuY3Rpb24iLCJhcmd1bWVudHMiLCJub3QiLCJpbmRleCIsIm9yYW5nZXMiLCJleGFtcGxlRnVuY3Rpb24iLCJ0eXBlIiwicSIsImV4YW1wbGVQYXJ0aWFsIl0sIm1hcHBpbmdzIjoiOztBQW1CQTs7QUFDQTs7QUFwQkE7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXNCQUEsUUFBUSxDQUFDLG9CQUFELEVBQXVCLFlBQU07QUFDbkNBLEVBQUFBLFFBQVEsQ0FBQyxvQkFBRCxFQUF1QixZQUFNO0FBQ25DQyxJQUFBQSxFQUFFLENBQUMsZ0NBQUQsRUFBbUMsWUFBTTtBQUN6QyxVQUFNQyxLQUFLLEdBQUcsU0FBUkEsS0FBUTtBQUFBLGVBQU0seUJBQWUsTUFBZixDQUFOO0FBQUEsT0FBZDs7QUFDQUMsTUFBQUEsTUFBTSxDQUFDRCxLQUFELENBQU4sQ0FBY0UsWUFBZCxDQUEyQiw2QkFBM0I7QUFDRCxLQUhDLENBQUY7QUFJRCxHQUxPLENBQVI7QUFPQUosRUFBQUEsUUFBUSxDQUFDLHNCQUFELEVBQXlCLFlBQU07QUFDckNDLElBQUFBLEVBQUUsQ0FBQyx1Q0FBRCxFQUEwQyxZQUFNO0FBQ2hELFVBQU1JLFVBQVUsR0FBRyxFQUFuQjtBQUNBLFVBQU1DLFNBQVMsR0FBRyx5QkFBZUQsVUFBZixDQUFsQjtBQUNBRixNQUFBQSxNQUFNLENBQUNHLFNBQUQsQ0FBTixDQUFrQkMsY0FBbEIsQ0FBaUMsT0FBakM7QUFDQUosTUFBQUEsTUFBTSxDQUFDRyxTQUFTLENBQUNFLEtBQVgsQ0FBTixDQUF3QkMsT0FBeEIs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YXN0aWNzZWFyY2ggQi5WLiB1bmRlciBvbmUgb3IgbW9yZSBjb250cmlidXRvclxuICogbGljZW5zZSBhZ3JlZW1lbnRzLiBTZWUgdGhlIE5PVElDRSBmaWxlIGRpc3RyaWJ1dGVkIHdpdGhcbiAqIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvbiByZWdhcmRpbmcgY29weXJpZ2h0XG4gKiBvd25lcnNoaXAuIEVsYXN0aWNzZWFyY2ggQi5WLiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyXG4gKiB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5XG4gKiBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IGZyb21FeHByZXNzaW9uIH0gZnJvbSAnLi9hc3QnO1xuaW1wb3J0IHsgZ2V0VHlwZSB9IGZyb20gJy4vZ2V0X3R5cGUnO1xuXG5kZXNjcmliZSgnYXN0IGZyb21FeHByZXNzaW9uJywgKCkgPT4ge1xuICBkZXNjcmliZSgnaW52YWxpZCBleHByZXNzaW9uJywgKCkgPT4ge1xuICAgIGl0KCd0aHJvd3Mgd2l0aCBpbnZhbGlkIGV4cHJlc3Npb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBjaGVjayA9ICgpID0+IGZyb21FeHByZXNzaW9uKCd3YXQhJyk7XG4gICAgICBleHBlY3QoY2hlY2spLnRvVGhyb3dFcnJvcigvVW5hYmxlIHRvIHBhcnNlIGV4cHJlc3Npb24vaSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd6ZXJvLWl0ZW0gZXhwcmVzc2lvbicsICgpID0+IHtcbiAgICBpdCgneWllbGRzIGEgemVyby1sZW5ndGggY2hhaW4gd2hlbiBlbXB0eScsICgpID0+IHtcbiAgICAgIGNvbnN0IGV4cHJlc3Npb24gPSAnJztcbiAgICAgIGNvbnN0IGFzdE9iamVjdCA9IGZyb21FeHByZXNzaW9uKGV4cHJlc3Npb24pO1xuICAgICAgZXhwZWN0KGFzdE9iamVjdCkudG9IYXZlUHJvcGVydHkoJ2NoYWluJyk7XG4gICAgICBleHBlY3QoYXN0T2JqZWN0LmNoYWluKS50b0VxdWFsKFtdKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NpbmdsZSBpdGVtIGV4cHJlc3Npb24nLCAoKSA9PiB7XG4gICAgaXQoJ2lzIGEgY2hhaW4nLCAoKSA9PiB7XG4gICAgICBjb25zdCBleHByZXNzaW9uID0gJ3doYXRldmVyJztcbiAgICAgIGV4cGVjdChmcm9tRXhwcmVzc2lvbihleHByZXNzaW9uKSkudG9IYXZlUHJvcGVydHkoJ2NoYWluJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnaXMgYSB2YWx1ZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGV4cHJlc3Npb24gPSAnXCJoZWxsb1wiJztcbiAgICAgIGV4cGVjdChmcm9tRXhwcmVzc2lvbihleHByZXNzaW9uLCAnYXJndW1lbnQnKSkudG9CZSgnaGVsbG8nKTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdmdW5jdGlvbiB3aXRob3V0IGFyZ3VtZW50cycsICgpID0+IHtcbiAgICAgIGxldCBleHByZXNzaW9uO1xuICAgICAgbGV0IGFzdE9iamVjdDtcbiAgICAgIGxldCBibG9jaztcblxuICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIGV4cHJlc3Npb24gPSAnY3N2JztcbiAgICAgICAgYXN0T2JqZWN0ID0gZnJvbUV4cHJlc3Npb24oZXhwcmVzc2lvbik7XG4gICAgICAgIGJsb2NrID0gYXN0T2JqZWN0LmNoYWluWzBdO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdpcyBhIGZ1bmN0aW9uICcsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KGdldFR5cGUoYmxvY2spKS50b0JlKCdmdW5jdGlvbicpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdpcyBjc3YgZnVuY3Rpb24nLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdChibG9jay5mdW5jdGlvbikudG9CZSgnY3N2Jyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ2hhcyBubyBhcmd1bWVudHMnLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdChibG9jay5hcmd1bWVudHMpLnRvRXF1YWwoe30pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnd2l0aCBzdHJpbmcgdmFsdWVzJywgKCkgPT4ge1xuICAgICAgbGV0IGV4cHJlc3Npb247XG4gICAgICBsZXQgYXN0T2JqZWN0O1xuICAgICAgbGV0IGJsb2NrO1xuXG4gICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgZXhwcmVzc2lvbiA9ICdlbGFzdGljc2VhcmNoIGluZGV4PVwibG9nc3Rhc2gtKlwiIG9yYW5nZXM9YmFuYW5hcyc7XG4gICAgICAgIGFzdE9iamVjdCA9IGZyb21FeHByZXNzaW9uKGV4cHJlc3Npb24pO1xuICAgICAgICBibG9jayA9IGFzdE9iamVjdC5jaGFpblswXTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnaGFzIGFyZ3VlbW50cyBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgICAgICBleHBlY3QoYmxvY2suYXJndW1lbnRzKS5ub3QudG9FcXVhbCh7fSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ2hhcyBpbmRleCBhcmd1bWVudCB3aXRoIHN0cmluZyB2YWx1ZScsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KGJsb2NrLmFyZ3VtZW50cykudG9IYXZlUHJvcGVydHkoJ2luZGV4Jyk7XG4gICAgICAgIGV4cGVjdChibG9jay5hcmd1bWVudHMuaW5kZXgpLnRvRXF1YWwoWydsb2dzdGFzaC0qJ10pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdoYXMgb3JhbmdlcyBhcmd1bWVudCB3aXRoIHN0cmluZyB2YWx1ZScsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KGJsb2NrLmFyZ3VtZW50cykudG9IYXZlUHJvcGVydHkoJ29yYW5nZXMnKTtcbiAgICAgICAgZXhwZWN0KGJsb2NrLmFyZ3VtZW50cy5vcmFuZ2VzKS50b0VxdWFsKFsnYmFuYW5hcyddKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3dpdGggZnVuY3Rpb24gdmFsdWUnLCAoKSA9PiB7XG4gICAgICBsZXQgZXhwcmVzc2lvbjtcbiAgICAgIGxldCBhc3RPYmplY3Q7XG4gICAgICBsZXQgYmxvY2s7XG5cbiAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICBleHByZXNzaW9uID0gJ2l0IGV4YW1wbGVGdW5jdGlvbj17c29tZUZ1bmN0aW9uIHE9XCJkbyBzb21ldGhpbmdcIn0nO1xuICAgICAgICBhc3RPYmplY3QgPSBmcm9tRXhwcmVzc2lvbihleHByZXNzaW9uKTtcbiAgICAgICAgYmxvY2sgPSBhc3RPYmplY3QuY2hhaW5bMF07XG4gICAgICB9KTtcblxuICAgICAgaXQoJ2lzIGV4cHJlc3Npb24gdHlwZScsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KGJsb2NrLmFyZ3VtZW50cykudG9IYXZlUHJvcGVydHkoJ2V4YW1wbGVGdW5jdGlvbicpO1xuICAgICAgICBleHBlY3QoYmxvY2suYXJndW1lbnRzLmV4YW1wbGVGdW5jdGlvblswXSkudG9IYXZlUHJvcGVydHkoJ3R5cGUnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnaGFzIGV4cGVjdGVkIHNoYXBlJywgKCkgPT4ge1xuICAgICAgICBleHBlY3QoYmxvY2suYXJndW1lbnRzLmV4YW1wbGVGdW5jdGlvbikudG9FcXVhbChbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogJ2V4cHJlc3Npb24nLFxuICAgICAgICAgICAgY2hhaW46IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdmdW5jdGlvbicsXG4gICAgICAgICAgICAgICAgZnVuY3Rpb246ICdzb21lRnVuY3Rpb24nLFxuICAgICAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICAgICAgcTogWydkbyBzb21ldGhpbmcnXSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9LFxuICAgICAgICBdKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3dpdGggcGFydGlhbCB2YWx1ZScsICgpID0+IHtcbiAgICAgIGxldCBleHByZXNzaW9uO1xuICAgICAgbGV0IGFzdE9iamVjdDtcbiAgICAgIGxldCBibG9jaztcblxuICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIGV4cHJlc3Npb24gPSAnaXQgZXhhbXBsZVBhcnRpYWw9JHtzb21lUGFydGlhbEZ1bmN0aW9uIHE9XCJkbyBzb21ldGhpbmdcIn0nO1xuICAgICAgICBhc3RPYmplY3QgPSBmcm9tRXhwcmVzc2lvbihleHByZXNzaW9uKTtcbiAgICAgICAgYmxvY2sgPSBhc3RPYmplY3QuY2hhaW5bMF07XG4gICAgICB9KTtcblxuICAgICAgaXQoJ2lzIGV4cHJlc3Npb24gdHlwZScsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KGJsb2NrLmFyZ3VtZW50cykudG9IYXZlUHJvcGVydHkoJ2V4YW1wbGVQYXJ0aWFsJyk7XG4gICAgICAgIGV4cGVjdChibG9jay5hcmd1bWVudHMuZXhhbXBsZVBhcnRpYWxbMF0pLnRvSGF2ZVByb3BlcnR5KCd0eXBlJyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ2hhcyBleHBlY3RlZCBzaGFwZScsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KGJsb2NrLmFyZ3VtZW50cy5leGFtcGxlUGFydGlhbCkudG9FcXVhbChbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogJ2V4cHJlc3Npb24nLFxuICAgICAgICAgICAgY2hhaW46IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdmdW5jdGlvbicsXG4gICAgICAgICAgICAgICAgZnVuY3Rpb246ICdzb21lUGFydGlhbEZ1bmN0aW9uJyxcbiAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHtcbiAgICAgICAgICAgICAgICAgIHE6IFsnZG8gc29tZXRoaW5nJ10sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==