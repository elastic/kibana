(function(){var root=this,timezoneJS;typeof exports!="undefined"?timezoneJS=exports:timezoneJS=root.timezoneJS={},timezoneJS.VERSION="0.4.4";var $=root.$||root.jQuery||root.Zepto,fleegix=root.fleegix,_arrIndexOf,DAYS=timezoneJS.Days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],MONTHS=timezoneJS.Months=["January","February","March","April","May","June","July","August","September","October","November","December"],SHORT_MONTHS={},SHORT_DAYS={},EXACT_DATE_TIME={},TZ_REGEXP=new RegExp("^[a-zA-Z]+/");for(var i=0;i<MONTHS.length;i++)SHORT_MONTHS[MONTHS[i].substr(0,3)]=i;for(i=0;i<DAYS.length;i++)SHORT_DAYS[DAYS[i].substr(0,3)]=i;_arrIndexOf=Array.prototype.indexOf||function(e){if(this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:r!==0&&r!==Infinity&&r!==-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(
i in t&&t[i]===e)return i;return-1};var _fixWidth=function(e,t){if(typeof e!="number")throw"not a number: "+e;var n=e.toString();if(e.length>t)return e.substr(e.length-t,e.length);while(n.length<t)n="0"+n;return n},_transport=function(e){if(!!fleegix&&typeof fleegix.xhr!="undefined"||!!$&&typeof $.ajax!="undefined"){if(!e)return;if(!e.url)throw new Error("URL must be specified");return"async"in e||(e.async=!0),e.async?fleegix&&fleegix.xhr?fleegix.xhr.send({url:e.url,method:"get",handleSuccess:e.success,handleErr:e.error}):$.ajax({url:e.url,dataType:"text",method:"GET",error:e.error,success:e.success}):fleegix&&fleegix.xhr?fleegix.xhr.doReq({url:e.url,async:!1}):$.ajax({url:e.url,async:!1}).responseText}throw new Error("Please use the Fleegix.js XHR module, jQuery ajax, Zepto ajax, or define your own transport mechanism for downloading zone files.")};timezoneJS.Date=function(){var e=Array.prototype.slice.apply(arguments),t=null,n=null,r=[];Object.prototype.toString.call(e[0])==="[object Array]"&&
(e=e[0]),typeof e[e.length-1]=="string"&&TZ_REGEXP.test(e[e.length-1])&&(n=e.pop());switch(e.length){case 0:t=new Date;break;case 1:t=new Date(e[0]);break;default:for(var i=0;i<7;i++)r[i]=e[i]||0;t=new Date(r[0],r[1],r[2],r[3],r[4],r[5],r[6])}this._useCache=!1,this._tzInfo={},this._day=0,this.year=0,this.month=0,this.date=0,this.hours=0,this.minutes=0,this.seconds=0,this.milliseconds=0,this.timezone=n||null,r.length?this.setFromDateObjProxy(t):this.setFromTimeProxy(t.getTime(),n)},timezoneJS.Date.prototype={getDate:function(){return this.date},getDay:function(){return this._day},getFullYear:function(){return this.year},getMonth:function(){return this.month},getYear:function(){return this.year-1900},getHours:function(){return this.hours},getMilliseconds:function(){return this.milliseconds},getMinutes:function(){return this.minutes},getSeconds:function(){return this.seconds},getUTCDate:function(){return this.getUTCDateProxy().getUTCDate()},getUTCDay:function(){return this.getUTCDateProxy(
).getUTCDay()},getUTCFullYear:function(){return this.getUTCDateProxy().getUTCFullYear()},getUTCHours:function(){return this.getUTCDateProxy().getUTCHours()},getUTCMilliseconds:function(){return this.getUTCDateProxy().getUTCMilliseconds()},getUTCMinutes:function(){return this.getUTCDateProxy().getUTCMinutes()},getUTCMonth:function(){return this.getUTCDateProxy().getUTCMonth()},getUTCSeconds:function(){return this.getUTCDateProxy().getUTCSeconds()},getTime:function(){return this._timeProxy+this.getTimezoneOffset()*60*1e3},getTimezone:function(){return this.timezone},getTimezoneOffset:function(){return this.getTimezoneInfo().tzOffset},getTimezoneAbbreviation:function(){return this.getTimezoneInfo().tzAbbr},getTimezoneInfo:function(){if(this._useCache)return this._tzInfo;var e;return this.timezone?e=this.timezone==="Etc/UTC"||this.timezone==="Etc/GMT"?{tzOffset:0,tzAbbr:"UTC"}:timezoneJS.timezone.getTzInfo(this._timeProxy,this.timezone):e={tzOffset:this.getLocalOffset(),tzAbbr:null},this._tzInfo=
e,this._useCache=!0,e},getUTCDateProxy:function(){var e=new Date(this._timeProxy);return e.setUTCMinutes(e.getUTCMinutes()+this.getTimezoneOffset()),e},setDate:function(e){return this.setAttribute("date",e),this.getTime()},setFullYear:function(e,t,n){return n!==undefined&&this.setAttribute("date",1),this.setAttribute("year",e),t!==undefined&&this.setAttribute("month",t),n!==undefined&&this.setAttribute("date",n),this.getTime()},setMonth:function(e,t){return this.setAttribute("month",e),t!==undefined&&this.setAttribute("date",t),this.getTime()},setYear:function(e){return e=Number(e),0<=e&&e<=99&&(e+=1900),this.setUTCAttribute("year",e),this.getTime()},setHours:function(e,t,n,r){return this.setAttribute("hours",e),t!==undefined&&this.setAttribute("minutes",t),n!==undefined&&this.setAttribute("seconds",n),r!==undefined&&this.setAttribute("milliseconds",r),this.getTime()},setMinutes:function(e,t,n){return this.setAttribute("minutes",e),t!==undefined&&this.setAttribute("seconds",t),n!==undefined&&
this.setAttribute("milliseconds",n),this.getTime()},setSeconds:function(e,t){return this.setAttribute("seconds",e),t!==undefined&&this.setAttribute("milliseconds",t),this.getTime()},setMilliseconds:function(e){return this.setAttribute("milliseconds",e),this.getTime()},setTime:function(e){if(isNaN(e))throw new Error("Units must be a number.");return this.setFromTimeProxy(e,this.timezone),this.getTime()},setUTCFullYear:function(e,t,n){return n!==undefined&&this.setUTCAttribute("date",1),this.setUTCAttribute("year",e),t!==undefined&&this.setUTCAttribute("month",t),n!==undefined&&this.setUTCAttribute("date",n),this.getTime()},setUTCMonth:function(e,t){return this.setUTCAttribute("month",e),t!==undefined&&this.setUTCAttribute("date",t),this.getTime()},setUTCDate:function(e){return this.setUTCAttribute("date",e),this.getTime()},setUTCHours:function(e,t,n,r){return this.setUTCAttribute("hours",e),t!==undefined&&this.setUTCAttribute("minutes",t),n!==undefined&&this.setUTCAttribute("seconds",n),
r!==undefined&&this.setUTCAttribute("milliseconds",r),this.getTime()},setUTCMinutes:function(e,t,n){return this.setUTCAttribute("minutes",e),t!==undefined&&this.setUTCAttribute("seconds",t),n!==undefined&&this.setUTCAttribute("milliseconds",n),this.getTime()},setUTCSeconds:function(e,t){return this.setUTCAttribute("seconds",e),t!==undefined&&this.setUTCAttribute("milliseconds",t),this.getTime()},setUTCMilliseconds:function(e){return this.setUTCAttribute("milliseconds",e),this.getTime()},setFromDateObjProxy:function(e){this.year=e.getFullYear(),this.month=e.getMonth(),this.date=e.getDate(),this.hours=e.getHours(),this.minutes=e.getMinutes(),this.seconds=e.getSeconds(),this.milliseconds=e.getMilliseconds(),this._day=e.getDay(),this._dateProxy=e,this._timeProxy=Date.UTC(this.year,this.month,this.date,this.hours,this.minutes,this.seconds,this.milliseconds),this._useCache=!1},setFromTimeProxy:function(e,t){var n=new Date(e),r;r=t?timezoneJS.timezone.getTzInfo(n,t).tzOffset:n.getTimezoneOffset
(),n.setTime(e+(n.getTimezoneOffset()-r)*6e4),this.setFromDateObjProxy(n)},setAttribute:function(e,t){if(isNaN(t))throw new Error("Units must be a number.");var n=this._dateProxy,r=e==="year"?"FullYear":e.substr(0,1).toUpperCase()+e.substr(1);n["set"+r](t),this.setFromDateObjProxy(n)},setUTCAttribute:function(e,t){if(isNaN(t))throw new Error("Units must be a number.");var n=e==="year"?"FullYear":e.substr(0,1).toUpperCase()+e.substr(1),r=this.getUTCDateProxy();r["setUTC"+n](t),r.setUTCMinutes(r.getUTCMinutes()-this.getTimezoneOffset()),this.setFromTimeProxy(r.getTime()+this.getTimezoneOffset()*6e4,this.timezone)},setTimezone:function(e){var t=this.getTimezoneInfo().tzOffset;this.timezone=e,this._useCache=!1,this.setUTCMinutes(this.getUTCMinutes()-this.getTimezoneInfo().tzOffset+t)},removeTimezone:function(){this.timezone=null,this._useCache=!1},valueOf:function(){return this.getTime()},clone:function(){return this.timezone?new timezoneJS.Date(this.getTime(),this.timezone):new timezoneJS.
Date(this.getTime())},toGMTString:function(){return this.toString("EEE, dd MMM yyyy HH:mm:ss Z","Etc/GMT")},toLocaleString:function(){},toLocaleDateString:function(){},toLocaleTimeString:function(){},toSource:function(){},toISOString:function(){return this.toString("yyyy-MM-ddTHH:mm:ss.SSS","Etc/UTC")+"Z"},toJSON:function(){return this.toISOString()},toString:function(e,t){e||(e="yyyy-MM-dd HH:mm:ss");var n=e,r=t?timezoneJS.timezone.getTzInfo(this.getTime(),t):this.getTimezoneInfo(),i=this;t&&(i=this.clone(),i.setTimezone(t));var s=i.getHours();return n.replace(/a+/g,function(){return"k"}).replace(/y+/g,function(e){return _fixWidth(i.getFullYear(),e.length)}).replace(/d+/g,function(e){return _fixWidth(i.getDate(),e.length)}).replace(/m+/g,function(e){return _fixWidth(i.getMinutes(),e.length)}).replace(/s+/g,function(e){return _fixWidth(i.getSeconds(),e.length)}).replace(/S+/g,function(e){return _fixWidth(i.getMilliseconds(),e.length)}).replace(/M+/g,function(e){var t=i.getMonth(),n=e.length
;return n>3?timezoneJS.Months[t]:n>2?timezoneJS.Months[t].substring(0,n):_fixWidth(t+1,n)}).replace(/k+/g,function(){return s>=12?(s>12&&(s-=12),"PM"):"AM"}).replace(/H+/g,function(e){return _fixWidth(s,e.length)}).replace(/E+/g,function(e){return DAYS[i.getDay()].substring(0,e.length)}).replace(/Z+/gi,function(){return r.tzAbbr})},toUTCString:function(){return this.toGMTString()},civilToJulianDayNumber:function(e,t,n){var r;t++,t>12&&(r=parseInt(t/12,10),t%=12,e+=r),t<=2&&(e-=1,t+=12),r=Math.floor(e/100);var i=2-r+Math.floor(r/4),s=Math.floor(365.25*(e+4716))+Math.floor(30.6001*(t+1))+n+i-1524;return s},getLocalOffset:function(){return this._dateProxy.getTimezoneOffset()}},timezoneJS.timezone=new function(){function invalidTZError(e){throw new Error('Timezone "'+e+'" is either incorrect, or not loaded in the timezone registry.')}function builtInLoadZoneFile(e,t){var n=_this.zoneFileBasePath+"/"+e;return!t||!t.async?_this.parseZones(_this.transport({url:n,async:!1})):_this.transport({async
:!0,url:n,success:function(e){return _this.parseZones(e)&&typeof t.callback=="function"&&t.callback(),!0},error:function(){throw new Error('Error retrieving "'+n+'" zoneinfo files')}})}function getRegionForTimezone(e){var t=regionExceptions[e],n,r;if(t)return t;n=e.split("/")[0],r=regionMap[n];if(r)return r;var i=_this.zones[e];if(typeof i=="string")return getRegionForTimezone(i);if(!_this.loadedZones.backward)return _this.loadZoneFile("backward"),getRegionForTimezone(e);invalidTZError(e)}function parseTimeString(e){var t=/(\d+)(?::0*(\d*))?(?::0*(\d*))?([wsugz])?$/,n=e.match(t);return n[1]=parseInt(n[1],10),n[2]=n[2]?parseInt(n[2],10):0,n[3]=n[3]?parseInt(n[3],10):0,n}function processZone(e){if(!e[3])return;var t=parseInt(e[3],10),n=11,r=31;e[4]&&(n=SHORT_MONTHS[e[4].substr(0,3)],r=parseInt(e[5],10)||1);var i=e[6]?e[6]:"00:00:00",s=parseTimeString(i);return[t,n,r,s[1],s[2],s[3]]}function getZone(e,t){var n=typeof e=="number"?e:(new Date(e)).getTime(),r=t,i=_this.zones[r];while(typeof i=="string"
)r=i,i=_this.zones[r];if(!i){if(!_this.loadedZones.backward)return _this.loadZoneFile("backward"),getZone(e,t);invalidTZError(r)}if(i.length===0)throw new Error('No Zone found for "'+t+'" on '+e);for(var s=i.length-1;s>=0;s--){var o=i[s];if(o[3]&&n>o[3])break}return i[s+1]}function getBasicOffset(e){var t=parseTimeString(e),n=e.charAt(0)==="-"?-1:1;return t=n*((t[1]*60+t[2])*60+t[3])*1e3,t/60/1e3}function getRule(e,t,n){var r=typeof e=="number"?new Date(e):e,i=t[1],s=t[0],o=i.match(/^([0-9]):([0-9][0-9])$/);if(o)return[-1e6,"max","-","Jan",1,parseTimeString("0:00"),parseInt(o[1])*60+parseInt(o[2]),"-"];var u=function(e,t,n){var r=0;if(t==="u"||t==="g"||t==="z")r=0;else if(t==="s")r=s;else{if(t!=="w"&&!!t)throw"unknown type "+t;r=getAdjustedOffset(s,n)}return r*=6e4,new Date(e.getTime()+r)},a=function(e,t){var n=e[0],r=e[1],i=r[5],s;EXACT_DATE_TIME[n]||(EXACT_DATE_TIME[n]={});if(EXACT_DATE_TIME[n][r])s=EXACT_DATE_TIME[n][r];else{if(!isNaN(r[4]))s=new Date(Date.UTC(n,SHORT_MONTHS[r[3]],r[4
],i[1],i[2],i[3],0));else{var o,a;r[4].substr(0,4)==="last"?(s=new Date(Date.UTC(n,SHORT_MONTHS[r[3]]+1,1,i[1]-24,i[2],i[3],0)),o=SHORT_DAYS[r[4].substr(4,3)],a="<="):(s=new Date(Date.UTC(n,SHORT_MONTHS[r[3]],r[4].substr(5),i[1],i[2],i[3],0)),o=SHORT_DAYS[r[4].substr(0,3)],a=r[4].substr(3,2));var f=s.getUTCDay();a===">="?s.setUTCDate(s.getUTCDate()+(o-f+(o<f?7:0))):s.setUTCDate(s.getUTCDate()+(o-f-(o>f?7:0)))}EXACT_DATE_TIME[n][r]=s}return t&&(s=u(s,i[4],t)),s},f=function(e,t){var n=[];for(var r=0;t&&r<t.length;r++)t[r][0]<=e&&(t[r][1]>=e||t[r][0]===e&&t[r][1]==="only"||t[r][1]==="max")&&n.push([e,t[r]]);return n},l=function(e,t,r){var i,s;return e.constructor!==Date?(i=e[0],s=e[1],e=!r&&EXACT_DATE_TIME[i]&&EXACT_DATE_TIME[i][s]?EXACT_DATE_TIME[i][s]:a(e,r)):r&&(e=u(e,n?"u":"w",r)),t.constructor!==Date?(i=t[0],s=t[1],t=!r&&EXACT_DATE_TIME[i]&&EXACT_DATE_TIME[i][s]?EXACT_DATE_TIME[i][s]:a(t,r)):r&&(t=u(t,n?"u":"w",r)),e=Number(e),t=Number(t),e-t},c=r.getUTCFullYear(),h;h=f(c,_this.rules[
i]),h.push(r),h.sort(l),_arrIndexOf.call(h,r)<2&&(h=h.concat(f(c-1,_this.rules[i])),h.sort(l));var p=_arrIndexOf.call(h,r);return p>1&&l(r,h[p-1],h[p-2][1])<0?h[p-2][1]:p>0&&p<h.length-1&&l(r,h[p+1],h[p-1][1])>0?h[p+1][1]:p===0?null:h[p-1][1]}function getAdjustedOffset(e,t){return-Math.ceil(t[6]-e)}function getAbbreviation(e,t){var n,r=e[2];if(r.indexOf("%s")>-1){var i;t?i=t[7]==="-"?"":t[7]:i="S",n=r.replace("%s",i)}else r.indexOf("/")>-1?n=r.split("/",2)[t[6]?1:0]:n=r;return n}var _this=this,regionMap={Etc:"etcetera",EST:"northamerica",MST:"northamerica",HST:"northamerica",EST5EDT:"northamerica",CST6CDT:"northamerica",MST7MDT:"northamerica",PST8PDT:"northamerica",America:"northamerica",Pacific:"australasia",Atlantic:"europe",Africa:"africa",Indian:"africa",Antarctica:"antarctica",Asia:"asia",Australia:"australasia",Europe:"europe",WET:"europe",CET:"europe",MET:"europe",EET:"europe"},regionExceptions={"Pacific/Honolulu":"northamerica","Atlantic/Bermuda":"northamerica","Atlantic/Cape_Verde"
:"africa","Atlantic/St_Helena":"africa","Indian/Kerguelen":"antarctica","Indian/Chagos":"asia","Indian/Maldives":"asia","Indian/Christmas":"australasia","Indian/Cocos":"australasia","America/Danmarkshavn":"europe","America/Scoresbysund":"europe","America/Godthab":"europe","America/Thule":"europe","Asia/Yekaterinburg":"europe","Asia/Omsk":"europe","Asia/Novosibirsk":"europe","Asia/Krasnoyarsk":"europe","Asia/Irkutsk":"europe","Asia/Yakutsk":"europe","Asia/Vladivostok":"europe","Asia/Sakhalin":"europe","Asia/Magadan":"europe","Asia/Kamchatka":"europe","Asia/Anadyr":"europe","Africa/Ceuta":"europe","America/Argentina/Buenos_Aires":"southamerica","America/Argentina/Cordoba":"southamerica","America/Argentina/Tucuman":"southamerica","America/Argentina/La_Rioja":"southamerica","America/Argentina/San_Juan":"southamerica","America/Argentina/Jujuy":"southamerica","America/Argentina/Catamarca":"southamerica","America/Argentina/Mendoza":"southamerica","America/Argentina/Rio_Gallegos":"southamerica"
,"America/Argentina/Ushuaia":"southamerica","America/Aruba":"southamerica","America/La_Paz":"southamerica","America/Noronha":"southamerica","America/Belem":"southamerica","America/Fortaleza":"southamerica","America/Recife":"southamerica","America/Araguaina":"southamerica","America/Maceio":"southamerica","America/Bahia":"southamerica","America/Sao_Paulo":"southamerica","America/Campo_Grande":"southamerica","America/Cuiaba":"southamerica","America/Porto_Velho":"southamerica","America/Boa_Vista":"southamerica","America/Manaus":"southamerica","America/Eirunepe":"southamerica","America/Rio_Branco":"southamerica","America/Santiago":"southamerica","Pacific/Easter":"southamerica","America/Bogota":"southamerica","America/Curacao":"southamerica","America/Guayaquil":"southamerica","Pacific/Galapagos":"southamerica","Atlantic/Stanley":"southamerica","America/Cayenne":"southamerica","America/Guyana":"southamerica","America/Asuncion":"southamerica","America/Lima":"southamerica","Atlantic/South_Georgia"
:"southamerica","America/Paramaribo":"southamerica","America/Port_of_Spain":"southamerica","America/Montevideo":"southamerica","America/Caracas":"southamerica"};this.zoneFileBasePath=null,this.zoneFiles=["africa","antarctica","asia","australasia","backward","etcetera","europe","northamerica","pacificnew","southamerica"],this.loadingSchemes={PRELOAD_ALL:"preloadAll",LAZY_LOAD:"lazyLoad",MANUAL_LOAD:"manualLoad"},this.loadingScheme=this.loadingSchemes.LAZY_LOAD,this.loadedZones={},this.zones={},this.rules={},this.init=function(e){var t={async:!0},n=this.loadingScheme===this.loadingSchemes.PRELOAD_ALL?this.zoneFiles:this.defaultZoneFile||"northamerica",r=0,i;for(var s in e)t[s]=e[s];if(typeof n=="string")return this.loadZoneFile(n,t);i=t.callback,t.callback=function(){r++,r===n.length&&typeof i=="function"&&i()};for(var o=0;o<n.length;o++)this.loadZoneFile(n[o],t)},this.loadZoneFile=function(e,t){if(typeof this.zoneFileBasePath=="undefined")throw new Error("Please define a base path to your zone file directory -- timezoneJS.timezone.zoneFileBasePath."
);if(this.loadedZones[e])return;return this.loadedZones[e]=!0,builtInLoadZoneFile(e,t)},this.loadZoneJSONData=function(url,sync){var processData=function(data){data=eval("("+data+")");for(var z in data.zones)_this.zones[z]=data.zones[z];for(var r in data.rules)_this.rules[r]=data.rules[r]};return sync?processData(_this.transport({url:url,async:!1})):_this.transport({url:url,success:processData})},this.loadZoneDataFromObject=function(e){if(!e)return;for(var t in e.zones)_this.zones[t]=e.zones[t];for(var n in e.rules)_this.rules[n]=e.rules[n]},this.getAllZones=function(){var e=[];for(var t in this.zones)e.push(t);return e.sort()},this.parseZones=function(e){var t=e.split("\n"),n=[],r="",i,s=null,o=null;for(var u=0;u<t.length;u++){i=t[u],i.match(/^\s/)&&(i="Zone "+s+i),i=i.split("#")[0];if(i.length>3){n=i.split(/\s+/),r=n.shift();switch(r){case"Zone":s=n.shift(),_this.zones[s]||(_this.zones[s]=[]);if(n.length<3)break;n.splice(3,n.length,processZone(n)),n[3]&&(n[3]=Date.UTC.apply(null,n[3])
),n[0]=-getBasicOffset(n[0]),_this.zones[s].push(n);break;case"Rule":o=n.shift(),_this.rules[o]||(_this.rules[o]=[]),n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||n[1],n[5]=parseTimeString(n[5]),n[6]=getBasicOffset(n[6]),_this.rules[o].push(n);break;case"Link":if(_this.zones[n[1]])throw new Error("Error with Link "+n[1]+". Cannot create link of a preexisted zone.");_this.zones[n[1]]=n[0]}}}return!0},this.transport=_transport,this.getTzInfo=function(e,t,n){if(this.loadingScheme===this.loadingSchemes.LAZY_LOAD){var r=getRegionForTimezone(t);if(!r)throw new Error("Not a valid timezone ID.");this.loadedZones[r]||this.loadZoneFile(r)}var i=getZone(e,t),s=i[0],o=getRule(e,i,n);o&&(s=getAdjustedOffset(s,o));var u=getAbbreviation(i,o);return{tzOffset:s,tzAbbr:u}}}}).call(this);