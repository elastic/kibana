define("panels/timepicker/module",["angular","app","underscore","moment","kbn"],function(e,t,n,r,i){var s=e.module("kibana.panels.timepicker",[]);t.useModule(s),s.controller("timepicker",["$scope","$rootScope","$timeout","timer","$http","dashboard","filterSrv",function(e,t,s,o,u,a,f){function h(t){return t.type="time",f.removeByType("time"),e.panel.filter_id=f.set(p(t)),e.panel.filter_id}function p(e){return e=n.clone(e),e.from=e.from.toDate(),e.to=e.to.toDate(),e}function d(t,n){e.timepicker={from:{time:t.format("HH:mm:ss"),date:t.format("MM/DD/YYYY")},to:{time:n.format("HH:mm:ss"),date:n.format("MM/DD/YYYY")}}}e.panelMeta={status:"Stable",description:"A panel for controlling the time range filters. If you have time based data,  or if you're using time stamped indices, you need one of these"};var l={status:"Stable",mode:"relative",time_options:["5m","15m","1h","6h","12h","24h","2d","7d","30d"],timespan:"15m",timefield:"@timestamp",timeformat:"",refresh:{enable:!1,interval:30,min:3}};n.
defaults(e.panel,l),e.init=function(){e.refresh_interval=e.panel.refresh.interval,e.filterSrv=f;switch(e.panel.mode){case"absolute":e.time={from:r(e.panel.time.from,"MM/DD/YYYY HH:mm:ss")||r(i.time_ago(e.panel.timespan)),to:r(e.panel.time.to,"MM/DD/YYYY HH:mm:ss")||r()};break;case"since":e.time={from:r(e.panel.time.from,"MM/DD/YYYY HH:mm:ss")||r(i.time_ago(e.panel.timespan)),to:r()};break;case"relative":e.time={from:r(i.time_ago(e.panel.timespan)),to:r()}}e.time.field=e.panel.timefield,d(e.time.from,e.time.to),c(),e.panel.mode!=="absolute"&&h(e.time),a.refresh(),e.panel.refresh.enable&&e.set_interval(e.panel.refresh.interval),e.$on("refresh",function(){if(f.idsByType("time").length>0){var t=f.timeRange("min");if(e.time.from.diff(r.utc(t.from),"seconds")!==0||e.time.to.diff(r.utc(t.to),"seconds")!==0)e.set_mode("absolute"),d(r(t.from),r(t.to)),e.time=e.time_calc(),c()}})},e.set_interval=function(t){e.panel.refresh.interval=t;if(n.isNumber(e.panel.refresh.interval)){if(e.panel.refresh.interval<
e.panel.refresh.min){e.panel.refresh.interval=e.panel.refresh.min,o.cancel(e.refresh_timer);return}o.cancel(e.refresh_timer),e.refresh()}else o.cancel(e.refresh_timer)},e.refresh=function(){e.panel.refresh.enable?(o.cancel(e.refresh_timer),e.refresh_timer=o.register(s(function(){e.refresh(),e.time_apply()},e.panel.refresh.interval*1e3))):o.cancel(e.refresh_timer)};var c=function(){e.panel.mode!=="relative"?e.panel.time={from:e.time.from.format("MM/DD/YYYY HH:mm:ss"),to:e.time.to.format("MM/DD/YYYY HH:mm:ss")}:delete e.panel.time};e.set_mode=function(t){e.panel.mode=t,e.panel.refresh.enable=t==="absolute"?!1:e.panel.refresh.enable,c()},e.to_now=function(){e.timepicker.to={time:r().format("HH:mm:ss"),date:r().format("MM/DD/YYYY")}},e.set_timespan=function(t){e.panel.timespan=t,e.timepicker.from={time:r(i.time_ago(t)).format("HH:mm:ss"),date:r(i.time_ago(t)).format("MM/DD/YYYY")},e.time_apply()},e.close_edit=function(){e.time_apply()},e.time_calc=function(){var t,o;return n.isUndefined(e.timepicker
)?(t=e.panel.mode==="relative"?r(i.time_ago(e.panel.timespan)):e.time.from,o=e.panel.mode!=="absolute"?r():e.time.to):(t=e.panel.mode==="relative"?r(i.time_ago(e.panel.timespan)):r(r(e.timepicker.from.date).format("MM/DD/YYYY")+" "+e.timepicker.from.time,"MM/DD/YYYY HH:mm:ss"),o=e.panel.mode!=="absolute"?r():r(r(e.timepicker.to.date).format("MM/DD/YYYY")+" "+e.timepicker.to.time,"MM/DD/YYYY HH:mm:ss")),t.valueOf()>=o.valueOf()&&(t=r(o.valueOf()-1e3)),s(function(){d(t,o)}),{from:t,to:o}},e.time_apply=function(){e.panel.error="",f.removeByType("time"),e.time=e.time_calc(),e.time.field=e.panel.timefield,c(),h(e.time),a.refresh()},e.$watch("panel.mode",e.time_apply)}])});