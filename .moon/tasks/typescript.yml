$schema: https://moonrepo.dev/schemas/project.json

fileGroups:
  sharedGlobals: [ ]
  default:
    - '**/*'
  production: [ ]
  src:
    - 'src/**/*'

tasks:
  eslint_with_types:
    command: node
    args:
      - scripts/eslint_with_types.js
      - '--project'
      - '$projectSource/tsconfig.json'
    env:
      NODE_OPTIONS: '--max-old-space-size=8192'
    options:
      runFromWorkspaceRoot: true

  genTypecheckConfig:
    script: "node scripts/type_check.js --project $projectSource/tsconfig.json --config-only"
    inputs:
      - "tsconfig.json"
    outputs:
      - "tsconfig.moon.json"
    options:
      runFromWorkspaceRoot: true

  typecheck:
    command:
      - 'tsc'
      - '--build'
      - '$projectSource/tsconfig.moon.json'
      - '--pretty'
    inputs:
      - '@group(src)'
      - 'tsconfig.json'
      - 'tsconfig.*.json'
    outputs:
      - 'target'
    deps:
      - 'kibana:generateAllTypecheckConfigs'
      - '^:typecheck'
    options:
      runFromWorkspaceRoot: true
      mergeOutputs: replace
    env:
      NODE_OPTIONS: '--max-old-space-size=8192'
