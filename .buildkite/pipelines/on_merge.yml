env:
  REPORT_FAILED_TESTS_TO_GITHUB: 'false'
steps:
  - command: .buildkite/scripts/lifecycle/pre_build.sh
    label: Pre-Build
    timeout_in_minutes: 10
    agents:
      queue: kibana-default
    retry:
      automatic:
        - exit_status: '*'
          limit: 1

  - wait

  - command: .buildkite/scripts/steps/test/jest.sh
    label: 'Jest Tests'
    parallelism: 16
    agents:
      queue: n2-4-spot
    timeout_in_minutes: 90
    key: jest
    retry:
      automatic:
        - exit_status: '-1'
          limit: 3

  - wait: ~
    continue_on_failure: true

  - command: .buildkite/scripts/lifecycle/post_build.sh
    label: Post-Build
    timeout_in_minutes: 10
    agents:
      queue: kibana-default
