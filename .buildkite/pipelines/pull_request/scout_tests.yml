steps:
  - command: .buildkite/scripts/steps/test/scout_test_run_builder.sh
    label: 'Scout Test Run Builder'
    agents:
      machineType: n2d-standard-4
      preemptible: true
      spotZones: us-central1-f,us-central1-a,us-central1-b,us-central1-c
    key: build_scout_tests
    timeout_in_minutes: 15
    depends_on:
      - build
      - quick_checks
      - checks
      - linting
      - linting_with_types
      - check_types
      - check_oas_snapshot
    env:
      SCOUT_CONFIGS_SCRIPT: '.buildkite/scripts/steps/test/scout_configs.sh'
    retry:
      automatic:
        - exit_status: '*'
          limit: 1
