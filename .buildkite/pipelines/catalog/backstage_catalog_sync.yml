# ==============================================================
# Backstage Catalog Sync Pipeline
# ==============================================================
# Pipeline: Generate Backstage entries for Kibana packages in elastic/kibana-package-catalog
# Description: Scans Kibana packages and generates Backstage component YAMLs in kibana-package-catalog repo.
# Trigger: when PR merged to main branch
# ==============================================================
#

steps:
  - label: ':gear: Generate catalog components from Kibana packages'
    key: generate_components
    commands:
      - .buildkite/pipelines/catalog/generate_backstage_catalog.sh
    soft_fail: true # Allowed to fail
    agents:
      image: family/kibana-ubuntu-2404
      imageProject: elastic-images-prod
      provider: gcp
      machineType: n2-standard-4
      preemptible: true
