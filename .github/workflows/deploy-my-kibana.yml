---
##
##   This the automation to let Observability team members to deploy a kibana instance
##   using the Observability test environments.
##   It will deploy a new instance for those who add a comment /oblt-deploy
##   only supported for Elasticians.
##
## Owner: @elastic/observablt-robots
## Further details: https://ela.st/oblt-deploy-my-kibana
##
name: deploy-my-kibana

on:
  issue_comment:
    types:
      - created

jobs:
  deploy-my-kibana:
    if: ${{ github.event.issue.pull_request && github.event.comment.body == '/oblt-deploy'}}
    runs-on: ubuntu-latest
    steps:
      - uses: elastic/apm-pipeline-library/.github/actions/deploy-my-kibana@current
        with:
          event: ${{ github.event }}
          user: ${{ github.triggering_actor }}
          vaultUrl: ${{ secrets.OBLT_VAULT_ADDR }}
          vaultRoleId: ${{ secrets.OBLT_VAULT_ROLE_ID }}
          vaultSecretId: ${{ secrets.OBLT_VAULT_SECRET_ID }}
